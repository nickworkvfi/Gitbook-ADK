<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: ADK-SEC Programmers Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_sec_users_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADK-SEC Programmers Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Preface"></a>
Preface</h1>
<p>This document is for programmers and developers who want to understand and use the ADK Security Service.</p>
<h2><a class="anchor" id="subsec_security_audience"></a>
Audience</h2>
<p>This guide provides all the information required for application developers to integrate and utilize the functionality of the ADK Security Service. In this document, the ADK Security Service is also referred to as ADK-SEC.</p>
<h2><a class="anchor" id="subsec_security_organization"></a>
Organization</h2>
<p>This guide is organized as follows:</p>
<p><a class="el" href="pg_sec_users_guide.html#sec_security_Introduction">Chapter 1, Introduction</a>: Provides a general introduction to ADK-SEC.</p>
<p><a class="el" href="pg_sec_users_guide.html#sec_security_Getting_Started">Chapter 2, Getting Started</a>: Presents an introduction in ADK-SEC usage.</p>
<p><a class="el" href="pg_sec_users_guide.html#sec_security_Programming">Chapter 3, Programming</a>: Supplies ADK-SEC programming information.</p>
<p><a class="el" href="pg_sec_users_guide.html#sec_security_System_Setup">Chapter 4, System Setup and Requirements</a>: Presents environment setup and dependencies.</p>
<p><a class="el" href="pg_sec_users_guide.html#sec_security_Troubleshooting">Chapter 5, Troubleshooting</a>: Gives solutions for possible issues in ADK-SEC.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Json_Config">Appendix A, JSON Schemes, Configuration and Output Examples</a>: Provides JSON Schemes for the configuration and for function outputs as well as a configuration and an output example.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_VSS_Specific_Programming">Appendix B, VSS Specific Programming</a>: Presents special programming and setup for VSS usage.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Reserved_VSS_Macro_and_Example">Appendix C, Reserved VSS Macros and Script Examples</a>: Provides a list of reserved VSS macros and presents VSS scripts as examples.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_PIN_Block_Formats">Appendix D, PIN Block Formats</a>: Lists the supported PIN block formats.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Migration_Guide">Appendix E, Migration Guide</a>: Gives advise for changeover to new ADK-SEC.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Special_Features">Appendix F, Special Features</a>: Describes how to use special features.</p>
<p><a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Acronyms_Definition">Appendix G, Acronyms Definition</a>: Lists and defines various acronyms and terms. <br  />
<br  />
 </p>
<h1><a class="anchor" id="sec_security_Introduction"></a>
Introduction</h1>
<p><br  />
<em>ADK Security Service</em> <br  />
<br  />
The ADK Security Service, or ADK-SEC, covers all functionalities as key update, PIN encryption, MAC generation/verification and data encryption/decryption which are needed to develop a payment application.</p>
<p>With version 2.0 the ADK Security Service was restructured and enhanced to realize the Encryption Governor concept. This concept brings all encryption schemes under one API and makes it easier for applications to use ADK-SEC.</p>
<p>Some key features of ADK-SEC:</p><ul>
<li>Master Session Key, DUKPT and RSA support</li>
<li>Support of various cryptographic systems as VSS, IPP, RSA, ADE</li>
<li>PIN encryption</li>
<li>MAC generation and verification</li>
<li>Data encryption and decryption</li>
<li>Key update outside a secure room</li>
<li>Multiple configurations based on hosts</li>
</ul>
<p>ADK-SEC is to be used in conjunction with user applications and services (e.g.: DirectGUI). It resides on the terminal as a separate task that can be installed, configured and maintained independently from the main payment application.</p>
<p>ADK-SEC communicates with a controlling application via an internal messaging system (IPC) and is isolated from the controlling application. To relieve the application developer from the IPC communication a function API (ADK-SEC-API) is provided. <br  />
This API is mandatory if an application developer will use ADK-SEC.</p>
<p>The following illustration shows the command flow for ADK-SEC.</p>
<div class="image">
<img src="01_ADK_SEC_Command_Flow.png" alt=""/>
<div class="caption">
ADK-SEC Command Flow</div></div>
 <p><br  />
<br  />
</p>
<h2><a class="anchor" id="sec_concepts"></a>
Concepts</h2>
<p>ADK-SEC is a self-contained component that interacts with some of the key services that makes up a typical ADK-based solution.</p>
<p>ADK-SEC is based on the following concepts:</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Security_Modules">Security Modules</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Security_Schemes">Security Schemes</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Multiple_Host_Support">Multiple Host Support</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Generic_Function_API">Generic Function API</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Configurable_API">Configurable API</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Transaction_Data">Transaction Data</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Key_Management">Key Management</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_VSS">VSS Script Based Security Engines</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Flexible_Key_Addressing">Flexible Key Addressing</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Flexible_Macro_Selection_in_vss">Flexible Macro Selection in VSS Scripts</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_PIN_Handling">PIN Handling</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Multiple_App_Support">Multiple Application Support</a></li>
</ul>
<h3><a class="anchor" id="subsubsec_security_Security_Modules"></a>
Security Modules</h3>
<p>ADK-SEC provides the concept of abstract modules which are implementations of cryptographic systems. Following Security Modules are currently supported by ADK-SEC:</p><ul>
<li><a class="el" href="group___config.html#VSS">VSS</a></li>
<li><a class="el" href="group___config.html#IPP">IPP</a> (IPPmsk and IPPdukpt)</li>
<li><a class="el" href="group___config.html#RSA">RSA</a></li>
<li><a class="el" href="group___config.html#SRED">SRED</a></li>
<li><a class="el" href="group___config.html#ADE">ADE</a></li>
<li><a class="el" href="group___config.html#VisaDSP">VisaDSP</a></li>
<li><a class="el" href="group___config.html#CryptoRW">CryptoRW</a></li>
<li><a class="el" href="group___config.html#AES">AES</a></li>
</ul>
<p>Descriptions (relevant API functions, configuration characteristics and examples, JSON-formatted outputs of API functions) can be found in <a class="el" href="group___config.html#VSS">VSS</a>, <a class="el" href="group___config.html#IPP">IPP</a>, <a class="el" href="group___config.html#RSA">RSA</a>, <a class="el" href="group___config.html#SRED">SRED</a>, <a class="el" href="group___config.html#ADE">ADE</a>, <a class="el" href="group___config.html#VisaDSP">VisaDSP</a>, <a class="el" href="group___config.html#CryptoRW">CryptoRW</a>, <a class="el" href="group___config.html#AES">AES</a>. <br  />
<br  />
Hint: A list of available Security Modules can be obtained by the API function <a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a> <br  />
</p>
<h3><a class="anchor" id="subsubsec_security_Security_Schemes"></a>
Security Schemes</h3>
<p>A Security Scheme includes mandatory and optional settings (i.e. script name, PIN block format, ...) for cryptographically schemes like VSS-MSK encryption, IPP-DUKPT encryption, ... . <br  />
A Security Scheme has to be defined in the ADK-SEC configuration (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>). <br  />
 </p>
<h3><a class="anchor" id="subsubsec_security_Multiple_Host_Support"></a>
Multiple Host Support</h3>
<p>A Host defines the individual and selectable security area for an application and is based on a Security Scheme and a Security Module. <br  />
A Host has to be set up in the ADK-SEC configuration and is identified by an unique string - the Hostname. The Hostname has to be used by applications to open the related Host (see <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a>). <br  />
ADK-SEC supports multiple Host configuration and usage. <br  />
<br  />
Examples for how to set up Security Schemes and Hosts can be found in <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>. <br  />
<br  />
<em>Special handling for External/Local SDI clients:</em> <br  />
 most crypto operations are restricted for applications connecting from the outside world. Projects, which want to use the ADK-SEC crypto interface via SDI remote connections, can “unlock” this restriction using <b><em>“UntrustedAllowed”</em></b> flag in host configuration. This must be done separately for each host configuration. All other host configurations which do not have this setting flag stays restricted for crypto operation. <br  />
An example of ADK-SEC host configuration (sccfg.json) for outside usage: <br  />
</p><div class="fragment"><div class="line">{</div>
<div class="line">  <span class="stringliteral">&quot;adksecconfig&quot;</span>: {</div>
<div class="line">    <span class="stringliteral">&quot;hosts&quot;</span>:</div>
<div class="line">    [</div>
<div class="line">      {</div>
<div class="line">        <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;ADE-DUKPT&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;this is ADE DUKPT configuration&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;module&quot;</span>: <span class="stringliteral">&quot;ADE&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;scheme&quot;</span>: <span class="stringliteral">&quot;schemeADE&quot;</span></div>
<div class="line">      }</div>
<div class="line">    ],</div>
<div class="line">    <span class="stringliteral">&quot;serviceCfg&quot;</span>:</div>
<div class="line">    {</div>
<div class="line">      <span class="stringliteral">&quot;secSchemes&quot;</span>:</div>
<div class="line">      [</div>
<div class="line">        {</div>
<div class="line">          <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;schemeADE&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;settings&quot;</span>: {</div>
<div class="line">            <span class="stringliteral">&quot;UntrustedAllowed&quot;</span>: <span class="keyword">true</span>,</div>
<div class="line">            <span class="stringliteral">&quot;padding&quot;</span>: <span class="stringliteral">&quot;PKCS7&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;KeyManagementType&quot;</span>: <span class="stringliteral">&quot;DUKPT&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;KeyAddressTable&quot;</span>: [</div>
<div class="line">              {<span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 &quot;</span>},</div>
<div class="line">              {<span class="stringliteral">&quot;encryptData&quot;</span>: [<span class="stringliteral">&quot;0&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;4&quot;</span>, <span class="stringliteral">&quot;5&quot;</span>, <span class="stringliteral">&quot;6&quot;</span>, <span class="stringliteral">&quot;7&quot;</span>, <span class="stringliteral">&quot;8&quot;</span>, <span class="stringliteral">&quot;9&quot;</span>]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Please note that it is the responsibility of these projects that unlocked ADKSEC functions are not misused.</b></p>
<h3><a class="anchor" id="subsubsec_security_Generic_Function_API"></a>
Generic Function API</h3>
<p>ADK-SEC provides a set of generic API functions which can be used by payment applications to handle cryptographic operations. <br  />
The functions and their interfaces are common for all Security Schemes. Their modes of operation depend on the opened Host. <br  />
For the Generic Function API see <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>.</p>
<h3><a class="anchor" id="subsubsec_security_Configurable_API"></a>
Configurable API</h3>
<p>All needed properties to handle cryptographic operations are configured in a JSON formatted file per host (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>).</p>
<h3><a class="anchor" id="subsubsec_security_Transaction_Data"></a>
Transaction Data</h3>
<p>Sometimes security operations need or deliver special data than can not be provided by input and output parameters of API functions. Therefore ADK-SEC allocates a Transaction Data container which allows multiple data transfer. The container can also hold data during a payment transaction.</p>
<p>Transaction Data may contain</p><ul>
<li>Hostname</li>
<li>Card Data (PAN, track data, ...)</li>
<li>PAN expiry</li>
<li>Encryption parameters</li>
<li>Data stored or used by modules</li>
</ul>
<p>Each data is assigned to a predefined or freely chosen tag index which holds a permission attribute for read/write access and for private or public usage (data hiding). <br  />
 The following API functions manage Transaction Data:</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ac31ab997e8dc434d72e427a5d841186a">secClearTransactionData()</a></li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a></li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a85ada2e35c1d1cbf60c05454b88b4b44">secGetTransactionValue()</a></li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#af127868b6268758596f8a2a1ca0aaab3">secGetPermission()</a></li>
</ul>
<h3><a class="anchor" id="subsubsec_security_Key_Management"></a>
Key Management</h3>
<p>Verifone payment terminals have installed the Verifone generated basic system key KLK (Key Loading Key). <br  />
For VSS key management scheme the KLK protects VSS scripts updates with security memory content preservation and may control loading of subsequent keys. <br  />
Each POS provider uses his own Key Management Scheme and provides proprietary keys to be maintained in terminal (acquirer keys). <br  />
<br  />
Note that Manufacturer Key Loading and loading of basic acquirer keys is not the task of ADK-SEC. <br  />
Nevertheless ADK-SEC provides the API function <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> to load various keys used by diverse Security Modules.</p>
<h3><a class="anchor" id="subsubsec_security_VSS"></a>
VSS Script Based Security Engines</h3>
<p>ADK-SEC employs the concept of different Security respective VSS Engines implemented via VeriShield Security Scripts (VSS). Each engine is implemented in its own VSS script and initialized at the start of the application.</p>
<p>Application developers responsibility is to provide appropriate VSS scripts.</p>
<h3><a class="anchor" id="subsubsec_security_Flexible_Key_Addressing"></a>
Flexible Key Addressing</h3>
<p>ADK-SEC provides the possibility to use multiple keys or key sets to allow user applications to handle multiple host and multiple merchants systems. <br  />
<br  />
A dedicated key or key set is identified by a number called KeySetId and can be selected by the API function <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a>. <br  />
The KeySetId has different meanings in the VSS module and Non-VSS modules. <br  />
<br  />
 <em>Non VSS modules</em> <br  />
A Key Address Table can be defined in the ADK-SEC configuration file (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>). The table determines which key slots will be accessed by corresponding API functions. <br  />
<br  />
<em>VSS module</em> <br  />
For this consider the concept of <a class="el" href="pg_sec_users_guide.html#subsubsec_security_Flexible_Macro_Selection_in_vss">Flexible Macro Selection in VSS Scripts</a> in the next section.</p>
<h3><a class="anchor" id="subsubsec_security_Flexible_Macro_Selection_in_vss"></a>
Flexible Macro Selection in VSS Scripts</h3>
<p>To achieve more flexibility for project specific requirements on cryptographic operations the concept of Flexible Macro Selection in VSS Scripts is implemented in ADK-SEC. <br  />
The macro selection is based on the KeySetId Table (see <a class="el" href="pg_sec_users_guide.html#subsec_KsITab">Key-Set-ID Table</a>) which includes VSS macro IDs for different Key Types and functional steps. The table is predefined in ADK-SEC and can be updated by the VSS developer.</p>
<h3><a class="anchor" id="subsubsec_security_PIN_Handling"></a>
PIN Handling</h3>
<p>In opposite to former ADK-SEC versions (1.6.x) PIN entry by ADK-SEC is no longer supported. The user application itself has to care for PIN entry while ADK-SEC retrieves the stored PIN and creates the encrypted PIN block. <br  />
<br  />
The application of UI is highly country resp. region specific and depends on domestic specifications and customer requirements. This is why ADK strictly separates business logic from GUI interface. Applications need to have all possible flexibility to realize customer-specific and region-specific applications. <br  />
 An example for a PIN entry implementation which uses ADK-GUI component DirectGUI can be seen in the source code of the Demo Application sub-function requestPIN() (see <a class="el" href="pg_sec_users_guide.html#subsec_use_api_functions">Use the API Functions</a>). <br  />
</p>
<h3><a class="anchor" id="subsubsec_security_Multiple_App_Support"></a>
Multiple Application Support</h3>
<p>Multiple Application Support is a feature that provides the ability to use the ADK Security Service by multiple applications resp. multiple instances of an application at the same time.</p>
<div class="image">
<img src="20_ADK_SEC_Multi_App_Concept.png" alt=""/>
<div class="caption">
Multi-app concept</div></div>
 <p>Security Service provides a possibility to be accessed from multiple applications in parallel. Following rules are realized:</p>
<ul>
<li>Multiple start of one service instance per user/group is possible</li>
<li>Two and more user applications can use security service at the same time</li>
<li>User application can connect to security service instance only if running under the same user/group</li>
<li>Each request processing is done in a sequential mode to avoid influences of other application changes</li>
<li>PIN activities are locked for applications that are not running under same user/group of the application that has initiated the activity. Such applications cannot retrieve an entered PIN, <br  />
cancel an activity or restart/initiate a PIN entry.</li>
</ul>
<p>The separation of access rights for VSS scripts installed for different user/group spaces is provided by the OS. <br  />
<br  />
<br  />
<br  />
</p>
<h1><a class="anchor" id="sec_security_Getting_Started"></a>
Getting Started</h1>
<p>This chapter will help you to apply ADK-SEC security operations for your payment application. This will be illustrated by a simple Demo Application. <br  />
<br  />
Following tasks have to be performed:</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#subsec_setup_configuration">Setup the Configuration</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_use_api_functions">Use the API Functions</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_use_build_adksec_packages">Build the Application and Setup a Device</a></li>
</ul>
<p>Following requirements are specified for the Demo Application:</p><ul>
<li>the payment application shall handle card data reading, PIN entry and encryption, data encryption and MAC generation</li>
<li>card data are provided to ADK-SEC but shall be hidden</li>
<li>PIN shall be retrieved and encrypted using PIN Block Format ISO-0</li>
<li>the security scheme shall be VSS based using DUKPT key management scheme</li>
<li>the application shall run on V/OS and V/OS2 devices</li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd>The Demo Application was extended by the functionality 'Visa DSP cardholder encryption'. For details see <a class="el" href="pg_sec_users_guide.html#subsubsec_feature_visa_dsp">Visa DSP with Point-to-Point Encryption</a>.</dd></dl>
<h2><a class="anchor" id="subsec_setup_configuration"></a>
Setup the Configuration</h2>
<p>The Demo Application uses the hosts "01" and "05". The corresponding configuration can be found in the file <code>sccfg</code>.<code>json</code> (see <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>): <br  />
</p><pre class="fragment">{
  "adksecconfig": {
     . . .
    "hosts":
    [
      {
        "name": "01",
        "scheme": "schemeVSSMSK",
        "module": "VSS"
      }, {
        "name": "05",
        "scheme": "schemeIPPDUKPT",
        "module": "IPPdukpt"
      }, {
      . . .  
</pre><p> For detailed information see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>. <br  />
<br  />
The host configuration will be effective by calling <em>secOpen("01", handle)</em> and <em>secOpen("05", handle)</em>.</p>
<h2><a class="anchor" id="subsec_use_api_functions"></a>
Use the API Functions</h2>
<p>By means of the Demo Application <code>DemoApp</code>. <code>cpp</code> it is illustrated how to use the ADK-SEC API functions for various operations in a payment application. <br  />
<br  />
<b><em>Demo Application description</em></b> <br  />
 A functionality description can be found in <a class="el" href="_demo_app_8cpp.html#DemoApplication">DemoApplication</a>. <br  />
<br  />
<b><em>Demo Application implementation</em></b> <br  />
 Following ADK-SEC header files are included in the Demo Application: <br  />
</p><ul>
<li><a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a> (mandatory)</li>
<li><a class="el" href="sec2_8h.html" title="ADK Security Definitions.">sec2.h</a> (already included by <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>)</li>
<li><a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a> (already included by <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>)</li>
<li><a class="el" href="_c_transaction_data_8h.html" title="ADK Security Service Transaction Data.">CTransactionData.h</a> (already included by <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>)</li>
</ul>
<p>Additionally following ADK header files are included: <br  />
</p><ul>
<li><a class="el" href="liblog_8h.html">liblog.h</a> (for ADK-LOG usage)</li>
<li><a class="el" href="gui_8h.html">gui.h</a> (for ADK-GUIPRT usage)</li>
</ul>
<p><br  />
The Demo Application source code is contained in the ADK-SEC delivery package in folder <em>doc/sec/example_2.x/DEMO/src</em>. <br  />
</p>
<h2><a class="anchor" id="subsec_use_build_adksec_packages"></a>
Build the Application and Setup a Device</h2>
<p>A description can be found in <a class="el" href="_demo_app_8cpp.html#DemoApplication">DemoApplication</a>.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_security_Programming"></a>
Programming</h1>
<p>ADK-SEC offers the whole functionality needed by a payment application developers to perform cryptographic operations. <br  />
Therefore ADK-SEC provides a generic API. <br  />
The following sections give an overview of the API header files and functions. <br  />
<br  />
Before using the API the security service has to be configured (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>). <br  />
</p>
<h2><a class="anchor" id="subsec_generic_api"></a>
Generic API</h2>
<h3><a class="anchor" id="subsubsec_header_files"></a>
API Header Files</h3>
<p>The following header files provide the ADK-SEC API:</p>
<ul>
<li><a class="el" href="sec2_8h.html" title="ADK Security Definitions.">sec2.h</a> - - General definitions, 'define' and 'typedef' instructions</li>
<li><a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a> - - Error Codes grouped by ADK-SEC parts where they occur</li>
<li><a class="el" href="_c_transaction_data_8h.html" title="ADK Security Service Transaction Data.">CTransactionData.h</a> - - Public definitions for Transaction Data handling</li>
<li><a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a> - - API function definitions</li>
</ul>
<h3><a class="anchor" id="subsubsec_mandatory_api_functions"></a>
Use the API functions</h3>
<p>To use ADK-SEC in an application implementation the following functions are needed to be called in subsequent order:</p>
<ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> -</li>
<li>sec...() - API functions for application needs</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a34f8a9e3b92467759d0bbdbf7b2dd8c0">secClose()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a644b5479904871433cffef9145c53dad">secDestroy()</a> -</li>
</ul>
<p>If a Security Module is opened a new Transaction Data container is created which can be accessed by the following API functions using the handle returned by <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a>.</p>
<ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ac31ab997e8dc434d72e427a5d841186a">secClearTransactionData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a85ada2e35c1d1cbf60c05454b88b4b44">secGetTransactionValue()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#af127868b6268758596f8a2a1ca0aaab3">secGetPermission()</a> -</li>
</ul>
<p>Following API functions are usable if a Security Module was opened:</p>
<ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a79b00ea8a8aed3b7950800bf136a1944">secGetKeyInventory()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aff0a109c58ef5637c7bf3ffc0722c48d">secGetKeyData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a77860b4cffed3ba159a5c124c8e2cde2">secIncrementKSN()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a9cd679dc9763b06566dff28b3d3268c9">secDecryptData()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a66a1992f617359f2e4a96f4980478f82">secSign()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> -</li>
</ul>
<p>Following API functions are usable independent from an opened Security Module:</p>
<ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a5499423d685ed9deb7ace9c22114adf2">secGetVersions()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a5ea5cbc9daa2ea726212741cd596b294">secGetApiVersion()</a> -</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a029d7e16ab6b044379e9568a6c969afa">secGetSvcVersion()</a> -</li>
</ul>
<p>What happens internally:</p><ul>
<li>serialize input parameters and command type (cmd)</li>
<li>send via IPC</li>
<li>de-serialize command type</li>
<li>use handle to get TransactionData (TD)</li>
<li>use configuration, TD and cmd to get specific module name and configuration for current command</li>
<li>create a module object which will live during executing of this cmd only (forward TD and current configuration to this module)</li>
<li>de-serialize input parameters</li>
<li>call cmd of specific module and forward input parameters to corresponding method</li>
<li>serialize output, send via IPC, de-serialize, return</li>
</ul>
<div class="image">
<img src="processRequest.png" alt=""/>
<div class="caption">
process request</div></div>
 <p><br  />
 A description of Security Modules (functionality, provided API functions, configuration) can be found in <a class="el" href="group___config.html#VSS">VSS</a>, <a class="el" href="group___config.html#IPP">IPP</a>, <a class="el" href="group___config.html#RSA">RSA</a>, <a class="el" href="group___config.html#SRED">SRED</a>, <a class="el" href="group___config.html#ADE">ADE</a>, <a class="el" href="group___config.html#VisaDSP">VisaDSP</a>, <a class="el" href="group___config.html#CryptoRW">CryptoRW</a>, <a class="el" href="group___config.html#AES">AES</a>. <br  />
<br  />
For VSS based Security Modules there is an additional description regarding script and macro handling (see <a class="el" href="pg_sec_users_guide.html#sec_vss_specific_programming">VSS Specific Programming</a> ). <br  />
</p>
<h2><a class="anchor" id="special_features"></a>
Special Features</h2>
<h3><a class="anchor" id="subsubsec_additional_kt"></a>
Additional Key Types</h3>
<p>Detailed description can be found in section <a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a>.</p>
<h3><a class="anchor" id="subsubsec_variable_blocksize"></a>
VSS Variable Block Size</h3>
<p>The feature was implemented to fulfill following requirements:</p><ul>
<li>Encryption or MAC-ing of data which cannot be padded to 8-byte length (e.g. HMAC, padding to 8-byte length is not possible)</li>
<li>Performance improvement on encryption and MAC-ing of big data volumes</li>
</ul>
<p>Detailed description can be found in section <a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a>. <br  />
</p>
<h3><a class="anchor" id="subsubsec_feature_visa_dsp"></a>
Visa DSP with Point-to-Point Encryption</h3>
<p>The service Visa DSP with Point-to-Point Encryption will have two methods to provide PCI point-to-point cardholder data encryption according the requirements of Visa Data Secure Platform (VisaDSP): <br  />
</p><ul>
<li>Standard Point-to-Point Encryption (P2PE)</li>
<li>Format-Preserving Encryption (FPE)</li>
</ul>
<p>Both methods are different, but use a DUKPT key management scheme with the same keys. <br  />
<br  />
Additionally the service provides a PIN block encryption (PIN request handling is not covered by ADK-SEC). <br  />
<br  />
The following features are required by VisaDSP:</p><ul>
<li>the data key variant of the DUKPT key shall be used for data encryption and the PIN key variant for PIN block encryption</li>
<li>the same DUKPT key (same Initial Key and same Key Serial Number) shall be used for both within a transaction: for deriving a data key variant and for deriving a PIN key variant</li>
<li>3DES encryption algorithm shall be used for all encryption operations</li>
<li>P2PE algorithm uses CBC mode with 8-byte blocks</li>
<li>FPE algorithm uses Visa FPE mode</li>
</ul>
<p><br  />
<b><em>VisaDSP in ADK-SEC</em></b> <br  />
<br  />
In ADK-SEC the feature VisaDSP is implemented for platform <b>V/OS2 only</b>. <br  />
<br  />
The data and PIN block encryption with VisaDSP is based on the IPP DUKPT or ADE DUKPT key management scheme, but with one restriction: PIN block encryption is not possible on ADE DUKPT. <br  />
The desired scheme can be selected in the ADK-SEC configuration file.<br  />
The DUKPT initial key and the Initial KSN have to be loaded for the corresponding scheme at first. But be aware that key loading is not the task of ADK-SEC. <br  />
Nevertheless ADK-SEC provides the API function <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> to load an initial DUKPT key and an IKSN (see also <a class="el" href="pg_sec_users_guide.html#subsubsec_security_Key_Management">Key Management</a>). <br  />
<br  />
The ADK-SEC API functions used on P2PE and FPE method are the same. The method is determined by the configuration. <br  />
The key variant selection is handled by ADK-SEC internally. <br  />
<br  />
VisaDSP functionality is provided by the module <code>VisaDSP</code> (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_Security_Modules">Security Modules</a>). <br  />
<br  />
On the P2PE method the data encryption function additionally performs an obfuscation of each cardholder data item based on the plain data (For details on obfuscation please refer to the correspnding documentation for Visa DSP). <br  />
The encryption result is provided the API function <a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a>. An obfuscated data item can be retrieved by API function <a class="el" href="namespacecom__verifone__seccmd.html#a85ada2e35c1d1cbf60c05454b88b4b44">secGetTransactionValue()</a>. <br  />
<br  />
A detailed description can be found in section <a class="el" href="pg_sec_users_guide.html#sec_feature_visa_dsp">Visa DSP</a>. <br  />
<br  />
</p>
<h1><a class="anchor" id="sec_security_System_Setup"></a>
System Setup and Requirements</h1>
<h2><a class="anchor" id="subsec_security_compiler_linker_settings"></a>
Compiler and Linker Settings</h2>
<h2><a class="anchor" id="subsec_security_hardware"></a>
Hardware</h2>
<p>ADK-SEC is running on any V/OS(2) hardware platform, like P400, V200, Mx925, ...</p>
<h2><a class="anchor" id="subsec_security_software"></a>
Software</h2>
<p>ADK-SEC is designed to be platform agnostic and will be supported on V/OS and V/OS2 terminal operating systems. <br  />
<br  />
This section describes</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsubsec_security_Additional_Library_Dependencies">Additional Library Dependencies</a></li>
</ul>
<p>VSS specific setups are described in <a class="el" href="pg_sec_users_guide.html#sec_vss_setup">VSS Setup</a>. <br  />
</p>
<h3><a class="anchor" id="subsubsec_security_adksec_configuration"></a>
ADK-SEC Configuration</h3>
<p>The user has to provide a JSON formatted file where he can specify his individual configuration. <br  />
The default file name is <code>sccfg</code>.<code>json</code> and the default installation path is <code>home/</code> <code>usr</code>. <br  />
<br  />
The configuration file is structured in parts for Security Schemes and Hosts by the following JSON objects: <br  />
</p><ul>
<li>"serviceCfg": Service Configuration:<ul>
<li>"secSchemes": definition of Security Scheme names and parameters (based on Security Modules)</li>
</ul>
</li>
<li>"hosts": Host Configuration - definition of host names (based on Security Schemes)</li>
</ul>
<p>The syntax of the configuration file is determined by the ADK-SEC JSON Schema (<code>adksecconfig_schema</code>. <code>json</code>, see <a class="el" href="pg_sec_users_guide.html#sec_json_config_schema">JSON Schema for Configuration File</a>) which is part of the ADK-SEC delivery. <br  />
 A configuration file should always be evaluated against the ADK-SEC JSON Schema (<code>adksecconfig_schema</code>. <code>json</code>) before the installation. Therefore a free available JSON Schema Validator can be used. <br  />
<br  />
A configuration file example can be found in <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>. <br  />
<br  />
 Examples for Security Module specific configurations can be obtained by <a class="el" href="group___config.html#VSS">VSS</a>, <a class="el" href="group___config.html#IPP">IPP</a>, <a class="el" href="group___config.html#RSA">RSA</a>, <a class="el" href="group___config.html#SRED">SRED</a>, <a class="el" href="group___config.html#ADE">ADE</a>, <a class="el" href="group___config.html#VisaDSP">VisaDSP</a>, <a class="el" href="group___config.html#CryptoRW">CryptoRW</a>, <a class="el" href="group___config.html#AES">AES</a>. <br  />
<br  />
Finally the configuration file has to be loaded in the device. For user individual naming and installation see (<a class="el" href="pg_sec_users_guide.html#subsubsec_security_Installation_Path_Config_Files">Installation Path for Configuration Files</a>).</p>
<p><br  />
</p>
<h3><a class="anchor" id="subsubsec_security_Additional_Library_Dependencies"></a>
Additional Library Dependencies</h3>
<p><em>Additional Libraries for Linking</em> <br  />
 The following additional libraries are used internally by ADK-SEC and need to be linked to the application in order to resolve all unknown symbols.</p>
<p><em>Table: Libraries to be linked</em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Library </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libvfiipc.so </td><td class="markdownTableBodyNone">ADK IPC shared library  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">liblog.so </td><td class="markdownTableBodyNone">ADK LOGGING shared library  </td></tr>
</table>
<p><br  />
<em>Libraries on the Device</em> <br  />
The following additional libraries must be available to run the ADK security component (see <a class="el" href="pg_sec_users_guide.html#subsub_adksec_binary_deliveries">ADK-SEC Binary Deliveries</a>).</p>
<p><em>Table: Libraries on device</em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Library </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Package  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libvfiguiprt.so </td><td class="markdownTableBodyNone">ADK GUI/Printer shared library </td><td class="markdownTableBodyNone">dl.libvfiguiprt-*.tar  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">libvfiipc.so </td><td class="markdownTableBodyNone">ADK IPC class library </td><td class="markdownTableBodyNone">dl.libvfiipc-*.tar  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">liblog.so </td><td class="markdownTableBodyNone">ADK LOGGING shared library </td><td class="markdownTableBodyNone">dl.liblog-*.tar  </td></tr>
</table>
<p>In this case the shared libraries <code>libvfiipc.so</code> and <code>libvfiguiprt.so</code> have to be available (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_SEC_API_Library_and_Header_Files">ADK-SEC API Library and Header Files</a>). <br  />
For supporting logging by ADK-LOG the daemon <code>syslog.out</code> has to be loaded in the device (<code>dl.syslog-*\</code> c.zip).</p>
<h2><a class="anchor" id="subsec_security_deliverables"></a>
Deliverables and Deployment</h2>
<p>Additionally to ADK-SEC binary the installation of relevant platform packages is necessary. <br  />
</p>
<h3><a class="anchor" id="subsub_adksec_binary_deliveries"></a>
ADK-SEC Binary Deliveries</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File </th><th class="markdownTableHeadNone">Purpose  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">scapp2 </td><td class="markdownTableBodyNone">ADK-SEC  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">libsec2.so </td><td class="markdownTableBodyNone">ADK-SEC shared API library  </td></tr>
</table>
<p><br  />
</p>
<h3><a class="anchor" id="subsubsec_security_SEC_API_Library_and_Header_Files"></a>
ADK-SEC API Library and Header Files</h3>
<p>Following shared library has to be linked to applications: <br  />
</p><ul>
<li><code>libsec2</code>. <code>so</code> (Security API)</li>
</ul>
<p><br  />
ADK-SEC API provides the following header files: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File </th><th class="markdownTableHeadNone">Purpose  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a> </td><td class="markdownTableBodyNone">exported functions  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sec2_8h.html" title="ADK Security Definitions.">sec2.h</a> </td><td class="markdownTableBodyNone">exported preprocessor and data definitions  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a> </td><td class="markdownTableBodyNone">exported error codes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_c_transaction_data_8h.html" title="ADK Security Service Transaction Data.">CTransactionData.h</a> </td><td class="markdownTableBodyNone">exported class for Transaction Data handling  </td></tr>
</table>
<p><br  />
</p>
<h3><a class="anchor" id="subsubsec_security_Installation_Path_Config_Files"></a>
Installation Path for Configuration Files</h3>
<p>ADK-SEC provides several possibilities to set up the path where a configuration file can be installed and found. <br  />
<br  />
The default path for the configuration file is the "home" directory, on V/OS(2) this is the user home directory.</p>
<p>Another option is to define a sub-path of the "home" directory of absolute path to config file. The (sub-)path can be determined by the environment variable SCAPPCFG. This can contain only path to config file. In this case default file name sccfg.json will be used.<br  />
If the security service should be started implicitly the environment variable must be provided by user application package.<br  />
<br  />
 Examples:</p><ul>
<li>Add <code>SCAPPCFG=flash/myconfig.json</code> to environment file (Please refer to "VOS Secure Installer ERS" document, chapter "Package env file")</li>
</ul>
<p>A further possibility is to set up a configuration path to use the directory “&lt;HOME&gt;/ADK/sec/”. <br  />
If this exists it is used as the default path and has priority over the user home directory. This allows users to create a symlink to “&lt;HOME&gt;/ADK/sec/” to link to any other directory (e.g. flash for write permissions). <br  />
<br  />
 ADK-SEC searches for a configuration path on the following priority of set-ups:<br  />
<em>1. Environment variable SCAPPCFG</em><br  />
<em>2. Default configuration directory “&lt;HOME&gt;ADK/sec/”</em><br  />
<em>3. Home directory</em><br  />
 <br  />
</p>
<h3><a class="anchor" id="subsubsec_security_running_of_service"></a>
Service startup</h3>
<p>The ADK-SEC package is a system signed package.<br  />
Applications run the service implicitly by calling <a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> if it is an user application. <br  />
</p><ul>
<li>The package will be installed on sys13</li>
<li>scapp2 is placed in /home/sys13/lib/</li>
<li>After implicit launch of security service it runs with same credential uid:gid as the application</li>
<li>Restriction: VSS must be installed for same uid:gid as the application. In case if ADK-SEC must be used from system application, a separate launcher is required as sys10 user to use VSS functionality.</li>
</ul>
<p>Multiple start of ADK-SEC per user group is prevented. That means ADK-SEC is only started once for each user group.</p>
<p>Important note:</p><ul>
<li>Users should not start security service (scapp2) to avoid conflicts with implicit start from <a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a></li>
<li>The environment variable SCAPPCFG must be provided by user application package</li>
<li>Not recommended: If security service (scapp2) shall be started explicitly (secure installer, MAC, run script), users have to take care that security service (scapp2) is started before <a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a>.</li>
</ul>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_security_Troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="subsec_security_Troubleshooting_Logging"></a>
Logging</h2>
<p>ADK-LOG is used to provide logging messages for diagnostics and problem analysis of ADK-SEC security service. <br  />
<br  />
Logging messages are redirected to the output channel <code>syslog</code>. <br  />
<br  />
According to new ADK-LOGGING configuration model the logging level can be configured via LCP or JSON formatted configuration file. ADKSEC uses:</p><ul>
<li>SEC_log.conf file for service and libsec logging configuration</li>
</ul>
<p>For additional information about logging please refer to ADK-LOGGING documentation. <br  />
</p>
<h2><a class="anchor" id="subsec_security_Troubleshooting_Debugging"></a>
Debugging</h2>
<p>A debug version of ADK-SEC can be provided individually upon request. <br  />
<br  />
Any logging messages are printed on console via COM Port 1. <br  />
</p>
<h2><a class="anchor" id="subsec_security_Troubleshooting_FAQ"></a>
Frequently Asked Questions</h2>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_1"></a>
How can I get information about error codes?</h3>
<p>Error codes are returned by API functions as 4-byte values. They are grouped and therefore composed as a sum of a 4-byte error group (<em>enum secErrorGroup</em>) and a 2-byte offset. <br  />
The corresponding values, symbolic identifiers (<em>enum secError</em>) and descriptions can be found in <a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a>. <br  />
If the symbolic identifier was found a click on it will lead to the description. <br  />
<br  />
<em>Example</em></p><ul>
<li><em>secRetrieveEncrypedPIN()</em> delivers the errCode=0x00120002. What is the reason?<br  />
</li>
<li>For 0x00120000 find error group <em>EsecGroupEncIPP</em> in <a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a>, for <em>EsecGroupEncIPP</em>+0x0002=0x00120002 find <em>EsecIPPSelectMK</em>. <br  />
</li>
<li>This leads to the desciption "Select MK failed". So, please check if a Master Key was loaded. <br  />
</li>
</ul>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_2"></a>
What is the reason for failures with error code 0x00030006 (EsecIPCComNotInit)?</h3>
<p><a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> is the first ADK-SEC API function an application must call to start the security service (scapp2) and to establish an IPC connection. <br  />
The error EsecIPCComNotInit is returned by ADK-SEC API functions in the following scenarios: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> has not be called firstly</li>
<li>scapp2 is not installed</li>
</ul>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_3"></a>
What could be reasons for unexpected behavior of API functions?</h3>
<p>Reason could be: <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> is provided with a non existing host name parameter. <br  />
In his case <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> will not fail as it uses the 'default' host name. <br  />
This will lead to an unexpected behavior. <br  />
So, please ensure that the selected host is available in the configuration file <code>sccfg</code>.<code>json</code> (see <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>).</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_4"></a>
Hence after migrating to ADK-SEC-2.x, the SCAPP package should be removed from CAMCORE bundle? The ADK-SEC will be started automatically on each restart?</h3>
<p>SCAPP package:</p><ul>
<li>SCAPP package for ADK-SEC 1.x is user signed and needs to be signed/loaded in scope of the application.</li>
<li>SCAPP package for ADK-SEC 2.x is system signed and already comes with the full ADK bundle. Applications don't need to care about SCAPP packaging and signing.</li>
</ul>
<p>SCAPP start: Both ADK-SEC 1.x and ADK-SEC 2.x contain mechanism to implicit start SCAPP via <a class="el" href="namespacecom__verifone__seccmd.html#a9871b00715c29b88812f6cbe88657a21">Sec_Init()</a> (ADK-SEC 1.x) or <a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> (ADK-SEC 2.x) calls. This mechansim was introduced with ADK-SEC release 1.6.0 (see ADKSEC-487). There is no need to start SCAPP by the application.<br  />
<a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> API must be called before performing any other ADK-SEC operation. As mentioned before, this function will start the SCAPP and establish the IPC conntection between the application/libsec and the SCAPP.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_5"></a>
What is the relation between the different ADE sections in host configurations &amp; the one in secScehemes section?</h3>
<p><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> is required to select a specific host configuration and the returned handle has to be used in subsequent operations. You can see this handle as a reference to the selected host configuration. In ADK-SEC 1.x there was an alternate approach to provide the host configuration (host ID) directly with the ADK-SEC APIs. Due to new host configuration approach and unifying ADK-SEC APIs in 2.x, all APIs will work with configuration handle as selected by <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a>.<br  />
Configuration schemes are schemes that can be used within multiple host configurations. You can see the scheme as a default configuration that can be used for several host configurations, e.g. in above example "schemeADE" is used in host configurations "07", "ADE-DUKPT", "ADE-DUKPT1" and "ADE-DUKPT2". When providing a scheme in the configuration, the values from the scheme will loaded as defaults for the selected configuration, but you can also overwrite specific settings with new values specified in your specific host configuration. E.g. in above example the host "07" works with setting from "schemeADE" as is, while host "ADE-DUKPT" overloads the padding from "schemeADE" ("padding": "PKCS7") with a new value ("padding": "NONE").</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_6"></a>
Hence with the test configuration sccfg.json how to use the ADE enrcryption? Also what does the numbers in "encryptData" field indicate?</h3>
<p>(Test configuration <code>sccfg</code>.<code>json</code> can be found here: <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>)<br  />
Regarding how to use the configuration for ADE encryption, provide an ADE host configuration according your needs, select the host config with <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> and encrypt the data with <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> using the handle returned by <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a>.<br  />
The numbers in "encryptData" field indicate different key slots for usage with <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a>. You can select a key with <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a> to be used with <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a>. The numbers in "encryptData" field will map a KeySetID to a specific key slot, e.g. in above configuration KeySetId 1 maps to key slot "0", KSId 2 maps to key slot "1" ...</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_7"></a>
What is the difference between secEncryptData() &amp; secEncryptTransactionData() API.</h3>
<p>The difference between <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> &amp; <a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> API is as follows:</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> will encrypt the data provided in plainData argument.</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> will encrypt the transaction data referenced by the index for the transaction data previously set with setPutTransactionData().</li>
</ul>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_8"></a>
VSS scripts from SEC1 is not working in SEC2 and log reports "script &lt;xxx&gt; is not installed in system and cannot be used!"</h3>
<p>SEC1 uses script in defined via xx.cfg slot without checking of the name. SEC2 searches for script in system defined in sccfg.json in tag "scriptName": independent from installed slot where is this script. The script name is in this case "SCRIPT &lt;script name&gt;" from .vss. Please correct sccfg.json with right value "scriptName": “&lt;script name&gt;”</p>
<p>Example of <a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> usage:<br  />
</p><div class="fragment"><div class="line"><a class="code" href="namespacecom__adksec__cmd.html#a8963c1dd7c626a621a8033209294fcbd">SecTransactionData_t</a> taData;</div>
<div class="line">taData[<span class="stringliteral">&quot;Zungenbrecher&quot;</span>] = sPlainText;</div>
<div class="line"><a class="code" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData</a>(g_Handle, taData);</div>
<div class="line"><a class="code" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData</a>(g_Handle, <span class="stringliteral">&quot;Zungenbrecher&quot;</span>, encryptedData, iv, ksn));</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_8"></a>
VSS scripts from SEC1 is not working in SEC2 and log reports "script &lt;xxx&gt; is not installed in system and cannot be used!"</h3>
<p>The class reference and provided APIs in CModADE.h are for internal use only and not accessible from the application. Applications should use the APIs provided in <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_9"></a>
secGetKeyInventory() can be used instead of ade_status() for retrieving the ade state?</h3>
<p>Yes, <a class="el" href="namespacecom__verifone__seccmd.html#a79b00ea8a8aed3b7950800bf136a1944">secGetKeyInventory()</a> can be used to check the ade state. It will provide information if ADE is enable and active and information about the ADE keys loaded to the different key slots.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_10"></a>
Is it possible to perform encryption using different key slots for different data? E.g. dataset1 is encrypted using the ADE Key in slot 1, dataset2 is encrypted using ADE key in slot 2. In such case how do we change the key slot for encryption?</h3>
<p>Yes, it is possible to perform encryption using different key slots for different data. Please see above description about "encryptData" field to indicate different key slots and select the keys with <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a> before encrypting the data with <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a>.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_11"></a>
When the RSA key is installed in OS i.e. using VRK, how do we configure the same in any of the RSA schemes?</h3>
<p>Normally, VRK installs keys in /mnt/flash/system/&lt;key type&gt;/&lt;user&gt;/ on the device. In ADK-SEC configuration both absolute path and relative to /mnt/flash/system/ can be used. Same key can be referenced by multiple host configurations/schemes.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_12"></a>
For the RSA keys loaded using secUpdateKey(), how do we mention the same in the scheme or host configuration(s)?</h3>
<p>Working RSA public keys (certificates) loaded via <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> are stored in ADK-SEC and can be referenced only by host. In host configuration “internal” marker must be used.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_13"></a>
Is there a possibility that we can just download the key onto the terminal (e.g. say the key is in /home/usr1/flash location) and use the same as it is i.e. without performing the load operation using UpdateKey()?</h3>
<p>In case of “just” loaded keys on the terminal, these RSA public keys (and certificates) must be referenced in host configuration with full path+file name. Please note a restriction that no private RSA key can be recognized by ADK-SEC. VRK is one way to install it to use private RSA key for decryption/signing operation.</p>
<h3><a class="anchor" id="subsubsec_security_Troubleshooting_FAQ_14"></a>
How we can use different public RSA keys for same crypto operation defined in "WMT-CardData-SHA1" (see config example)? What value do we provide the "ksid" parameter to get the corresponding key in effect?</h3>
<p>(Test configuration <code>sccfg</code>.<code>json</code> can be found here: <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>)<br  />
setKeySetId() works with Key Index. In case of "WMT-CardData-SHA1" host configuration following key will be used for <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> if setKeySetId() called before:</p><ul>
<li>setKeySetId(hdl, 1) -&gt; /home/usr1/wmt-pki/encr_pub.pem</li>
<li>setKeySetId(hdl, 2) -&gt; /home/usr1/wmt-pki/enc2_pub.pem</li>
<li>setKeySetId(hdl, 3) -&gt; <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> fails with error</li>
</ul>
<p>The same for <a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a>:</p><ul>
<li>setKeySetId(hdl, 1) -&gt; /home/usr1/wmt-pki/vali_pub.pem</li>
<li>setKeySetId(hdl, 2) -&gt; /home/usr1/wmt-pki/vali_pub.pem</li>
<li>setKeySetId(hdl, 3) -&gt; <a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a> fails with error</li>
</ul>
<p>In other words, just use the sequence </p><div class="fragment"><div class="line">setKeySetId(hdl, x);</div>
<div class="line">sec&lt;crypto operation&gt;(hdl,…)</div>
</div><!-- fragment --><p> if crypto operation must be performed with key index “x”. "KeyAddressTable" looks like an array of keys [ksId 1, ksid 2,…] for each crypto operation</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_Json_Config"></a>
Appendix A: JSON Schemes, Configuration and Output Examples</h1>
<p>This document provides the following JSON Schemes and JSON examples:</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#sec_json_config_schema">JSON Schema for Configuration File</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_json_secGetKeyInventory_schema">JSON Schema for Output of secGetKeyInventory()</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_json_secGetStatus_schema">JSON Schema for Output of secGetStatus()</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_json_secGetStatus_output_example">Output example of secGetStatus()</a></li>
</ul>
<p><br  />
</p>
<h2><a class="anchor" id="sec_json_config_schema"></a>
JSON Schema for Configuration File</h2>
<p>The following ADK-SEC JSON schema defines the possible values to be used in the configuration file and can be used for validation. <br  />
 </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-06/schema#&quot;,</div>
<div class="line">  &quot;$id&quot;: &quot;http://json-schema.org/draft-06/schema#&quot;,</div>
<div class="line">  &quot;definitions&quot;: {</div>
<div class="line">    &quot;command&quot;:{</div>
<div class="line">      &quot;enum&quot;:[</div>
<div class="line">        &quot;updateKey&quot;,</div>
<div class="line">        &quot;getKeyInfo&quot;,</div>
<div class="line">        &quot;getKeyInventory&quot;,</div>
<div class="line">        &quot;encryptData&quot;,</div>
<div class="line">        &quot;decryptData&quot;,</div>
<div class="line">        &quot;sign&quot;,</div>
<div class="line">        &quot;verify&quot;,</div>
<div class="line">        &quot;retrieveEncPIN&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;KeyAdressMappingTable&quot;: {</div>
<div class="line">      &quot;type&quot;:&quot;array&quot;,</div>
<div class="line">      &quot;items&quot;:{ &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">      &quot;uniqueItems&quot;: false,</div>
<div class="line">      &quot;minItems&quot;: 1</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;moduleSettings&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;PINBlockFormat&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;ISO0&quot;,</div>
<div class="line">            &quot;ISO1&quot;,</div>
<div class="line">            &quot;ISO2&quot;,</div>
<div class="line">            &quot;ISO3&quot;,</div>
<div class="line">            &quot;ISO4&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;KeyManagementType&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;MSK&quot;,</div>
<div class="line">            &quot;DUKPT&quot;,</div>
<div class="line">            &quot;ADE&quot;,</div>
<div class="line">            &quot;SRED&quot;,</div>
<div class="line">            &quot;AS2805&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;encMode&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;MODE_ECB&quot;,</div>
<div class="line">            &quot;MODE_CBC&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;keyVariant&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;X924_MAC_REQ_BW&quot;,</div>
<div class="line">            &quot;X924_MAC_RESP&quot;,</div>
<div class="line">            &quot;X924_DE_REQ_BW&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;algo&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;DES112&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_1&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_1A&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_2&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_3&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_4&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_5&quot;,</div>
<div class="line">            &quot;ALG_9797_MAC_5A&quot;,</div>
<div class="line">            &quot;ALG_CMAC_TDEA&quot;,</div>
<div class="line">            &quot;ALG_HMAC_SHA256&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;IVType&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;NONE&quot;,</div>
<div class="line">            &quot;ZERO&quot;,</div>
<div class="line">            &quot;RANDOM&quot;,</div>
<div class="line">            &quot;USER_DEFINED&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;padding&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;NONE&quot;,</div>
<div class="line">            &quot;PKCS1&quot;,</div>
<div class="line">            &quot;PKCS1_OAEP&quot;,</div>
<div class="line">            &quot;PKCS7&quot;,</div>
<div class="line">            &quot;X923&quot;,</div>
<div class="line">            &quot;ISO7816&quot;,</div>
<div class="line">            &quot;ZERO&quot;,</div>
<div class="line">            &quot;FF&quot;,</div>
<div class="line">            &quot;SPACE&quot;,</div>
<div class="line">            &quot;ISO10126&quot;,</div>
<div class="line">            &quot;ISO9797_1&quot;,</div>
<div class="line">            &quot;ISO9797_2&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;KSNincrementation&quot;: {</div>
<div class="line">          &quot;description&quot;: &quot;BY_OPERATION - (default) by each operation generate a next KSN, BY_API - manage next KSN explicit via secUpdateKey()&quot;,</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;BY_OPERATION&quot;,</div>
<div class="line">            &quot;BY_API&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;KeyManagementOption&quot;:{</div>
<div class="line">          &quot;type&quot;: &quot;string&quot;,</div>
<div class="line">          &quot;pattern&quot;: &quot;^[a-fA-F0-9]{3}$&quot;,</div>
<div class="line">          &quot;description&quot;: &quot;[KMM + DEMF] according IPP Packet 17 (see OS Programmers Manual)&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;KeyAddressTable&quot;:{</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: {</div>
<div class="line">            &quot;properties&quot;:{</div>
<div class="line">              &quot;updateKey&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;getKeyInfo&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;getKeyInventory&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;encryptData&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;decryptData&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;sign&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;verify&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              },</div>
<div class="line">              &quot;retrieveEncPIN&quot;:{</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;$ref&quot;: &quot;#/definitions/KeyAdressMappingTable&quot;</div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">          },</div>
<div class="line">          &quot;additionalItems&quot;: false,</div>
<div class="line">          &quot;uniqueItems&quot;: true,</div>
<div class="line">          &quot;minItems&quot;: 1</div>
<div class="line">        },</div>
<div class="line">        &quot;encMethod&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;HMAC&quot;,</div>
<div class="line">            &quot;CMAC&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;hashType&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;SHA1&quot;,</div>
<div class="line">            &quot;SHA224&quot;,</div>
<div class="line">            &quot;SHA256&quot;,</div>
<div class="line">            &quot;SHA384&quot;,</div>
<div class="line">            &quot;SHA512&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;calcHash&quot;: {</div>
<div class="line">          &quot;enum&quot;: [</div>
<div class="line">            &quot;yes&quot;,</div>
<div class="line">            &quot;no&quot;</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;moduleScheme&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;name&quot;: {&quot;type&quot;: &quot;string&quot;},</div>
<div class="line">        &quot;settings&quot;: {&quot;$ref&quot;: &quot;#/definitions/moduleSettings&quot;},</div>
<div class="line">        &quot;scriptFileName&quot;: { &quot;type&quot;: &quot;string&quot;},</div>
<div class="line">        &quot;scriptName&quot;: { &quot;type&quot;: &quot;string&quot;}</div>
<div class="line">        },</div>
<div class="line">      &quot;required&quot;: [&quot;name&quot;, &quot;settings&quot;]</div>
<div class="line">    },</div>
<div class="line">    &quot;moduleElement&quot;: {</div>
<div class="line">        &quot;enum&quot;: [</div>
<div class="line">          &quot;VSS&quot;, &quot;BENDIGO&quot;,</div>
<div class="line">          &quot;IPPmsk&quot;, &quot;IPPdukpt&quot;,</div>
<div class="line">          &quot;ADE&quot;, &quot;VCL&quot;, &quot;SREDMAC&quot;,</div>
<div class="line">          &quot;Voltage&quot;, &quot;VisaDSP&quot;,</div>
<div class="line">          &quot;RSA&quot;, &quot;AES&quot;</div>
<div class="line">        ]</div>
<div class="line">    },</div>
<div class="line">    &quot;keyMapElement&quot;: {</div>
<div class="line">      &quot;description&quot;: &quot;mapping between KeySetId and in OS installed key&quot;,</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;keySetId&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">        &quot;realKey&quot;: {  &quot;type&quot;: &quot;string&quot;  }</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;hostElement&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;description&quot;: &quot;`scheme` is a reference to `name` of moduleScheme object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;name&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;module&quot;: { &quot;$ref&quot;: &quot;#/definitions/moduleElement&quot; },</div>
<div class="line">        &quot;scheme&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;settings&quot;: { &quot;$ref&quot;: &quot;#/definitions/moduleSettings&quot; },</div>
<div class="line">        &quot;hosts&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/hostElement&quot; }</div>
<div class="line">        },</div>
<div class="line">        &quot;commands&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: {</div>
<div class="line">            &quot;properties&quot;: {</div>
<div class="line">              &quot;command&quot;:{ &quot;$ref&quot;: &quot;#/definitions/command&quot; },</div>
<div class="line">              &quot;module&quot;: { &quot;$ref&quot;: &quot;#/definitions/moduleElement&quot; },</div>
<div class="line">              &quot;scheme&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;settings&quot;: {&quot;$ref&quot;: &quot;#/definitions/moduleSettings&quot; },</div>
<div class="line">              &quot;useParentSettings&quot;: { &quot;type&quot;: &quot;boolean&quot; },</div>
<div class="line">              &quot;hosts&quot;: {</div>
<div class="line">                &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">                &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/hostElement&quot; }</div>
<div class="line">              }</div>
<div class="line">            },</div>
<div class="line">            &quot;required&quot;: [&quot;command&quot;, &quot;module&quot;]</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        &quot;keyMapping&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyMapElement&quot; }</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;: [&quot;name&quot;, &quot;module&quot;]</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;title&quot;: &quot;ADKSEC scheme&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">  &quot;properties&quot;: {</div>
<div class="line">    &quot;adksecconfig&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;serviceCfg&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">          &quot;properties&quot;: {</div>
<div class="line">            &quot;secSchemes&quot;: {</div>
<div class="line">              &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">              &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/moduleScheme&quot; },</div>
<div class="line">              &quot;minItems&quot;: 1,</div>
<div class="line">              &quot;uniqueItems&quot;: true</div>
<div class="line">            }</div>
<div class="line">          },</div>
<div class="line">          &quot;required&quot;: [&quot;secSchemes&quot;]</div>
<div class="line">        },</div>
<div class="line">        &quot;hosts&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/hostElement&quot; },</div>
<div class="line">          &quot;uniqueItems&quot;: true,</div>
<div class="line">          &quot;minItems&quot;: 1</div>
<div class="line">        },</div>
<div class="line">        &quot;hostMapping&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: {</div>
<div class="line">            &quot;BINrange&quot;: {</div>
<div class="line">                &quot;pattern&quot;: &quot;^[0-9-]{2,30}$&quot;,</div>
<div class="line">                &quot;type&quot;: &quot;string&quot;</div>
<div class="line">            },</div>
<div class="line">            &quot;dataType&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">            &quot;technology&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">            &quot;paymentScheme&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">            &quot;host&quot;: {</div>
<div class="line">               &quot;description&quot;:&quot;this is reference to host name&quot;,</div>
<div class="line">                &quot;type&quot;: &quot;string&quot;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;: [&quot;serviceCfg&quot;, &quot;hosts&quot;]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
<h2><a class="anchor" id="sec_json_config_example"></a>
Configuration File Example</h2>
<p>This is an example of a configuration file for ADK-SEC: <br  />
</p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;adksecconfig&quot;: {</div>
<div class="line">    &quot;hosts&quot;:</div>
<div class="line">    [</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;default&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Use this as fallback&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;,</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;testReadOnly&quot;: 16,</div>
<div class="line">          &quot;testWriteOnly&quot;: 1,</div>
<div class="line">          &quot;testPrivate&quot;: 0,</div>
<div class="line">          &quot;testReadWrite&quot;: 17</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;01&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is VSS MSK configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSMSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;02&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is Bendigo configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeBendigo&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;BENDIGO&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;03&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is VSS DUKPT configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSDUKPT&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;04&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP MSK configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;44&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP MSK configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSK44&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;04slotF&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP MSK configuration for compatibility with testing slot F(=15)&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSKslotF&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;05&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP DUKPT configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPDUKPT&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPdukpt&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;06&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is VSS configuration for HMAC calculation&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSHMAC&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;07&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is ADE configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeADE&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;ADE&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;08&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is VSS DUKPT BY OPERATION configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSDUKPTBYAPI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;09&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP MSK configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSKFALSE&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;10&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP DUKPT configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPDUKPTFALSE&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPdukpt&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;11&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is IPP MSK configuration for compatibility with old name handling&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSKNULLSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      },{</div>
<div class="line">        &quot;name&quot;: &quot;ADE-DUKPT&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is ADE DUKPT configuration&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;ADE&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeADE&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;IVType&quot;:  &quot;ZERO&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;NONE&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;ADE-DUKPT-KSN_BY_API&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is ADE DUKPT configuration&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeADE&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;ADE&quot;,</div>
<div class="line">        &quot;settings&quot;:</div>
<div class="line">        {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;IVType&quot;:  &quot;ZERO&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;: &quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;NONE&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;ADE-DUKPT1&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is ADE DUKPT configuration&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;ADE&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeADE&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">          &quot;IVType&quot;:  &quot;ZERO&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;NONE&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;ADE-DUKPT2&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is ADE DUKPT configuration&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;ADE&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeADE&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;IVType&quot;:  &quot;RANDOM&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;: &quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;IPPhost&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeIPPMSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;BendigoHost&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeBendigo&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;BENDIGO&quot;,</div>
<div class="line">        &quot;commands&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;command&quot;: &quot;retrieveEncPIN&quot;,</div>
<div class="line">            &quot;module&quot;: &quot;BENDIGO&quot;,</div>
<div class="line">            &quot;useParentSettings&quot;: true</div>
<div class="line">          }, </div>
<div class="line">          {</div>
<div class="line">            &quot;command&quot;: &quot;updateKey&quot;,</div>
<div class="line">            &quot;module&quot;: &quot;BENDIGO&quot;,</div>
<div class="line">            &quot;useParentSettings&quot;: true</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VoltageHost1&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;Voltage&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;TrackEncryptionProtocol&quot;: &quot;TEP1&quot;,</div>
<div class="line">          &quot;bbParamsFileName&quot;: &quot;www/voltage/bbparams.1024&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagMID&quot;: 1,</div>
<div class="line">          &quot;TagPANandCVV&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1,</div>
<div class="line">          &quot;TagTrack3&quot;: 1,</div>
<div class="line">          &quot;TagAlphaNum&quot;: 1,</div>
<div class="line">          &quot;TagByteArray&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VoltageHost2&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;Voltage&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;TrackEncryptionProtocol&quot;: &quot;TEP2&quot;,</div>
<div class="line">          &quot;bbParamsFileName&quot;: &quot;www/voltage/bbparams.1024&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagMID&quot;: 1,</div>
<div class="line">          &quot;TagPANandCVV&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1,</div>
<div class="line">          &quot;TagTrack3&quot;: 1,</div>
<div class="line">          &quot;TagAlphaNum&quot;: 1,</div>
<div class="line">          &quot;TagByteArray&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VoltageHost1x&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;Voltage&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;TrackEncryptionProtocol&quot;: &quot;TEP1x&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagMID&quot;: 1,</div>
<div class="line">          &quot;TagPANandCVV&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1,</div>
<div class="line">          &quot;TagTrack3&quot;: 1,</div>
<div class="line">          &quot;TagAlphaNum&quot;: 1,</div>
<div class="line">          &quot;TagByteArray&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VoltageHost2x&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;Voltage&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;TrackEncryptionProtocol&quot;: &quot;TEP2x&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagMID&quot;: 1,</div>
<div class="line">          &quot;TagPANandCVV&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1,</div>
<div class="line">          &quot;TagTrack3&quot;: 1,</div>
<div class="line">          &quot;TagAlphaNum&quot;: 1,</div>
<div class="line">          &quot;TagByteArray&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VoltageHost4&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;Voltage&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;TrackEncryptionProtocol&quot;: &quot;TEP4&quot;</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagMID&quot;: 1,</div>
<div class="line">          &quot;TagPANandCVV&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1,</div>
<div class="line">          &quot;TagTrack3&quot;: 1,</div>
<div class="line">          &quot;TagAlphaNum&quot;: 1,</div>
<div class="line">          &quot;TagByteArray&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VisaDSP_P2PE_Host&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;for P2PE algo usage (IPP-DUKPT)&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVisaDSP&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VisaDSP&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encryptionAlgo&quot;: &quot;P2PE&quot;,</div>
<div class="line">          &quot;KeyManagementOption&quot;: &quot;0A3&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">            {&quot;updateKey&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;encryptData&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagCHName&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VisaDSP_P2PE_Host_ADE&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;for P2PE algo usage (ADE)&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVisaDSP&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VisaDSP&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encryptionAlgo&quot;: &quot;P2PE&quot;,</div>
<div class="line">          &quot;KeyManagementType&quot;: &quot;ADE&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">            {&quot;updateKey&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;encryptData&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagCHName&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VisaDSP_FPE_Host&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;IPP-DUKPT usage&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVisaDSP&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VisaDSP&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encryptionAlgo&quot;: &quot;FPE&quot;,</div>
<div class="line">          &quot;KeyManagementOption&quot;: &quot;0A3&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">            {&quot;updateKey&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;encryptData&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagCHName&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VisaDSP_FPE_Host_ADE&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;ADE usage&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVisaDSP&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VisaDSP&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encryptionAlgo&quot;: &quot;FPE&quot;,</div>
<div class="line">          &quot;KeyManagementType&quot;: &quot;ADE&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;updateKey&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">            {&quot;encryptData&quot;:  [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        &quot;permissions&quot;: {</div>
<div class="line">          &quot;TagPAN&quot;: 1,</div>
<div class="line">          &quot;TagCHName&quot;: 1,</div>
<div class="line">          &quot;TagTrack1&quot;: 1,</div>
<div class="line">          &quot;TagTrack2&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;RSA_CalcHashNo&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA_CalcHashNo&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-Common&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;commands&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;command&quot;: &quot;encryptData&quot;,</div>
<div class="line">            &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">            &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;NONE&quot;,</div>
<div class="line">              &quot;KeyAddressTable&quot;: [</div>
<div class="line">                {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">                {&quot;encryptData&quot;: [&quot;internal&quot;,&quot;internal&quot;]}</div>
<div class="line">              ]</div>
<div class="line">            }</div>
<div class="line">          }, </div>
<div class="line">          {</div>
<div class="line">            &quot;command&quot;: &quot;verify&quot;,</div>
<div class="line">            &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">            &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA256&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;yes&quot;,</div>
<div class="line">              &quot;KeyAddressTable&quot;: [</div>
<div class="line">                {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">                {&quot;verify&quot;: [&quot;internal&quot;,&quot;internal&quot;]}</div>
<div class="line">              ]</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA1&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA1&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA224&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA224&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA384&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA384&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA512&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA512&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA1done&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Input data are already SHA-1-hashed&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA1&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;no&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA224done&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Input data are already SHA-224-hashed&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA224&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;no&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA256done&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Input data are already SHA-256-hashed&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA256&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;no&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {    </div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA384done&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Input data are already SHA-384-hashed&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA384&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;no&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;WMT-CardData-SHA512done&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Input data are already SHA-512-hashed&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">              &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">              &quot;hashType&quot;: &quot;SHA512&quot;,</div>
<div class="line">              &quot;calcHash&quot;: &quot;no&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;RSApemder&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;Key as public key, no certificate&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;padding&quot;: &quot;NONE&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;/home/usr1/flash/rsatestkeys/tpublic.key&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;DUKPTHost01&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSDUKPT&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;: &quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;DUKPTHost02&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSDUKPT_2&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;PaymarkVSS&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;VSS MSK configuration for Paymark (NZ) - administrate additional key types by ksid masking&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemePaymarkVSSMSK&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;test_multi_module&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;ADKSEC-440&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeRSA&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;RSA&quot;,</div>
<div class="line">        &quot;commands&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;command&quot;: &quot;retrieveEncPIN&quot;,</div>
<div class="line">            &quot;module&quot;: &quot;IPPdukpt&quot;,</div>
<div class="line">            &quot;settings&quot;: {</div>
<div class="line">              &quot;KeyManagementOption&quot;: &quot;0A0&quot;,</div>
<div class="line">              &quot;KeyAddressTable&quot;: [</div>
<div class="line">                {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">                {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">              ]</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        ]</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESHMAC-sha256&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for HMAC and type SHA256&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;algo&quot;: &quot;HMAC&quot;,</div>
<div class="line">          &quot;hashType&quot;: &quot;SHA256&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESHMAC-sha512&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for HMAC and type SHA256&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;algo&quot;: &quot;HMAC&quot;,</div>
<div class="line">          &quot;hashType&quot;: &quot;SHA512&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line"> </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESHMAC-sha224&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for HMAC and type SHA224&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;algo&quot;: &quot;HMAC&quot;,</div>
<div class="line">          &quot;hashType&quot;: &quot;SHA224&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_DEFAULT&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_DEFAULT, key variant default&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_BY_API&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_BY_API, key variant default&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_BY_OPERATION&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_BY_OPERATION, key variant default&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_BY_OPERATION_request&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_BY_OPERATION, key variant request&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;keyVariant&quot;: &quot;request&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_BY_OPERATION_resp&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_BY_OPERATION, key variant response&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;keyVariant&quot;: &quot;response&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT_KSN_BY_OPERATION_both&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for encryption (CBC, no padding), CMAC, KSN_BY_OPERATION, key variant both way&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;keyVariant&quot;: &quot;both&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-ECB&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using ECB, 128-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;CMAC&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;sign&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;verify&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-ECB-KSN_BY_OPERATION&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using ECB, 128-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-ECB-NoKSNincrementation&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using ECB, 128-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES192-ECB&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using ECB, 192-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key1.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES256-ECB&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using ECB, 256-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_ECB&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingISO7816&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:ISO7816&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;ISO7816&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingX923&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:X923&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;X923&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingISO9797_2&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:ISO9797_2&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;ISO9797_2&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingISO9797_1&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:ISO9797_1&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;ISO9797_1&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingISO10126&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:ISO10126&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;ISO10126&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingZERO&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:ZERO&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;ZERO&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES128-CBC-paddingNONE&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-Bit-InitialKey, padding:NONE&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES192-CBC&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 192-Bit-InitialKey&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">          &quot;keyVariant&quot;: &quot;response&quot;,</div>
<div class="line">          &quot;KeyAddressTable&quot;: [</div>
<div class="line">            {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">            {&quot;encryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;]},</div>
<div class="line">            {&quot;decryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;]},</div>
<div class="line">            {&quot;sign&quot;: [&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">            {&quot;verify&quot;: [&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">            {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key1.ses&quot;]}</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AESDUKPT-CBC&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration using CBC, 128-, 192- and 256-Bit-Initial Keys)&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;,&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">              {&quot;decryptData&quot;: [&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;,&quot;generickeys/usr1/key2.ses&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES256-CBC-paddingNONE&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for data encryption/decryption (CBC), 256-Bit-InitialKey)&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;AES256-CBC&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;AES DUKPT configuration for data encryption/decryption (CBC), 256-Bit-InitialKey)&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;AES&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC2&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_1A&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-1A&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_1A&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-3&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_3&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-CMAC_TDEA&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_CMAC_TDEA&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-CMAC_TDEA-KSN_BY_API&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation, KSN BY_API&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_API&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_CMAC_TDEA&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-CMAC_TDEA-KSN_BY_OPERATION&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation, KSN BY_OPERATION&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;KSNincrementation&quot;:&quot;BY_OPERATION&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_CMAC_TDEA&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-CMAC_TDEA-KSN_DEFAULT&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation, KSN DEFAULT&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_CMAC_TDEA&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-HMAC_SHA256&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_HMAC_SHA256&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-2&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_2&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-4&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_4&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-5&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_5&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-9797-5A&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;ALG_9797_MAC_5A&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;SRED-MAC-DES112&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;SRED configuration for MAC calculation&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">          &quot;algo&quot;: &quot;DES112&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VariableBlockSizeVSS&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;this is VSS configuration for Variable Block Size feature verification&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSVBS&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;VariableBlockSizeVSSPadd&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeVSSVBS&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;VSS&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;padding&quot;: &quot;PKCS7&quot;</div>
<div class="line">        }</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;CryptoRWnew&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeCryptoReadWrite&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;CryptoRW&quot;</div>
<div class="line">      }, </div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;CryptoRWlegacy&quot;,</div>
<div class="line">        &quot;scheme&quot;: &quot;schemeCryptoReadWrite&quot;,</div>
<div class="line">        &quot;module&quot;: &quot;CryptoRW&quot;,</div>
<div class="line">        &quot;settings&quot;: {</div>
<div class="line">          &quot;legacy_decrypt&quot;: true</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    ],</div>
<div class="line">    &quot;serviceCfg&quot;:</div>
<div class="line">    {</div>
<div class="line">      &quot;secSchemes&quot;:</div>
<div class="line">      [</div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeBendigo&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;AU010222.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;AU010222&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;AS2805&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSMSK&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TS020122.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TS020122&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;MSK&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true,</div>
<div class="line">            &quot;transportKey&quot;: &quot;generickeys/usr1/ADKSEC_CustomVSS_RKL.der&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemePaymarkVSSMSK&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TSV20122.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TSV20122&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;MSK&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSDUKPT&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TS010322.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TS010322&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;DUKPT&quot;,</div>
<div class="line">            &quot;KSNincrementation&quot;: &quot;BY_OPERATION&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSDUKPTBYAPI&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TS010322.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TS010322&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;DUKPT&quot;,</div>
<div class="line">            &quot;KSNincrementation&quot;: &quot;BY_API&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSDUKPT_2&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TS010322.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TS010322&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;DUKPT&quot;,</div>
<div class="line">            &quot;RESET_PINALGO&quot;: true</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSHMAC&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TS010622.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TS010622&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;MSK&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVSSVBS&quot;,</div>
<div class="line">          &quot;scriptFileName&quot;: &quot;TSV20222.vso&quot;,</div>
<div class="line">          &quot;scriptName&quot;: &quot;TSV20222&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementType&quot;: &quot;MSK&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPMSK&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;8A3&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;updateKey&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPMSK44&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;820&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;6&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;6&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;6&quot;]},</div>
<div class="line">              {&quot;updateKey&quot;: [&quot;6&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPMSKslotF&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;8A3&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;updateKey&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;15&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPDUKPT&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;0A3&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]},</div>
<div class="line">              {&quot;updateKey&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPMSKFALSE&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;0A0&quot;,</div>
<div class="line">            &quot;IPPUseBinFormat&quot;: false,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPDUKPTFALSE&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;0A0&quot;,</div>
<div class="line">            &quot;IPPUseBinFormat&quot;: false,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3 | &lt;- KeySetId (3 slots)&quot;},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeIPPMSKNULLSK&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;KeyManagementOption&quot;: &quot;8A3&quot;,</div>
<div class="line">            &quot;IPPUseBinFormat&quot;: true,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVAES&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;IVType&quot;: &quot;ZERO&quot;,</div>
<div class="line">            &quot;padding&quot;: &quot;PKCS7&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVoltage&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;ctxFileName&quot;: &quot;flash/key0.ses&quot;,</div>
<div class="line">            &quot;bbParamsFileName&quot;: &quot;www/voltage/bbparams.3072&quot;,</div>
<div class="line">            &quot;IdentityString&quot;: &quot;pos@example.com&quot;,</div>
<div class="line">            &quot;TrackEncryptionProtocol&quot;: &quot;TEP4&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeVisaDSP&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;encryptionAlgo&quot;: &quot;P2PE&quot;</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeRSA&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;rkeys/usr1/key0.crt&quot;]},</div>
<div class="line">              {&quot;decryptData&quot;: [&quot;rkeys/usr1/key0.der&quot;]},</div>
<div class="line">              {&quot;sign&quot;: [&quot;rkeys/usr1/key0.der&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;rkeys/usr1/key0.crt&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeRSA_CalcHashNo&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;padding&quot;: &quot;PKCS1&quot;,</div>
<div class="line">            &quot;calcHash&quot;:&quot;no&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;rkeys/usr1/key0.crt&quot;]},</div>
<div class="line">              {&quot;decryptData&quot;: [&quot;rkeys/usr1/key0.der&quot;]},</div>
<div class="line">              {&quot;sign&quot;: [&quot;rkeys/usr1/key0.der&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;rkeys/usr1/key0.crt&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeADE&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;padding&quot;: &quot;PKCS7&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeSREDMAC&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;padding&quot;: &quot;NONE&quot;,</div>
<div class="line">            &quot;IVType&quot;: &quot;ZERO&quot;,</div>
<div class="line">            &quot;encMode&quot;: &quot;MODE_ECB&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeAESDUKPT&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;algo&quot;: &quot;CMAC&quot;,</div>
<div class="line">            &quot;encMode&quot;: &quot;MODE_CBC&quot;,</div>
<div class="line">            &quot;padding&quot;: &quot;NONE&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | &lt;- KeySetId (1 slot)&quot;},</div>
<div class="line">              {&quot;sign&quot;: [&quot;generickeys/usr1/key2.ses&quot;,&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;generickeys/usr1/key2.ses&quot;,&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;generickeys/usr1/key2.ses&quot;,&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">              {&quot;decryptData&quot;: [&quot;generickeys/usr1/key2.ses&quot;,&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;]},</div>
<div class="line">              {&quot;retrieveEncPIN&quot;: [&quot;generickeys/usr1/key2.ses&quot;,&quot;generickeys/usr1/key1.ses&quot;,&quot;generickeys/usr1/key0.ses&quot;]}</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeRSA-WMT-PKI&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;padding&quot;: &quot;NONE&quot;,</div>
<div class="line">            &quot;KeyAddressTable&quot;: [</div>
<div class="line">              {&quot;description&quot;: &quot;| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)&quot;},</div>
<div class="line">              {&quot;encryptData&quot;: [&quot;/home/usr1/wmt-pki/encr_pub.pem&quot;,&quot;/home/usr1/wmt-pki/enc2_pub.pem&quot;]},</div>
<div class="line">              {&quot;verify&quot;: [&quot;/home/usr1/wmt-pki/vali_pub.pem&quot;,&quot;/home/usr1/wmt-pki/vali_pub.pem&quot;]}</div>
<div class="line">           ]  </div>
<div class="line">          }</div>
<div class="line">        }, </div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;: &quot;schemeCryptoReadWrite&quot;,</div>
<div class="line">          &quot;settings&quot;: {</div>
<div class="line">            &quot;legacy_decrypt&quot;: false</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
<h2><a class="anchor" id="sec_json_secGetStatus_schema"></a>
JSON Schema for Output of secGetStatus()</h2>
<p>The following JSON schema specifies the possible values delivered by the output string of the API function <a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a>. <br  />
 </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,</div>
<div class="line">  &quot;id&quot;: &quot;/&quot;,</div>
<div class="line">  &quot;definitions&quot;: {</div>
<div class="line">    &quot;moduleElement&quot;: {</div>
<div class="line">        &quot;enum&quot;: [</div>
<div class="line">          &quot;VSS&quot;, &quot;BENDIGO&quot;,</div>
<div class="line">          &quot;IPPmsk&quot;, &quot;IPPdukpt&quot;,</div>
<div class="line">          &quot;ADE&quot;, &quot;VCL&quot;, &quot;SREDMAC&quot;,</div>
<div class="line">          &quot;Voltage&quot;, &quot;VisaDSP&quot;,</div>
<div class="line">          &quot;RSA&quot;, &quot;AES&quot;</div>
<div class="line">        ]</div>
<div class="line">    },</div>
<div class="line">    &quot;statusEnum&quot;: {</div>
<div class="line">      &quot;enum&quot;: [</div>
<div class="line">        &quot;EsecOK&quot;,</div>
<div class="line">        &quot;EsecNotSupported&quot;,</div>
<div class="line">        &quot;EsecNotSupportedModule&quot;,</div>
<div class="line">        &quot;EsecCmdNotReachable&quot;,</div>
<div class="line">        &quot;EsecINVAL&quot;,</div>
<div class="line">        &quot;EsecVSSCryptpdevice&quot;,</div>
<div class="line">        &quot;EsecVSSInvalidPointer&quot;,</div>
<div class="line">        &quot;EsecVSSNotInstalled&quot;,</div>
<div class="line">        &quot;EsecVSSSystemError&quot;,</div>
<div class="line">        &quot;EsecVSSNotDefined&quot;,</div>
<div class="line">        &quot;EsecVSSnotFound&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;hostStatusElement&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;description&quot;: &quot;&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;name&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;config&quot;: { },</div>
<div class="line">        &quot;status&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: {</div>
<div class="line">            &quot;properties&quot;: {</div>
<div class="line">              &quot;commands&quot;: {</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;properties&quot;: {</div>
<div class="line">                  &quot;decryptData&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;encryptData&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;getKeyInfo&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;getKeyInventory&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;retrieveEncPIN&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;sign&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;updateKey&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;verify&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; }</div>
<div class="line">                },</div>
<div class="line">                &quot;minItems&quot;: 1,</div>
<div class="line">                &quot;uniqueItems&quot;: true</div>
<div class="line">              },</div>
<div class="line">              &quot;module&quot;: { &quot;$ref&quot;: &quot;#/definitions/moduleElement&quot; },</div>
<div class="line">              &quot;script&quot;: {</div>
<div class="line">                &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">                &quot;properties&quot;: {</div>
<div class="line">                  &quot;name&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">                  &quot;status&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; },</div>
<div class="line">                  &quot;version&quot;: { &quot;type&quot;: &quot;number&quot; }</div>
<div class="line">                },</div>
<div class="line">                &quot;required&quot;: [&quot;name&quot;, &quot;status&quot;]</div>
<div class="line">              },</div>
<div class="line">              &quot;error&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusEnum&quot; }</div>
<div class="line">            },</div>
<div class="line">            &quot;required&quot;: [&quot;module&quot;],</div>
<div class="line">            &quot;minItems&quot;: 1</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;: [&quot;status&quot;, &quot;name&quot;]</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;title&quot;: &quot;ADKSEC Get Status scheme&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">  &quot;properties&quot;: {</div>
<div class="line">    &quot;hosts&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">      &quot;items&quot;: {</div>
<div class="line">         &quot;description&quot;: &quot;service version&quot;,</div>
<div class="line">         &quot;$ref&quot;: &quot;#/definitions/hostStatusElement&quot;</div>
<div class="line">      },</div>
<div class="line">      &quot;uniqueItems&quot;: true,</div>
<div class="line">      &quot;minItems&quot;: 1</div>
<div class="line">    },</div>
<div class="line">    &quot;modules&quot;:{</div>
<div class="line">      &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">      &quot;items&quot;: {</div>
<div class="line">          &quot;description&quot;: &quot;list of supported modules by service&quot;,</div>
<div class="line">          &quot;$ref&quot;: &quot;#/definitions/moduleElement&quot;</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;service&quot;:{</div>
<div class="line">      &quot;description&quot;: &quot;service version&quot;,</div>
<div class="line">      &quot;type&quot;: &quot;string&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;API&quot;:{</div>
<div class="line">      &quot;description&quot;: &quot;API library version&quot;,</div>
<div class="line">      &quot;type&quot;: &quot;string&quot;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
<h2><a class="anchor" id="sec_json_secGetKeyInventory_schema"></a>
JSON Schema for Output of secGetKeyInventory()</h2>
<p>The following JSON schema specifies the possible values delivered by the output string of the API function <a class="el" href="namespacecom__verifone__seccmd.html#a79b00ea8a8aed3b7950800bf136a1944">secGetKeyInventory()</a>. <br  />
 </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,</div>
<div class="line">  &quot;id&quot;: &quot;/&quot;,</div>
<div class="line">  &quot;definitions&quot;: {</div>
<div class="line">    &quot;keyTypeStatus&quot; : {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;injected&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;},</div>
<div class="line">        &quot;info&quot; : {</div>
<div class="line">          &quot;type&quot;:&quot;object&quot;,</div>
<div class="line">          &quot;properties&quot;: {</div>
<div class="line">            &quot;key_id&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">            &quot;status&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">            &quot;ts&quot;:  { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">            &quot;user_id&quot;: { &quot;type&quot;: &quot;integer&quot; }</div>
<div class="line">          }</div>
<div class="line">        },</div>
<div class="line">        &quot;info_type&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;install_date&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;name&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;rkl_kbh&quot;: {</div>
<div class="line">          &quot;type&quot;:&quot;object&quot;,</div>
<div class="line">            &quot;properties&quot;: {</div>
<div class="line">              &quot;status&quot;: { &quot;$ref&quot;: &quot;#/definitions/statusRKL&quot; },</div>
<div class="line">              &quot;KeyBlockVersionID&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KeyUsage&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Algorithm&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;ModeOfUse&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KeyVersionNumber&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Exportability&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Reserved&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KSN&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;GID&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KMMMask&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KMM&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Slot&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Engine&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;RSAType&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;DeleteKeys&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;Timestamp&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KC&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">              &quot;KP&quot;: { &quot;type&quot;: &quot;string&quot; }</div>
<div class="line">            },</div>
<div class="line">            &quot;required&quot;:[&quot;status&quot;]</div>
<div class="line">        },</div>
<div class="line">        &quot;serial_number&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;version&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">        &quot;KeyType&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;KSN&quot;: { &quot;type&quot;: &quot;string&quot; }</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;:[&quot;injected&quot;]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;keyTypeStatusKEK&quot; : {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;injected&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;},</div>
<div class="line">        &quot;Algorithm&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;KeyAddress&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">        &quot;KeyLength&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">        &quot;KeyUsageAttribute&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;KeyVersion&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;ModeOfUseAttribute&quot;: { &quot;type&quot;: &quot;string&quot; },</div>
<div class="line">        &quot;slot_id&quot;: { &quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;:[&quot;injected&quot;]</div>
<div class="line">    },</div>
<div class="line">    &quot;keyTypeStatusRestricted&quot; : {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;injected&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;}</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;:[&quot;injected&quot;]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;statusType&quot;: {</div>
<div class="line">      &quot;enum&quot;: [</div>
<div class="line">        &quot;yes&quot;,</div>
<div class="line">        &quot;no&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;statusRKL&quot;: {</div>
<div class="line">      &quot;enum&quot;: [</div>
<div class="line">        &quot;available&quot;,</div>
<div class="line">        &quot;parsing failure&quot;,</div>
<div class="line">        &quot;open failure&quot;,</div>
<div class="line">        &quot;not available&quot;</div>
<div class="line">      ]</div>
<div class="line">    },</div>
<div class="line"> </div>
<div class="line">    &quot;keyElement&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;: {</div>
<div class="line">        &quot;KeySet&quot;: {</div>
<div class="line">          &quot;type&quot;:&quot;integer&quot;,</div>
<div class="line">          &quot;minimum&quot;: 1</div>
<div class="line">        },</div>
<div class="line">        &quot;DDK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot; },</div>
<div class="line">        &quot;DEK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot; },</div>
<div class="line">        &quot;MGK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot; },</div>
<div class="line">        &quot;MVK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot; },</div>
<div class="line">        &quot;PPK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot;},</div>
<div class="line">        &quot;TMK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatusRestricted&quot;},</div>
<div class="line">        &quot;KEK&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyTypeStatusKEK&quot;},</div>
<div class="line">        &quot;DUKPT&quot;: {&quot;$ref&quot;: &quot;#/definitions/keyTypeStatus&quot;},</div>
<div class="line">        &quot;AS2805&quot;: {&quot;$ref&quot;: &quot;#/definitions/keyTypeStatusRestricted&quot;}</div>
<div class="line">      },</div>
<div class="line">      &quot;required&quot;: [&quot;KeySet&quot;]</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;title&quot;: &quot;ADKSEC Get Key Inventory scheme&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;object&quot;,</div>
<div class="line">  &quot;properties&quot;: {</div>
<div class="line">    &quot;Keys&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">      &quot;items&quot;: { &quot;$ref&quot;: &quot;#/definitions/keyElement&quot; },</div>
<div class="line">      &quot;uniqueItems&quot;: true,</div>
<div class="line">      &quot;minItems&quot;: 1</div>
<div class="line">    },</div>
<div class="line">    &quot;Status&quot;: {</div>
<div class="line">      &quot;type&quot;:&quot;object&quot;,</div>
<div class="line">      &quot;properties&quot;:{</div>
<div class="line">        &quot;ADE active&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;},</div>
<div class="line">        &quot;ADE enabled&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;},</div>
<div class="line">        &quot;SlotsInUse&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;array&quot;,</div>
<div class="line">          &quot;items&quot;: { &quot;type&quot;: &quot;integer&quot; },</div>
<div class="line">          &quot;uniqueItems&quot;: true,</div>
<div class="line">          &quot;minItems&quot;: 1</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    },</div>
<div class="line">    &quot;CERT_TREE&quot;: {&quot;$ref&quot;: &quot;#/definitions/statusType&quot;}</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
 </p>
<h2><a class="anchor" id="sec_json_secGetStatus_output_example"></a>
Output example of secGetStatus()</h2>
<p>The functions <a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a> delivers a JSON formatted output string which provides the status of modules. <br  />
 </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;API&quot;: &quot;2.0.9&quot;,</div>
<div class="line">    &quot;hosts&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;default&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecNotS upported&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecNotS upported&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">         &quot;name&quot;:&quot;01&quot;,</div>
<div class="line">         &quot;status&quot;:[</div>
<div class="line">            {</div>
<div class="line">               &quot;commands&quot;:{</div>
<div class="line">                  &quot;decryptData&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;encryptData&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;getKeyInfo&quot;:&quot;EsecNotSupported&quot;,</div>
<div class="line">                  &quot;getKeyInventory&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;retrieveEncPIN&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;sign&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;updateKey&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                  &quot;verify&quot;:&quot;EsecOK&quot;</div>
<div class="line">               },</div>
<div class="line">               &quot;module&quot;:&quot;VSS&quot;,</div>
<div class="line">               &quot;script&quot;:{</div>
<div class="line">                  &quot;id&quot;:0,</div>
<div class="line">                  &quot;name&quot;:&quot;TS020122&quot;,</div>
<div class="line">                  &quot;status&quot;:&quot;EsecOK&quot;</div>
<div class="line">               }</div>
<div class="line">            }</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;name&quot;:&quot;03&quot;,</div>
<div class="line">          &quot;status&quot;:[</div>
<div class="line">              {</div>
<div class="line">                &quot;commands&quot;:{</div>
<div class="line">                    &quot;decryptData&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;encryptData&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;getKeyInfo&quot;:&quot;EsecNotSupported&quot;,</div>
<div class="line">                    &quot;getKeyInventory&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;retrieveEncPIN&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;sign&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;updateKey&quot;:&quot;EsecOK&quot;,</div>
<div class="line">                    &quot;verify&quot;:&quot;EsecOK&quot;</div>
<div class="line">                },</div>
<div class="line">                &quot;module&quot;:&quot;VSS&quot;,</div>
<div class="line">                &quot;script&quot;:{</div>
<div class="line">                    &quot;id&quot;:2,</div>
<div class="line">                    &quot;name&quot;:&quot;TS010322&quot;,</div>
<div class="line">                    &quot;status&quot;:&quot;EsecOK&quot;</div>
<div class="line">                }</div>
<div class="line">              }</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;04&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecNotSupported&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;IPPmsk&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;05&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecNotSupported&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;IPPdukpt&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;VisaDSP_P2PE_Host&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecNotSupported&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;VisaDSP&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;VisaDSP_FPE_Host&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecNotSupported&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;VisaDSP&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;RSA&quot;,</div>
<div class="line">            &quot;status&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecOK&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;RSA&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;SRED-MAC&quot;,</div>
<div class="line">            &quot;s tatus&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;commands&quot;: {</div>
<div class="line">                        &quot;decryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;encryptData&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInfo&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;getKeyInventory&quot;: &quot;EsecNotSuppo rted&quot;,</div>
<div class="line">                        &quot;retrieveEncPIN&quot;: &quot;EsecNotSupported&quot;,</div>
<div class="line">                        &quot;sign&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;updateKey&quot;: &quot;EsecOK&quot;,</div>
<div class="line">                        &quot;verify&quot;: &quot;EsecOK&quot;</div>
<div class="line">                    },</div>
<div class="line">                    &quot;module&quot;: &quot;SREDMAC&quot;</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">    ],</div>
<div class="line">    &quot;modules&quot;: [</div>
<div class="line">        &quot;ADE&quot;,</div>
<div class="line">        &quot;IPPdukpt&quot;,</div>
<div class="line">        &quot;IPPmsk&quot;,</div>
<div class="line">        &quot;RSA&quot;,</div>
<div class="line">        &quot;SREDMAC&quot;,</div>
<div class="line">        &quot;VSS&quot;,</div>
<div class="line">        &quot;VisaDSP&quot;</div>
<div class="line">    ],</div>
<div class="line">    &quot;service&quot;: &quot;2.0.9&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_VSS_Specific_Programming"></a>
Appendix B: VSS Specific Programming and Setup</h1>
<p>This document describes <a class="el" href="pg_sec_users_guide.html#sec_vss_specific_programming">VSS Specific Programming</a> as well as the <a class="el" href="pg_sec_users_guide.html#sec_vss_setup">VSS Setup</a>. A basic description of the VSS Security Module can be found in <a class="el" href="group___config.html#VSS">VSS</a>. <br  />
<br  />
</p>
<h2><a class="anchor" id="sec_vss_specific_programming"></a>
VSS Specific Programming</h2>
<p>This section provides the following descriptions:</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#subsec_security_initialization_vss_engines">Initialization of VSS Engines</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_KsITab">Key-Set-ID Table</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_flexible_macro_selection">Flexible Macro Selection</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_macros_used_by_functions">API Functions and Related Macros</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_macros_in_api_functions">Macro Usage in API Functions</a></li>
</ul>
<p>The special VSS features <a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a> and <a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a> are described in <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a>. <br  />
</p>
<h3><a class="anchor" id="subsec_security_initialization_vss_engines"></a>
Initialization of VSS Engines</h3>
<p>After startup ADK-SEC executes following actions:</p><ul>
<li>reading VSS script names from the configuration file and installs the required engines</li>
<li>initializing the VSS Engines with key data by the macros <code>SCRIPT_INIT</code> (if not yet initialized what is checked by macro <code>SCRIPT_CHECK_INIT</code>)</li>
<li>set up a delta for Key-Set-ID Table by macro <code>SCRIPT_GET_KEY_SET_INIT</code> if available (see <a class="el" href="pg_sec_users_guide.html#subsec_flexible_macro_selection">Flexible Macro Selection</a>) otherwise the <a class="el" href="pg_sec_users_guide.html#subsubsec_default_keysetid_table">Default Key-Set-ID Table</a> is used</li>
</ul>
<p>Once the settings have been established the application can process the supported security commands as per API. <br  />
<br  />
<em>Table: Macros Executed by VSS Engine Initialization</em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Macro name </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Macro input data </th><th class="markdownTableHeadNone">Macro output data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="group__vss.html#ga6f0b4e52bf562c5a7496865d4dffadb6">SCRIPT_CHECK_INIT</a></code>  </td><td class="markdownTableBodyNone">33 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Checks if script has not been already initialized. Provide <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a> information  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="group__vss.html#gae1bdf3a721db08a56686cdc1fbd1a396">SCRIPT_INIT</a></code>  </td><td class="markdownTableBodyNone">30 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Initializes script, is executed after script installation  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="group__vss.html#ga4c974ae980ab4b8813673b5b555836b8">SCRIPT_GET_KEY_SET_INIT</a></code>  </td><td class="markdownTableBodyNone">32 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Delta[] </td><td class="markdownTableBodyNone">Provides a delta for Key Set ID Table (see Key-Set-ID Table). Execution if macro is available  </td></tr>
</table>
<p>The macros are in the responsibility of the VSS developer. <br  />
</p>
<h3><a class="anchor" id="subsec_KsITab"></a>
Key-Set-ID Table</h3>
<p>The Key-Set-ID Table is a fundamental concept of VSS programming. The table is implemented in VSS Security Module and allows to hold up to 64 different crypto schemes each defined by <br  />
a table element of macro IDs per Key Types and functional steps. <br  />
Each table element is assigned to a KeySetID and includes macros which are executed by certain operations (API functions). <br  />
 This means that a cryptographic scheme can be selected by setting the KeySetID (by <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a>). <br  />
<br  />
The table is predefined (<a class="el" href="pg_sec_users_guide.html#subsubsec_default_keysetid_table">Default Key-Set-ID Table</a>) and can be updated by the VSS developer to define his own cryptographic scheme (see <a class="el" href="pg_sec_users_guide.html#subsec_flexible_macro_selection">Flexible Macro Selection</a>). <br  />
<br  />
The table structure is described in the following section. The relationship between API functions, Key Types and macros is presented in <a class="el" href="pg_sec_users_guide.html#subsec_macros_used_by_functions">API Functions and Related Macros</a>.</p>
<h4><a class="anchor" id="subsubsec_struct_keysetid_table"></a>
Structure and Mode of Operation of the Key-Set-ID Table</h4>
<p>The Key-Set-ID Table is implemented in the VSS Security Module and includes VSS macro IDs per Key Types and functional steps ('Update' and 'Crypto' oerations).</p>
<p><em>Table: Structure of a Key-Set-ID Table Element</em></p>
<p><a class="anchor" id="Key-Set-ID-Table-Element"></a></p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key Type </th><th class="markdownTableHeadNone">Update Prepare </th><th class="markdownTableHeadNone">Update Process </th><th class="markdownTableHeadNone">Update Finalize </th><th class="markdownTableHeadNone">Crypto Test </th><th class="markdownTableHeadNone">Crypto Prepare </th><th class="markdownTableHeadNone">Crypto Process </th><th class="markdownTableHeadNone">Crypto Finalize  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b> 0 (DUKPT) </b> </td><td class="markdownTableBodyNone">macro10 (00h) </td><td class="markdownTableBodyNone">macro20 (10h) </td><td class="markdownTableBodyNone">macro30 (00h) </td><td class="markdownTableBodyNone">macro40 (00h) </td><td class="markdownTableBodyNone">macro50 (00h) </td><td class="markdownTableBodyNone">macro60 (00h) </td><td class="markdownTableBodyNone">macro70 (00h)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b> 1 (PPK) </b> </td><td class="markdownTableBodyNone">macro11 (35h) </td><td class="markdownTableBodyNone">macro21 (16h) </td><td class="markdownTableBodyNone">macro31 (00h) </td><td class="markdownTableBodyNone">macro41 (37h) </td><td class="markdownTableBodyNone">macro51 (70h) </td><td class="markdownTableBodyNone">macro61 (75h) </td><td class="markdownTableBodyNone">macro71 (76h)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b> 2 (MGK) </b> </td><td class="markdownTableBodyNone">macro12 (35h) </td><td class="markdownTableBodyNone">macro22 (17h) </td><td class="markdownTableBodyNone">macro32 (00h) </td><td class="markdownTableBodyNone">macro42 (38h) </td><td class="markdownTableBodyNone">macro52 (60h) </td><td class="markdownTableBodyNone">macro62 (61h) </td><td class="markdownTableBodyNone">macro72 (62h)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b> 3 (MVK) </b> </td><td class="markdownTableBodyNone">macro13 (35h) </td><td class="markdownTableBodyNone">macro23 (19h) </td><td class="markdownTableBodyNone">macro33 (00h) </td><td class="markdownTableBodyNone">macro43 (38h) </td><td class="markdownTableBodyNone">macro53 (63h) </td><td class="markdownTableBodyNone">macro63 (64h) </td><td class="markdownTableBodyNone">macro73 (65h)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b> 4 (DEK) </b> </td><td class="markdownTableBodyNone">macro14 (35h) </td><td class="markdownTableBodyNone">macro24 (15h) </td><td class="markdownTableBodyNone">macro34 (00h) </td><td class="markdownTableBodyNone">macro44 (36h) </td><td class="markdownTableBodyNone">macro54 (40h) </td><td class="markdownTableBodyNone">macro64 (43h) </td><td class="markdownTableBodyNone">macro74 (42h)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b> 5 (DDK) </b> </td><td class="markdownTableBodyNone">macro15 (35h) </td><td class="markdownTableBodyNone">macro25 (18h) </td><td class="markdownTableBodyNone">macro35 (00h) </td><td class="markdownTableBodyNone">macro45 (36h) </td><td class="markdownTableBodyNone">macro55 (50h) </td><td class="markdownTableBodyNone">macro65 (53h) </td><td class="markdownTableBodyNone">macro75 (52h)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b> 6 (KEK) </b> </td><td class="markdownTableBodyNone">macro16 (35h) </td><td class="markdownTableBodyNone">macro26 (1Ah) </td><td class="markdownTableBodyNone">macro36 (00h) </td><td class="markdownTableBodyNone">macro46 (00h) </td><td class="markdownTableBodyNone">macro56 (00h) </td><td class="markdownTableBodyNone">macro66 (00h) </td><td class="markdownTableBodyNone">macro76 (00h)  </td></tr>
</table>
<p>Here the elements macro10 to macro76 are just placeholders for the real macro IDs. In brackets the default macro IDs are listed (see <a class="el" href="pg_sec_users_guide.html#subsubsec_default_keysetid_table">Default Key-Set-ID Table</a>). <br  />
<br  />
 The following Key Types are defined:</p><ul>
<li>Basic DUKPT Key (DUKPT)</li>
<li>PIN Protection Key (PPK)</li>
<li>Mac Generation Key (MGK)</li>
<li>Mac Verification Key (MVK)</li>
<li>Data Encryption Key (DEK)</li>
<li>Data Decryption Key (DDK)</li>
<li>Key Encryption Key (KEK).</li>
</ul>
<p>The following functional steps are defined:</p><ul>
<li>for an 'update' key operation:<ul>
<li>Update Prepare</li>
<li>Update Process</li>
<li>Update Finalize <br  />
<br  />
</li>
</ul>
</li>
<li>for a 'cryptographic' operation:<ul>
<li>Crypto Test</li>
<li>Crypto Prepare</li>
<li>Crypto Process</li>
<li>Crypto Finalize</li>
</ul>
</li>
</ul>
<p>The 'update' key operations are performed sequentially by the function <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> and execute the VSS macros according a selected Key Type. <br  />
Similarly the 'cryptographic' operations are performed by functions <a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#a66a1992f617359f2e4a96f4980478f82">secSign()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> and <a class="el" href="namespacecom__verifone__seccmd.html#a9cd679dc9763b06566dff28b3d3268c9">secDecryptData()</a>. <br  />
A detailed description of the relationship between API functions and related macros can be found in <a class="el" href="pg_sec_users_guide.html#subsec_macros_used_by_functions">API Functions and Related Macros</a>. <br  />
<br  />
A macro execution is skipped if a macro ID is equal to 0.</p>
<h4><a class="anchor" id="subsubsec_default_keysetid_table"></a>
Default Key-Set-ID Table</h4>
<p>The Key-Set-ID Table is predefined in the VSS Security Module but can be changed (see <a class="el" href="pg_sec_users_guide.html#subsec_flexible_macro_selection">Flexible Macro Selection</a>). <br  />
The Default Key-Set-ID Table has 8 elements which means that KeySetID=1, ..., KeySetID=8 can be selected. The table values of the are presented by the following table: <br  />
<br  />
<em>Table: Default Key-Set-ID Table</em> <a class="anchor" id="Default-Key-Set-ID-Table"></a></p><div class="fragment"><div class="line">KT   | Key set 1            | Key set 2            | Key set 3            | Key set 4            | Key set 5            | Key set 6            | Key set 7            | Key set 8</div>
<div class="line">-----|----------------------|----------------------|----------------------|----------------------|----------------------|----------------------|----------------------|---------------------</div>
<div class="line">DUPKT| 00,10,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">PPK  | 35,16,00,37,70,75,76 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">MGK  | 35,17,00,38,60,61,62 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">MVK  | 35,19,00,38,63,64,65 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">DEK  | 35,15,00,36,40,43,42 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">DDK  | 35,18,00,36,50,53,52 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
<div class="line">KEK  | 35,1a,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00 | 00,00,00,00,00,00,00</div>
</div><!-- fragment --><p><code>KeySetID=1</code> is also the default adjustment in ADK-SEC. That means, if no Key-Set-ID is selected, the default macro ID set of the first table element is effective. <br  />
<br  />
 </p>
<h3><a class="anchor" id="subsec_flexible_macro_selection"></a>
Flexible Macro Selection</h3>
<p>Flexible Macro Selection allows a VSS developer to define his own cryptographic scheme based on the Key-Set-ID Table by updating the predefined <a class="el" href="pg_sec_users_guide.html#subsubsec_default_keysetid_table">Default Key-Set-ID Table</a>. <br  />
This can be done by editing the VSS macro <code>SCRIPT_GET_KEY_SET_INIT</code> (32h) and inserting a delta list of macro IDs. <br  />
The macro <code>SCRIPT_GET_KEY_SET_INIT</code> is executed on each system restart (see <a class="el" href="pg_sec_users_guide.html#subsec_security_initialization_vss_engines">Initialization of VSS Engines</a>) and returns the delta list of macro IDs to the security service <br  />
which updates the Key-Set-ID-Table and makes the new cryptographic scheme effective. <br  />
<br  />
For details see the following section. </p>
<h4><a class="anchor" id="subsubsec_keyset_id_table_update"></a>
Key-Set-ID Table Update</h4>
<p>The Key-Set-ID Table can be updated by editing the default VSS macro IDs of <code>SCRIPT_GET_KEY_SET_INIT</code> (32h) and adding a delta list of macro IDs. <br  />
This shall result in a data vector with the following structure (each element is a one byte hexadecimal number) (see also <a class="el" href="pg_sec_users_guide.html#Examples">Examples</a>): </p><div class="fragment"><div class="line">{Version, MaxNoKeySetIDs},</div>
<div class="line"> </div>
<div class="line">Per Key Type/ Key Set ID:</div>
<div class="line">{KeyType, {KeySetID, update-prepare-macroID, update-process-macroID, update-finalize-macroID, crypto-test-macroID, crypto-prepare- macroID, crypto-process-macroID, crypto-finalize-macroID}},</div>
<div class="line">{KeyType-separator}</div>
</div><!-- fragment --><ul>
<li>Version: version of vector</li>
<li>MaxNoKeySetIDs: max. number of supported KeySetIDs (&lt;=8 in version1; &lt;=64 in version2)</li>
<li>KeyType: Key Type (0 - 6), mandatory if next Key Type will be different, possible values:<ul>
<li>DUKPT: 0</li>
<li>PPK: 1</li>
<li>MGK: 2</li>
<li>MVK: 3</li>
<li>DEK: 4</li>
<li>DDK: 5</li>
<li>KEK: 6</li>
</ul>
</li>
<li>KeySetID: Key Set ID (1 - <code>MaxNoKeySetIDs</code>)</li>
<li>...-macroID: ID of macro used for relevant functional step</li>
<li>KeyType-separator: value 00h, mandatory if next Key Type will be different</li>
</ul>
<p>The data have to be loaded 8-Byte-wise in script register A by instruction LDAI. <br  />
</p><dl class="section note"><dt>Note</dt><dd><a class="anchor" id="Version"></a><b><em>Version and MaxNoKeySetIDs</em></b> <br  />
The <code>Version</code> byte can indicate to the VSS security module how many Key-Set-IDs to handle: <br  />
<ul>
<li><code>Version=1</code>: maximal 8 Key-Set-IDs can be used</li>
<li><code>Version=2</code>: up to 64 Key-Set-IDs can be used</li>
</ul>
</dd></dl>
<p><br  />
<b>Update Dependency of feature "Additional Key Types"</b> <br  />
The update of the Key-Set-ID Table depends on the feature <a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a> in macro SCRIPT_CHECK_INIT. <br  />
How the macro IDs are updated per Key-Set-ID is shown by the following table: <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">feature </th><th class="markdownTableHeadNone">Key Set 1 </th><th class="markdownTableHeadNone">Key Set 2, ...  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">disabled </td><td class="markdownTableBodyNone">default table updated by macro 32h </td><td class="markdownTableBodyNone">0-initialized table updated by macro 32h  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">enabled </td><td class="markdownTableBodyNone">default table updated by macro 32h </td><td class="markdownTableBodyNone">Key Set 1 values updated by macro 32h  </td></tr>
</table>
<p><br  />
<a class="anchor" id="Examples"></a><b>Example 1: Key-Set-ID Table Update by <code>SCRIPT_GET_KEY_SET_INIT</code> (Feature 'Additional Key Types' disabled)</b> <br  />
</p><div class="fragment"><div class="line"><span class="comment">//------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// SCRIPT_GET_KEY_SET_INIT</span></div>
<div class="line"><span class="comment"></span>MACRO 32h</div>
<div class="line">LENGTH 0</div>
<div class="line"><span class="comment">// set init vector for key set table</span></div>
<div class="line"><span class="comment">//      {1, 8}, {4, {1, EE,15,00, 35,40,43,42}, {5, 1D,1E,1B, 0,2B,23,2A}}, 00,</span></div>
<div class="line"><span class="comment">//              {1, {3, 35,16,00, 37,70,75,76}}, 00,</span></div>
<div class="line"><span class="comment">//              {2, {3, 35,17,00, 38,60,61,62}}, 00,</span></div>
<div class="line"><span class="comment">//              {3, {3, 35,19,00, 38,63,64,65}}, 00,</span></div>
<div class="line"><span class="comment">//              {4, {3, 35,15,00, 36,40,43,42}}, 00,</span></div>
<div class="line"><span class="comment">//              {5, {3, 35,18,00, 36,50,53,52}}, 00,</span></div>
<div class="line"><span class="comment">//              {6, {3, 35,1a,00, 00,00,00,00}}, 00 and send out</span></div>
<div class="line"><span class="comment">// - {1, 8} - Version, maximal count of key sets</span></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------------</span></div>
<div class="line">LDAI 01080401EE150035      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 0                    <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 404342051D1E1B00      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 8                    <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 2B232A0001033516      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 16                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 0037707576000203      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 24                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 3517003860616200      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 32                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 0303351900386364      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 40                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 6500040335150036      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 48                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 4043420005033518      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 56                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 0036505352000603      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 64                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">LDAI 351a000000000000      <span class="comment">// Load A default status</span></div>
<div class="line">SENDA 72                   <span class="comment">// Copy the Status from A to the CB</span></div>
<div class="line">EOM 80</div>
</div><!-- fragment --><p>The following trace illustrates the Key-Set-ID-Table update after macro execution:</p>
<p><em>Table: Updated Key-Set-ID Table</em> <br  />
</p><div class="fragment"><div class="line">KS Id| Macro type          |DUKPT| PPK | MGK | MVK | DEK | DDK | KEK |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   1 | update prepare      |   0 |  35 |  35 |  35 |  ee |  35 |  35 |</div>
<div class="line">     | update process      |  10 |  16 |  17 |  19 |  15 |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |  35 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  40 |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  43 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  42 |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   2 | update prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   3 | update prepare      |   0 |  35 |  35 |  35 |  35 |  35 |  35 |</div>
<div class="line">     | update process      |   0 |  16 |  17 |  19 |  15 |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |  36 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  40 |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  43 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  42 |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   4 | update prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   5 | update prepare      |   0 |   0 |   0 |   0 |  1d |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |  1e |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |  1b |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |  2b |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |  23 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |  2a |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   6 | update prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   7 | update prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   8 | update prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto process      |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
</div><!-- fragment --><p> <br  />
<br  />
<b>Example 2: Key-Set-ID Table Update by <code>SCRIPT_GET_KEY_SET_INIT</code> (Feature 'Additional Key Types' enabled)</b> <br  />
<br  />
An example of Key-Set-ID Table can be found in <a class="el" href="pg_sec_users_guide.html#subsubsec_example_add_key_types">Example: Use additional Key Types for key loading and data encryption</a>. <br  />
<br  />
The following trace illustrates the Key-Set-ID-Table update after macro execution:</p>
<p><em>Table: Updated Key-Set-ID Table</em> <br  />
</p><div class="fragment"><div class="line">KS Id| Macro type          |DUKPT| PPK | MGK | MVK | DEK | DDK | KEK |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   1 | update prepare      |   0 |  35 |  35 |  35 |  ee |  35 |  35 |</div>
<div class="line">     | update process      |  10 |  16 |  17 |  19 |  15 |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |  35 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  40 |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  43 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  42 |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   3 | update prepare      |   0 |  35 |  35 |  35 |  35 |  35 |  35 |</div>
<div class="line">     | update process      |  10 |  16 |  17 |  19 |  15 |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |  36 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  40 |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  43 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  42 |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">   5 | update prepare      |   0 |  35 |  35 |  35 |  1d |  35 |  35 |</div>
<div class="line">     | update process      |  10 |  16 |  17 |  19 |  1e |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |  1b |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |   0 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  2b |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  23 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  2a |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
<div class="line">  24 | update prepare      |   0 |  35 |  35 |  35 |  ee |  35 |  35 |</div>
<div class="line">     | update process      |  10 |  16 |  17 |  19 |  15 |  18 |  1a |</div>
<div class="line">     | update finalize     |   0 |   0 |   0 |   0 |   0 |   0 |   0 |</div>
<div class="line">     | crypto test work.key|   0 |  37 |  38 |  38 |  35 |  36 |   0 |</div>
<div class="line">     | crypto prepare      |   0 |  70 |  60 |  63 |  40 |  50 |   0 |</div>
<div class="line">     | crypto process      |   0 |  75 |  61 |  64 |  43 |  53 |   0 |</div>
<div class="line">     | crypto finalize     |   0 |  76 |  62 |  65 |  42 |  52 |   0 |</div>
<div class="line">----------------------------------------------------------------------</div>
</div><!-- fragment --><h3><a class="anchor" id="subsec_macros_used_by_functions"></a>
API Functions and Related Macros</h3>
<p>The subsequent flow charts show the used macros per API function. <br  />
The macros are identified by symbolic names (see <a class="el" href="pg_sec_users_guide.html#sec_reserved_macro_ids_and_script_examples">Reserved VSS Macro IDs and Script Examples</a>) and are in the responsibility of the VSS script developer. <br  />
<br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="07_Flow_Chart__secUpdateKey.png" alt=""/>
</div>
  <blockquote class="doxtable">
<dl class="section remark"><dt>Remarks</dt><dd><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> is able to deliver output data returned by the assigned Update Finalize macro. <br  />
The data are provided by the parameter <em>propData</em>. This is independent from the selected Key Type. </dd></dl>
</blockquote>
<p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#a77860b4cffed3ba159a5c124c8e2cde2">secIncrementKSN()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="08_Flow_Chart__secIncrementKSN.png" alt=""/>
</div>
 <p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#a66a1992f617359f2e4a96f4980478f82">secSign()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="11_Flow_Chart__secSign.png" alt=""/>
</div>
  <blockquote class="doxtable">
<dl class="section remark"><dt>Remarks</dt><dd><a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a> changes the parameters of macros. </dd></dl>
</blockquote>
<p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="12_Flow_Chart__secVerify.png" alt=""/>
</div>
  <blockquote class="doxtable">
<dl class="section remark"><dt>Remarks</dt><dd><a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a> changes the parameters of macros. </dd></dl>
</blockquote>
<p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="10_Flow_Chart__secEncryptData.png" alt=""/>
</div>
 <p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#a9cd679dc9763b06566dff28b3d3268c9">secDecryptData()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="10_2_Flow_Chart__secDecryptData.png" alt=""/>
</div>
  <blockquote class="doxtable">
<dl class="section remark"><dt>Remarks</dt><dd><a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a> changes the parameters of macros. </dd></dl>
</blockquote>
<p><br  />
<br  />
<em>Flow Chart: <a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> related macros</em> <br  />
<br  />
</p><div class="image">
<img src="16_Flow_Chart__secRetrieveEncryptedPIN.png" alt=""/>
</div>
<p>  <br  />
<br  />
</p>
<h3><a class="anchor" id="subsec_macros_in_api_functions"></a>
Macro Usage in API Functions</h3>
<p>The following tables show the VSS macros used by API function with their in- and output parameters. <br  />
Each table presents the macros in the order of execution per API function. <br  />
</p>
<p>The macro are presented by their symbolic names or by their path in the Key-Set-ID Table (see <a class="el" href="pg_sec_users_guide.html#Key-Set-ID-Table-Element">Key-Set-ID-Table-Element</a>). <br  />
<br  />
<a class="anchor" id="Function-Macro-Tables"></a> <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">UpdatePrepare[KeySetID] [KeyType] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">UpdateProcess[KeySetID] [KeyType] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">KeyData [KeyDataLen] </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">stores key data in script  </td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">if DUKPT configuration "KSNincrementation"<br  />
 is not set or set to "BY_OPERATION": </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoTest[KeySetID][DEK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: check for data encryption key (DEK)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoPrepare[KeySetID][DEK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">IV[8] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: set IV  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Loop over blocks: </td><td class="markdownTableBodyNone">CryptoProcess[KeySetID][DEK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">Block <br  />
 [Block Size] </td><td class="markdownTableBodyNone">encData [Block Size] </td><td class="markdownTableBodyNone">encrypts data block wise <br  />
 (last block padded with 0 if needed)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoFinalize[KeySetID][KeyType] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#a9cd679dc9763b06566dff28b3d3268c9">secDecryptData()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">if DUKPT configuration "KSNincrementation"<br  />
 is not set or set to "BY_OPERATION": </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoTest[KeySetID][DDK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: check for data decryption key (DDK)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoPrepare[KeySetID][DDK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">IV[8] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: set IV  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Loop over blocks: </td><td class="markdownTableBodyNone">CryptoProcess[KeySetID][DDK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">Block <br  />
 [Block Size] </td><td class="markdownTableBodyNone">decData <br  />
 [Block Size] </td><td class="markdownTableBodyNone">decrypts data block wise  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoFinalize[KeySetID][DDK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#a66a1992f617359f2e4a96f4980478f82">secSign()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">if DUKPT configuration "KSNincrementation"<br  />
 is not set or set to "BY_OPERATION": </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoTest[KeySetID][MGK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: check for MAC generation key (MGK)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoPrepare[KeySetID][MGK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">IV[8] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">initialized with 0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Loop over blocks: </td><td class="markdownTableBodyNone">CryptoProcess[KeySetID][MGK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">Block [Block Size] </td><td class="markdownTableBodyNone">decData [Block Size] </td><td class="markdownTableBodyNone">block wise data iteration (last block padded with 0 if needed)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoFinalize[KeySetID][MGK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">MAC[MACLength] </td><td class="markdownTableBodyNone">generates MAC  </td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">if DUKPT configuration "KSNincrementation"<br  />
 is not set or set to "BY_OPERATION": </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoTest[KeySetID][MVK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: check for MAC verification key (MVK)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoPrepare[KeySetID][MVK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">IV[8] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">initialized with 0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Loop over blocks: </td><td class="markdownTableBodyNone">CryptoProcess[KeySetID][MVK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">Block [Block Size] </td><td class="markdownTableBodyNone">decData [Block Size] </td><td class="markdownTableBodyNone">block wise data iteration (last block padded with 0 if needed)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoFinalize[KeySetID][MVK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">MAC[4] </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">MAC verification  </td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version=1 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> + (KeySetID-1) <br  />
 </td><td class="markdownTableBodyNone">C7+(Key SetID-1) </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version=2 (see <a class="el" href="pg_sec_users_guide.html#Version">Version</a>): </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> </td><td class="markdownTableBodyNone">C7 </td><td class="markdownTableBodyNone">KeySetID </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">stores KeySetID in script  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">if DUKPT configuration "KSNincrementation"<br  />
 is not set or set to "BY_OPERATION": </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoTest[KeySetID][PPK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">e.g.: check for PIN encryption key (PPK)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoPrepare[KeySetID][PPK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PIN initialization  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PINBlockFormat: <br  />
 <b>If</b> <b>PIN</b> <b>entered:</b>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">sets PIN block format  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ISO-0: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#gab0401f08b432090d24c08d693c24623f">ISO_0_PREPARE</a> </td><td class="markdownTableBodyNone">71 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">PINLen[1] </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">or ISO-1: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga00b2e946cd1be6cf52c2c7a4053dfbe1">ISO_1_PREPARE</a> </td><td class="markdownTableBodyNone">72 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">PINLen[1] </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">or ISO-2: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#gacea965f7ae6b742e08f5b58bb3d5662f">ISO_2_PREPARE</a> </td><td class="markdownTableBodyNone">73 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PINLen[1] </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">or ISO-3: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga8f23d658f785f47190fec967d9783060">ISO_3_PREPARE</a> </td><td class="markdownTableBodyNone">74 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">PINLen[1] </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>else:</b>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ISO-0: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#gaf2d8b3378e65c59be442b014f2b8d778">ISO_0_PREPARE_PIN_0</a> </td><td class="markdownTableBodyNone">80 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">or ISO-1: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga39c55220e84204f89781f2d6de3f6816">ISO_1_PREPARE_PIN_0</a> </td><td class="markdownTableBodyNone">81 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">or ISO-2: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga9d809956812d078bd317d5ea51d3a3b7">ISO_2_PREPARE_PIN_0</a> </td><td class="markdownTableBodyNone">82 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">or ISO-3: </td><td class="markdownTableBodyNone"><a class="el" href="group__vss.html#gaf265eb037a8e3c00a57d1e62a5ee1d95">ISO_3_PREPARE_PIN_0</a> </td><td class="markdownTableBodyNone">83 </td><td class="markdownTableBodyNone">PAN[6] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">sets PIN block format  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoProcess[KeySetID][PPK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">Optional:<br  />
 <a class="el" href="pg_sec_users_guide.html#PINDerivationData">PINDerivationData</a>[16] </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PIN iteration  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CryptoFinalize[KeySetID][PPK] </td><td class="markdownTableBodyNone"><a class="el" href="pg_sec_users_guide.html#id">id</a> </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">encPIN[8] </td><td class="markdownTableBodyNone">encrypts PIN block  </td></tr>
</table>
<p><br  />
 <em>Table: Macro Table for <b><a class="el" href="namespacecom__verifone__seccmd.html#a77860b4cffed3ba159a5c124c8e2cde2">secIncrementKSN()</a></b></em> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Macro ID path </th><th class="markdownTableHeadNone">Macro ID (hex) </th><th class="markdownTableHeadNone">Input Data </th><th class="markdownTableHeadNone">Output Data </th><th class="markdownTableHeadNone">Macro description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group__vss.html#ga7af69135d805e5206cf42c8783c9c8f9">GET_NEW_DUKPT</a> </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">KSN[10] </td><td class="markdownTableBodyNone">increments KSN and generates DUKPT key  </td></tr>
</table>
<p><br  />
 </p><hr  />
<p><b><em>Footnotes</em></b></p><ul>
<li><a class="anchor" id="id"></a><b>id</b>: This macro ID is provided by the <a class="el" href="pg_sec_users_guide.html#subsubsec_default_keysetid_table">Default Key-Set-ID Table</a> or by the updated Key-Set-Table (refer to <a class="el" href="pg_sec_users_guide.html#subsubsec_keyset_id_table_update">Key-Set-ID Table Update</a>).</li>
<li><a class="anchor" id="PINDerivationData"></a><b>PINDerivationData</b>: PIN derivation data (16 bytes) include <em>Stan</em> (6 bytes) and <em>Amount</em> (6 bytes) in the following manner (numbers in brackets mean array index): <div class="fragment"><div class="line">PINDerivationData[0...2] &lt;- Stan[3...5]</div>
<div class="line">PINDerivationData[3...10] = 0</div>
<div class="line">PINDerivationData[10...15] &lt;- Amount[0...5].</div>
</div><!-- fragment --></li>
</ul>
<p><br  />
<br  />
</p>
<h2><a class="anchor" id="sec_vss_setup"></a>
VSS Setup</h2>
<p>The VSS setup includes the following issues:</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#subsec_vss_scripts">VSS Scripts</a></li>
<li><a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a></li>
</ul>
<h3><a class="anchor" id="subsec_vss_scripts"></a>
VSS Scripts</h3>
<h4><a class="anchor" id="subsubsec_vss_script_naming"></a>
VSS Script Naming</h4>
<p>Each host configuration has its own security script with an unique name per Host ID.</p>
<p>Distinguish two notations:</p><ol type="1">
<li><em>Script</em> <em>File</em> <em>Name</em> </li>
<li><em>Script</em> <em>Name</em> defined by identifier SCRIPT inside a VSS script</li>
</ol>
<p>It is recommended to use a structured naming convention for <em>Script</em> <em>File</em> <em>Name</em> and <em>Script</em> <em>Name</em> as suggested below. <br  />
However, since several user need to apply legacy VSS scripts with generic names a free choice of names is also possible. <br  />
 <br  />
<em>Naming Convention for Script File Name</em> <br  />
The file name should match the following format: <br  />
</p><pre class="fragment">   &lt;Name&gt;&lt;Host ID&gt;&lt;Key Management&gt;&lt;Algorithm&gt;.vss
</pre><p> There is no limitation in the amount of characters for the file name.</p>
<p>Examples:</p><ol type="1">
<li><em>ABC0121.vss</em> (Name: ABC, Host ID: 01, Key Management: DUKPT, Algo.: 1DES)</li>
<li><em>ABC0222.vss</em> (Name: ABC, Host ID: 02, Key Management: DUKPT, Algo.: 3DES)</li>
</ol>
<p><br  />
<em>Naming Convention for Script Name</em> <br  />
The script name defined by identifier SCRIPT in the configuration part of the VSS script must consist of 8 ASCII characters and should be structured as follows:</p><ul>
<li>Character 1-4: a name including a version</li>
<li>Character 5-6: HostId (mandatory)</li>
<li>Character 7: Key Management Scheme</li>
<li>Character 8: Algorithm</li>
</ul>
<p>Example: <br  />
</p><pre class="fragment">    SCRIPT AU010122 // Script Name AU010122
                    // AU01 - APCA Compliant Security Script
                    // 01 - Host ID 01
                    // 22 - 3DES compliant.
</pre><p><br  />
<em>Free Choice Notation</em> <br  />
Only the length of the Script Name is restricted to maximal 8 characters.</p>
<p>Example: <br  />
Script Name: <code>INTRv1.0</code>, Script File Name: <code>SECU.vso</code> <br  />
</p>
<p>Entries in configuration file (see <a class="el" href="pg_sec_users_guide.html#sec_json_config_schema">JSON Schema for Configuration File</a> and sec_json_config_example ): </p><pre class="fragment">     "scriptFileName": "SECU.vso",
         "scriptName": "SECU",
</pre><p> Entry in VSS script SECU.vss: </p><pre class="fragment">     SCRIPT INTRv1.0
</pre><dl class="section remark"><dt>Remarks</dt><dd>Examples of VSS scripts can be found in <a class="el" href="pg_sec_users_guide.html#subsec_msk_vss_script_example">MSK VSS Script Example</a> and <a class="el" href="pg_sec_users_guide.html#subsec_dukpt_vss_script_example">DUKPT VSS Script Example</a>. <br  />
<br  />
</dd></dl>
<h3><a class="anchor" id="subsec_security_vss_feature"></a>
VSS Feature Switches</h3>
<p>Each VSS script can have the possibility to enable/disable special VSS features. <br  />
This can be realized by the Macro 33h. <br  />
<br  />
Currently the special featues can be the <a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a> and the feature <a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a>. <br  />
<br  />
The data of Macro 33h must have the following format:</p>
<ul>
<li>byte 1: Version<br  />
</li>
<li>byte 2: Feature bitmask<ul>
<li>bit 0 - enable/disable variable block size for enc-/decryption and MAC macros (<a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a>)</li>
<li>bit 1 - enable/disable support of Additional Key Types(<a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a>)</li>
</ul>
</li>
</ul>
<p><br  />
<em>Example</em> <br  />
<b>MACRO 33h // <code>SCRIPT_CHECK_INIT</b></code> </p><div class="fragment"><div class="line">MACRO 33h</div>
<div class="line">  LENGTH 0</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// provide version and feature mask</span></div>
<div class="line">  LDAI 0101000000000000   <span class="comment">// 01 - version, 01 - use variable block size for crypto and MAC operation</span></div>
<div class="line">  SENDA 0</div>
<div class="line">EOM 2</div>
</div><!-- fragment --><p> <br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_Reserved_VSS_Macro_and_Example"></a>
Appendix C: Reserved VSS Macro IDs and Script Examples</h1>
<h2><a class="anchor" id="sec_reserved_macro_ids_and_script_examples"></a>
Reserved VSS Macro IDs and Script Examples</h2>
<p>This documentation shows the reserved VSS macro IDs and presents script examples for MSK (<a class="el" href="pg_sec_users_guide.html#subsec_msk_vss_script_example">MSK VSS Script Example</a>) and DUKPT (<a class="el" href="pg_sec_users_guide.html#subsec_dukpt_vss_script_example">DUKPT VSS Script Example</a>) key management systems. <br  />
A list of reserved macro IDs can be found in <a class="el" href="group__vss.html">Vss</a>. <br  />
 </p>
<h3><a class="anchor" id="subsec_msk_vss_script_example"></a>
MSK VSS Script Example</h3>
<p>This section presents a MSK VSS script example which can be used as a templates for own user implementation. <br  />
<br  />
 </p><div class="fragment"><div class="line">SCRIPT xxxxxxxx   </div>
<div class="line">SUBDEV 00h    // Script Number: 0 </div>
<div class="line">DEF_BLK 255 0 // Allocate 255 blocks </div>
<div class="line">  </div>
<div class="line">// Slots description </div>
<div class="line">// 0 -  1 TMK  key [MSK] </div>
<div class="line"> </div>
<div class="line">// Slot Sz  Description </div>
<div class="line">// 2    96  Refer table </div>
<div class="line">// </div>
<div class="line">//                    Key Set </div>
<div class="line">//           _______________________________ </div>
<div class="line">// Key Type |   |   |   |   |   |   |   |   | </div>
<div class="line">//          |_1_|_2_|_3_|_4_|_5_|_6_|_7_|_8_| </div>
<div class="line">//          |   |   |   |   |   |   |   |   | </div>
<div class="line">// PPK      |2  |14 |26 |38 |50 |62 |74 |86 | </div>
<div class="line">// MGK      |4  |16 |28 |40 |52 |64 |76 |88 | </div>
<div class="line">// MVK      |6  |18 |30 |42 |54 |66 |78 |90 | </div>
<div class="line">// DEK      |8  |20 |32 |44 |56 |68 |80 |92 | </div>
<div class="line">// DDK      |10 |22 |34 |46 |58 |70 |82 |94 | </div>
<div class="line">// KEK      |12 |24 |36 |48 |60 |72 |84 |96 | </div>
<div class="line">//          |_______________________________| </div>
<div class="line">   </div>
<div class="line">// 100 -    KeySetId </div>
<div class="line">// 101 -    Intermediate value for MAC </div>
<div class="line">// 102 -    Intermediate value for PIN Block Format </div>
<div class="line">// 103 -    place holder for PIN digits for PIN confirmation feature   </div>
<div class="line">   </div>
<div class="line">/////////////////// </div>
<div class="line">// </div>
<div class="line">// Script status macros </div>
<div class="line">// </div>
<div class="line">/////////////////// </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// TEST_TMK_ENGINE </div>
<div class="line">// @brief  Tests if TMK key is loaded if not returns with error. </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 35h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDA    0 // try to load first part of key </div>
<div class="line">  LDA    1 // try to load second part of key </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// TEST_TMK_ENGINE   - same as 35h </div>
<div class="line">// @brief  Tests if TMK key is loaded if not returns with error. </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 1Dh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDA    0 // try to load first part of key </div>
<div class="line">  LDA    1 // try to load second part of key </div>
<div class="line">EOM 0 </div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------        </div>
<div class="line">// TEST_KEY_FOR_DATA </div>
<div class="line">// @brief  Tests if key for data is loaded if not returns with error. </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">MACRO 36h </div>
<div class="line">  LENGTH 1 </div>
<div class="line">  GETA 0     // get key type </div>
<div class="line">  MOV_A_B0 </div>
<div class="line">  LDAI 0400000000000000 // Encryption Data type </div>
<div class="line">  CMPA_B0_BEQ Lab_DEK </div>
<div class="line">  // DDK          decryption data type </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 10   // Increment to next slot index </div>
<div class="line">  SELECTX </div>
<div class="line">  BRA Lab_End </div>
<div class="line">  // DEK </div>
<div class="line">Lab_DEK: </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 8    // Increment to next slot index </div>
<div class="line">  SELECTX </div>
<div class="line">Lab_End: </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// TEST_KEY_FOR_MAC </div>
<div class="line">// @brief  Tests if key for MAC is loaded if not returns with error. </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">MACRO 38h </div>
<div class="line">  LENGTH 1 </div>
<div class="line">  GETA 0    // get key type </div>
<div class="line">  MOV_A_B0 </div>
<div class="line">  LDAI 0200000000000000// generate MAC type </div>
<div class="line">  CMPA_B0_BEQ Lab_MGK </div>
<div class="line">  // MVK          verify MAC type </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with MAC key slot index </div>
<div class="line">  ADDXI 6    // Increment to next slot index </div>
<div class="line">  SELECTX </div>
<div class="line">  BRA Lab_MAC_End </div>
<div class="line">  // MGK </div>
<div class="line">Lab_MGK: </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with MAC key slot index </div>
<div class="line">  ADDXI 4    // Increment to next slot index </div>
<div class="line">  SELECTX </div>
<div class="line">  Lab_MAC_End: </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// TEST_KEY_FOR_PIN </div>
<div class="line">// @brief  Tests if key for PIN is loaded if not returns with error. </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 37h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 2    // Increment to next slot index </div>
<div class="line">  SELECTX    // check PIN key </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// SCRIPT_CHECK_INIT </div>
<div class="line">// @brief  This macro checks if script has not been already initialized.   </div>
<div class="line">// If script wasn&#39;t initialized it returns with error. </div>
<div class="line">//------------------------------------------------------------------------   </div>
<div class="line">MACRO 33h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  SETA      // clear the pin block comparison slot </div>
<div class="line">  STA 103</div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// SCRIPT_GET_KEY_SET_INIT </div>
<div class="line">//  @brief  This macro provides a delta for Key Set Table. </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 32h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  // set init vector for key set table </div>
<div class="line">  // {1, 8}, </div>
<div class="line">  // {4, {1, EE,15,00, 35,40,43,42}, {5, 1D,1E,1B, 0,2B,23,2A}}, 00, </div>
<div class="line">  // {1, {3, 35,16,00, 37,70,75,76}}, 00, </div>
<div class="line">  // {2, {3, 35,17,00, 38,60,61,62}}, 00, </div>
<div class="line">  // {3, {3, 35,19,00, 38,63,64,65}}, 00, </div>
<div class="line">  // {4, {3, 35,15,00, 36,40,43,42}}, 00, </div>
<div class="line">  // {5, {3, 35,18,00, 36,50,53,52}}, 00, </div>
<div class="line">  // {6, {3, 35,1a,00, 00,00,00,00}}, 00   and send out </div>
<div class="line">  // - {1, 8} - Version, maximal count of key sets </div>
<div class="line">  LDAI  01080401EE150035 // Load A default status </div>
<div class="line">  SENDA 0                // Copy the Status from A to the CB </div>
<div class="line">  LDAI  404342051D1E1B00 // Load A default status </div>
<div class="line">  SENDA 8                // Copy the Status from A to the CB </div>
<div class="line">  LDAI  2B232A0001033516 // Load A default status </div>
<div class="line">  SENDA 16               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  0037707576000203 // Load A default status </div>
<div class="line">  SENDA 24               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  3517003860616200 // Load A default status </div>
<div class="line">  SENDA 32               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  0303351900386364 // Load A default status </div>
<div class="line">  SENDA 40               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  6500040335150036 // Load A default status </div>
<div class="line">  SENDA 48               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  4043420005033518 // Load A default status </div>
<div class="line">  SENDA 56               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  0036505352000603 // Load A default status </div>
<div class="line">  SENDA 64               // Copy the Status from A to the CB </div>
<div class="line">  LDAI  351a000000000000 // Load A default status </div>
<div class="line">  SENDA 72               // Copy the Status from A to the CB </div>
<div class="line">EOM 80 </div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// SCRIPT_INIT </div>
<div class="line">// @brief  This macro initialize the script. It should be executed after    </div>
<div class="line">// script install.  </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 30h // Init script, this macro should be execute after script install </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  SETA    // clear the pin block comparison slot </div>
<div class="line">  STA 103</div>
<div class="line">EOM 0 </div>
<div class="line">  </div>
<div class="line">   </div>
<div class="line">/////////////////// </div>
<div class="line">// </div>
<div class="line">//MSK ENGINE key loading </div>
<div class="line">// </div>
<div class="line">/////////////////// </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// LOAD_TMK_KEY </div>
<div class="line">// @brief      This macro loads TMK key for MSK engine. </div>
<div class="line">// @param[in]  16 bytes of TMK key </div>
<div class="line">// @return    nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 11h </div>
<div class="line">  LENGTH 16 // check if in CB is 8 bytes of first and 8 bytes of second key </div>
<div class="line">  GETA 0    // copy first key from CB into A </div>
<div class="line">  STA  0    // store first key into slot #0 </div>
<div class="line">  GETA 8    // copy second key from CB into A </div>
<div class="line">  STA  1    // store second key into slot #1 </div>
<div class="line">EOM 0 </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">// LOAD_KEY_ENC_DATA_MSK_INIT </div>
<div class="line">// @brief </div>
<div class="line">// @param[in] </div>
<div class="line">// @return    nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO EEh </div>
<div class="line">LENGTH 1 </div>
<div class="line">  // next operators are only for test </div>
<div class="line">  GETA 0  // get key type </div>
<div class="line">  MOV_A_X // Load key type into X register. Only one byte.                    </div>
<div class="line">EOM 0</div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// LOAD_KEY_ENC_DATA_MSK </div>
<div class="line">// @brief  This macro loads DATA key for MSK engine and encrypt it with  </div>
<div class="line">// TMK key. </div>
<div class="line">// Before execution you should load TMK key using macro LOAD_TMK_KEY_GISKE </div>
<div class="line">// or LOAD_TMK_KEY. </div>
<div class="line">// @param[in]  16 bytes of DATA key. </div>
<div class="line">// @return    nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 15h //Load key for data encryption key and decrypt it </div>
<div class="line">  LENGTH 16 </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 8    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 9    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0   // select TMK key </div>
<div class="line">  DECB       // decrypt first key </div>
<div class="line">  MOV_A_B0   //  Move the decrypted data to B0 </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 8    // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted DATA to the         </div>
<div class="line">             // designated DATA left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 9    // Increment the DATA Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted DATA to the  </div>
<div class="line">             // designated DATA right slot </div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// LOAD_KEY_ENC_DATA_MSK  , same as 15h</div>
<div class="line">// @brief  This macro loads DATA key for MSK engine and encrypt it with  </div>
<div class="line">// TMK key. </div>
<div class="line">// Before execution you should load TMK key using macro LOAD_TMK_KEY_GISKE  </div>
<div class="line">// or LOAD_TMK_KEY. </div>
<div class="line">// @param[in]  16 bytes of DATA key. </div>
<div class="line">// @return    nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 1Eh // Load key for data encryption key and decrypt it </div>
<div class="line">  LENGTH 16   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 8    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 9    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">   </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0    // select TMK key </div>
<div class="line">  DECB        // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line">   </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 8    // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted DATA to the  </div>
<div class="line">             // designated DATA left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 9    // Increment the DATA Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted DATA to the  </div>
<div class="line">             // designated DATA right slot </div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// LOAD_KEY_DEC_DATA_MSK </div>
<div class="line">// @brief  This macro loads DATA key for MSK engine and encrypt it with  </div>
<div class="line">// TMK key. </div>
<div class="line">// Before execution you should load TMK key using macro LOAD_TMK_KEY_GISKE  </div>
<div class="line">// or LOAD_TMK_KEY. </div>
<div class="line">// @param[in]  16 bytes of DATA key. </div>
<div class="line">// @return    nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 18h // Load key for data encryption key and decrypt it </div>
<div class="line">  LENGTH 16 </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 10   // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 11   // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">   </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0    // select TMK key </div>
<div class="line">  DECB        // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line">   </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 10   // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted DATA to the  </div>
<div class="line">             // designated DATA left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with DATA key slot index </div>
<div class="line">  ADDXI 11   // Increment the DATA Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted DATA to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted DATA to the  </div>
<div class="line">             // designated DATA right slot</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// LOAD_KEY_PIN_MSK </div>
<div class="line">// @brief </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 16h </div>
<div class="line">  LENGTH 16 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 2    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 3    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0    // select TMK key </div>
<div class="line">  DECB        // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line">   </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line"> </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with PIN key slot index </div>
<div class="line">  ADDXI 2    // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted PIN to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted PIN to the  </div>
<div class="line">             // designated PIN left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 3    // Increment the PIN Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted PIN to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted PIN to the  </div>
<div class="line">             // designated PIN right slot </div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// LOAD_KEY_GEN_MAC_MSK </div>
<div class="line">// @brief </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">MACRO 17h </div>
<div class="line">  LENGTH 16 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 4    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 5    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line"> </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0    // select TMK key </div>
<div class="line">  DECB        // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line"> </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with MAC key slot index </div>
<div class="line">  ADDXI 4    // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 5    // Increment the MAC Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC right slot </div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">// LOAD_KEY_VER_MAC_MSK </div>
<div class="line">// @brief </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 19h </div>
<div class="line">  LENGTH 16 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 6    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 7    // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">   </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0    // select TMK key </div>
<div class="line">  DECB        // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line">   </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with MAC key slot index </div>
<div class="line">  ADDXI 6    // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 7    // Increment the MAC Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC right slot </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// LOAD_KEY_KEK_MSK </div>
<div class="line">// @brief </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">MACRO 1Ah </div>
<div class="line">  LENGTH 16 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 12   // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 13   // Increment to next slot index </div>
<div class="line">  DELETEX    // Invalidate slot </div>
<div class="line">   </div>
<div class="line">  GETA 0      // get first key </div>
<div class="line">  ALGO_DES112 // select 3DES algorithm </div>
<div class="line">  SELECT 0   // select TMK key </div>
<div class="line">  DECB       // decrypt first key </div>
<div class="line">  MOV_A_B0   // Move the decrypted data to B0 </div>
<div class="line">   </div>
<div class="line">  GETA 8     // get second key </div>
<div class="line">  DECB       // decrypt it </div>
<div class="line">  MOV_A_B1   // Move the decrypted data to B1 </div>
<div class="line">   </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with MAC key slot index </div>
<div class="line">  ADDXI 12   // Increment to next slot index </div>
<div class="line">  MOV_B0_A   // Move the first 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the first 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC left slot </div>
<div class="line">  LDA 100    // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 13   // Increment the MAC Index </div>
<div class="line">  MOV_B1_A   // Move the second 8 bytes of the decrypted MAC to A </div>
<div class="line">  STAX       // Copy the second 8 bytes of the decrypted MAC to the  </div>
<div class="line">             // designated MAC right slot </div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// MACRO_RETRIEVE_STATUS </div>
<div class="line">// @brief  Retrieve the Key Status. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    8 bytes Status </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO B0h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 0000000000000002  // Load A default status </div>
<div class="line">  SENDA 0                // Copy the Status from A to the CB </div>
<div class="line">EOM 8 </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// ENCRYPT_INIT </div>
<div class="line">// @brief  Initialize data encryption. It does not accept parameters and  </div>
<div class="line">// noting return. </div>
<div class="line">// @return nothing </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 40h   //encrypt data init </div>
<div class="line">  LENGTH 8 </div>
<div class="line">  GETA 0    // copy IV [8 bytes] </div>
<div class="line">  MOV_A_IV  // Move A to IV </div>
<div class="line">EOM 0       //return nothing </div>
<div class="line">   </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">// ENCRYPT_ITERATION </div>
<div class="line">// @brief  This macro is used for data encryption. </div>
<div class="line">// @param[in]  8 bytes for encryption </div>
<div class="line">// @return    8 bytes encrypted data </div>
<div class="line">//------------------------------------------------------------------------- </div>
<div class="line">MACRO 41h //encrypt data iteration </div>
<div class="line">  LENGTH 8 </div>
<div class="line">  LDA 100   // Get the key set start slot index </div>
<div class="line">  MOV_A_X   // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 8   // Increment to next slot index to point the data encryption  </div>
<div class="line">            // key </div>
<div class="line">  </div>
<div class="line">  GETA 0    //copy from CB 8-bytes for encryption into A </div>
<div class="line">  ALGO_DES112 //select decryption algorithm </div>
<div class="line">  SELECTX   //select slots #2 and #3 as keys </div>
<div class="line">   </div>
<div class="line">  EECB      //encrypt data using ECB </div>
<div class="line">  SENDA 0   //copy encrypted data from A into CB </div>
<div class="line">EOM 8 //return 8 bytes </div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// ENCRYPT_CBC_ITERATION </div>
<div class="line">// @brief  This macro is used for CBC data encryption. </div>
<div class="line">// @param[in]  8 bytes for encryption </div>
<div class="line">// @return    8 bytes encrypted data </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 43h </div>
<div class="line">  LENGTH 8 </div>
<div class="line">  LDA 100   // Get the key set start slot index </div>
<div class="line">  MOV_A_X   // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 8   // Increment to next slot index to point the data encryption  </div>
<div class="line">            // key </div>
<div class="line">   </div>
<div class="line">  GETA 0    // Get the 8 bytes of data </div>
<div class="line">  ALGO_DES112 // Select the algorithm </div>
<div class="line">  SELECTX   //select slots #2 and #3 as keys </div>
<div class="line">   </div>
<div class="line">  ECBC      // 3DES encrypt the data with KMACs </div>
<div class="line">  SENDA 0   // Copy A (encrypted data) to CB offset 0 </div>
<div class="line">EOM 8 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">// ENCRYPT_FINISH </div>
<div class="line">// @brief  This macro finalizes data encryption. It does not accept  </div>
<div class="line">// parameters and noting return. </div>
<div class="line">//-------------------------------------------------------------------------  </div>
<div class="line">MACRO 42h //encrypt data finish </div>
<div class="line">  LENGTH 0 //do nothing </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// DECRYPT_INIT </div>
<div class="line">// @brief  This macro initialize data encryption. It does not accept  </div>
<div class="line">// parameters and nothing return. </div>
<div class="line">// return nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 50h   //decrypt data init </div>
<div class="line">  LENGTH 8 </div>
<div class="line">  GETA 0    // copy IV [8 bytes] </div>
<div class="line">  MOV_A_IV  // Move A to IV </div>
<div class="line">EOM 0       // return 0 bytes </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// DECRYPT_ITERATION </div>
<div class="line">// @brief  This macro is used for data decryption. </div>
<div class="line">// @param[in]  8 bytes of data for decryption </div>
<div class="line">// @return    8 bytes decrypted data </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 51h   // decrypt data iteration </div>
<div class="line">  LENGTH 8  // check if there is 8-bytes of data in the CB </div>
<div class="line">  LDA 100   // Get the key set start slot index </div>
<div class="line">  MOV_A_X   // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 10  // Increment to next slot index to point the data encryption  </div>
<div class="line">            // key </div>
<div class="line">   </div>
<div class="line">  GETA  0    // get 8 bytes from CB into A </div>
<div class="line">  ALGO_DES112  // select decryption algorithm </div>
<div class="line">  SELECTX    // select slots #2 and #3 as keys </div>
<div class="line">  DECB       // decrypt selected data </div>
<div class="line">  SENDA 0    // copy decrypted data from A into CB </div>
<div class="line">EOM 8        // return 0 bytes </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// DECRYPT_CBC_ITERATION </div>
<div class="line">// @brief  This macro is used for CBC data decryption. </div>
<div class="line">// @param[in]  8 bytes for decryption </div>
<div class="line">// @return    8 bytes decrypted data </div>
<div class="line">//-------------------------------------------------------------------------       </div>
<div class="line">MACRO 53h </div>
<div class="line">  LENGTH 8  // check if there is 8-bytes of data in the CB </div>
<div class="line">  LDA 100   // Get the key set start slot index </div>
<div class="line">  MOV_A_X   // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 10  // Increment to next slot index to point the data encryption  </div>
<div class="line">            // key </div>
<div class="line">   </div>
<div class="line">  GETA  0    // get 8 bytes from CB into A </div>
<div class="line">  ALGO_DES112  // select decryption algorithm </div>
<div class="line">  SELECTX    // select slots #2 and #3 as keys </div>
<div class="line">  DCBC       // decrypt selected data </div>
<div class="line">  SENDA 0    // copy decrypted data from A into CB </div>
<div class="line">EOM 8 // return 0 bytes </div>
<div class="line">    </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// DECRYPT_FINISH </div>
<div class="line">// @brief  This macro finalize data decryption.  It does not accept  </div>
<div class="line">// parameters and noting return. </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">MACRO 52h  // decrypt data finish </div>
<div class="line">  LENGTH 0   // do nothing </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MAC_GENERATE_INIT </div>
<div class="line">// @brief    This macro initialize MAC generation. It returns nothing. </div>
<div class="line">// @param[in]  8 bytes of initialization vector. </div>
<div class="line">// @return   nothing </div>
<div class="line">//-------------------------------------------------------------------------      </div>
<div class="line">MACRO 60h   // MAC init </div>
<div class="line">  LENGTH 8  // in CB should be 8-bytes - initialization vector (IV) for    </div>
<div class="line">            // MAC  </div>
<div class="line">  GETA 0    // copy IV to A </div>
<div class="line">  STA 101   // store IV into slot #101 </div>
<div class="line">EOM 0  // return nothing </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// MAC_GENERATE_ITERATION </div>
<div class="line">// @brief  This macro iterates MAC generation. It returns nothing. </div>
<div class="line">// @param[in]  8 bytes of data </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 61h     // MAC iteration </div>
<div class="line">  LENGTH 8    // block i of 8-bytes </div>
<div class="line">   </div>
<div class="line">  LDA 101     // Copy contents of temporary slot to A </div>
<div class="line">  MOV_A_IV    // Move A to IV </div>
<div class="line">   </div>
<div class="line">  LDA 100     // Get the key set start slot index </div>
<div class="line">  MOV_A_X     // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 4     // Increment to next slot index to point the MAC generation  </div>
<div class="line">              // key </div>
<div class="line">   </div>
<div class="line">  ALGO_DES112 // Select the algorithm </div>
<div class="line">  SELECTX     // Select the MAC key </div>
<div class="line">  GETA 0      // Get the 8 bytes of data </div>
<div class="line">  ECBC        // 3DES encrypt the data with MAC key </div>
<div class="line">  STA 101     // Copy A to slot temporary slot </div>
<div class="line">EOM 0//return nothing </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MAC_GENERATE_FINISH </div>
<div class="line">// @brief  This macro finalize MAC generation. It does not accept  </div>
<div class="line">// parameters. </div>
<div class="line">// @return  8 bytes of MAC </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 62h  // mac finish </div>
<div class="line">  LENGTH 0 </div>
<div class="line">   </div>
<div class="line">  LDA 101    // Copy contents of temporary slot to A </div>
<div class="line">  SENDA 0    // Copy the MAC to the CB </div>
<div class="line">EOM 4//return 4-bytes (MAC) </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MAC_VERIFY_INIT </div>
<div class="line">// @brief  This macro initialize MAC verification. It returns nothing. </div>
<div class="line">// @param[in]  8 bytes of initialization vector. </div>
<div class="line">// @return   nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 63h </div>
<div class="line">  LENGTH 8    // 8-bytes - initialization vector (IV) for MAC </div>
<div class="line">  GETA 0      // copy IV to A </div>
<div class="line">  STA 101     // store IV into temporary slot </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MAC_VERIFY_ITERATION </div>
<div class="line">// @brief  This macro iterates MAC verification. It returns nothing. </div>
<div class="line">// @param[in]  8 bytes of data </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">MACRO 64h </div>
<div class="line">  LENGTH 8    // block i of 8-bytes </div>
<div class="line">  LDA 101     // Copy contents of temporary slot to A </div>
<div class="line">  MOV_A_IV    // Move A to IV </div>
<div class="line">   </div>
<div class="line">  LDA 100     // Get the key set start slot index </div>
<div class="line">  MOV_A_X     // Load X with the merchant start slot index </div>
<div class="line">  ADDXI 6     // Increment to next slot index to point the MAC  </div>
<div class="line">              // verification key </div>
<div class="line">   </div>
<div class="line">  ALGO_DES112 // Select the algorithm </div>
<div class="line">  SELECTX     // Select the MAC key </div>
<div class="line">  GETA 0      // Get the 8 bytes of data </div>
<div class="line">  ECBC        // 3DES encrypt the data with MAC key </div>
<div class="line">  STA 101     // Copy A to slot temporary slot </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MAC_VERIFY_FINISH </div>
<div class="line">// @brief  This macro finalizes MAC verification. The MAC to verify is  </div>
<div class="line">// passed as the parameter. </div>
<div class="line">// @param[in]  4 bytes of MAC </div>
<div class="line">// @return    nothing </div>
<div class="line">//-----------------------------------------------------------------------   </div>
<div class="line">MACRO 65h </div>
<div class="line">  LENGTH 4 </div>
<div class="line">  LDA 101     // Copy contents of temporary slot to A </div>
<div class="line">  LSRA 32     // Right shift the MAC to get the first 4 bytes of the MAC </div>
<div class="line">  MOV_A_B0    // Move the computed MAC to B0 </div>
<div class="line">  GETA 0      // Get the host computed MAC to A </div>
<div class="line">  LSRA 32     // Right shift the host MAC to get the first 4 bytes of the  </div>
<div class="line">              // MAC </div>
<div class="line">  CMPA_B0     // Compare the computed MAC with the host MAC, if the  </div>
<div class="line">              // comparison fails macro will return error </div>
<div class="line">EOM 0 </div>
<div class="line">    </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// PIN_INIT </div>
<div class="line">// This macro initialize PIN encryption. It does not accept parameters and  </div>
<div class="line">// returns nothing. </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 70h //enter and encrypt pin init </div>
<div class="line">  LENGTH 0 </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// ISO_0_PREPARE </div>
<div class="line">// This macro prepare ISO-0 PIN Block Format for encryption. It returns  </div>
<div class="line">// nothing. </div>
<div class="line">// @param[in] 6 bytes of PAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 71h </div>
<div class="line">  LENGTH  6 //check if in the CB is 6 bytes of PAN (2 digits per byte) </div>
<div class="line">  GETA 0   // copy 6 bytes of PAN into A</div>
<div class="line">  MOV_A_B1 // save PAN for use later   </div>
<div class="line">  SETA     // set all A bytes to 0xFF - now A will look like FFFFFFFFFFFFFFFF  </div>
<div class="line">  GETPIN0  // get pin digits into A   - now A will look like 1234FFFFFFFFFFFF </div>
<div class="line">  LSRA 8   // shift right 8 bits      - now A will look like 001234FFFFFFFFFF </div>
<div class="line">  GETPINNB // get pin digits number   - now A will look like 041234FFFFFFFFFF </div>
<div class="line">  CMPA_BEQ 103 PIN_OK // pin block comparison logic</div>
<div class="line">  LDXI 0</div>
<div class="line">  CMPA_BNE 103 CONT</div>
<div class="line">PIN_OK:</div>
<div class="line">  LDXI 1</div>
<div class="line">CONT:</div>
<div class="line">  SENDX 0</div>
<div class="line">  STA 103   // store pin block for comparison in next call   </div>
<div class="line">  MOV_A_B0  // copy pin block into B0</div>
<div class="line">  MOV_B1_A  // restore PAN</div>
<div class="line">  LSRA  16  // shift right by 2 bytes</div>
<div class="line">  XORA_B0   // XOR PIN block with 6 bytes of PAN</div>
<div class="line">  STA   102 // store part of PIN block into #102 slot</div>
<div class="line">EOM 1       // &quot;1&quot; - entered PIN is the same as stored PIN, &quot;0&quot; - PINs  </div>
<div class="line">            // are different</div>
<div class="line"> </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// ISO_0_PREPARE_PIN_0 </div>
<div class="line">// This macro prepare ISO-0 PIN Block Format with 0 PIN digits for  </div>
<div class="line">// encryption. It returns nothing. </div>
<div class="line">// @param[in] 6 bytes of PAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 80h </div>
<div class="line">  LENGTH  6 // check if in the CB is 6 bytes of PAN (2 digits per byte)   </div>
<div class="line">  SETA      // set all A bytes 0xFF </div>
<div class="line">  LSRA    8 // shift right</div>
<div class="line">  MOV_A_B0  // copy it into B0 </div>
<div class="line">  GETA  0   // copy 6 bytes of PAN </div>
<div class="line">  LSRA  16  // shift right by 2 bytes </div>
<div class="line">  XORA_B0   // XOR PIN block with 6 bytes of PAN </div>
<div class="line">  STA   102 // store part of PIN block into #102 slot </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// ISO_1_PREPARE </div>
<div class="line">// This macro prepare ISO-1 PIN Block Format for encryption. </div>
<div class="line">// @param[in]   6 bytes of STAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 72h </div>
<div class="line">  LENGTH  6 // check if in the CB is 6 bytes of STAN (2 digits per byte) </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// ISO_1_PREPARE_PIN_0 </div>
<div class="line">// This macro prepare ISO-1 PIN Block Format with 0 PIN digits for  </div>
<div class="line">// encryption. </div>
<div class="line">// @param[in]   6 bytes of STAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 81h </div>
<div class="line">  LENGTH 6 // check if in the CB is 6 bytes of STAN (2 digits per byte) </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line"> EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// ISO_2_PREPARE </div>
<div class="line">// This macro prepare ISO-2 PIN Block Format for encryption. It does not  </div>
<div class="line">// accept parameters and returns nothing. </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 73h </div>
<div class="line">  LENGTH 0  </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// ISO_2_PREPARE_PIN_0 </div>
<div class="line">// This macro prepare ISO-2 PIN Block Format with 0 PIN digits for  </div>
<div class="line">// encryption. It does not accept parameters and returns nothing. </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">MACRO 82h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// ISO_3_PREPARE </div>
<div class="line">// This macro prepare ISO-3 PIN Block Format for encryption. It returns  </div>
<div class="line">// nothing. </div>
<div class="line">// @param[in] 6 bytes of PAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 74h </div>
<div class="line">  LENGTH  6 // check if in the CB is 6 bytes of PAN (2 digits per byte) </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// ISO_3_PREPARE_PIN_0 </div>
<div class="line">// This macro prepare ISO-3 PIN Block Format with 0 PIN digits for </div>
<div class="line">// encryption. It returns nothing. </div>
<div class="line">// @param[in] 6 bytes of PAN </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 83h </div>
<div class="line">  LENGTH  6 // check if in the CB is 6 bytes of PAN (2 digits per byte)   </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0 </div>
<div class="line">  </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// PIN_ITERATION </div>
<div class="line">// This macro encrypt prepared ISO Pin Block Format. It does not accept  </div>
<div class="line">// parameters and returns nothing. </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 75h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDA   100  // Get the key set start slot index </div>
<div class="line">  MOV_A_X    // Load X with PIN key slot index </div>
<div class="line">  ADDXI 2    // Increment to next slot index </div>
<div class="line">   </div>
<div class="line">  LDA   102 // load PIN Block Format from slot #102 </div>
<div class="line">  ALGO_DES112 // select encryption algorithm </div>
<div class="line">  SELECTX   // select key for PIN encryption </div>
<div class="line">  EECB      // encrypt PIN </div>
<div class="line">  STA 102   // store result into slot #102 </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// PIN_FINISH </div>
<div class="line">// This macro finalize pin encryption. It does not accept parameters. </div>
<div class="line">// @return  encrypted PIN Block Format </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 76h      // enter and encrypt pin finish </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDA    102   // get encrypted PIN Block Format into A </div>
<div class="line">  SENDA  0     // copy it into CB </div>
<div class="line">EOM 8          // return 8 bytes of PIN Block Format </div>
<div class="line">    </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// PIN_CANCEL </div>
<div class="line">// This macro gets the PIN from keyboard buffer where it is deleted and  </div>
<div class="line">// deletes it also from slots. </div>
<div class="line">// @param[in] nothing </div>
<div class="line">// @return  nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 77h </div>
<div class="line">  LENGTH  0 </div>
<div class="line">  GETPIN0   // get pin digits into A </div>
<div class="line">  SETA      // clear the pin block from slots </div>
<div class="line">  STA 102 </div>
<div class="line">  STA 103 </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_1 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 1. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO C7h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  CLRA      // Load A with Merchant 1 start slot index </div>
<div class="line">  STA 100   // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_2 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 2. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO C8h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 0C00000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_3 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 3. </div>
<div class="line">// @param[in] nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO C9h </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 1800000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_4 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 4. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO CAh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 2400000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_5 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 5. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO CBh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 3000000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_6 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 6. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO CCh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 3C00000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_7 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 7. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO CDh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 4800000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------   </div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_8 </div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 8. </div>
<div class="line">// @param[in]  nothing </div>
<div class="line">// @return    nothing </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO CEh </div>
<div class="line">  LENGTH 0 </div>
<div class="line">  LDAI 5400000000000000 // Load A with Merchant 6 start slot index </div>
<div class="line">  STA 100               // Store value in Merchant Start Slot Index </div>
<div class="line">EOM 0 </div>
<div class="line">   </div>
<div class="line">//-------------------------------------------------------------------------    </div>
<div class="line">// UPDATE_FINALIZE// </div>
<div class="line">// @brief  This macro finalize key update.  It does not accept parameters  </div>
<div class="line">// and noting return. </div>
<div class="line">//-------------------------------------------------------------------------     </div>
<div class="line">MACRO 1Bh </div>
<div class="line">  LENGTH 0  //do nothing </div>
<div class="line">EOM 0 </div>
<div class="line">//-------------------------------------------------------------------------  </div>
</div><!-- fragment --><h3><a class="anchor" id="subsec_dukpt_vss_script_example"></a>
DUKPT VSS Script Example</h3>
<p>This section presents a DUKPT VSS script example which can be used as a templates for own user implementation. <br  />
<br  />
 </p><div class="fragment"><div class="line">SCRIPT xxxxxxxx   // Script Name</div>
<div class="line"> </div>
<div class="line">// Script uses 3DES DUKPT for MAC, PIN and DATA (ECB) encryption</div>
<div class="line">SUBDEV 02h        // Script Number: 2</div>
<div class="line">DEF_BLK 255 0    //Allocate 255 blocks</div>
<div class="line"> </div>
<div class="line">// Slots description</div>
<div class="line">// 2 -  3 ENC key [DUKPT]</div>
<div class="line">// 4 -  5 DUKPT key</div>
<div class="line">// 6 -  7 PIN key  [DUKPT]</div>
<div class="line">// 8 -  9 MAC key  [DUKPT]</div>
<div class="line">// 10 -    Intermediate value for MAC</div>
<div class="line">// 11 -    Intermediate value for PIN Block Format</div>
<div class="line">// 102 -   first part of DATA key </div>
<div class="line">// 103 -   second part of DATA key</div>
<div class="line">// 106 -   first part of PIN key</div>
<div class="line">// 107 -   second part of PIN key</div>
<div class="line">// 108 -   first part of MAC key</div>
<div class="line">// 109 -   second part of MAC key</div>
<div class="line">// 110 -   PINblock for comparison</div>
<div class="line"> </div>
<div class="line">///////////////////</div>
<div class="line">//</div>
<div class="line">// Script status macros</div>
<div class="line">//</div>
<div class="line">///////////////////</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// TEST_TMK_ENGINE</div>
<div class="line">// @brief  Tests if TMK key is loaded if not returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 35h    </div>
<div class="line">  LENGTH 0</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// TEST_DUKPT_ENGINE</div>
<div class="line">// @brief  Tests if DUPKT key is loaded if not returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 39h    </div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   4  //try to load first part of key</div>
<div class="line">  LDA   5  //try to load second part of key</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// TEST_KEY_FOR_DATA</div>
<div class="line">// @brief  Tests if key for data is loaded if not returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 36h    </div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   2  //try to load first part of key</div>
<div class="line">  LDA   3  //try to load second part of key</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// TEST_KEY_FOR_MAC</div>
<div class="line">// @brief  Tests if key for MAC is loaded if not returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 38h    </div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   8  //try to load first part of key</div>
<div class="line">  LDA   9  //try to load second part of key</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// TEST_KEY_FOR_PIN</div>
<div class="line">// @brief  Tests if key for PIN is loaded if not returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 37h    </div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   6  //try to load first part of key</div>
<div class="line">  LDA   7  //try to load second part of key</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// SCRIPT_CHECK_INIT</div>
<div class="line">// @brief  This macro checks if script has not been already initialized. If script </div>
<div class="line">// wasn&#39;t initialized it returns with error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 33h </div>
<div class="line">  LENGTH 0</div>
<div class="line">  SETA                    // clear the pin block comparison slot</div>
<div class="line">  STA 110</div>
<div class="line">  LDA 102   //try to load first part of DATA key </div>
<div class="line">  LDA 103   //try to load second part of DATA key</div>
<div class="line">  LDA 106   //try to load first part of PIN key</div>
<div class="line">  LDA 107   //try to load second part of PIN key</div>
<div class="line">  LDA 108   //try to load first part of MAC key</div>
<div class="line">  LDA 109   //try to load second part of MAC key</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// SCRIPT_INIT</div>
<div class="line">// @brief  This macro initialize the script. It should be executed after script </div>
<div class="line">// install.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 30h  //Init script, this macro should be execute after script install</div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDAI  0000000000FF0000  //bitmask which modifies Data Key</div>
<div class="line">  STA 102                 //store first key for Data</div>
<div class="line">  LDAI  0000000000FF0000  //bitmask which modifies Data Key</div>
<div class="line">  STA 103                 //store first key for Data</div>
<div class="line">  LDAI  00000000000000FF  //bitmask which modifies PIN Key</div>
<div class="line">  STA 106                 //store first key for PIN into #6 slot</div>
<div class="line">  LDAI  00000000000000FF  //bitmask which modifies PIN Key</div>
<div class="line">  STA 107                 //store second key for PIN into #7 slot</div>
<div class="line">  LDAI  000000000000FF00  //bitmask which modifies MAC Key</div>
<div class="line">  STA 108                 //store first key for MAC</div>
<div class="line">  LDAI  000000000000FF00  //bitmask which modifies MAC Key</div>
<div class="line">  STA 109                 //store first key for MAC</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// LOAD_KEY_DATA_MSK</div>
<div class="line">// @brief  This is dummy macro for DATA key loading. This macro always return with </div>
<div class="line">// error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 15h   //Load key for data and decrypt it</div>
<div class="line">  LENGTH 0</div>
<div class="line">  ERR_RET 0</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// LOAD_KEY_PIN_MSK</div>
<div class="line">// @brief  This is dummy macro for PIN key loading. This macro always return with </div>
<div class="line">// error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 16h</div>
<div class="line">  LENGTH 0</div>
<div class="line">  ERR_RET 0</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">//LOAD_KEY_MAC_MSK</div>
<div class="line">// @brief  This is dummy macro for MAC key loading. This macro always return with </div>
<div class="line">// error.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 17h</div>
<div class="line">  LENGTH 0</div>
<div class="line">  ERR_RET 0</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">////////////////////</div>
<div class="line">//</div>
<div class="line">//DUKPT ENGINE key loading</div>
<div class="line">//</div>
<div class="line">///////////////////</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// LOAD_DUKPT_KEY</div>
<div class="line">// @brief  This macro loads DUKPT key [TIK] and IKSN and initialize 3DES DUKPT engine.</div>
<div class="line">// param[in]  10 bytes IKSN and 16 bytes of TIK</div>
<div class="line">// @return nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 10h   //Load DUKPT key, loads 10 bytes IKSN and 16 bytes BDK [TIK]</div>
<div class="line">  LENGTH 26</div>
<div class="line">  GETA 10   //Load first and second part of BDK into B0 and B1</div>
<div class="line">  MOV_A_B0</div>
<div class="line">  GETA 18</div>
<div class="line">  MOV_A_B1</div>
<div class="line">  INIT_3DES_DUKPT //init 3DES DUKPT Engine</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// LOAD_EXXON_KEY</div>
<div class="line">// @brief   This macro loads EXXON key [TIK] and IKSN and initialize 3DES DUKPT </div>
<div class="line">// engine.</div>
<div class="line">// param[in]    10 bytes IKSN and 16 bytes of TIK</div>
<div class="line">// @return nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 90h   //Load EXXON key</div>
<div class="line">   LENGTH 0</div>
<div class="line">   </div>
<div class="line">   RNDA</div>
<div class="line">   STA 20</div>
<div class="line">   STA 30</div>
<div class="line">   </div>
<div class="line">   RNDA</div>
<div class="line">   STA 21</div>
<div class="line">   STA 31</div>
<div class="line">   </div>
<div class="line">   RNDA</div>
<div class="line">   STA 22</div>
<div class="line">   STA 32</div>
<div class="line">   </div>
<div class="line">   RNDA</div>
<div class="line">   STA 23</div>
<div class="line">   STA 33</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//////////////////</div>
<div class="line">//</div>
<div class="line">//DUKPT ENGINE key prepare</div>
<div class="line">//</div>
<div class="line">//////////////////</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// GET_NEW_DUKPT</div>
<div class="line">// @brief  This macro generate DUKPT key for new transaction. It does not accept any // parameters.</div>
<div class="line">// @return 10 bytes KSN</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 28h //Get new DUKPT key, returns 10 bytes of KSN</div>
<div class="line">  LENGTH 0</div>
<div class="line">  GET_DUKPT_KEY  //get new pair of 3DES DUKPT Key</div>
<div class="line">  //010808 ADDED</div>
<div class="line">  TSTXI  1 1     //check GET_DUKPT_KEY status, exit if error</div>
<div class="line">  MOV_B0_A  //copy new key from B0 into A</div>
<div class="line">  STA 4     //store first key into #4 slot</div>
<div class="line">  MOV_B1_A  //copy new key from B1 into A</div>
<div class="line">  STA 5     //store second key into #5 slot</div>
<div class="line">  LDA 4     //get first 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 102   //bitmask which modifies ENC Key</div>
<div class="line">  XORA_B0   //modify key for ENC</div>
<div class="line">  STA 2     //store first key for MAC into #2 slot</div>
<div class="line">  LDA 5     //get second 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 103   //bitmask which modifies ENC Key</div>
<div class="line">  XORA_B0   //modify key for ENC</div>
<div class="line">  STA 3     //store second key for MAC into #3 slot</div>
<div class="line">  // according ANS x9.24 2009</div>
<div class="line">  ALGO_DES112 //select encryption algorithm</div>
<div class="line">  SELECT 2    //select slots #2 and #3 as keys</div>
<div class="line">  LDA 2       //load #2 into A for encryption</div>
<div class="line">  EECB        //encrypt data using ECB</div>
<div class="line">  STA 2       //store first key for ENC into #2 slot</div>
<div class="line">  LDA 3       //load #3 into A for encryption</div>
<div class="line">  EECB</div>
<div class="line">  STA 3       //store first key for ENC into #2 slot </div>
<div class="line"> </div>
<div class="line">  LDA 4     //get first 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 106   //bitmask which modifies PIN Key</div>
<div class="line">  XORA_B0   //modify key for PIN</div>
<div class="line">  STA 6     //store first key for PIN into #6 slot</div>
<div class="line">  LDA 5     //get second 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 107   //bitmask which modifies PIN Key</div>
<div class="line">  XORA_B0   //modify key for PIN</div>
<div class="line">  STA 7     //store second key for PIN into #7 slot</div>
<div class="line">  LDA 4     //get first 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 108   //bitmask which modifies MAC Key</div>
<div class="line">  XORA_B0   //modify key for MAC</div>
<div class="line">  STA 8     //store first key for MAC into #8 slot</div>
<div class="line">  LDA 5     //get second 3DES DUKPT Key</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  LDA 109   //bitmask which modifies MAC Key</div>
<div class="line">  XORA_B0   //modify key for MAC</div>
<div class="line">  STA 9     //store second key for MAC into #9 slot</div>
<div class="line">EOM 10 //return KSN</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// SET_DUKPT_MASK</div>
<div class="line">//  @brief  This macro sets DUKPT key masks for PIN, MAC, ENC key.</div>
<div class="line">//  @return nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 29h //Set DUKPT keys masks</div>
<div class="line">    LENGTH 48   // mask_PIN, mask_MAC, mask_ENC</div>
<div class="line">    </div>
<div class="line">    //processing PIN key</div>
<div class="line">    LDA 4         // get first half of the key from #4 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 0</div>
<div class="line">   STA 106     // store new mask for PIN</div>
<div class="line">    XORA_B0     // modify key for PIN</div>
<div class="line">    STA 6</div>
<div class="line">    LDA 5         // get second half of the key from #5 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 8</div>
<div class="line">   STA 107     // store new mask for PIN</div>
<div class="line">    XORA_B0     // modify key for PIN</div>
<div class="line">    STA 7</div>
<div class="line">    //processing MAC key</div>
<div class="line">    LDA 4         // get first half of the key from #4 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 16</div>
<div class="line">   STA 108     // store new mask for MAC</div>
<div class="line">    XORA_B0     // modify key for MAC</div>
<div class="line">    STA 8</div>
<div class="line">    LDA 5         // get second half of the key from #5 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 24</div>
<div class="line">   STA 109     // store new mask for MAC</div>
<div class="line">    XORA_B0     // modify key for MAC</div>
<div class="line">    STA 9</div>
<div class="line">    //processing DATA key</div>
<div class="line">    LDA 4         //get first half of the key from #4 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 32</div>
<div class="line">   STA 102     // store new mask for DATA</div>
<div class="line">    XORA_B0     // modify key for DATA</div>
<div class="line">    STA 2</div>
<div class="line">    LDA 5         // get second half of the key from #5 slot</div>
<div class="line">    MOV_A_B0 </div>
<div class="line">    GETA 40</div>
<div class="line">   STA 103     // store new mask for DATA</div>
<div class="line">    XORA_B0     // modify key for DATA</div>
<div class="line">    STA 3</div>
<div class="line">  // according ANS x9.24 2009</div>
<div class="line">  ALGO_DES112 //select encryption algorithm</div>
<div class="line">  SELECT 2    //select slots #2 and #3 as keys</div>
<div class="line">  LDA 2       //load #2 into A for encryption</div>
<div class="line">  EECB        //encrypt data using ECB</div>
<div class="line">  STA 2       //store first key for ENC into #2 slot</div>
<div class="line">  LDA 3       //load #3 into A for encryption</div>
<div class="line">  EECB</div>
<div class="line">  STA 3       //store first key for ENC into #2 slot </div>
<div class="line">EOM 0 </div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ENCRYPT_INIT</div>
<div class="line">// @brief  Initialize data encryption. It does not accept parameters and noting </div>
<div class="line">// return.</div>
<div class="line">// @return nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 40h //encrypt data init</div>
<div class="line">  LENGTH 0</div>
<div class="line">  CLRIV   //clear initialization vector, which is used for CBC encryption</div>
<div class="line">EOM 0     //return nothing</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ENCRYPT_ITERATION</div>
<div class="line">// @brief  This macro is used for data encryption.</div>
<div class="line">// @param[in]  8 bytes for encryption</div>
<div class="line">// @return    8 bytes encrypted data</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 43h //encrypt data iteration (previous: MACRO 41h)</div>
<div class="line">  LENGTH 8</div>
<div class="line">  GETA 0      //copy from CB 8-bytes for encryption into A</div>
<div class="line">  ALGO_DES112 //select decryption algorithm</div>
<div class="line">  SELECT 2    //select slots #2 and #3 as keys</div>
<div class="line">  EECB        //encrypt data using ECB</div>
<div class="line">  SENDA 0     //copy encrypted data from A into CB</div>
<div class="line">EOM 8 //return 8 bytes</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ENCRYPT_FINISH</div>
<div class="line">// @brief  This macro finalizes data encryption. It does not accept parameters and </div>
<div class="line">// noting return.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 42h     //encrypt data finish</div>
<div class="line">  LENGTH 0    //do nothing</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// DECRYPT_INIT</div>
<div class="line">// @brief  This macro initialize data decryption. It does not accept parameters and </div>
<div class="line">// nothing return.</div>
<div class="line">// return nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 50h //decrypt data init</div>
<div class="line">  LENGTH 0</div>
<div class="line">  CLRIV     //clear initialization vector, which is used for CBC encryption</div>
<div class="line">EOM 0  //return 0 bytes</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// DECRYPT_ITERATION</div>
<div class="line">// @brief  This macro is used for data decryption.</div>
<div class="line">// @param[in]  8 bytes of data for decryption</div>
<div class="line">// @return    8 bytes decrypted data</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 53h     //decrypt data iteration (previous: MACRO 51h)</div>
<div class="line">  LENGTH 8    //chek if there is 8-bytes of data in the CB</div>
<div class="line">  GETA  0     //get 8 bytes from CB into A</div>
<div class="line">  ALGO_DES112 //select decryption algorithm</div>
<div class="line">  SELECT  2   //select slots #2 and #3 as keys</div>
<div class="line">  DECB        //decrypt selected data</div>
<div class="line">  SENDA   0   //copy decrypted data from A into CB</div>
<div class="line">EOM 8  //return 0 bytes</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// DECRYPT_FINISH</div>
<div class="line">// @brief  This macro finalize data decryption.  It does not accept parameters and </div>
<div class="line">// noting return.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 52h      //decrypt data finish</div>
<div class="line">  LENGTH 0     //do nothing</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_INIT</div>
<div class="line">// @brief    This macro initialize MAC generation. It returns nothing.</div>
<div class="line">// @param[in]  8 bytes of initialization vector.</div>
<div class="line">// @return   nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 60h //MAC init</div>
<div class="line">  LENGTH 8    //in CB should be 8-bytes - initialization vector (IV) for MAC</div>
<div class="line">  GETA 0      //copy IV to A</div>
<div class="line">  STA 10      //store IV into slot #10</div>
<div class="line">EOM 0         //return nothing</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_ITERATION</div>
<div class="line">// @brief  This macro iterates MAC generation. It returns nothing.</div>
<div class="line">// @param[in]  8 bytes of data</div>
<div class="line">// @return    nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 61h //MAC iteration</div>
<div class="line">  LENGTH 8    //block i of 8-bytes</div>
<div class="line">  //ALGO_DES56  //select algorithm</div>
<div class="line">  //LDA 10      //load intermediate value into A</div>
<div class="line">  //MOV_A_B0    //copy data from A into B0</div>
<div class="line">  //GETA  0     //get block i</div>
<div class="line">  //XORA_B0     //input for DES1 encryption</div>
<div class="line">  //SELECT 8    //select key</div>
<div class="line">  //EECB        //encrypt data</div>
<div class="line">  //STA  10     //store intermediate data into #10 slot</div>
<div class="line">  </div>
<div class="line">  LDA 10        // Copy contents of temporary slot to A</div>
<div class="line">  MOV_A_IV      // Move A to IV</div>
<div class="line">  ALGO_DES112   // Select the algorithm  </div>
<div class="line">  SELECT 8      // Select the MAC key</div>
<div class="line">  GETA 0        // Get the 8 bytes of data</div>
<div class="line">  ECBC          // 3DES encrypt the data with MAC key</div>
<div class="line">  STA 10        // Copy A to slot temporary slot</div>
<div class="line">EOM 0  //return nothing</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_FINISH</div>
<div class="line">// @brief  This macro finalize MAC generation. It does not accept parameters.</div>
<div class="line">// @return  8 bytes of CBC-MAC</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 62h //mac finish</div>
<div class="line">  LENGTH 0    </div>
<div class="line">  //ALGO_DES56  //select algorithm</div>
<div class="line">  //SELECT  9   //select second key</div>
<div class="line">  //LDA    10   //load intermediate value into A</div>
<div class="line">  //DECB        //decrypt data in A using ECB</div>
<div class="line">  //SELECT  8   //select first key</div>
<div class="line">  //EECB        //encrypt data using this key</div>
<div class="line">  //SENDA   0   //copy into CB data from A on offset 0</div>
<div class="line">  </div>
<div class="line">  LDA 10       // Copy contents of temporary slot to A</div>
<div class="line">  SENDA 0      // Copy the MAC to the CB</div>
<div class="line">EOM 4  //return 4-bytes (MAC)</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_VERIFY_INIT</div>
<div class="line">// @brief  This macro initialize MAC verification. It returns nothing.</div>
<div class="line">// @param[in]  8 bytes of initialization vector.</div>
<div class="line">// @return   nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 63h</div>
<div class="line">  LENGTH 8      // 8-bytes - initialization vector (IV) for MAC</div>
<div class="line">  GETA 0        // copy IV to A</div>
<div class="line">  STA 10        // store IV into temporary slot</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_VERIFY_ITERATION</div>
<div class="line">// @brief  This macro iterates MAC verification. It returns nothing.</div>
<div class="line">// @param[in]  8 bytes of data</div>
<div class="line">// @return    nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 64h</div>
<div class="line">  LENGTH 8    //block i of 8-bytes</div>
<div class="line">  ALGO_DES56  //select algorithm</div>
<div class="line">  LDA 10      //load intermediate value into A</div>
<div class="line">  MOV_A_B0    //copy data from A into B0</div>
<div class="line">  GETA  0     //get block i</div>
<div class="line">  XORA_B0     //input for DES1 encryption</div>
<div class="line">  SELECT 8    //select key</div>
<div class="line">  EECB        //encrypt data</div>
<div class="line">  STA  10     //store intermediate data into #10 slot</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MAC_VERIFY_FINISH</div>
<div class="line">// @brief  This macro finalizes MAC verification. The MAC to verify is passed as the </div>
<div class="line">// parameter.</div>
<div class="line">// @param[in]  4 bytes of CBC-MAC-Retail</div>
<div class="line">// @return    nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 65h</div>
<div class="line">  LENGTH 4</div>
<div class="line">  ALGO_DES56   //select algorithm</div>
<div class="line">  SELECT  9    //select second key</div>
<div class="line">  LDA    10    //load intermediate value into A</div>
<div class="line">  DECB         //decrypt data in A using ECB</div>
<div class="line">  SELECT  8    //select first key</div>
<div class="line">  EECB         //encrypt data using this key</div>
<div class="line">  LSRA 32      // Right shift the MAC to get the first 4 bytes of the MAC</div>
<div class="line">  MOV_A_B0     // Move the computed MAC to B0</div>
<div class="line">  GETA 0       // Get the host computed MAC to A</div>
<div class="line">  LSRA 32      // Right shift the host MAC to get the first 4 bytes of the MAC</div>
<div class="line">  CMPA_B0      // Compare the computed MAC with the host MAC, if the comparison fails macro will return error</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// PIN_INIT</div>
<div class="line">// This macro initialize PIN encryption. It does not accept parameters and returns </div>
<div class="line">// nothing.</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 70h //enter and encrypt pin init</div>
<div class="line">  LENGTH 0</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_0_PREPARE</div>
<div class="line">// This macro prepare ISO-0 PIN Block Format for encryption. It returns nothing.</div>
<div class="line">// @param[in] 6 bytes of PAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 71h</div>
<div class="line">  LENGTH  6   //check if in the CB is 6 bytes of PAN (2 digits per byte)</div>
<div class="line">  </div>
<div class="line">  GETA 0      // copy 6 bytes of PAN into A</div>
<div class="line">  MOV_A_B1    // save PAN for use later</div>
<div class="line">  SETA        // set all A bytes to 0xFF - now A will look like FFFFFFFFFFFFFFFF</div>
<div class="line">  GETPIN0     // get pin digits into A   - now A will look like 1234FFFFFFFFFFFF</div>
<div class="line">  LSRA 8      // shift right 8 bits      - now A will look like 001234FFFFFFFFFF</div>
<div class="line">  GETPINNB    // get pin digits number   - now A will look like 041234FFFFFFFFFF</div>
<div class="line">  CMPA_BEQ 110 PIN_OK  // pin block comparison logic</div>
<div class="line">  LDXI 0</div>
<div class="line">  CMPA_BNE 110 CONT</div>
<div class="line">PIN_OK:</div>
<div class="line">  LDXI 1</div>
<div class="line">CONT:</div>
<div class="line">  SENDX 0</div>
<div class="line">  STA   110     //storing clear text pin for comparison in next call</div>
<div class="line">  MOV_A_B0    //copy it into B0</div>
<div class="line">  MOV_B1_A    // restore PAN</div>
<div class="line">  LSRA  16    //shift right by 2 bytes</div>
<div class="line">  XORA_B0     //XOR PIN block with 6 bytes of PAN</div>
<div class="line">  STA   11       //store part of PIN block into #11 slot</div>
<div class="line">EOM 1         // &quot;0&quot; - PINs are different, &quot;1&quot; - entered PIN is the same as stored PIN</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_0_PREPARE_PIN_0</div>
<div class="line">// This macro prepare ISO-0 PIN Block Format with 0 PIN digits for encryption. It </div>
<div class="line">// returns nothing.</div>
<div class="line">// @param[in] 6 bytes of PAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 80h</div>
<div class="line">  LENGTH  6  //check if in the CB is 6 bytes of PAN (2 digits per byte)</div>
<div class="line">  SETA      //set all A bytes 0xFF</div>
<div class="line">  LSRA    8  //shift right</div>
<div class="line">  MOV_A_B0  //copy it into B0</div>
<div class="line">  GETA  0  //copy 6 bytes of PAN</div>
<div class="line">  LSRA  16  //shift right by 2 bytes</div>
<div class="line">  XORA_B0    //XOR PIN block with 6 bytes of PAN</div>
<div class="line">  STA    11  //store part of PIN block into #11 slot</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_1_PREPARE</div>
<div class="line">// This macro prepare ISO-1 PIN Block Format for encryption.</div>
<div class="line">// @param[in]   6 bytes of STAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 72h</div>
<div class="line">  LENGTH  6  //check if in the CB is 6 bytes of STAN (2 digits per byte)</div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_1_PREPARE_PIN_0</div>
<div class="line">// This macro prepare ISO-1 PIN Block Format with 0 PIN digits for encryption.</div>
<div class="line">// @param[in]   6 bytes of STAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 81h</div>
<div class="line">  LENGTH  6  //check if in the CB is 6 bytes of STAN (2 digits per byte)</div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_2_PREPARE</div>
<div class="line">// This macro prepare ISO-2 PIN Block Format for encryption. It does not accept </div>
<div class="line">// parameters and returns nothing.</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 73h</div>
<div class="line">  LENGTH 0  </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_2_PREPARE_PIN_0</div>
<div class="line">// This macro prepare ISO-2 PIN Block Format with 0 PIN digits for encryption. It does </div>
<div class="line">// not accept parameters and returns nothing.</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 82h</div>
<div class="line">  LENGTH 0  </div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_3_PREPARE</div>
<div class="line">// This macro prepare ISO-3 PIN Block Format for encryption. It returns nothing.</div>
<div class="line">// @param[in] 6 bytes of PAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 74h</div>
<div class="line">  LENGTH  6  //check if in the CB is 6 bytes of PAN (2 digits per byte)</div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// ISO_3_PREPARE_PIN_0</div>
<div class="line">// This macro prepare ISO-3 PIN Block Format with 0 PIN digits for encryption. It </div>
<div class="line">// returns nothing.</div>
<div class="line">// @param[in] 6 bytes of PAN</div>
<div class="line">// @return  nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 83h</div>
<div class="line">  LENGTH  6  //check if in the CB is 6 bytes of PAN (2 digits per byte)</div>
<div class="line">  // implementation has yet to be done</div>
<div class="line">EOM 0</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// PIN_ITERATION</div>
<div class="line">// This macro encrypt prepared ISO Pin Block Format. It does not accept parameters and </div>
<div class="line">// returns nothing.</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 75h</div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   11      //load PIN Block Format from slot #11</div>
<div class="line">// SENDA 0</div>
<div class="line">  ALGO_DES112   //select encryption algorithm</div>
<div class="line">  SELECT 6      //select key for PIN encryption</div>
<div class="line">  EECB          //encrypt PIN</div>
<div class="line">  STA 11        //store result into slot #11</div>
<div class="line">EOM 0</div>
<div class="line">// LDA   6</div>
<div class="line">// SENDA 8</div>
<div class="line">// LDA   7</div>
<div class="line">// SENDA 16</div>
<div class="line">//EOM 24</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// PIN_FINISH</div>
<div class="line">// This macro finalize pin encryption. It does not accept parameters.</div>
<div class="line">// @return  encrypted PIN Block Format</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO 76h //enter and encrypt pin finish</div>
<div class="line">  LENGTH 0</div>
<div class="line">  LDA   11  //get encrypted PIN Block Format into A</div>
<div class="line">  SENDA  0  //copy it into CB</div>
<div class="line">EOM 8  //return 8 bytes of PIN Block Format</div>
<div class="line"> </div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">// MACRO_SELECT_KEY_SET_ID_1</div>
<div class="line">// @brief  Loads the Merchant Key Start Slot Index for Merchant 1.</div>
<div class="line">// @param[in]  nothing</div>
<div class="line">// @return    nothing</div>
<div class="line">//------------------------------------------------------------------------------------</div>
<div class="line">MACRO C7h</div>
<div class="line">  LENGTH 0</div>
<div class="line">EOM 0</div>
</div><!-- fragment --><p> <br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_PIN_Block_Formats"></a>
Appendix D: PIN Block Formats</h1>
<h2><a class="anchor" id="sec_pin_block_formats"></a>
PIN Block Formats</h2>
<p>This section provides PIN block formats for ISO-0 (<a class="el" href="pg_sec_users_guide.html#subsec_security_ISO_0_PIN_block_format">ISO-0 PIN Block Format</a>), ISO-1 (<a class="el" href="pg_sec_users_guide.html#subsec_security_ISO_1_PIN_block_format">ISO-1 PIN Block Format</a>), ISO-2 (<a class="el" href="pg_sec_users_guide.html#subsec_security_ISO_2_PIN_block_format">ISO-2 PIN Block Format</a>) and ISO-3 (<a class="el" href="pg_sec_users_guide.html#subsec_security_ISO_3_PIN_block_format">ISO-3 PIN Block Format</a>).</p>
<p>Each box in the following tables represents a 4-Bit field.</p>
<h3><a class="anchor" id="subsec_security_ISO_0_PIN_block_format"></a>
ISO-0 PIN Block Format</h3>
<p>The PIN block is formed by XORing an 'original PIN Block' comprising the PIN digits with a mask formed from the least significant 12 digits (excluding the check digit) of the Primary Account Number (PAN).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">Original PIN Block  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">PAN  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">PIN Block  </td></tr>
</table>
<ul>
<li>0 in the "Original PIN Block" stands for ISO-0 format.</li>
<li>4 in the "Original PIN Block" stands for the PIN length.</li>
<li>P = PIN digit (possible values 0 to 9).</li>
<li>F is the fill digit (must be hexadecimal F).</li>
</ul>
<p>This format is used for online interchange transactions.</p>
<h3><a class="anchor" id="subsec_security_ISO_1_PIN_block_format"></a>
ISO-1 PIN Block Format</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R </td><td class="markdownTableBodyNone">R  </td></tr>
</table>
<ul>
<li>1 stands for ISO-1 format.</li>
<li>4 stands for the PIN length.</li>
<li>P = PIN digit (possible values 0 to 9).</li>
<li>R = Random or transaction sequence number or time stamp (possible values 0 to F).</li>
</ul>
<p>This format is used for online interchange transactions.</p>
<h3><a class="anchor" id="subsec_security_ISO_2_PIN_block_format"></a>
ISO-2 PIN Block Format</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F  </td></tr>
</table>
<ul>
<li>2 stands for ISO-2 format.</li>
<li>4 stands for the PIN length.</li>
<li>P is the PIN digit (possible values 0 to 9).</li>
<li>F is the fill digit (must be hexadecimal F).</li>
</ul>
<p>This format is used for the physical personalization process (when creating the card) and is not approved for online interchange transactions.</p>
<h3><a class="anchor" id="subsec_security_ISO_3_PIN_block_format"></a>
ISO-3 PIN Block Format</h3>
<p>The PIN block is formed by XORing an 'original PIN Block' comprising the PIN digits with a mask formed from the least significant 12 digits (excluding the check digit) of the Primary Account Number (PAN).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">F </td><td class="markdownTableBodyNone">Original PIN Block  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">A </td><td class="markdownTableBodyNone">PAN  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">P </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">X </td><td class="markdownTableBodyNone">PIN Block  </td></tr>
</table>
<ul>
<li>3 in the "Original PIN Block" stands for ISO-3 format.</li>
<li>4 in the "Original PIN Block" stands for the PIN length.</li>
<li>P is the PIN digit (possible values 0 to 9).</li>
<li>F is the fill digit (possible value A to F).</li>
</ul>
<p>This format is used for online interchange transactions. <br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_Migration_Guide"></a>
Appendix E: Migration Guide</h1>
<p>This documentation describes what a developer has to do if he wants to migrate from ADK-SEC version 1.x.x to version 2.x.x (hereinafter referred to ADK-SEC-1.x respective ADK-SEC-2.x).</p>
<h2><a class="anchor" id="sec_migration_guide"></a>
Migration to ADK-SEC-2.x</h2>
<p>ADK-SEC-2.x provides a new API which is <b>not</b> compatible to ADK-SEC-1.x. This concerns</p><ul>
<li>API functions</li>
<li>ADK-SEC configuration</li>
</ul>
<p>Nevertheless it is possible to use the legacy API function set furthermore. This is offered for those application developers who don't want to change their code fundamentally. <br  />
In this case a Compatibility Layer maps the legacy functions to the new ones. <br  />
But it is recommended to use the new API function set because an identical legacy functionality can not be provided. <br  />
<br  />
Firstly an application developer has to set up a new ADK-SEC-2.x configuration (see <a class="el" href="pg_sec_users_guide.html#subsec_configure_adksec">Configure ADK-SEC</a>). <br  />
The usage of API functions is described in the sections <a class="el" href="pg_sec_users_guide.html#subsec_migrate_to_new_api_func">Apply New API Functions</a> and <a class="el" href="pg_sec_users_guide.html#subsec_migrate_to_legacy_api_func">Apply Legacy API Functions</a>. <br  />
Specifics regarding multiple host usage is described in <a class="el" href="pg_sec_users_guide.html#subsec_multi_host_specifics">Multiple Hosts Usage</a>. <br  />
How to build an application and how to setup a device is described in <a class="el" href="pg_sec_users_guide.html#subsec_build_app_setup_device">Build an Application and Setup a Device</a>. <br  />
<br  />
Comparisons between ADK-SEC-1.x and ADK-SEC-2.x API functions, error codes and configuration items are presented in <a class="el" href="pg_sec_users_guide.html#sec_annex_1_comparisons">ANNEX_1: Comparison of ADK-SEC-1.x and ADK-SEC-2.x API</a>.</p>
<h3><a class="anchor" id="subsec_configure_adksec"></a>
Configure ADK-SEC</h3>
<p>In ADK-SEC-1.x the configuration was determined by the scapp configuration file <code>scapp</code>. <code>cfg</code> and the host configuration files <code>hostxx</code>. <code>cfg</code> (xx from {01, 02, ..., 99}). <br  />
In ADK-SEC-2.x the configuration is defined by one file: <code>sccfg</code>. <code>json</code> (see <a class="el" href="pg_sec_users_guide.html#subsubsec_security_adksec_configuration">ADK-SEC Configuration</a>). <br  />
<br  />
The ADK-SEC-1.x host configuration files can be converted to <code>sccfg</code>. <code>json</code> by the Windows tool <code>cfgtool</code>.<code>exe</code> (see <a class="el" href="pg_sec_users_guide.html#sec_annex_2_config_conversion_tool">ANNEX_2: Configuration Conversion Tool</a>) which is part of the ADK-SEC delivery. <br  />
The legacy <code>scapp</code> configuration file is no longer relevant. For details see section <a class="el" href="pg_sec_users_guide.html#subsec_comparison_of_config_files">Comparison of Configuration Files</a>.</p>
<h3><a class="anchor" id="subsec_migrate_to_new_api_func"></a>
Apply New API Functions</h3>
<p>The new function interface is given by <a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a> and <a class="el" href="sec_error_8h.html" title="ADK Security Service Error Codes.">secError.h</a>. <br  />
A comparison of legacy and new functions can be seen in <a class="el" href="pg_sec_users_guide.html#subsec_compare_API_functions">Comparison of API functions</a>. <br  />
<br  />
An additional functionality in ADK-SEC-2.x is provided by the Transaction Data container and its handling. This allows the exchange of data between a user application and ADK-SEC. <br  />
Therefore special API functions are provided whichh are described in <a class="el" href="_c_transaction_data_8h.html" title="ADK Security Service Transaction Data.">CTransactionData.h</a>.</p>
<h3><a class="anchor" id="subsec_migrate_to_legacy_api_func"></a>
Apply Legacy API Functions</h3>
<p>If an application developer wants to apply ADK-SEC-2.x but intends using his legacy API functions as before he can use this functions provided by the Compatibility Layer. <br  />
This interface is provided by the header file <a class="el" href="libseccmd-comp_8h.html" title="ADK Security Service API (legacy)">libseccmd-comp.h</a>. <br  />
The supported functions are also listed in <a class="el" href="pg_sec_users_guide.html#subsec_compare_API_functions">Comparison of API functions</a>. <br  />
<br  />
Be aware that the output of error codes is not fully compatible with the ADK-SEC-1.x. <br  />
A comparison of error codes can be found in <a class="el" href="pg_sec_users_guide.html#subsec_compare_error_codes">Comparison of Error Messages</a>.</p>
<h3><a class="anchor" id="subsec_multi_host_specifics"></a>
Multiple Hosts Usage</h3>
<p>In opposite to ADK-SEC-1.x where one configuration file was used per host ADK-SEC-2.x uses only one file to handle multiple hosts. <br  />
A switch to another host can be done by the functions <a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> and <a class="el" href="namespacecom__verifone__seccmd.html#a16e0564f479c004161cf826dbc6670b1">Sec_Open()</a> (of the compatible layer). <br  />
For details see the example in <a class="el" href="pg_sec_users_guide.html#subsec_example_01">Example: Convert host configuration files 01.cfg and 03.cfg to sccfg.json</a>. <br  />
<br  />
 If a further configuration file shall be used note that the switch cannot be done at runtime.</p>
<h3><a class="anchor" id="subsec_build_app_setup_device"></a>
Build an Application and Setup a Device</h3>
<p>To build an application using ADK-SEC-2.x the following library has to be linked:</p><ul>
<li>libsec2.so (shared ADK-SEC-API library)</li>
</ul>
<p>Create the following application packages and load into the device:</p><ul>
<li>Application package</li>
<li>config package</li>
<li>VSS script package (optional)</li>
</ul>
<p>Following ADK-SEC packages have to be installed on the device</p><ul>
<li>dl.sec-scapp2-2.x.x.tar</li>
<li>dl.libsec2-2.x.x.tar</li>
</ul>
<p>Following ADK components respective the appropriate packages have to available on the device:</p><ul>
<li>libvfiipc (mandatory)</li>
<li>liblog (for using ADK-LOG)</li>
<li>libguiprt (for using ADK-GUIPRT)</li>
<li>guiprtserver (for using ADK-GUIPRT)</li>
<li>libsysinfo (for using MAC)</li>
</ul>
<p><br  />
 </p>
<h2><a class="anchor" id="sec_annex_1_comparisons"></a>
ANNEX_1: Comparison of ADK-SEC-1.x and ADK-SEC-2.x API</h2>
<h3><a class="anchor" id="subsec_compare_API_functions"></a>
Comparison of API functions</h3>
<p>The API functions are provided by following header files:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ADK-SEC Version </th><th class="markdownTableHeadNone">API </th><th class="markdownTableHeadNone">Header File  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1.x </td><td class="markdownTableBodyNone">(legacy) API </td><td class="markdownTableBodyNone">libseccmd.h  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2.x </td><td class="markdownTableBodyNone">new API </td><td class="markdownTableBodyNone"><a class="el" href="libsec_8h.html" title="ADK Security Service API.">libsec.h</a>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2.x </td><td class="markdownTableBodyNone">legacy API (Compatibility Layer) </td><td class="markdownTableBodyNone"><a class="el" href="libseccmd-comp_8h.html" title="ADK Security Service API (legacy)">libseccmd-comp.h</a>  </td></tr>
</table>
<p><br  />
 In the following table all legacy API functions are listed and contrasted with new API functions. <br  />
<br  />
<br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API function in<br  />
ADK-SEC-1.x </th><th class="markdownTableHeadNone">Functionality </th><th class="markdownTableHeadNone">Supported by<br  />
Comp. Layer? </th><th class="markdownTableHeadNone">Corresponding<br  />
API function<br  />
in ADK-SEC-2.x </th><th class="markdownTableHeadNone">Differences<br  />
in ADK-SEC-2.x  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a9871b00715c29b88812f6cbe88657a21">Sec_Init()</a> </td><td class="markdownTableBodyNone">Establish an IPC communication to Security Service </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ab649bee85abb5cb4085c3958f279483d">secInit()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a16e0564f479c004161cf826dbc6670b1">Sec_Open()</a> </td><td class="markdownTableBodyNone">Open a Security Scheme based on Host Name </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> </td><td class="markdownTableBodyNone">Open a Host configuration with module name refernced in the configuration  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#aed03f5425bde3f1404d4b97f8175c39f">Sec_Close()</a> </td><td class="markdownTableBodyNone">Close a Security Module </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a34f8a9e3b92467759d0bbdbf7b2dd8c0">secClose()</a> </td><td class="markdownTableBodyNone">Close opened Host Configuration  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a9815dafaa8bd5999fbfaa20d7d22e661">Sec_Destroy()</a> </td><td class="markdownTableBodyNone">Close an IPC communication to Security Service </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a644b5479904871433cffef9145c53dad">secDestroy()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ae805c757835a3b0a1b9e8adfc5ab574c">Sec_SelectHostConf()</a> </td><td class="markdownTableBodyNone">Select a Host Configuration </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> </td><td class="markdownTableBodyNone">If a HostId doesn't exist the 'default' host is selected  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a3deda460871c6786f09216ea917dbfe0">Sec_GetKeyData()</a> </td><td class="markdownTableBodyNone">Get Key Data </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#aff0a109c58ef5637c7bf3ffc0722c48d">secGetKeyData()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a433ea1cf1bb2d33de167c140f01239ed">Sec_UpdateKey()</a> </td><td class="markdownTableBodyNone">Load a key </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a86bd1dbbaa97e44d4678e2cfbddca9a0">Sec_EncryptData()</a> </td><td class="markdownTableBodyNone">Encrypt data </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#aa58bc1a6a2056aebd3edc92f3bfcce9d">secEncryptData()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#abd1a0b2921b3987ea04a3554f9b01654">Sec_DecryptData()</a> </td><td class="markdownTableBodyNone">Decrypt data </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a9cd679dc9763b06566dff28b3d3268c9">secDecryptData()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a6db6f20b1810117273ba926c668abe09">Sec_AS2805KeyMgmnt()</a> </td><td class="markdownTableBodyNone">Special Key Management acc. AS2805 </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a415992011cbd54131165ca25801edb8a">Sec_GenerateMAC()</a> </td><td class="markdownTableBodyNone">Generate a MAC </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a66a1992f617359f2e4a96f4980478f82">secSign()</a> </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a415992011cbd54131165ca25801edb8a">Sec_GenerateMAC()</a> for IPP provides MAC in ASCII or BIN format <br  />
 depending on input parameter MACMode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a8a524ef7b08dde1a6e71492a44f1ea6b">Sec_VerifyMAC()</a> </td><td class="markdownTableBodyNone">Verify a MAC </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a5470ce89fa947abc445f251ae0b2387b">secVerify()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Sec_EnterAndEncryptPIN() </td><td class="markdownTableBodyNone">Enter a PIN and provide an encrypted PIN block </td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Sec_EnterAndHoldPIN() </td><td class="markdownTableBodyNone">Enter and hold a PIN </td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a9a8932b53f4d3b1c33fe80636f25abb5">Sec_RetrieveEncryptedPIN()</a> </td><td class="markdownTableBodyNone">Retrieve an encrypted PIN block </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Sec_CancelPIN() </td><td class="markdownTableBodyNone">Cancel a PIN entry process </td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Sec_SetSecurityConfig() </td><td class="markdownTableBodyNone">Set Security Configuration </td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Several host configurations can be specified by sccfg.json  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Sec_GetSecurityConfig() </td><td class="markdownTableBodyNone">Get Security Configuration </td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#acbda26bbc5a491c6cc45e05e801e0c43">Sec_GetVersions()</a> </td><td class="markdownTableBodyNone">Get versions of components </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a5499423d685ed9deb7ace9c22114adf2">secGetVersions()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#aac3397523242fcae1a15786ff8f5aa09">Sec_GetVersion()</a> </td><td class="markdownTableBodyNone">Get API library version </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a5ea5cbc9daa2ea726212741cd596b294">secGetApiVersion()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ac17ac87391e0a1843fab4825be72b151">Sec_GetSvcVersion()</a> </td><td class="markdownTableBodyNone">Get security service version </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a029d7e16ab6b044379e9568a6c969afa">secGetSvcVersion()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a88e049aa8e79d431c600e78fee76a969">Sec_SetKSId()</a> </td><td class="markdownTableBodyNone">Set Key set ID </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#ad71befc1abbf8dad13f233b4730c8f08">Sec_SetDUKPTMask()</a> </td><td class="markdownTableBodyNone">Set DUKPT key mask </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Functionality is provided by <a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a><br  />
and <a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - see (*1)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a1bdf809486c2ce3ef0e8dc9b4dd97130">Sec_IncrementKSN()</a> </td><td class="markdownTableBodyNone">Increment KSN </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone"><a class="el" href="namespacecom__verifone__seccmd.html#a77860b4cffed3ba159a5c124c8e2cde2">secIncrementKSN()</a> </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p><br  />
(*1) The following example shows how to set DUKPT masks in ADK-SEC-2.x: <br  />
</p><pre class="fragment">    int SetDUKPTMask(secHandle_t handle, DUKPTmask *pDUKPTMask, ...)
    {
      . . .
      secError ret;

      SecTransactionData_t taData;
      taData[CTransactionData::TagVSSDUKPTMaskPIN] = CTransactionValue(pDUKPTMask-&gt;maskPIN, pDUKPTMask-&gt;sizeP);
      taData[CTransactionData::TagVSSDUKPTMaskMAC] = CTransactionValue(pDUKPTMask-&gt;maskMAC, pDUKPTMask-&gt;sizeM);
      taData[CTransactionData::TagVSSDUKPTMaskENC] = CTransactionValue(pDUKPTMask-&gt;maskENC, pDUKPTMask-&gt;sizeE);
      taData[CTransactionData::setDUKPTmasks] = true;
      ret = secPutTransactionData(handle, taData);
      if (!ret)
      {
        std::vector&lt;uint8_t&gt; dummy;
        ret = secUpdateKey(handle, KEY_TYPE_DUKPT, dummy, dummy);
      }
      . . .
</pre><h3><a class="anchor" id="subsec_compare_error_codes"></a>
Comparison of Error Messages</h3>
<p><b><em>API function Error Messages in ADK-SEC-1.x</em></b> <br  />
<br  />
The API functions return a command error and an error code. <br  />
 </p><pre class="fragment">  int ret = Sec_EncryptData(..., uint8_t *errCode,...);
</pre><p>The command error indicates a <em>basic</em> misbehavior (e.g. defective IPC communication). <br  />
The error code is a function output parameter (<code>errCode</code>) which indicates a <em>specific</em> misbehavior. <br  />
<br  />
<b><em>API function Error Messages in ADK-SEC-2.x</em></b> <br  />
<br  />
The new API functions return a 4-byte error code in a detailed way (e.g. EsecVSSMacroError (0x00110108)). <br  />
</p><pre class="fragment">  secError ret = secEncryptData(...);
</pre><p>The error codes can be found in <a class="el" href="namespacecom__adksec__cmd.html#af511ddd4237541a758df48299546d49a">com_adksec_cmd::secError</a>. <br  />
<br  />
<b><em>Legacy API function Error Messages in ADK-SEC-2.x</em></b> <br  />
<br  />
The Compatibility Layer maps the 4-byte error code delivered by new API functions to the command return value and to the 1-byte error code. <br  />
<br  />
<em>Mapping to Command Return Values</em> <br  />
</p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Error Cause </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Legacy Function<br  />
Return Value<br  />
(<code>ret</code>)  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">- com_adksec_cmd::EsecOK <br  />
 - not com_adksec_cmd::EsecINVAL <br  />
 - not <a class="el" href="namespacecom__adksec__cmd.html#afe1062c1bfd2726a8d1ab38e7811bfb1a8d1038dad4c0f15215f4788a08f9584e" title="IPC related.">com_adksec_cmd::EsecGroupIPC</a> <br  />
 - not <a class="el" href="namespacecom__adksec__cmd.html#afe1062c1bfd2726a8d1ab38e7811bfb1a167ffff4c0820ffb92f955cb7a8d29ee" title="Api-lib.">com_adksec_cmd::EsecGroupApi</a> </td><td class="markdownTableBodyNone">no error or error in scapp (means: not listed below) </td><td class="markdownTableBodyNone">SC_SUCCESS (0)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__adksec__cmd.html#afe1062c1bfd2726a8d1ab38e7811bfb1a167ffff4c0820ffb92f955cb7a8d29ee" title="Api-lib.">com_adksec_cmd::EsecGroupApi</a> </td><td class="markdownTableBodyNone">error in API lib </td><td class="markdownTableBodyNone">SC_ERROR (-1)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">com_adksec_cmd::EsecINVAL or *errCode==NULL </td><td class="markdownTableBodyNone">Invalid argument or no memory for <code>errCode</code> allocated </td><td class="markdownTableBodyNone">SC_WRONG_PAR (-2)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="namespacecom__adksec__cmd.html#afe1062c1bfd2726a8d1ab38e7811bfb1a8d1038dad4c0f15215f4788a08f9584e" title="IPC related.">com_adksec_cmd::EsecGroupIPC</a> </td><td class="markdownTableBodyNone">IPC error </td><td class="markdownTableBodyNone">SC_SEND_FAILED (-3)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">buffer size to small </td><td class="markdownTableBodyNone">buffer size for function parameter (out, ksn, mac) is to small </td><td class="markdownTableBodyNone">SC_RECBUF_SMALL (-4)  </td></tr>
</table>
<p><br  />
<em>Mapping to Error Codes</em> <br  />
<br  />
The mapping can be obtained in <a class="el" href="namespacecom__adksec__cmd.html#af511ddd4237541a758df48299546d49a">com_adksec_cmd::secError</a>. <br  />
 </p>
<h3><a class="anchor" id="subsec_comparison_of_config_files"></a>
Comparison of Configuration Files</h3>
<p>In ADK-SEC-1.x the following configuration files are used:</p><ul>
<li><code>scapp</code>.<code>cfg</code> - scapp configuration file</li>
<li><code>xx</code>.<code>cfg</code> , xx from {01, .., 99} - host configuration files</li>
</ul>
<p>As all <code>scapp</code>.<code>cfg</code> items are obsolete for ADK-SEC-2.x this configuration need not to be converted (see <a class="el" href="pg_sec_users_guide.html#Footnotes">Footnotes</a>). <br  />
<br  />
The Host Configuration items have to be mapped to tags in JSON file <code>sccfg</code>.<code>json</code> or ignored according the following table. <br  />
This can be done automatically by the conversion tool <code>cfgtool</code> (see <a class="el" href="pg_sec_users_guide.html#sec_annex_2_config_conversion_tool">ANNEX_2: Configuration Conversion Tool</a>). <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Item in xx.cfg </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Tag in <code>sccfg</code>.<code>json</code>   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PIN_ENTRY_TYPE </td><td class="markdownTableBodyNone">PIN entry type </td><td class="markdownTableBodyNone">Obsolete as PIN entry is no longer supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PIN_BLOCK_FORMAT </td><td class="markdownTableBodyNone">PIN block format </td><td class="markdownTableBodyNone">Set "PINBlockFormat" or use function parameter <code>pinBlockFormat</code>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KEY_MANAGEMENT </td><td class="markdownTableBodyNone">Key Management type </td><td class="markdownTableBodyNone">Set "KeyManagementType"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PIN_ALGORITHM </td><td class="markdownTableBodyNone">PIN Encryption algorithm </td><td class="markdownTableBodyNone">Obsolete (Triple DES is hard coded)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DATA_ALGORITHM </td><td class="markdownTableBodyNone">Data Encryption algorithm </td><td class="markdownTableBodyNone">Obsolete (Triple DES is hard coded)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VSS </td><td class="markdownTableBodyNone">MSK: VSS Security Script name prefix </td><td class="markdownTableBodyNone">Set "scriptName"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">VSS </td><td class="markdownTableBodyNone">IPP: Supported Key Management </td><td class="markdownTableBodyNone">Obsolete  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SCRIPT_FILE </td><td class="markdownTableBodyNone">VSS Security Script name </td><td class="markdownTableBodyNone">Set "scriptFileName"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KEY_MAN_OPTION </td><td class="markdownTableBodyNone">IPP Key Management options </td><td class="markdownTableBodyNone">Set "KeyManagementOption"  </td></tr>
</table>
<p><br  />
<b><em>Footnotes</em></b> <br  />
<a class="anchor" id="Footnotes"></a></p><ol type="1">
<li>As PIN entry is no longer supported the configuration items for PIN handling are omitted</li>
<li>The item IPP_DATA_FORMAT is no longer effective, the encrypted PIN block is always provided in BIN format <br  />
<br  />
 </li>
</ol>
<h2><a class="anchor" id="sec_annex_2_config_conversion_tool"></a>
ANNEX_2: Configuration Conversion Tool</h2>
<p>ADK-SEC provides the Windows tool <code>cfgtool</code> to convert ADK-SEC-1.x host configuration files <code>hostxx</code>. <code>cfg</code> (xx from {01, 02, ..., 99}) to one JSON-formatted file <code>sccfg</code>. <code>json</code> needed for ADK-SEC-2.x applications. <br  />
<code>sccfg</code>. <code>json</code> is a full operational configuration file. <br  />
<br  />
 The tool and the needed dll-files are provided in the ADK-SEC delivery package <code>sec-cfgtool-2.0.0-*</code>.<code>zip</code>. <br  />
<br  />
If <code>cfgtool</code>.<code>exe</code> is started in a DOS Box it's usage can be seen: </p><pre class="fragment">  cfgtool --version
  cfgtool [&lt;cfg file names&gt;...]
</pre><h3><a class="anchor" id="subsec_example_01"></a>
Example: Convert host configuration files 01.cfg and 03.cfg to sccfg.json</h3>
<p>The following host configuration files shall be converted to <code>sccfg</code>.<code>json</code>.</p>
<ul>
<li>Host Configuration File <code>01</code>.<code>cfg:</code> <pre class="fragment">########################################################
# Host Configuration File #
########################################################
#
# PIN entry type
# 0 - PIN mandatory
# 1 - PIN optional
# 2 - PIN optional with zero length PIN encryption
# 3 - Zero length PIN
PIN_ENTRY_TYPE=0
#
# PIN block format
# 0 - ISO0
# 1 - ISO1
# 2 - ISO2
# 3 - ISO3(EMV format)
PIN_BLOCK_FORMAT=0
#
# Key Management type
# 1 - MSK
# 2 - DUKPT
# 3 - AS2805
#
KEY_MANAGEMENT=1
#
# PIN Encryption algorithm (currently not changeable - hard coded value: Triple DES)
# 1 - Single DES
# 2 - Triple DES
# 3 - AES
PIN_ALGORITHM=2
#
# Data Encryption algorithm (currently not changeable - hard coded value: Triple DES)
# 1 - Single DES
# 2 - Triple DES
# 3 - AES
DATA_ALGORITHM=2
#
# VSS Security Script Name Prefix
#
# ... used as fallback if paramater SCRIPT_FILE is not available.
# ... will be completed by the Security Component with &lt;host_id&gt; (2 char) as well as
# &lt;Key Management&gt; and &lt;PIN Algorithm or Data Algorithm&gt; (each with 1 char) plus '.vso'.
# A VSS Security Script with this file name will be installed.
# This naming allows identification of the correct security script.
VSS = TS02
#
# Vss Security Script Name
#
# A VSS Security Script with this name will be installed.
# Recommented file naming convention:
# &lt;VSS&gt;&lt;host_id&gt;&lt;Key Management&gt;&lt;PIN Algorithm or Data Algorithm&gt;.vso
# This naming convention allows identification of the correct security script.
SCRIPT_FILE = TS020122.vso
</pre> <br  />
<br  />
</li>
<li>Host Configuration File <code>03</code>.<code>cfg:</code> <pre class="fragment">########################################################
# Host Configuration File #
########################################################
#
# PIN entry type
# 0 - PIN mandatory
# 1 - PIN optional
# 2 - PIN optional with zero length PIN encryption
# 3 - Zero length PIN
PIN_ENTRY_TYPE=0
#
# PIN block format
# 0 - ISO0
# 1 - ISO1
# 2 - ISO2
# 3 - ISO3(EMV format)
PIN_BLOCK_FORMAT=0
#
# Key Management type
# 1 - MSK
# 2 - DUKPT
# 3 - AS2805
#
KEY_MANAGEMENT=2
#
# PIN Encryption algorithm (currently not changeable - hard coded value: Triple DES)
# 1 - Single DES
# 2 - Triple DES
# 3 - AES
PIN_ALGORITHM=2
#
# Data Encryption algorithm (currently not changeable - hard coded value: Triple DES)
# 1 - Single DES
# 2 - Triple DES
# 3 - AES
DATA_ALGORITHM=2
#
# VSS Security Script Name Prefix
#
# ... used as fallback if paramater SCRIPT_FILE is not available.
# ... will be completed by the Security Component with &lt;host_id&gt; (2 char) as well as
# &lt;Key Management&gt; and &lt;PIN Algorithm or Data Algorithm&gt; (each with 1 char) plus '.vso'.
# A VSS Security Script with this file name will be installed.
# This naming allows identification of the correct security script.
VSS = TS01
#
# Vss Security Script Name
#
# A VSS Security Script with this name will be installed.
# Recommented file naming convention:
# &lt;VSS&gt;&lt;host_id&gt;&lt;Key Management&gt;&lt;PIN Algorithm or Data Algorithm&gt;.vso
# This naming convention allows identification of the correct security script.
SCRIPT_FILE = TS010322.vso
</pre> <br  />
<br  />
 Convert <code>01</code>.<code>cfg</code> and <code>03</code>.<code>cfg</code> to <code>sccfg</code>.<code>json</code> <pre class="fragment">  &gt;cfgtool.exe 01.cfg 03.cfg
</pre> <br  />
<br  />
 Conversion result is <code>sccfg</code>.<code>json:</code> <pre class="fragment">{
  "adksecconfig":
  {
    "hosts": [
      {
        "description": "Use this as fallback",
        "name": "default",
        "scheme": "schemeIPPmsk"
      },
      {
        "description": "host configuration 01.cfg",
        "module": "VSS",
        "name": "01",
        "scheme": "01_scheme"
      },
      {
        "description": "host configuration 03.cfg",
        "module": "VSS",
        "name": "03",
        "scheme": "03_scheme"
      }],
    "serviceCfg":
    {
      "secSchemes": [
        {
          "module": "IPPmsk",
          "name": "schemeIPPmsk",
          "settings":
          {
            "KeyAddressTable":
            [
              {"description": "| 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8 |  9 | 10 | &lt;- KeySetId (10 slots)"},
              {"retrieveEncPIN": ["0","1","2","3","4","5","6","7","8","9"]},
              {"sign": ["0","1","2","3","4","5","6","7","8","9"]}
            ],
            "KeyManagementOption": "0A0",
            "PINBlockFormat": "ISO0"
          }
        },
        {
          "name": "01_scheme",
          "scriptFileName": "TS020122.vso",
          "scriptName": "TS020122",
          "settings":
          {
            "KeyManagementType": "MSK",
            "PINBlockFormat": "ISO0"
          }
        },
        {
          "name": "03_scheme",
          "scriptFileName": "TS010322.vso",
          "scriptName": "TS010322",
          "settings":
          {
            "KeyManagementType": "DUKPT",
            "PINBlockFormat": "ISO0"
          }
        }
      ]
    }
  }
}
</pre> <br  />
<br  />
 </li>
</ul>
<h1><a class="anchor" id="page_adksec_appendix_Special_Features"></a>
Appendix F: Special Features</h1>
<p>This section describes how to use the following special features and provides some code examples.</p><ul>
<li><a class="el" href="pg_sec_users_guide.html#sec_security_vss_vbs">Variable Block Size Feature</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_additional_key_types">Additional Key Types</a></li>
<li><a class="el" href="pg_sec_users_guide.html#sec_feature_visa_dsp">Visa DSP</a></li>
</ul>
<p><br  />
</p>
<h2><a class="anchor" id="sec_security_vss_vbs"></a>
Variable Block Size Feature</h2>
<p>Default block size that is used in iteration macros of VSS crypto operations is 8 bytes. Some projects need the possibility to operate with more data per iteration e.g. to achieve higher performance. This is possible by using the Variable Block Size feature. </p>
<h3><a class="anchor" id="subsec_security_vss_vbs_prin"></a>
Principle</h3>
<p>Each crypto operation with VSS (enc-/decrypt, sign and verify) can:</p><ul>
<li>define block size of data in INIT macro for its own iteration loop</li>
<li>define padding block size of data in INIT macro for data padding. Padding method can be defined via host configuration (<a class="el" href="pg_sec_users_guide.html#page_adksec_appendix_Json_Config">Appendix A: JSON Schemes, Configuration and Output Examples</a>, tag "padding")</li>
<li>define its own Initial Vector (IV) to provide this to application (e.g. generate random IV in script before data encryption)</li>
<li>receive data of size defined in first 8-byte CB block of ITERATION macro</li>
<li>receive length of real received data in ITERATION macro in case if last data block is not multiple of block size</li>
</ul>
<h3><a class="anchor" id="subsec_security_vss_vbs_act"></a>
Activation</h3>
<p>This functionality is configurable and can be activated using <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a> via macro SCRIPT_CHECK_INIT (33h). This changes will apply to all crypto operations (ITERATION macros) Please see section <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_vbs_migr">Migration</a>. </p>
<h3><a class="anchor" id="subsec_security_vss_vbs_usage"></a>
Usage</h3>
<h4><a class="anchor" id="subsubsec_security_vss_vbs_init"></a>
Init macro</h4>
<p>If the feature is activated the INIT macro can provide:</p><ul>
<li>the block size in little endian format in the first 2 bytes CB as output data</li>
<li>the padding block size in little endian format in the second 2 bytes CB as output data (optional parameter)</li>
<li>the IV in the n bytes begining with 8-th CB byte as output data (optional parameter)</li>
</ul>
<p>Communication Buffer as response of INIT macro <br  />
</p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">0 </th><th class="markdownTableHeadNone">1 </th><th class="markdownTableHeadNone">2 </th><th class="markdownTableHeadNone">3 </th><th class="markdownTableHeadNone">4 </th><th class="markdownTableHeadNone">5 </th><th class="markdownTableHeadNone">6 </th><th class="markdownTableHeadNone">7 </th><th class="markdownTableHeadNone">8 ...  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">blk size, lo </td><td class="markdownTableBodyNone">blk size, hi </td><td class="markdownTableBodyNone">pad blk size, lo </td><td class="markdownTableBodyNone">pad blk size, hi </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">new IV  </td></tr>
</table>
<p>If the macro returns 0 bytes the security service assumes that the iteration macro will use default block size and default padding block size of 8 bytes.</p>
<p><br  />
<em>Example</em> <br  />
<b>MACRO 60h <code>//MAC_GENERATE_INIT</b></code> </p><div class="fragment"><div class="line">MACRO 60h <span class="comment">//MAC init</span></div>
<div class="line">  LENGTH 8</div>
<div class="line">  ...</div>
<div class="line">  LDAI 0800080000000000 <span class="comment">// little endian format, iteration block size = 8 bytes, padding block size = 8 bytes</span></div>
<div class="line">  SENDA 0</div>
<div class="line">  LDAI 1234567890123456 <span class="comment">// new IV</span></div>
<div class="line">  SENDA 8</div>
<div class="line">  MOV_A_IV              <span class="comment">// set new IV for future usage in ITERATION macro</span></div>
<div class="line">EOM 16   <span class="comment">//return data</span></div>
</div><!-- fragment --><h4><a class="anchor" id="subsubsec_security_vss_vbs_iter"></a>
Iteration macro</h4>
<p>ITERATION macro always receives 8 bytes little endian coded block size (n) + n bytes of data.<br  />
Output data format is depending on operation. Signing and verification macros does not need to return data (EOM 0). Enc-/decryption macros have to return 8 bytes block size (n) + n bytes of enc-/decrypted data.</p>
<p><em>Example 1</em> <br  />
<b>MACRO 53h <code>//DECRYPTION_ITERATION</code> on comunication buffer</b> </p><div class="fragment"><div class="line">  LENGTH 8       <span class="comment">//check if minimum 8-bytes of data in the CB</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// length check for Variable Block Size</span></div>
<div class="line">  LDAI 0001000000000000 <span class="comment">// 256 bytes</span></div>
<div class="line">  MOV_A_B0</div>
<div class="line">  GETA 0         <span class="comment">// data length</span></div>
<div class="line">  CMPA_B0        <span class="comment">// data must be 256 bytes long</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// encryption</span></div>
<div class="line">  ALGO_DES112    <span class="comment">// select decryption algorithm</span></div>
<div class="line">  SELECT 10      <span class="comment">// select DEK</span></div>
<div class="line">  DCBC_CB 8 256  <span class="comment">//decrypt data using CBC &lt;-- work only with VSS engine begining with v.6</span></div>
<div class="line"> </div>
<div class="line">EOM 264 <span class="comment">//return 8 bytes of length + 256 bytes of data</span></div>
</div><!-- fragment --><p> <br  />
<em>Example 2</em> <br  />
<b>MACRO 61h <code>//MAC_GENERATE_ITERATION</b></code> </p><div class="fragment"><div class="line">  LENGTH 8          <span class="comment">// length of data, little endian coded</span></div>
<div class="line"> </div>
<div class="line">  GETA 0            <span class="comment">// Get the 8 bytes of block size, little endian coded</span></div>
<div class="line">  MOV_A_B0</div>
<div class="line"> </div>
<div class="line">  GETW 8 8          <span class="comment">// Get the 8 bytes of data to calculate next scha256 data</span></div>
<div class="line"> </div>
<div class="line">  LDAI 0800000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_8</div>
<div class="line">  SHA256UPDATE 8</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_8:</div>
<div class="line">  LDAI 0700000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_7</div>
<div class="line">  SHA256UPDATE 7</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_7:</div>
<div class="line">  LDAI 0600000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_6</div>
<div class="line">  SHA256UPDATE 6</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_6:</div>
<div class="line">  LDAI 0500000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_5</div>
<div class="line">  SHA256UPDATE 5</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_5:</div>
<div class="line">  LDAI 0400000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_4</div>
<div class="line">  SHA256UPDATE 4</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_4:</div>
<div class="line">  LDAI 0300000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_3</div>
<div class="line">  SHA256UPDATE 3</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_3:</div>
<div class="line">  LDAI 0200000000000000</div>
<div class="line">  CMPA_B0_BNE mac_less_2</div>
<div class="line">  SHA256UPDATE 2</div>
<div class="line">  BRA mac_end</div>
<div class="line">mac_less_2:</div>
<div class="line">  LDAI 0100000000000000</div>
<div class="line">  CMPA_B0</div>
<div class="line">  SHA256UPDATE 1</div>
<div class="line"> </div>
<div class="line">mac_end:</div>
<div class="line"> </div>
<div class="line">EOM 0  <span class="comment">//return nothing</span></div>
</div><!-- fragment --><h4><a class="anchor" id="subsubsec_security_vss_vbs_fin"></a>
Finish macro</h4>
<p>It is not affected from Variable Block Size feature. </p>
<h3><a class="anchor" id="subsec_security_vss_vbs_defbeh"></a>
Default behavior</h3>
<p>If the block size is not defined in INIT macro but the feature is activated the default block size will be set to 8 bytes. In this case ITERATION macro will receive 8 bytes length + 8 bytes data. If padding block size is not defined, it will be assingned using block size value. (padding block size=iteration block size) </p>
<h3><a class="anchor" id="subsec_security_vss_vbs_migr"></a>
Migration</h3>
<p>Minimal changes are required if the feature is activated: Iteration macro must be able to handle block size information received in communication buffer. This is defined by the first 8 bytes in CB. That means <b>all</b> ITERATION macros in script must fetch data for crypto operation beginning with 9-th byte of CB.<br  />
 <em>Example</em> <br  />
<b>MACRO 43h <code>//ENCRYPTION_ITERATION</b></code> </p><div class="fragment"><div class="line">  LENGTH 16</div>
<div class="line"> </div>
<div class="line">  GETA 8      <span class="comment">//copy from CB 8-bytes for encryption into A</span></div>
<div class="line">  ALGO_DES112 <span class="comment">//select decryption algorithm</span></div>
<div class="line">  SELECT 8</div>
<div class="line"> </div>
<div class="line">  ECBC        <span class="comment">//encrypt data using CBC</span></div>
<div class="line">  SENDA 8     <span class="comment">//copy encrypted data from A into CB</span></div>
<div class="line">EOM 16 <span class="comment">//return 8 bytes of length + 8 bytes of data</span></div>
</div><!-- fragment --><p> <br  />
 If some crypto operation must work with block size different to 8 bytes, macros of these operation must be changed:</p><ol type="1">
<li>INIT macro must provide block size as response value</li>
<li>ITERATION macro must fetch data for crypto operation beginning with 9-th byte of CB. Enc-/decryption iteration macro must store result of crypto operation in CB beginning with 9-th position as well. Block size information in first 8 bytes of CB can be evaluated.</li>
</ol>
<p><br  />
 </p>
<h2><a class="anchor" id="sec_additional_key_types"></a>
Additional Key Types</h2>
<p>By default the MSK-VSS module supports the following key types explicitly: PPK, MGK, MVK, DEK, DDK, KEK (see also <a class="el" href="pg_sec_users_guide.html#subsubsec_struct_keysetid_table">Structure and Mode of Operation of the Key-Set-ID Table</a>). <br  />
For projects that require additional key types ADK-SEC provides a feature which allows a flexible allocation by the API function <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a>. This functionality is configurable and can be activated using <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a>. <br  />
<br  />
 <em>Support of Additional Key Types by <a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a></em> <br  />
<a class="el" href="namespacecom__verifone__seccmd.html#a75edecb24f839e04debb1aa5e47b5714">secSetKSId()</a> sets the KeysetID by the parameter <code>ksid</code> and loads the key start slot index in a VSS script by a macro. <br  />
A masked KeySetID can be used to indicate an additional key type. This KeySetID is transfered to the macro MACRO_SELECT_KEY_SET_ID_X (C7h) which separates the pure KeySetID <br  />
and the additional information and stores these in separate slots for further Key Set handling. <br  />
This feature is enabled by feature bit 1 in macro SCRIPT_CHECK_INIT (33h) which has to be '1'. Further configurations are not needed. <br  />
<br  />
 If the feature is not active the default handling is used (no transfer of KeySetID to macro MACRO_SELECT_KEY_SET_ID_1 (C7h)). <br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">feature </th><th class="markdownTableHeadNone">executed macro to select ksid  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">disabled </td><td class="markdownTableBodyNone">there are up to 8 different macros (<a class="el" href="group__vss.html#ga720cc8ec469e36af59973ec62fc95702" title="select KeySet Macro for ksid=1 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_1</a> to <a class="el" href="group__vss.html#ga392ad9e8494ee717ef2b8a63220ed19f" title="select KeySet Macro for ksid=8 and version=1. No input parameters.">MACRO_SELECT_KEY_SET_ID_8</a>) for each ksid without parameter)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">enabled </td><td class="markdownTableBodyNone">execute the same macro <a class="el" href="group__vss.html#ga9aa98a84182f89bbb537c5290eaecc69" title="select KeySet Macro for all ksid and version=2. input parameter: ksid.">MACRO_SELECT_KEY_SET_ID_X</a> for each ksid with different parameters  </td></tr>
</table>
<p><br  />
<br  />
The following example illustrates how the feature can be used for key loading and data encryption. Furthermore it is shown how the VSS macros could be handled. <br  />
Basically the VSS implementation is in the responsibility of the application developer. <br  />
</p>
<h3><a class="anchor" id="subsubsec_example_add_key_types"></a>
Example: Use additional Key Types for key loading and data encryption</h3>
<p>Three keys of additional types MEK, MDK and KEK2 should be loaded and used for data encryption and MAC generation by ADK-SEC. <br  />
To address these key types the Key-Set-ID is masked. <br  />
<br  />
Key-Set-ID mask definition: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key Type </th><th class="markdownTableHeadNone">Mask  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MEK </td><td class="markdownTableBodyNone">0x10  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MDK </td><td class="markdownTableBodyNone">0x20  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KEK2 </td><td class="markdownTableBodyNone">0x30  </td></tr>
</table>
<p><br  />
<b><em>Use UpdateKey()</em></b> <br  />
<br  />
Update of the default keys DEK, DDK, KEK for Key Set 1 occurs in the normal way: <br  />
</p><pre class="fragment">    secSetKSId(handle, 1);
    secUpdateKey(handle, KEY_TYPE_DEK, keyData);
    secUpdateKey(handle, KEY_TYPE_DDK, keyData);
    secUpdateKey(handle, KEY_TYPE_KEK, keyData);
</pre><p> <br  />
Update of MEK, MDK, KEK2 for Key Set 1: <br  />
</p><pre class="fragment">    secSetKSId(handle, 0x10 | 1);
    secUpdateKey(handle, KEY_TYPE_MEK, keyData);

    secSetKSId(handle, 0x20 | 1);
    secUpdateKey(handle, KEY_TYPE_MDK, keyData);

    secSetKSId(handle, 0x30 | 1);
    secUpdateKey(handle, KEY_TYPE_KEK2, keyData);
</pre><p> <br  />
<b><em>Use EncryptData()</em></b> <br  />
<br  />
Encryption of data with the default keys DEK, DDK, KEK for Key Set 1 occurs in the normal way: <br  />
</p><pre class="fragment">    secSetKSId(handle, 1);
    secEncryptData(handle, data, ...);
</pre><p> <br  />
Encryption of data with keys MEK, MDK, KEK2 for Key Set 1: <br  />
</p><pre class="fragment">    secSetKSId(handle, 0x10 | 1);
    secEncryptData(handle, data, ...);

    secSetKSId(handle, 0x20 | 1);
    secEncryptData(handle, data, ...);

    secSetKSId(handle, 0x30 | 1);
    secEncryptData(handle, data, ...);
</pre><p> <br  />
 <b><em>Prepare the VSS Script</em></b> <br  />
<br  />
Use the MKS-VSS script example from <a class="el" href="pg_sec_users_guide.html#subsec_msk_vss_script_example">MSK VSS Script Example</a> as a basic implementation and update it according the following description. <br  />
<br  />
<em>1. VSS Slot Description</em> <br  />
<br  />
The keys shall be organized in VSS key slots as follows: <br  />
</p><div class="fragment"><div class="line"><span class="comment">//  Slots description</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  0 -  1 TMK  key [MSK]</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//                     Key Set</span></div>
<div class="line"><span class="comment">//           ________________________________________</span></div>
<div class="line"><span class="comment">//          |   |   |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//          |_1_|_2_|_3_|_4_|_5_|_6_|_7_|_8_|...|_80_|</span></div>
<div class="line"><span class="comment">// Key Type |   |   |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  PPK     |2  |20 |38 |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  MGK     |4  |22 | . |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  MVK     |6  |24 | . |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  DEK     |8  |26 | . |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  DDK     |10 |28 |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  KEK     |12 |30 |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  MEK     |14 |32 |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  MDK     |16 |34 |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//  KEK2    |18 |36 |   |   |   |   |   |   |   |    |</span></div>
<div class="line"><span class="comment">//          |________________________________________|</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// 100 -    KeySetId</span></div>
<div class="line"><span class="comment">// 101 -    Intermediate value for MAC</span></div>
<div class="line"><span class="comment">// 102 -    Intermediate value for PIN Block Format</span></div>
<div class="line"><span class="comment">// 103 -    place holder for PIN digits for PIN confirmation feature</span></div>
<div class="line"><span class="comment">// 104 -    additional key set information (additional key types)</span></div>
</div><!-- fragment --><p> <br  />
<br  />
<em>2. Activate support of Additional Key Types feature </em> <br  />
<br  />
Add feature bitmask to Macro 33h (see <a class="el" href="pg_sec_users_guide.html#subsec_security_vss_feature">VSS Feature Switches</a>). <br  />
</p><div class="fragment"><div class="line">MACRO 33h</div>
<div class="line">  LENGTH 0</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// provide version and feature mask</span></div>
<div class="line">  LDAI 0102000000000000   <span class="comment">// 01 - version, 02 - use Additional Key Types feature</span></div>
<div class="line">  SENDA 0</div>
<div class="line">EOM 2</div>
</div><!-- fragment --><p> <br  />
<em>3. Update macro for loading Key Start Slot Index</em> <br  />
<br  />
For version 2 of macro SCRIPT_GET_KEY_SET_INIT the 4 Byte Key-Set-ID (maybe masked) is transfered to the following macro MACRO_SELECT_KEY_SET_ID_X (C7h): <br  />
</p><div class="fragment"><div class="line"><span class="comment">//---------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//  MACRO_SELECT_KEY_SET_ID_X</span></div>
<div class="line"><span class="comment"></span>MACRO C7h</div>
<div class="line">  LENGTH 8</div>
<div class="line">  GETA 0        <span class="comment">// get (masked) KSId</span></div>
<div class="line">  LSLA 4        <span class="comment">// pure KSId - cast out additional info (left 4 bits)</span></div>
<div class="line">  LSRA 60       <span class="comment">// pure KSId</span></div>
<div class="line"> </div>
<div class="line">  MOV_A_B0      <span class="comment">// end condition of loop</span></div>
<div class="line">  CLRA          <span class="comment">// begin idx of loop</span></div>
<div class="line">  LDXI 0        <span class="comment">// offset of ksid table</span></div>
<div class="line">  INCA</div>
<div class="line"> </div>
<div class="line">label1:</div>
<div class="line">  CMPA_B0_BEQ label2</div>
<div class="line">  ADDXI 18 <span class="comment">// 0C + 6 additional key types</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_B0_BLT label1</div>
<div class="line"> </div>
<div class="line">label2:</div>
<div class="line">  CLRA</div>
<div class="line">  MOV_X_A</div>
<div class="line">  STA 100       <span class="comment">// store KSId in slot 100</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// store additional key type information</span></div>
<div class="line">  CLRA</div>
<div class="line">  GETA 0        <span class="comment">// get (masked) KSId</span></div>
<div class="line">  LSRA 60       <span class="comment">// Right shift to cut 4 bits KSId</span></div>
<div class="line">  STA  104      <span class="comment">// store additional key type value for future usage</span></div>
<div class="line">EOM 0</div>
</div><!-- fragment --><p> <br  />
<em>4. Update macro for loading Data Encryption Key DEK or MEK</em> <br  />
<br  />
Address information of slot 100 and slot 104 are used to address the right key. <br  />
</p><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//  LOAD_KEY_ENC_DATA_MSK</span></div>
<div class="line"><span class="comment"></span>MACRO 15h   <span class="comment">//Load key for data encryption key and decrypt it</span></div>
<div class="line">  LENGTH 16</div>
<div class="line"> </div>
<div class="line">  LDA 100      <span class="comment">// Get the key set start slot index</span></div>
<div class="line">  MOV_A_X      <span class="comment">// Load X with the merchant start slot index</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// clear key1 slot</span></div>
<div class="line">  CLRA</div>
<div class="line">  CMPA_BEQ 104 Lab_0 <span class="comment">// 104: =0?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_1 <span class="comment">// 104: =1?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_2 <span class="comment">// 104: =2?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_3 <span class="comment">// 104: =3?</span></div>
<div class="line">  CMPA 104           <span class="comment">//exit with error</span></div>
<div class="line">Lab_0:</div>
<div class="line">  ADDXI 8      <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_1:</div>
<div class="line">  ADDXI 14     <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_2:</div>
<div class="line">  ADDXI 16     <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_3:</div>
<div class="line">  ADDXI 18     <span class="comment">// Increment to next slot index</span></div>
<div class="line"> </div>
<div class="line">CONT:</div>
<div class="line">  DELETEX      <span class="comment">// Invalidate slot</span></div>
<div class="line">  ADDXI 1      <span class="comment">// Increment to next slot index</span></div>
<div class="line">  DELETEX      <span class="comment">// Invalidate slot</span></div>
<div class="line"> </div>
<div class="line">  GETA 0       <span class="comment">//get first key</span></div>
<div class="line">  ALGO_DES112  <span class="comment">//select 3DES algorithm</span></div>
<div class="line">  SELECT 0     <span class="comment">//select TMK key</span></div>
<div class="line">  DECB         <span class="comment">//dencrypt first key</span></div>
<div class="line">  MOV_A_B0     <span class="comment">// Move the decrypted data to B0</span></div>
<div class="line"> </div>
<div class="line">  GETA 8       <span class="comment">//get second key</span></div>
<div class="line">  DECB         <span class="comment">//decrypt it</span></div>
<div class="line">  MOV_A_B1     <span class="comment">// Move the decrypted data to B1</span></div>
<div class="line"> </div>
<div class="line">  LDA 100      <span class="comment">// Get the key set start slot index</span></div>
<div class="line">  MOV_A_X      <span class="comment">// Load X with DATA key slot index</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// store key1 in slot</span></div>
<div class="line">  CLRA</div>
<div class="line">  CMPA_BEQ 104 Lab_10 <span class="comment">// 104: =0?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_11 <span class="comment">// 104: =1?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_12 <span class="comment">// 104: =2?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_13 <span class="comment">// 104: =3?</span></div>
<div class="line">Lab_10:</div>
<div class="line">  ADDXI 8      <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT_1</div>
<div class="line">Lab_11:</div>
<div class="line">  ADDXI 14     <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT_1</div>
<div class="line">Lab_12:</div>
<div class="line">  ADDXI 16     <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT_1</div>
<div class="line">Lab_13:</div>
<div class="line">  ADDXI 18     <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CMPA_BEQ 104 CONT_1</div>
<div class="line"> </div>
<div class="line">CONT_1:</div>
<div class="line">  CLRA</div>
<div class="line">  MOV_B0_A     <span class="comment">// Move the first 8 bytes of the decrypted DATA to A</span></div>
<div class="line">  STAX         <span class="comment">// Copy the first 8 bytes of the decrypted DATA to the designated DATA left slot</span></div>
<div class="line">  ADDXI 1      <span class="comment">// Increment to next slot index</span></div>
<div class="line">  CLRA</div>
<div class="line">  MOV_B1_A     <span class="comment">// Move the second 8 bytes of the decrypted DATA to A</span></div>
<div class="line">  STAX         <span class="comment">// Copy the second 8 bytes of the decrypted DATA to the designated DATA right slot</span></div>
<div class="line">EOM 0</div>
<div class="line"><span class="comment">//--------------------------------------------------------------------------------------</span></div>
</div><!-- fragment --><p> <br  />
<em>5. Macros for Data Encryption using key DEK or MEK</em> <br  />
<br  />
Address information of slot 100 and slot 104 are used to address the right key. <br  />
</p><div class="fragment"><div class="line"><span class="comment">//--------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//  ENCRYPT_ITERATION</span></div>
<div class="line"><span class="comment"></span>MACRO 41h <span class="comment">//encrypt data iteration</span></div>
<div class="line">  LENGTH 8</div>
<div class="line"> </div>
<div class="line">  LDA 100     <span class="comment">// Get the key set start slot index</span></div>
<div class="line">  MOV_A_X     <span class="comment">// Load X with the merchant start slot index</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set key slot</span></div>
<div class="line">  CLRA</div>
<div class="line">  CMPA_BEQ 104 Lab_0 <span class="comment">// 104: =0?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_1 <span class="comment">// 104: =1?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_2 <span class="comment">// 104: =2?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_3 <span class="comment">// 104: =3?</span></div>
<div class="line">  CMPA 104           <span class="comment">//exit with error</span></div>
<div class="line">Lab_0:</div>
<div class="line">  ADDXI 8      <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_1:</div>
<div class="line">  ADDXI 14     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_2:</div>
<div class="line">  ADDXI 16     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_3:</div>
<div class="line">  ADDXI 18     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line"> </div>
<div class="line">CONT:</div>
<div class="line">  GETA 0      <span class="comment">//copy from CB 8-bytes for encryption into A</span></div>
<div class="line">  ALGO_DES112 <span class="comment">//select decryption algorithm</span></div>
<div class="line">  SELECTX     <span class="comment">//select slots #2 and #3 as keys</span></div>
<div class="line"> </div>
<div class="line">  EECB        <span class="comment">//encrypt data using ECB</span></div>
<div class="line">  SENDA 0     <span class="comment">//copy encrypted data from A into CB</span></div>
<div class="line">EOM 8</div>
<div class="line"><span class="comment">//--------------------------------------------------------------------------------------</span></div>
</div><!-- fragment --><p> <br  />
</p><div class="fragment"><div class="line"><span class="comment">//---------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">//  ENCRYPT_ITERATION</span></div>
<div class="line"><span class="comment"></span>MACRO 43h</div>
<div class="line">  LENGTH 8</div>
<div class="line"> </div>
<div class="line">  LDA 100     <span class="comment">// Get the key set start slot index</span></div>
<div class="line">  MOV_A_X     <span class="comment">// Load X with the merchant start slot index</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set key slot</span></div>
<div class="line">  CLRA</div>
<div class="line">  CMPA_BEQ 104 Lab_0 <span class="comment">// 104: =0?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_1 <span class="comment">// 104: =1?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_2 <span class="comment">// 104: =2?</span></div>
<div class="line">  INCA</div>
<div class="line">  CMPA_BEQ 104 Lab_3 <span class="comment">// 104: =3?</span></div>
<div class="line">  CMPA 104           <span class="comment">//exit with error</span></div>
<div class="line">Lab_0:</div>
<div class="line">  ADDXI 8      <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_1:</div>
<div class="line">  ADDXI 14     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_2:</div>
<div class="line">  ADDXI 16     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line">Lab_3:</div>
<div class="line">  ADDXI 18     <span class="comment">// Increment to next slot index to point the data encryption key</span></div>
<div class="line">  CMPA_BEQ 104 CONT</div>
<div class="line"> </div>
<div class="line">CONT:</div>
<div class="line">  GETA 0      <span class="comment">// Get the 8 bytes of data</span></div>
<div class="line">  ALGO_DES112 <span class="comment">// Select the algorithm</span></div>
<div class="line">  SELECTX     <span class="comment">//select slots #2 and #3 as keys</span></div>
<div class="line"> </div>
<div class="line">  ECBC        <span class="comment">// 3DES encrypt the data with KMACs</span></div>
<div class="line">  SENDA 0     <span class="comment">// Copy A (encrypted data) to CB offset 0</span></div>
<div class="line">EOM 8</div>
<div class="line"><span class="comment">//--------------------------------------------------------------------------------------</span></div>
</div><!-- fragment --><p><br  />
 </p>
<h2><a class="anchor" id="sec_feature_visa_dsp"></a>
Visa DSP</h2>
<h3><a class="anchor" id="subsec_visa_dsp_p2pe_how_to_use"></a>
How to use P2PE</h3>
<p>Firstly the user has to setup a host configuration for the method 'VisaDSP P2PE' by the file <code>sccfg</code>.<code>json</code>. </p>
<h4><a class="anchor" id="subsubsec_p2pe_host_configuration"></a>
P2PE host configuration</h4>
<p>A configuration example is provided in <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>, see host object "VisaDSP_P2PE_Host". This can be used as a template and be changed according individual needs. <br  />
<br  />
<b><em>P2PE configuration based on IPP DUKPT</em></b> <br  />
<br  />
The IPP DUKPT key management scheme is the default scheme and has not to be configured explicitly. <br  />
Generally the configuration shall contain: <br  />
</p><ul>
<li>Mandatory settings<ul>
<li>VisaDSP scheme in object "secSchemes" which may include the default encryption algorithm <br  />
<br  />
Example: <pre class="fragment">  {
   "name": "schemeVisaDSP",
   "settings": {
   "encryptionAlgo": "P2PE"
  }
</pre> <br  />
</li>
<li>host configuration in object "hosts"<ul>
<li>"name"</li>
<li>"scheme"</li>
<li>"module": "VisaDSP"</li>
<li>"settings":<ul>
<li>"encryptionAlgo": "P2PE" - if not set in scheme</li>
<li>"KeyManagementOption" - in case of DUKPT IPP key management type</li>
<li>"KeyAddressTable" - list Key Address Table of involved functions (key slots can be selected by setting Key Set Ids) <br  />
<br  />
Example: <pre class="fragment">   "name": "VisaDSP_P2PE_Host",
   "description": "for P2PE algo usage (IPP-DUKPT)",
   "scheme": "schemeVisaDSP",
   "module": "VisaDSP",
   "settings": {
     "encryptionAlgo": "P2PE",
     "KeyManagementOption": "0A3",
     "KeyAddressTable": [
       {"description": "| 1  | 2  | 3 | &lt;- KeySetId (3 slots)"},
       {"encryptData":  ["0", "1", "2"]},
       {"retrieveEncPIN": ["0", "1", "2"]}
     ]
   }
</pre> <br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="anchor" id="OptinalSettingsForHostConfig"></a>Optional settings for the host configuration <br  />
<ul>
<li>"permissions" - define the access permission for cardholder data tags (see <a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#a85ada2e35c1d1cbf60c05454b88b4b44">secGetTransactionValue()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#af127868b6268758596f8a2a1ca0aaab3">secGetPermission()</a>) <br  />
<br  />
Example -&gt; permission <em>write only</em>: <pre class="fragment">   "settings": {"permissions": {"TagPAN": 1,
                                "TagCHName": 1,
                                "TagTrack1": 1,
                                "TagTrack2": 1}}
</pre> <br  />
</li>
<li>"KeyAddressTable" - settings for key slot usage <br  />
<br  />
Example: <pre class="fragment">   "settings": {
     "KeyAddressTable": [
       {"description": "| 1  | 2  | 3 | &lt;- KeySetId (3 slots)"},
       {"updateKey":  ["0", "1", "2"]}
     ]
   }
</pre></li>
</ul>
</li>
</ul>
<p><br  />
<br  />
The configuration is working towards the following API functions: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new IPP DUKPT key and IKSN (optional)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP P2PE</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> - retrieve encrypted PIN block</li>
</ul>
<p>Other API functions are not affected by the configuration and can be used insofar as they are meaningful and applicable to VisaDSP P2PE (see <a class="el" href="pg_sec_users_guide.html#subsubsec_p2pe_available_functions">Which API functions are available for P2PE?</a>). <br  />
<br  />
<b><em>P2PE configuration based on ADE DUKPT</em></b> <br  />
<br  />
The ADE DUKPT key management scheme has to be configured by setting "ADE" for the string "KeyManagementType". This is mandatory in the host configuration. <br  />
</p><ul>
<li>Mandatory settings<ul>
<li>VisaDSP scheme in object "secSchemes" which may include the default encryption algorithm <br  />
<br  />
</li>
<li>host configuration in object "hosts"<ul>
<li>"name"</li>
<li>"scheme"</li>
<li>"module": "VisaDSP"</li>
<li>"settings":<ul>
<li>"encryptionAlgo": "P2PE" - if not set in scheme</li>
<li>"KeyManagementType": "ADE"</li>
<li>"KeyAddressTable" - list Key Address Table of involved functions (key slots can be selected by setting Key Set Ids) <br  />
<br  />
Example: <pre class="fragment">   "name": "VisaDSP_P2PE_Host_ADE",
   "description": "for P2PE algo usage (ADE-DUKPT)",
   "scheme": "schemeVisaDSP",
   "module": "VisaDSP",
   "settings": {
      "encryptionAlgo": "P2PE",
      "KeyManagementType": "ADE",
      "KeyAddressTable": [
        {"description": "| 1  | 2  | 3 | &lt;- KeySetId (3 slots)"},
        {"encryptData":  ["0", "1", "2"]}
      ]
   }
</pre> <br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="anchor" id="OptinalSettingsADE"></a>Optional settings for the host configuration <br  />
<ul>
<li>same as <a class="el" href="pg_sec_users_guide.html#OptinalSettingsForHostConfig">OptinalSettingsForHostConfig</a></li>
</ul>
</li>
</ul>
<p><br  />
The configuration is working towards the following API functions: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new ADE DUKPT key and IKSN (optional)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP P2PE</li>
</ul>
<p>Other API functions are not affected by the configuration and can be used insofar as they are meaningful and applicable to VisaDSP P2PE (see <a class="el" href="pg_sec_users_guide.html#subsubsec_p2pe_available_functions">Which API functions are available for P2PE?</a>). <br  />
</p>
<h4><a class="anchor" id="subsubsec_p2pe_available_functions"></a>
Which API functions are available for P2PE?</h4>
<p>Following ADK-SEC API function can be used for VisaDSP P2PE handling: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> - open VisaDSP module</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a34f8a9e3b92467759d0bbdbf7b2dd8c0">secClose()</a> - close module</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new DUKPT key and IKSN</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a> - used to provide the cardholder data and set KSN incrementation handling</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a85ada2e35c1d1cbf60c05454b88b4b44">secGetTransactionValue()</a> - get obfuscated data</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ac31ab997e8dc434d72e427a5d841186a">secClearTransactionData()</a>) - clear cardholder data explicitely</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#af127868b6268758596f8a2a1ca0aaab3">secGetPermission()</a> - set access permissions for cardholder data</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> - retrieve encrypted PIN block (Not available on ADE DUKPT scheme!)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a79b00ea8a8aed3b7950800bf136a1944">secGetKeyInventory()</a> - get information about keys</li>
<li>info functions (<a class="el" href="namespacecom__verifone__seccmd.html#a5499423d685ed9deb7ace9c22114adf2">secGetVersions()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a>, ...)</li>
</ul>
<h4><a class="anchor" id="subsubsec_p2pe_how_to_handle_functions"></a>
How can I handle the API functions for P2PE?</h4>
<p>The DEMO application module <code>DemoVDSPApp</code>.<code>cpp</code> includes a code example in function DEMO_HandleVisaDSP_P2PE() that shows how a P2PE cardholder data encryption can be handled. <br  />
The source code is contained in the ADK-SEC delivery package in folder <em>doc/sec/example_2.x/DEMO/src</em>. <br  />
<br  />
The DUKPT key loading for IPP DUKPT is handled in module <code>DemoApp</code>.<code>cpp</code> in function <a class="el" href="_demo_app_8cpp.html#a0662130b4714f539176c568f6a5c260b">DEMO_InjectKeys()</a>. <br  />
<br  />
Following tasks are performed in DEMO_HandleVisaDSP_P2PE(): <br  />
</p><ul>
<li>opens the host session 'VisaDSP_P2PE_Host' and gets a handle as a reference for all ADK-SEC functions using this host</li>
<li>puts cardholder data into Transaction Data (TD)</li>
<li>set KSN incrementation to 'next KSN' in TD</li>
<li>perform P2PE encryption of PAN (inclusive obfuscation) and dump results</li>
<li>set KSN incrementation to 'same KSN' in TD</li>
<li>perform P2PE encryption of CardHolder Name (use same key) (inclusive obfuscation) and dump results</li>
<li>perform P2PE encryption of P2PE encryption of Track1 data (use same key) (inclusive obfuscation) and dump results</li>
<li>perform P2PE encryption of P2PE encryption of Track2 data (use same key) (inclusive obfuscation) and dump results</li>
<li>get obfuscated data item PAN and dump result</li>
<li>get obfuscated data item CHName and dump result</li>
<li>get obfuscated data item Track1 Data and dump result</li>
<li>get obfuscated data item Track2 Data and dump result</li>
<li>initiate a PIN entry by ADK-GUI and dump result</li>
<li>retrieve and encrypt the PIN. PAN is retrieved from TD</li>
<li>close the VisaDSP session</li>
</ul>
<p>The DEMO application for P2PE can be started by using the option 'VDSP_P2PE'. <br  />
<br  />
</p>
<h3><a class="anchor" id="subsec_visa_dsp_fpe_how_to_use"></a>
How to use FPE</h3>
<p>Firstly the user has to setup a host configuration for the method 'VisaDSP FPE' by the file <code>sccfg</code>.<code>json</code>. </p>
<h4><a class="anchor" id="subsubsec_fpe_host_configuration"></a>
FPE host configuration</h4>
<p>A configuration example is provided in <a class="el" href="pg_sec_users_guide.html#sec_json_config_example">Configuration File Example</a>, see host object "VisaDSP_FPE_Host". This can be used as a template and be changed according individual needs. <br  />
<br  />
<b><em>FPE configuration based on IPP DUKPT</em></b> <br  />
<br  />
The IPP DUKPT key management scheme is the default scheme and has not to be configured explicitly. <br  />
Generally the configuration shall contain: <br  />
</p><ul>
<li>Mandatory settings<ul>
<li>VisaDSP scheme in object "secSchemes" which may include the default encryption algorithm <br  />
<br  />
Example: <pre class="fragment">  {
   "name": "schemeVisaDSP",
   "settings": {
   "encryptionAlgo": "P2PE"
  }
</pre> <br  />
</li>
<li>host configuration in object "hosts"<ul>
<li>"name"</li>
<li>"scheme"</li>
<li>"module": "VisaDSP"</li>
<li>"settings":<ul>
<li>"encryptionAlgo": "FPE" - if not set in scheme</li>
<li>"KeyManagementOption" - in case of DUKPT IPP key management type</li>
<li>"KeyAddressTable" - list Key Address Table of involved functions (key slots can be selected by setting Key Set Ids) <br  />
<br  />
Example: <pre class="fragment">  {
   "name": "VisaDSP_FPE_Host",
   "description": "IPP-DUKPT usage",
   "scheme": "schemeVisaDSP",
   "module": "VisaDSP",
   "settings": {
      "encryptionAlgo": "FPE",
      "KeyManagementOption": "0A3",
      "KeyAddressTable": [
        {"description": "| 1  | 2  | 3 | &lt;- KeySetId (3 slots)"},
        {"encryptData":  ["0", "1", "2"]},
        {"retrieveEncPIN": ["0", "1", "2"]}
      ]
   }
</pre> <br  />
<br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Optional settings for the host configuration <br  />
<ul>
<li>same as <a class="el" href="pg_sec_users_guide.html#OptinalSettingsForHostConfig">OptinalSettingsForHostConfig</a></li>
</ul>
</li>
</ul>
<p><br  />
The configuration is working for the following API functions: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new ADE DUKPT key and IKSN (optional)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP FPE<br  />
</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> - retrieve encrypted PIN block</li>
</ul>
<p>Other API functions are not relevant for configuration and can be used insofar as they are meaningful and applicable to VisaDSP (see <a class="el" href="pg_sec_users_guide.html#subsubsec_fpe_available_functions">Which API functions are available for FPE?</a>). <br  />
<br  />
<b><em>FPE configuration based on ADE DUKPT</em></b> <br  />
<br  />
The ADE DUKPT key management scheme has to be configured by setting "ADE" for the string "KeyManagementType". This is mandatory in the host configuration. <br  />
</p><ul>
<li>Mandatory settings<ul>
<li>VisaDSP scheme in object "secSchemes" which may include the default encryption algorithm <br  />
<br  />
</li>
<li>host configuration in object "hosts"<ul>
<li>"name"</li>
<li>"scheme"</li>
<li>"module": "VisaDSP"</li>
<li>"settings":<ul>
<li>"encryptionAlgo": "FPE" - if not set in scheme</li>
<li>"KeyManagementType": "ADE"</li>
<li>"KeyAddressTable" - list Key Address Table of involved functions (key slots can be selected by setting Key Set Ids) <br  />
<br  />
Example: <pre class="fragment">   "name": "VisaDSP_FPE_Host_ADE",
   "description": "for FPE algo usage (ADE-DUKPT)",
   "scheme": "schemeVisaDSP",
   "module": "VisaDSP",
   "settings": {
     "encryptionAlgo": "FPE",
     "KeyManagementType": "ADE",
     "KeyAddressTable": [
       {"encryptData":  ["0", "1", "2"]}
     ]
   }
</pre> <br  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="anchor" id="OptinalSettingsFPEADE"></a>Optional settings for the host configuration <br  />
<ul>
<li>same as <a class="el" href="pg_sec_users_guide.html#OptinalSettingsForHostConfig">OptinalSettingsForHostConfig</a></li>
</ul>
</li>
</ul>
<p><br  />
The configuration is working towards the following API functions: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new ADE DUKPT key and IKSN (optional)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP FPE</li>
</ul>
<p>Other API functions are not affected by the configuration and can be used insofar as they are meaningful and applicable to VisaDSP FPE (see <a class="el" href="pg_sec_users_guide.html#subsubsec_fpe_available_functions">Which API functions are available for FPE?</a>). <br  />
 </p>
<h4><a class="anchor" id="subsubsec_fpe_available_functions"></a>
Which API functions are available for FPE?</h4>
<p>Following ADK-SEC API function can be used for VisaDSP FPE handling: <br  />
</p><ul>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a8091d419f67f4b53630f2fabe1888a09">secOpen()</a> - open VisaDSP module</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a34f8a9e3b92467759d0bbdbf7b2dd8c0">secClose()</a> - close module</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab249c77069e9fc9946745fd4c63d5e39">secUpdateKey()</a> - load new DUKPT key and IKSN</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">secPutTransactionData()</a> - used to provide the cardholder data and set KSN incrementation handling</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">secEncryptTransactionData()</a> - encrypt data according VisaDSP</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ac31ab997e8dc434d72e427a5d841186a">secClearTransactionData()</a>) - clear cardholder data explicitely</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#af127868b6268758596f8a2a1ca0aaab3">secGetPermission()</a> - set access permissions for cardholder data</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#ab3d26136c64019fd223aa9ccd120d4e0">secRetrieveEncryptedPIN()</a> - retrieve encrypted PIN block (Not available on ADE DUKPT scheme!)</li>
<li><a class="el" href="namespacecom__verifone__seccmd.html#a79b00ea8a8aed3b7950800bf136a1944">secGetKeyInventory()</a> - get information about keys</li>
<li>info functions (<a class="el" href="namespacecom__verifone__seccmd.html#a5499423d685ed9deb7ace9c22114adf2">secGetVersions()</a>, <a class="el" href="namespacecom__verifone__seccmd.html#a008e3cde266f576be23846d0c7b729c5">secGetStatus()</a>, ...)</li>
</ul>
<h4><a class="anchor" id="subsubsec_fpe_how_to_handle_functions"></a>
How can I handle the API functions for FPE?</h4>
<p>The DEMO application module <code>DemoVDSPApp</code>.<code>cpp</code> includes a code example in function DEMO_HandleVisaDSP_FPE() that shows how a FPE cardholder data encryption can be handled. <br  />
The source code is contained in the ADK-SEC delivery package in folder <em>doc/sec/example_2.x/DEMO/src</em>. <br  />
<br  />
The DUKPT key loading for IPP DUKPT is handled in module <code>DemoApp</code>.<code>cpp</code> in function <a class="el" href="_demo_app_8cpp.html#a0662130b4714f539176c568f6a5c260b">DEMO_InjectKeys()</a>. <br  />
<br  />
Following tasks are performed in DEMO_HandleVisaDSP_FPE(): <br  />
</p><ul>
<li>opens the host session 'VisaDSP_FPE_Host' and gets a handle as a reference for all ADK-SEC functions using this host</li>
<li>puts cardholder data into Transaction Data (TD)</li>
<li>set KSN incrementation to 'next KSN' in TD</li>
<li>perform FPE encryption of PAN and dump results</li>
<li>set KSN incrementation to 'same KSN' in TD</li>
<li>perform FPE encryption of CardHolder Name (use same key) and dump results</li>
<li>perform FPE encryption of FPE encryption of Track1 data (use same key) and dump results</li>
<li>perform FPE encryption of FPE encryption of Track2 data (use same key) and dump results</li>
<li>initiate a PIN entry by ADK-GUI and dump result</li>
<li>retrieve and encrypt the PIN. PAN is retrieved from TD</li>
<li>close the VisaDSP session</li>
</ul>
<p>The DEMO application for FPE can be started by using the option 'VDSP_FPE'. <br  />
<br  />
</p>
<h1><a class="anchor" id="page_adksec_appendix_Acronyms_Definition"></a>
Appendix G: Acronyms Definition</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Acronym </th><th class="markdownTableHeadNone">Definitions  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3DES </td><td class="markdownTableBodyNone">Triple DES encryption  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ADE </td><td class="markdownTableBodyNone">Account Data Encryption  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ADK </td><td class="markdownTableBodyNone">Application Development Kit  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AES </td><td class="markdownTableBodyNone">Advanced Encryption Standard  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">API </td><td class="markdownTableBodyNone">Application Protocol Interface  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CRC </td><td class="markdownTableBodyNone">Cyclical Redundancy Checking  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DDK </td><td class="markdownTableBodyNone">Data Decryption Key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DEK </td><td class="markdownTableBodyNone">Data Encryption Key  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DES </td><td class="markdownTableBodyNone">Data Encryption Standard  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DUKPT </td><td class="markdownTableBodyNone">Derived Unique Key Per Transaction Method  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">EMV </td><td class="markdownTableBodyNone">Europay, Mastercard and Visa  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GISKE </td><td class="markdownTableBodyNone">Global Inter-operable Secure Key Exchange  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GUI </td><td class="markdownTableBodyNone">Graphical User Interface  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HSM </td><td class="markdownTableBodyNone">Hardware Security Module  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IKSN </td><td class="markdownTableBodyNone">Initial Key Serial Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IPC </td><td class="markdownTableBodyNone">Inter Process Communication  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IPP </td><td class="markdownTableBodyNone">Internal PIN Pad  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">KEK </td><td class="markdownTableBodyNone">Key Encryption Key  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KLK </td><td class="markdownTableBodyNone">Key Loading Key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">KSN </td><td class="markdownTableBodyNone">Key Serial Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MAC </td><td class="markdownTableBodyNone">Message Authentication Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MGK </td><td class="markdownTableBodyNone">MAC Generation Key  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MSK </td><td class="markdownTableBodyNone">Master Session Key scheme  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MTK </td><td class="markdownTableBodyNone">Master Terminal Key  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MVK </td><td class="markdownTableBodyNone">MAC Verification Key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OS </td><td class="markdownTableBodyNone">Operating System  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PAN </td><td class="markdownTableBodyNone">Primary Account Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PED </td><td class="markdownTableBodyNone">PIN Entry Device  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PIN </td><td class="markdownTableBodyNone">Personal Identification Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">POS </td><td class="markdownTableBodyNone">Point-of-Sale  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PPK </td><td class="markdownTableBodyNone">PIN Protection Key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RSA </td><td class="markdownTableBodyNone">Rivest-Shamir-Adleman  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SRED </td><td class="markdownTableBodyNone">Secure Reading and Exchange of Data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">STAN </td><td class="markdownTableBodyNone">System Trace Audit Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TMK </td><td class="markdownTableBodyNone">Terminal Master Key  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UI </td><td class="markdownTableBodyNone">User Interface  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UID </td><td class="markdownTableBodyNone">Unique Identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">V/OS </td><td class="markdownTableBodyNone">Verifone Operating System  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">VPN </td><td class="markdownTableBodyNone">Verifone Part Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VSS </td><td class="markdownTableBodyNone">VeriShield Security Scripts  </td></tr>
</table>
<p><br  />
<br  />
</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacecom__adksec__cmd_html_a8963c1dd7c626a621a8033209294fcbd"><div class="ttname"><a href="namespacecom__adksec__cmd.html#a8963c1dd7c626a621a8033209294fcbd">com_adksec_cmd::SecTransactionData_t</a></div><div class="ttdeci">CTransactionData SecTransactionData_t</div><div class="ttdef"><b>Definition:</b> CTransactionData.h:206</div></div>
<div class="ttc" id="anamespacecom__verifone__seccmd_html_a6bc0d39e1739680282d33d3d68df84c9"><div class="ttname"><a href="namespacecom__verifone__seccmd.html#a6bc0d39e1739680282d33d3d68df84c9">com_verifone_seccmd::secPutTransactionData</a></div><div class="ttdeci">DllSpecSEC VOS3_Depricated secError secPutTransactionData(secHandle_t handle, const SecTransactionData_t &amp;taData)</div></div>
<div class="ttc" id="anamespacecom__verifone__seccmd_html_aaed6fc175245ba31936547cffd988948"><div class="ttname"><a href="namespacecom__verifone__seccmd.html#aaed6fc175245ba31936547cffd988948">com_verifone_seccmd::secEncryptTransactionData</a></div><div class="ttdeci">DllSpecSEC VOS3_Depricated secError secEncryptTransactionData(secHandle_t handle, const secIndex_t &amp;TDindex, std::vector&lt; uint8_t &gt; &amp;encData, std::vector&lt; uint8_t &gt; &amp;iv, std::vector&lt; uint8_t &gt; &amp;ksn)</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li><li class="navelem"><a class="el" href="pg_all_components.html">ADK Components</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:02 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
