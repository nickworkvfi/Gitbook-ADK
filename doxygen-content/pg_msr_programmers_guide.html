<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: ADK-MSR Programmers Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_msr_programmers_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADK-MSR Programmers Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_msr_preface"></a>
Preface</h1>
<p>This document is for programmers and developers who want to understand and use the ADK-MSR.</p>
<h2><a class="anchor" id="subsec_msr_audience"></a>
Audience</h2>
<p>This guide provides all the information required for application developers to integrate and utilize the functionality of the ADK-MSR.</p>
<h2><a class="anchor" id="subsec_msr_organization"></a>
Organization</h2>
<p>This guide is organized as follows:</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_introduction">Introduction</a>: Provides a summary of ADK-MSR.</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_getting_started">Getting Started</a>: Presents an introduction in ADK-MSR usage.</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_programming">Programming</a>: Supplies ADK-MSR programming information.</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_system_setup_and_requirements">System Setup and Requirements</a>: Supplies information about required dependencies.</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_troubleshooting">Troubleshooting</a>: Gives solutions for possible issues in ADK-MSR.</p>
<p><a class="el" href="pg_msr_programmers_guide.html#sec_msr_appendix">Appendix</a>: Links to related documents.</p>
<h1><a class="anchor" id="sec_msr_introduction"></a>
Introduction</h1>
<p>ADK-MSR provides access to the terminals magnetic card reader.</p>
<p>Supported card types (depends also on OS support): </p><ul>
<li><b> ISO/IEC 7811 </b> <br  />
 activation by <a class="el" href="group___m_s_r___o_p_t_i_o_n_s___b_i_t_m_a_s_k.html#ga552908ea327761a80fc0557a4f617f97" title="options[1] Detect ISO cards">MSR_DETECT_ISO</a>, result given with <a class="el" href="group___m_s_r___t_r_a_c_k___t_y_p_e_s.html#gacd72026476677415eaf482b2fb2e0032">MSR_CARD_ISO</a> </li>
<li><b> JIS II </b> <br  />
 activation by <a class="el" href="group___m_s_r___o_p_t_i_o_n_s___b_i_t_m_a_s_k.html#ga9f84cf93e845a72a46da5530a2f0fda6" title="options[1] Detect JIS-II cards">MSR_DETECT_JIS_II</a>, result given with <a class="el" href="group___m_s_r___t_r_a_c_k___t_y_p_e_s.html#gaf1dad30c2494f4da59022687eb8e9dc1">MSR_CARD_JIS_II</a> </li>
<li><b> US Driving License (CADL, AAVMA) </b> <br  />
 activation by <a class="el" href="group___m_s_r___o_p_t_i_o_n_s___b_i_t_m_a_s_k.html#ga57908026ec7d34ab1eab699f5a01bfdc" title="options[0] Enable detection of US driving license">MSR_ENABLE_LICENSE_DECODE</a> <br  />
 Supported on V/OS, but on Engage (VOS2) only for M440</li>
</ul>
<h2><a class="anchor" id="subsec_msr_intro_compos"></a>
Components</h2>
<p>To make use of the magnetic card reader, you need the following components of ADK-MSR:</p><ul>
<li><a class="el" href="msr_8h.html">msr.h</a></li>
<li><a class="el" href="msr__common_8h.html">msr_common.h</a></li>
<li><code>libmsr.so</code> </li>
</ul>
<p>This is illustrated in the following image: </p><div class="image">
<object type="image/svg+xml" data="msr.svg" style="pointer-events: none;"></object>
</div>
<h2><a class="anchor" id="sec_msr_intro_android"></a>
Android</h2>
<p>In Android the ADK-MSR is hidden inside SDI. So application has to use the "Card Detection (23-01)" resp. "MSR Read (21-01)" from <a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a>.</p>
<h2><a class="anchor" id="sec_msr_intro_vos3"></a>
VOS3</h2>
<p>In VOS3 ADK-MSR is accessible through SDI. The ADK-MSR-interface is rebuild in <a href="./pg_sdiclient_users_guide.html" title="ADK-SDI-Client Programmers Guide">ADK-SDI-Client Programmers Guide</a>.</p>
<h2><a class="anchor" id="sec_msr_intro_2piece"></a>
Two-Piece Solution</h2>
<p>Former Two-Piece Solution with Client/Server architecture for MSR, TEC, ... is not supported anymore. <br  />
 SDI EPP has to be used instead (see <a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a>).</p>
<h1><a class="anchor" id="sec_msr_getting_started"></a>
Getting Started</h1>
<h2><a class="anchor" id="sec_msr_sample"></a>
Sample Application</h2>
<p>Link your application with <code>libmsr.so</code>.</p>
<h3><a class="anchor" id="sec_msr_sample_blocking"></a>
Wait until card swipe (blocking/polling API)</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="msr_8h.html">msr.h</a>&quot;</span></div>
<div class="line">....</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate</a>(NULL, NULL) == <a class="code" href="group___m_s_r___e_r_r_o_r___c_o_d_e_s.html#ga56ff5f02000b1dcc767ffeea8f6478a7">MSR_OK</a>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="msr__common_8h.html#struct_m_s_r___track_data">MSR_TrackData</a> tracks;</div>
<div class="line">  <a class="code" href="msr__common_8h.html#struct_m_s_r___decoded_data">MSR_DecodedData</a> data;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Wait 10 seconds for a card swipe:</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData</a>(10000, &amp;tracks, &amp;data) == <a class="code" href="group___m_s_r___e_r_r_o_r___c_o_d_e_s.html#ga56ff5f02000b1dcc767ffeea8f6478a7">MSR_OK</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// card read successfully</span></div>
<div class="line">  }</div>
<div class="line">  (void) <a class="code" href="msr_8h.html#aac28b2c3771f8221fc26a35f0fd6d0f8">MSR_Deactivate</a>();</div>
<div class="line">}</div>
<div class="line">....</div>
</div><!-- fragment --><p>The function <a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> blocks until the timeout has elapsed or a card has been swiped. <br  />
 You could also implement a periodic polling (with reduced timeout). <br  />
 So it's possible to e.g. check if the cancel key was pressed. <br  />
 Another option is to poll the <a class="el" href="msr_8h.html#a8096fa193f035eb4b80673260d720477">MSR_DataAvailable()</a> and (if returned true) call <a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> only once with timeout 0.</p>
<h3><a class="anchor" id="sec_msr_sample_callback"></a>
Register callback for swipe event</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="msr_8h.html">msr.h</a>&quot;</span></div>
<div class="line">....</div>
<div class="line"><span class="keywordtype">void</span> callback(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// card swiped -&gt; read data</span></div>
<div class="line">  <a class="code" href="msr__common_8h.html#struct_m_s_r___track_data">MSR_TrackData</a> tracks;</div>
<div class="line">  <a class="code" href="msr__common_8h.html#struct_m_s_r___decoded_data">MSR_DecodedData</a> data;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData</a>(0, &amp;tracks, &amp;data) == <a class="code" href="group___m_s_r___e_r_r_o_r___c_o_d_e_s.html#ga56ff5f02000b1dcc767ffeea8f6478a7">MSR_OK</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// card read successfully</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate</a>(&amp;callback, NULL) == <a class="code" href="group___m_s_r___e_r_r_o_r___c_o_d_e_s.html#ga56ff5f02000b1dcc767ffeea8f6478a7">MSR_OK</a>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Do something here until callback has been called....</span></div>
<div class="line">  <span class="keywordflow">while</span> (...)</div>
<div class="line">  {</div>
<div class="line">  }</div>
<div class="line">  (void) <a class="code" href="msr_8h.html#aac28b2c3771f8221fc26a35f0fd6d0f8">MSR_Deactivate</a>();</div>
<div class="line">}</div>
<div class="line">....</div>
</div><!-- fragment --><p><a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> can be either called within the callback function or (after the callback has been invoked) in another function/thread. <br  />
 But keep in mind that you can obtain any card swipe's data only once.</p>
<h1><a class="anchor" id="sec_msr_programming"></a>
Programming</h1>
<h2><a class="anchor" id="subsec_msr_programming_and_api_principles"></a>
Programming and API Principles</h2>
<p>The API consists of the following functions:</p>
<ul>
<li><a class="el" href="msr__common_8h.html#a4c82e0afa0ae93bb7a97a03431c202b8">MSR_Version()</a> <br  />
 </li>
<li><a class="el" href="msr__common_8h.html#ac4fab89b234ae87c7da91fb529b833e0">MSR_SetTraceCallback()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#ac3c6f568aa57690a8b369936fc362c2a">MSR_SetOptions()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#aac28b2c3771f8221fc26a35f0fd6d0f8">MSR_Deactivate()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#a8096fa193f035eb4b80673260d720477">MSR_DataAvailable()</a> </li>
<li><a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#a1bf2f70013c79b94a09b3504607a0667">MSR_GetData2()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#ab2415e817a7d2a1189897757485ff660">MSR_GetData3()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#a7436a0f6d88d3eb717c10025325b47e8">MSR_GetData4()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#a70fedc4ea5687982f39102e2738d8ef5">MSR_AbortGetData()</a> <br  />
 </li>
<li><a class="el" href="msr_8h.html#abca7e8953c8430d80f51c867c7699fa6">MSR_SwitchLeds()</a> <br  />
</li>
</ul>
<h1><a class="anchor" id="sec_msr_system_setup_and_requirements"></a>
System Setup and Requirements</h1>
<h2><a class="anchor" id="subsec_msr_compiler_and_linker_settings"></a>
Compiler and Linker Settings</h2>
<p>Do the following: <br  />
 include <a class="el" href="msr_8h.html">msr.h</a> and link <code>libmsr.so</code>. Additionally you have to link <code>libvfisysinfo.so</code> and <code>liblog.so</code> (provided by ADK).</p>
<h2><a class="anchor" id="subsec_msr_hardware"></a>
Hardware</h2>
<p>ADK-MSR is hardware platform agnostic and supports installation on V/OS and VOS2 terminals.</p>
<h2><a class="anchor" id="subsec_msr_software"></a>
Software</h2>
<p>ADK-MSR is designed to be platform agnostic and will be supported on V/OS and VOS2 terminal operating systems.</p>
<h2><a class="anchor" id="subsec_msr_deliverables_and_deployment"></a>
Deliverables and Deployment</h2>
<p>Packages delivered (x - version number digit):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package name </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>msr-doc-x.x.x-xx.zip</code>  </td><td class="markdownTableBodyNone">Documentation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>msr-vos-dev-x.x.x-xx.zip</code>  </td><td class="markdownTableBodyNone">VOS development package, to be installed in PC build environment  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>msr-vos2-dev-x.x.x-xx.zip</code>  </td><td class="markdownTableBodyNone">VOS2 development package, to be installed in PC build environment  </td></tr>
</table>
<h1><a class="anchor" id="sec_msr_troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="subsec_msr_frequently_asked_questions"></a>
Frequently Asked Questions</h2>
<p>Q: Some time ago, upon reviewing our test logs, you pointed out that we should not call the API <a class="el" href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate()</a> if next we start the selection with the API <a class="el" href="tec_8h.html#ac6699fe32fc23e90713eb617e9ff25e7">cts_StartSelection()</a> because the latter activates the reader by itself. And what about the scenario when we want to establish the MSR callback and then use the selection? Here, <a class="el" href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate()</a> is the only way to establish such a callback. Is this a legal use case to use simultaneously the MSR callback and the selection which, in turn, may have its own callback?</p>
<p>A: No, this is not a legal use case. You should not establish the MSR callback if you use technology selection. This is confusing and not necessary anyway. If MSR data is available, technology selection will finish, so you get the information from TEC, no need to set MSR callback. If you even call <a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> upon receiving MSR callback, TEC would most likely not be able to detect that MSR data is available and continue waiting for technology (TEC calls <a class="el" href="msr_8h.html#a8096fa193f035eb4b80673260d720477">MSR_DataAvailable()</a> and as soon as <a class="el" href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData()</a> is called, the former will return 'no data available'). So please do not do anything like this.</p>
<h2><a class="anchor" id="subsec_msr_logging"></a>
Logging</h2>
<p>You have two options to enable logging, choose one of them (if you think this is helpful, you could actually use both at once):</p><ul>
<li>Register a trace callback function with <a class="el" href="msr__common_8h.html#ac4fab89b234ae87c7da91fb529b833e0">MSR_SetTraceCallback()</a>.</li>
<li>Use ADK-LOG: You need to install liblog.so and create a configuration file msr_log.conf (this is intended to be done by log control panel provided by ADK-LOG). Be sure that you activate log level LOGAPI_INFO.</li>
</ul>
<h1><a class="anchor" id="sec_msr_appendix"></a>
Appendix</h1>
<p>Appendix is empty. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup___m_s_r___e_r_r_o_r___c_o_d_e_s_html_ga56ff5f02000b1dcc767ffeea8f6478a7"><div class="ttname"><a href="group___m_s_r___e_r_r_o_r___c_o_d_e_s.html#ga56ff5f02000b1dcc767ffeea8f6478a7">MSR_OK</a></div><div class="ttdeci">#define MSR_OK</div><div class="ttdef"><b>Definition:</b> msr_common.h:15</div></div>
<div class="ttc" id="amsr_8h_html_aac28b2c3771f8221fc26a35f0fd6d0f8"><div class="ttname"><a href="msr_8h.html#aac28b2c3771f8221fc26a35f0fd6d0f8">MSR_Deactivate</a></div><div class="ttdeci">int MSR_Deactivate(void)</div></div>
<div class="ttc" id="amsr__common_8h_html_struct_m_s_r___track_data"><div class="ttname"><a href="msr__common_8h.html#struct_m_s_r___track_data">MSR_TrackData</a></div><div class="ttdef"><b>Definition:</b> msr_common.h:129</div></div>
<div class="ttc" id="amsr_8h_html_ad00fdde838f486d43be689650ab58d43"><div class="ttname"><a href="msr_8h.html#ad00fdde838f486d43be689650ab58d43">MSR_GetData</a></div><div class="ttdeci">int MSR_GetData(int timeout_msec, MSR_TrackData *tracks, MSR_DecodedData *data)</div></div>
<div class="ttc" id="amsr_8h_html"><div class="ttname"><a href="msr_8h.html">msr.h</a></div></div>
<div class="ttc" id="amsr_8h_html_a1e92fd29720fecbf50da24a30c7b512f"><div class="ttname"><a href="msr_8h.html#a1e92fd29720fecbf50da24a30c7b512f">MSR_Activate</a></div><div class="ttdeci">int MSR_Activate(MSR_Callback cbf, void *cb_data)</div></div>
<div class="ttc" id="amsr__common_8h_html_struct_m_s_r___decoded_data"><div class="ttname"><a href="msr__common_8h.html#struct_m_s_r___decoded_data">MSR_DecodedData</a></div><div class="ttdef"><b>Definition:</b> msr_common.h:189</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li><li class="navelem"><a class="el" href="pg_all_components.html">ADK Components</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:01 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
