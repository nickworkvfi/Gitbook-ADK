<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: ADK-IPC Programmers Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_ipc_users_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADK-IPC Programmers Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_ipc_preface"></a>
Preface</h1>
<p>This document contains information on how to develop inter process communication using ADK IPC.</p>
<h2><a class="anchor" id="subsec_ipc_audience"></a>
Audience</h2>
<p>This guide provides all the information required for application developers to install and utilize the functionality of ADK IPC.</p>
<h2><a class="anchor" id="subsec_ipc_organization"></a>
Organization</h2>
<p>This guide is organized as follows:</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_overview">Chapter 1, Overview</a>: Provides the introduction to ADK IPC.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_supported_platforms">Chapter 2, Supported Platforms</a>: Shows the OS platforms ADK IPC can interface with.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_ADK_IPC_Class_Hierarchy">Chapter 3, IPC Class Hierarchy</a>: Illustrates and describes the application interface for ADK IPC.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_I_O_Functions">Chapter 4, IPC I/O Functions</a>: Contains the I/O functions of ADK IPC.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Error_Detection">Chapter 5, IPC Error Detection</a>: Chapter about an application can detect communication errors.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_IPC_Data_Detection">Chapter 6, IPC Data Detection</a>: Chapter about an application can check for available data.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Client_Functions">Chapter 7, IPC Client Functions</a>: Description of IPC client functions.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Server_Functions">Chapter 8, IPC Server Functions</a>: Description of IPC server functions.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Remote_Information">Chapter 9, IPC Remote Information</a>: How to get remote information about the connected remote process or machine.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_tls">Chapter 10, TLS support</a>: How to use Transport Layer Security (TLS) with ADKIPC.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_notification_service">Chapter 11, Notification Service</a>: Description of IPC notification interface.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Compiling_and_Linking">Chapter 12, Compiling and Linking</a>: Contains information on compiling and linking ADK IPC libraries.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_Troubleshooting">Chapter 13, Troubleshooting:</a> Gives solutions for possible issues in ADK IPC.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_ADK_IPC_Demo_Applications">Chapter 14, IPC Demo Applications</a>: Provides a sample server/client application for the ADK IPC distribution package.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_JSON_Demo_Application">Chapter 15, JSON Demo Application</a>: Contains a sample JSON application included in the ADK IPC distribution package.</p>
<p><a class="el" href="pg_ipc_users_guide.html#sec_ipc_APPENDIX_A_Glossary">Appendix A: Glossary</a>: Listing and definitions of various acronyms and terms</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_overview"></a>
Overview</h1>
<p>The ADK IPC library consists of several services and interfaces:</p><ul>
<li><a class="el" href="pg_ipc_users_guide.html#subsec_ipc_vfiipc">Interprocess communication service (IPC)</a></li>
<li><a class="el" href="pg_ipc_users_guide.html#subsec_ipc_jsobject">JSON API - JSObject C++ class</a></li>
<li><a class="el" href="pg_ipc_users_guide.html#subsec_ipc_notification_service">Notification service</a></li>
</ul>
<h2><a class="anchor" id="subsec_ipc_vfiipc"></a>
Interprocess communication service (IPC)</h2>
<p>ADK IPC library provides a C++ application interface for inter process communication, which can be used to transfer data between multiple threads in one or more processes. Processes may run on one or more machines connected by a TCP/IP network.</p>
<div class="image">
<img src="ipc_overview.png" alt=""/>
<div class="caption">
ADK IPC Overview</div></div>
 <p>ADK IPC library supports the following communication methods:</p><ul>
<li>Named pipes</li>
<li>TCP/IP sockets</li>
</ul>
<p>Named pipes support communication between processes running on the same machine/terminal only. TCP/IP allows the transfer of data over a network, either to a different process on the same or to another machine/terminal. Processes intending to communicate on the same machine/terminal should prefer named pipes, since TCP/IP requires a working network interface or the existence of a loopback device. </p><dl class="section note"><dt>Note</dt><dd>On some platforms it might be necessary to initialize the network interface before TCP sockets will work, whereas named pipes can be used offhand on both platforms.</dd>
<dd>
On Unix based systems (e.g. VOS) pipes are implemented with unix domain sockets. On Windows pipes are not supported. The pipe name refers to an object in the file system, file permissions are used to control access.</dd></dl>
<h2><a class="anchor" id="subsec_ipc_jsobject"></a>
JSON API - JSObject C++ class</h2>
<p>Since version 1.3.0, ADK IPC provides an additional helper library containing class JSObject. This class can be used by applications to serialize data into JSON format. JSON (JavaScript Object Notation) is an open standard format that uses human-readable text to transmit data objects consisting of attribute-value pairs. For instance, it is used to transmit data between a server and web application, as an alternative to XML.</p>
<p>The class JSObject contains several functions to store any data (simple or complex data types) to this object. The class provides functions to dump the stored data into a JSON string for transmission or to load a received JSON string to an object for easy access to the data via the member functions. The usage of an object is demonstrated by the sample application found in chapter <a class="el" href="pg_ipc_users_guide.html#sec_ipc_JSON_Demo_Application">JSON Demo Application</a>.</p>
<h2><a class="anchor" id="subsec_ipc_notification_service"></a>
Notification service</h2>
<p>Since version 1.4.0, ADKIPC library comes along with a additional service for sending asynchronous notifications for interprocess communication within a terminal. Each application, which wants to use the notification interface must register with the service to specify its own application ID used for adressing the notification messages. Notification messages are JSON encoded and itself identified by a notification ID. For more details please refer to chapter <a class="el" href="pg_ipc_users_guide.html#sec_ipc_notification_service">Notification Service</a>.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_supported_platforms"></a>
Supported Platforms</h1>
<h2><a class="anchor" id="subsec_ipc_terminal_platforms"></a>
Terminal Platforms</h2>
<p>Pre-compiled shared ADK IPC libraries (and static variants) are available for the following platforms:</p><ul>
<li>V/OS Fusion (<b><code>vos</code></b> dev package): <code>libvfiipc.a</code>, <code>libvfiipc.so</code>, <code>libvfiipctls.a</code>, <code>libvfiipctls.so</code></li>
<li>V/OS2 Engage (<b><code>vos2</code></b> dev package): <code>libvfiipc.a</code>, <code>libvfiipc.so</code>, <code>libvfiipctls.a</code>, <code>libvfiipctls.so</code></li>
<li>V/OS3 (<b><code>vos3</code></b> dev package): <code>libvfiipc.a</code>, <code>libvfiipc.so</code>, <code>libvfiipctls.a</code>, <code>libvfiipctls.so</code>, <code>libengine_keyservice.so</code>, <code>libengine_keyservice_sdi.so</code></li>
<li>Android (<b><code>android</code></b> dev package): <code>libvfiipc.so</code>, <code>libvfiipctls.so</code>, <code>libengine_keyservice_sdi.so</code></li>
<li>Android System (<b><code>androidsys</code></b> package): <code>libvfiipc.so</code>, <code>libvfiipctls.so</code>, <code>libengine_keyservice.so</code></li>
</ul>
<p><code>libvfipctls</code> contains the <a class="el" href="pg_ipc_users_guide.html#sec_ipc_tls">TLS support</a>, the remaining features are contained in <code>libvfiipc</code>.</p>
<dl class="section note"><dt>Note</dt><dd>Android System components cannot be used by normal Android user applications. These libaries require the application to run as system service with additional privileges to access the security processor.</dd></dl>
<h2><a class="anchor" id="subsec_ipc_other_platforms"></a>
Other Platforms</h2>
<p>In addition, IPC sources are considered to be used for other platforms, for which recently no pre-compiled libraries are provided. Source code can be directly integrated to application projects for the following platforms and compilers:</p><ul>
<li>Windows (TCP/IP only, e.g. Visual Studio 2008)</li>
<li>Other native x86 Unix platforms (GCC compiler).</li>
</ul>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_ADK_IPC_Class_Hierarchy"></a>
IPC Class Hierarchy</h1>
<h2><a class="anchor" id="subsec_ipc_Class_Hierarchy"></a>
Class Hierarchy</h2>
<p>The following illustration shows the class hierarchy of ADK IPC.</p>
<div class="image">
<img src="ADK_IPC_class_diagram.png" alt=""/>
<div class="caption">
ADK IPC Class Hierarchy</div></div>
 <p>Basic application interface of the ADK IPC library <code>libvfiipc</code> consists of 3 classes:</p><ul>
<li>IPC (base class)</li>
<li>Pipe (derived subclass)</li>
<li>TCP (derived subclass)</li>
</ul>
<p>Additional TLS subclass is provided by separate library <code>libvfiipctls</code>.</p>
<p>Class IPC represents the base class providing a generic interface of I/O methods. The subclasses Pipe and TCP are derived from class IPC and contain the specific implementation for the appropriate communication method.</p>
<p>The inheritance in the interface allows the use of most I/O methods independent from the underlying communication method. An application creates an instance of class Pipe or TCP and may use pointers to reference the base class, in order to use the generic I/O interface as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ipc_8h.html">ipc.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">Pipe *p=<span class="keyword">new</span> Pipe();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(!p-&gt;connect(<span class="stringliteral">&quot;/tmp/foobar&quot;</span>)) {</div>
<div class="line">   fprintf(stderr,<span class="stringliteral">&quot;connect to pipe failed!&quot;</span>nn);</div>
<div class="line">   <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// use generic interface functions</span></div>
<div class="line">IPC *ipc=p;</div>
<div class="line"> </div>
<div class="line">ipc-&gt;write(<span class="stringliteral">&quot;some data&quot;</span>,9);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[255];</div>
<div class="line"> </div>
<div class="line">ipc-&gt;read(buf,<span class="keyword">sizeof</span>(buf));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// close connection and destroy the IPC object delete ipc;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Since the <code>IPC</code> destructor is <code>virtual</code>, invoking <code>delete</code> on the pointer of the <code>IPC</code> base class will destroy the instance of the derived class <code>Pipe</code> or <code>TCP</code> automatically. In addition, destroying the object will close the connection with an implicit invocation of <code>close()</code>.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_I_O_Functions"></a>
IPC I/O Functions</h1>
<p>The I/O functions of the ADK IPC library support both stream and message-based operation.</p>
<h2><a class="anchor" id="subsec_ipc_Stream_Based_Operation"></a>
Stream Based Operation</h2>
<p>For stream-based operations, the base class IPC provides following low-level I/O functions: </p><div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::write(<span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ping.html#ae0d180616fe53dddd61f70c62526b0db">size</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">int</span> IPC::read(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> maxsize, <span class="keywordtype">int</span> timeout_msec=-1);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">int</span> IPC::read(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> maxsize, <span class="keywordtype">int</span> timeout_msec, <span class="keywordtype">int</span> timeout_msec2);</div>
</div><!-- fragment --><p>The <a class="el" href="classvfiipc_1_1_i_p_c.html#a04f753a2a5691e2d36266e2ff084a217">write()</a> function writes data to the IPC stream, the result is returned as a boolean value (<em>true</em> for success). The <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> reads data from the IPC stream, unless the number of bytes exceeds the size specified by <code>maxsize</code> or the given timeout in milliseconds <code>timeout_msec</code> expires. If the timeout is expired, the number of received bytes is returned. The overloaded <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> function with timeout <code>timeout_msec2</code> can be used to specify the timeout in milliseconds after at least one byte has been read.</p>
<h2><a class="anchor" id="subsec_ipc_Message_Based_Operation"></a>
Message Based Operation</h2>
<p>ADK IPC library provides functions for sending and receiving messages. The data is transferred with a simple synchronization protocol that specifies the following message format:</p>
<div class="image">
<img src="ipc_message_format.png" alt=""/>
<div class="caption">
ADK IPC Message Format</div></div>
 <p>ADK IPC messages are pre-appended by a header that allows splitting the stream of bytes into ADK IPC messages. The header consists of the following fields:</p><ul>
<li>prefix</li>
<li>message size</li>
<li>message ID.</li>
</ul>
<p>The prefix is used for checking synchronization between sender and receiver, and to resynchronize in case synchronization has been lost. The receiver discards the data until a valid prefix has been found. The message size field contains the number of bytes for the following fields: the message ID (4 bytes) plus message data (n bytes). The message ID field may contain a unique number to identify the messages by sender and receiver. For instance, if one ADK IPC connection is used for multiple multiplexed communications, the message ID may address the messages for several logical channels. All header fields (prefix, message size and message ID) are in big endian format.</p>
<p>The following functions can be used for message based operations:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::write_msg(<span class="keywordtype">unsigned</span> prefix, <span class="keywordtype">int</span> msg_id, <span class="keyword">const</span> <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ping.html#ae0d180616fe53dddd61f70c62526b0db">size</a>);</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::write_msg(<span class="keywordtype">unsigned</span> prefix, <span class="keywordtype">int</span> msg_id, <span class="keyword">const</span> std::vector&lt;unsigned char&gt; &amp;msg);</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::write_msg(<span class="keywordtype">unsigned</span> prefix, <span class="keywordtype">int</span> msg_id, <span class="keyword">const</span> std::vector&lt;char&gt; &amp;msg);</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::read_msg(<span class="keywordtype">unsigned</span> prefix, <span class="keywordtype">int</span> &amp;msg_id, std::vector&lt;unsigned char&gt; &amp;msg, <span class="keywordtype">int</span> size_limit, <span class="keywordtype">int</span> timeout_msec=-1);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::read_msg(<span class="keywordtype">unsigned</span> prefix, <span class="keywordtype">int</span> &amp;msg_id, std::vector&lt;char&gt;&amp;msg, <span class="keywordtype">int</span> size_limit, <span class="keywordtype">int</span> timeout_msec=-1);</div>
</div><!-- fragment --><p>IPC header file <code><a class="el" href="ipc_8h.html">ipc.h</a></code> offers several signatures of <code>write_msg()</code> and <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> to send and receive messages. All functions take the prefix and the message ID as first and second parameters. Several signatures of <code>write_msg()</code> and <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> just differ in type of message parameter <code>msg</code>. The <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> function additionally takes parameters <code>timeout_msec</code> (timeout in milliseconds) and a <code>size_limit</code> specifying the limited number of bytes for the messages to be stored in the vector <code>msg</code>. All functions return the result as a boolean value (<code>true</code> for success).</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_Error_Detection"></a>
IPC Error Detection</h1>
<h2><a class="anchor" id="subsec_Error_Detection"></a>
Error Detection</h2>
<p>In order to indicate communication errors or a disturbed connection, the application may invoke IPC function <a class="el" href="classvfiipc_1_1_i_p_c.html#a090dfa7806330da64843832e3985ebdf">error()</a>. </p><div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::error();</div>
</div><!-- fragment --><p> Errors are detected by IPC functions for reading and writing, and <a class="el" href="classvfiipc_1_1_i_p_c.html#a090dfa7806330da64843832e3985ebdf">error()</a> is generally called as the subsequent function. If <a class="el" href="classvfiipc_1_1_i_p_c.html#a090dfa7806330da64843832e3985ebdf">error()</a> returns <code>true</code>, the application invokes <a class="el" href="classvfiipc_1_1_i_p_c.html#a47feccb1873356363e4d0e302bc3822c">close()</a> function to re-use the IPC object: </p><div class="fragment"><div class="line">IPC *ipc;</div>
<div class="line"> </div>
<div class="line">TCP *tcp;</div>
<div class="line"> </div>
<div class="line">ipc=tcp=<span class="keyword">new</span> TCP();</div>
<div class="line"> </div>
<div class="line">tcp-&gt;connect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>,12345);</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">int <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>=ipc-&gt;read(buf,<span class="keyword">sizeof</span>(buf));</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&lt;=0) {</div>
<div class="line">   <span class="keywordflow">if</span>(ipc-&gt;error() || ipc-&gt;eof()) {</div>
<div class="line"> </div>
<div class="line">      ipc-&gt;close();</div>
<div class="line">      ...</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// reconnect</span></div>
<div class="line"> </div>
<div class="line">      tcp-&gt;connect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>,12345);</div>
<div class="line"> </div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p> An application indicates an <code>EOF</code> (end of file) if the IPC connection was closed by the other side. </p><div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">bool</span> IPC::eof();</div>
</div><!-- fragment --><p> <code>EOF</code> is detected by IPC functions for reading only, e.g. <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> or <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a>. If <a class="el" href="classvfiipc_1_1_i_p_c.html#a044713f1fcbdbec24aae467186a95481">eof()</a> returns true, the application invokes <a class="el" href="classvfiipc_1_1_i_p_c.html#a47feccb1873356363e4d0e302bc3822c">close()</a> function to re-use the IPC object.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_IPC_Data_Detection"></a>
IPC Data Detection</h1>
<p>ADK IPC library provides two APIs to check for availability of incoming data. On the one hand application can use a function to poll the IPC object for available data, on the other hand there is an event-driven interface to register a callback, which is invoked, if the IPC object holds some data for reading.</p>
<h2><a class="anchor" id="subsec_ipc_Poll_API_Function"></a>
Polling API Function</h2>
<p>If an application just wants to check the IPC object for availability of incoming data and it is not intended to read the data immediately, the following function can be used: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> poll_in(<span class="keywordtype">int</span> timeout_msec=-1);</div>
</div><!-- fragment --><p> This function returns true, if data is pending in the object and ready for reading with <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> or <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a>. In case of an error or an EOF (end of file) this function also returns true and sets the internal flags for functions <a class="el" href="classvfiipc_1_1_i_p_c.html#a044713f1fcbdbec24aae467186a95481">IPC::eof()</a> and <a class="el" href="classvfiipc_1_1_i_p_c.html#a090dfa7806330da64843832e3985ebdf">IPC::error()</a>. An additional timeout <em>timeout_msec</em> can be used to wait for the arrival of data for a specified time (in milliseconds). A negative timeout means wait forever.</p>
<dl class="section note"><dt>Note</dt><dd>Function <a class="el" href="classvfiipc_1_1_i_p_c.html#aae3d66ed5454894b1ace225e51de8674">poll_in()</a> is a poll-driven API and application needs to call this function cyclically (or blocking) to detect the arrival of data. Another event-driven API is also provided with IPC function <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a>. For more details please refer to next chapter <a class="el" href="pg_ipc_users_guide.html#subsec_ipc_Callback_Interface_for_Available_Data">Callback Interface (event-driven)</a>.</dd></dl>
<h2><a class="anchor" id="subsec_ipc_Callback_Interface_for_Available_Data"></a>
Callback Interface (event-driven)</h2>
<p>IPC applications can register a callback function to an IPC object, which is invoked if data is available for reading on this object. From inside this function the application can use functions <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> or <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> to read the data or send an event to another task or thread that data is pending. The callback is set with the following IPC function: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> set_callback(<a class="code" href="namespacevfiipc.html#ad81e4165dd387a02aacdb8a57c4fdd4f">ipcCallback</a> cb, <span class="keywordtype">void</span> *data=0);</div>
</div><!-- fragment --><p> The callback function is represented by parameter <em>cb</em> of type <code>ipcCallback</code>, which is defined as a function pointer: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> void (*<a class="code" href="namespacevfiipc.html#ad81e4165dd387a02aacdb8a57c4fdd4f">ipcCallback</a>)(<span class="keywordtype">void</span> *data, IPC *ipc);</div>
</div><!-- fragment --><p> In case that data is pending for the object, the callback function is invoked. The function is passed a pointer to parameter <em>data</em> that was set with <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a>. In addition, a pointer to the IPC object is provided as second parameter, which allows access to the IPC object and its member functions, e.g. <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a>. Example: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ipc_callback(<span class="keywordtype">void</span> *data, IPC *ipc)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> buf[256];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>=ipc-&gt;read(buf,<span class="keyword">sizeof</span>(buf),0);</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&gt;0) {</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> Functions <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> and <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> can be invoked from inside the callback with a zero timeout, since data is already available and there is no need to wait for arrival of data.</p>
<dl class="section note"><dt>Note</dt><dd>Please note that no more callbacks are invoked unless some data was read from this IPC object with <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> or <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a>. For instance, if data is splitted into 2 packages and applications expects a callback for the second part, the callback for this second part is not invoked unless application has called <a class="el" href="classvfiipc_1_1_i_p_c.html#aa04744c17ae9eec2b37fb8c476a8c62d">read()</a> or <a class="el" href="classvfiipc_1_1_i_p_c.html#a5fc3e8a54237502339f9483465730704">read_msg()</a> for the first part. The reason for this implementation is ADKIPC must avoid application overloading with multiple callbacks.</dd>
<dd>
Please also note that <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a> starts a seperate thread, which invokes the callback functions for all IPC objects. For this reason application always should check return code of <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a> to avoid deadlocks, since callback function won't be invoked, if <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a> returns <code>false</code>. In order to unregister the callback function from the IPC object, application invokes <a class="el" href="classvfiipc_1_1_i_p_c.html#aa73e8080bdf5412792220bbb47cd2f4d">set_callback()</a> with a <code>NULL</code> pointer for parameter <em>cb</em>.</dd></dl>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_Client_Functions"></a>
IPC Client Functions</h1>
<h2><a class="anchor" id="subsec_Client_Functions"></a>
Client Functions</h2>
<p>The application can establish a new pipe connection with the following function: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> Pipe::connect(<span class="keyword">const</span> <span class="keywordtype">char</span> *pipe);</div>
</div><!-- fragment --><p> Parameter <code>pipe</code> specifies the named pipe the server provides in the file system. The function returns <code>false</code> if the pipe is not available or cannot be opened.</p>
<p>The application can establish a new TCP/IP connection by using: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> TCP::connect(<span class="keyword">const</span> <span class="keywordtype">char</span> *hostname, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port,<span class="keywordtype">int</span> timeout_msec=-1);</div>
</div><!-- fragment --><p> Parameter <code>hostname</code> specifies the DNS name or the IP address of the server. Parameter <code>port</code> specifies the TCP/IP port of the server. The function returns <code>false</code> if no connection could be established or if the timeout in milliseconds has expired.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_Server_Functions"></a>
IPC Server Functions</h1>
<h2><a class="anchor" id="subsec_Server_Functions"></a>
Server Functions</h2>
<p>An IPC server application can create a new named pipe to listen for new incoming connections: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> Pipe::listen(<span class="keyword">const</span> <span class="keywordtype">char</span> *pipe);</div>
</div><!-- fragment --><p> Parameter <code>pipe</code> specifies the named pipe to be provided to clients in the files system. The function returns <code>false</code> if the pipe cannot be created.</p>
<p>A server application can create a new TCP/IP listen socket for new incoming connections by using: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> TCP::listen(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port, <span class="keyword">const</span> <span class="keywordtype">char</span> *listen_address=0);</div>
</div><!-- fragment --><p> Parameter <code>port</code> specifies the port for the new listen socket. An IP address passed via <code>listen_address</code> specifies the network adapter for accepting connections. Default <code>listen_address=0</code> means acceptance of connections on all available adapters. Use <code>127.0.0.1</code> for local loopback device to avoid that external connections are accepted. The function returns <code>false</code> if the listen socket cannot be created.</p>
<p>Incoming connections can be accepted with following ADK IPC functions: </p><div class="fragment"><div class="line">IPC * IPC::accept(<span class="keywordtype">int</span> timeout_msec=-1);</div>
<div class="line">IPC * Pipe::accept(<span class="keywordtype">int</span> timeout_msec=-1);</div>
<div class="line">IPC * TCP::accept(<span class="keywordtype">int</span> timeout_msec=-1);</div>
</div><!-- fragment --><p> <code>IPC::accept()</code> has the same signature as functions of derived classes and works for both communication methods named <code>pipes</code> and <code>TCP/IP</code>. If an incoming connection has been accepted, a pointer to a new <code>IPC</code> instance is returned for this new connection. The caller takes over the ownership for this object, and if it is no longer needed, it must be released using <code>delete:</code> </p><div class="fragment"><div class="line">Pipe p;</div>
<div class="line"> </div>
<div class="line">p.listen(<span class="stringliteral">&quot;/tmp/foobar&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(1) {</div>
<div class="line"> </div>
<div class="line">   IPC *ipc=p.accept();</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span>(!ipc) <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[255];</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>=ipc-&gt;read(buf,<span class="keyword">sizeof</span>(buf));</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span>(<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&gt;0) {</div>
<div class="line"> </div>
<div class="line">      ipc-&gt;write(buf,<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>);</div>
<div class="line"> </div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// free IPC object for this connection</span></div>
<div class="line"> </div>
<div class="line">   <span class="keyword">delete</span> ipc;</div>
<div class="line">}</div>
</div><!-- fragment --><p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_Remote_Information"></a>
IPC Remote Information</h1>
<h2><a class="anchor" id="subsec_Remote_Information"></a>
Remote Information</h2>
<p>The following function can be used to get remote information about the connected process or machine. </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *remote_addr() <span class="keyword">const</span>;</div>
</div><!-- fragment --><p> For <code><a class="el" href="classvfiipc_1_1_t_c_p.html">vfiipc::TCP</a></code> objects this function always returns the IP address and session port of the connected client or server. The string format of the return value is the following: </p><div class="fragment"><div class="line">&lt;IP address&gt;:&lt;port&gt;</div>
</div><!-- fragment --><p> For <code><a class="el" href="classvfiipc_1_1_pipe.html">vfiipc::Pipe</a></code> objects this function returns a string containing <code>PID</code>, <code>UID</code> and <code>GID</code> of the remote process. The string format is the following: </p><div class="fragment"><div class="line">&lt;pid&gt; &lt;uid&gt; &lt;gid&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_ipc_tls"></a>
TLS support</h1>
<p>TLS support is provided for Linux platforms (V/OS, V/OS 2, V/OS 3) and Android with library <code>libvfiipctls</code> coming along with the distribution package.</p>
<p>Compared to TCP setting up a TLS connection requires additional information for key and certificate handling. This information must be set before actually connecting to a target or before listening for connections using <a class="el" href="classvfiipc_1_1_t_l_s.html#ae964fcae76a97db22c3e2a6128c4aaad">TLS::setKeyCert</a>, <a class="el" href="classvfiipc_1_1_t_l_s.html#a4084c8652036e45c21b56d78f5bf07ee">TLS::setCA</a> and <a class="el" href="classvfiipc_1_1_t_l_s.html#a3f9d5450bdb44150cd43cc294bb93649">TLS::setClientAuth</a>. Depending on whether the connection is the client or server side of the link, not all of them are required.</p>
<p>Wenn setting up a TLS link, additional error information may be obtained using <a class="el" href="classvfiipc_1_1_t_l_s.html#a5e0030ca1fbfa22c41a7d88e2ecde6f6">TLS::TLSError()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Please note that <code>libvfiipctls</code> depends on OpenSSL libraries, which may need to be installed separately, if the OS does not already include them. On V/OS, V/OS 2 and V/OS 3 OpenSSL libraries comes along with the OS. Older V/OS and V/OS 2 versions use OpenSSL 1.0.2, but since ADK 4.10 the OS will be upgraded to OpenSSL 3. On Android OpenSSL is not part of the system, thus, each application must provide the libraries with the APK. Older installations might still use older OpenSSL 1.1.1, but these projects should migrate to OpenSSL 3 soon, since old version have reached end-of-support. Due to the fact different OpenSSL versions are used on these platforms, ADKIPC requires to provide 2 variants to cover transition phase to the new OpenSSL 3. Thus, for targets with new OpenSSL 3 the user must link library <code>libvfiipctls</code> of subfolder <code>lib/openssl3</code> coming along with development packages, e.g. <code>ipc-android-dev-X.X.X-X.zip</code>. New VOS3 platform already uses OpenSSL 3 from begin, thus, development and load packages already contain one set of libraries under <code>lib</code> already fitting to all OS versions.</dd></dl>
<h2><a class="anchor" id="sec_ipc_authex"></a>
Using client key/certificate</h2>
<p>Class <code>TLS</code> provides API functions <a class="el" href="classvfiipc_1_1_t_l_s.html#ae964fcae76a97db22c3e2a6128c4aaad">TLS::setKeyCert</a> to specify a client key/certificate and <a class="el" href="classvfiipc_1_1_t_l_s.html#a3f9d5450bdb44150cd43cc294bb93649">TLS::setClientAuth</a> to enable client authentication against a TLS server (mutual authentication). In most cases the terminal will use Authex key/certificate, which is installed by factory with warrantied keys. Newer OS verions also allow to install a customer loaded key/certificate with RKL (remote key loading). RKL uses VRK (VeriShield remote key) with an end to end authenticated encrpytion to bring in a terminal individual payload containing the key and the certificate. For more details about how to create such download files please refer to RKL/VRK documentation.</p>
<dl class="section note"><dt>Note</dt><dd>Client keys are always encrypted and never exposed in plain text to applications.</dd></dl>
<p>Both, AuthEx and a customer loaded key/certificate are used with an OpenSSL engine, which provides a keyservice to access the encrypted client private key in a secure manner.<br  />
Two different types of keyservice engines are provided:</p><ul>
<li>Local keyservice engine:<br  />
 The local keyservice engine is intended for applications having permissions to access the local security module (see chapter <a class="el" href="pg_ipc_users_guide.html#sec_ipc_local_keyservice">Local keyservice engine</a>). On older terminal platforms the local keyservice engine is part of the operating system, e.g. Fusion (V/OS) and Engage (V/OS 2) provide this service with library <code>engine_keyservice.so</code>. On Android and V/OS 3 user applications are not allowed to use the local keyservice, only system applications (e.g. SDI) can use it. On Android the library uses prefix <code>lib</code>, thus, the library <code>libengine_keyservice.so</code> and comes along with the IPC development distribution package.</li>
<li>Remote keyservice engine:<br  />
 For applications running on systems w/o permissions to access security module (e.g. Android and V/OS 3) the ADKIPC project provides the remote keyservice engine (see chapter <a class="el" href="pg_ipc_users_guide.html#sec_ipc_remote_keyservice">Remote keyservice engine</a>). This engine is provided by library <code>engine_keyservice_sdi.so</code> (or <code>libengine_keyservice_sdi.so</code> for Android platforms). The library also comes along IPC development distribution package for the corresponding platform.</li>
</ul>
<p>Users need not deal with details to load the shared objects in application to get keyservice capabilities. Library <code>libvfiipctls</code> does this job and knows for each platform, which engine to load and to use. The engine libraries just must be installed in the <code>lib</code> directory next to the executable (x86-Linux) or in the <code>lib</code> subdirectory of the current working directory (Android). If installed, a keyservice engine can be addressed by using an engine prefix with a key reference name, which is passed as key and certificate parameter to <a class="el" href="classvfiipc_1_1_t_l_s.html#ae964fcae76a97db22c3e2a6128c4aaad">TLS::setKeyCert</a> in the following format: </p><pre class="fragment">&lt;engine prefix&gt;:[&lt;key reference name&gt;]
</pre><p> The value <code>&lt;engine prefix&gt;</code> is used to select a keyservice engine for the TLS connection. Available engines with its prefix are described in the following chapters. Please note that prefix needn't necessarily match to an intalled keyservice engine and <code>libvfiipctls</code> might fallback to another engine available on the system. The value <code>&lt;key reference name&gt;</code> selects a key/certificate, which shall be used by the keyservice engine for the TLS connection. Friendly key reference names are unanimously used across supported engines and platforms, whereas reference names for customer loaded key/certificates may depend on platform. The keyservice engines are designed to support several keys/certificates, the following are recently supported:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Supported RSA key/certificate </th><th class="markdownTableHeadCenter">Used key reference name  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AuthEx key/certificate </td><td class="markdownTableBodyCenter"><code>VFI_AUTHN_RSA</code> (friendly name)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Customer loaded RSA key/certificate </td><td class="markdownTableBodyCenter">Arbitrary name (depending on platform)  </td></tr>
</table>
<p><code>VFI_AUTHN_RSA</code> is the default for all keyservice engines, therefore, value <code>&lt;key reference name&gt;</code> can stay empty to select the AuthEx key/certificate.</p>
<dl class="section note"><dt>Note</dt><dd>Presence of a valid AuthEx key/certificate can be checked using <a class="el" href="classvfiipc_1_1_t_l_s.html#ac4660b9dda0672220272fc39b597e208">TLS::hasAuthEx</a>.</dd></dl>
<p><b>Customer loaded RSA key/certificate</b>:<br  />
</p>
<p>On Engage a customer RSA certificate will be stored by RKL as <code>*.crt</code> file unter the following location: </p><pre class="fragment">/mnt/flash/system/generickeys/usr&lt;X&gt;
</pre><p> <code>&lt;X&gt;</code> stands for an user number 1-16, whereas keys/certificates can be shared between different users. The corresponding RSA key is VRK encrypted and stored next to the certificate having the same basename with extension <code>*.der</code>. The basename is specified by the VRK key label. Finally, applications can use the following notation as key reference name to address a related customer RSA key/certificate: </p><pre class="fragment">[usr&lt;X&gt;/]&lt;key label&gt;
</pre><p> <code>usr&lt;X&gt;/</code> is the user prefix used as subfolder under <code>/mnt/flash/system/generickeys</code>. The user prefix is optional and engines use prefix <code>usr1/</code> as default to look up keys/certificates under <code>/mnt/flash/system/generickeys/usr1</code>. Thus, the <code>&lt;key label&gt;</code> only w/o user prefix can be used as key reference name to address a <code>usr1</code> key/certificate. Other users require usage of the user prefix with the key label, e.g. <code>usr2/mykey</code>.</p>
<dl class="section note"><dt>Note</dt><dd>The value used for key reference name must match user prefix and key label case sensitive.</dd></dl>
<p>Android (Trinity, Neo) usually uses the friendly key label to specify the key or certficate. Additionally, serial number (hex string, e.g. <code>65C95907166F14DA</code>) can be used as key reference name. Neo platform even allows to use the subject <code>CN</code> of the certificate.</p>
<h3><a class="anchor" id="sec_ipc_local_keyservice"></a>
Local keyservice engine</h3>
<p>Applications having permissions to access the local security module (e.g. a payment application running on Fusion (V/OS) or Engage (V/OS 2) with direct access to Vault or SDI component on Android and V/OS3 with direct access to K81) can use the local keyservice engine (<code>engine_keyservice.so</code> or <code>libengine_keyservice.so</code>), which directly invokes the API of the security module to read the certificates or to operate with a private RSA key. When the local keyservice engine has been installed, it can be selected by using the engine name <code>vault</code>, which is passed as prefix in parameters for the key and/or the certificate on to <a class="el" href="classvfiipc_1_1_t_l_s.html#ae964fcae76a97db22c3e2a6128c4aaad">TLS::setKeyCert</a>.<br  />
Example to select local keyservice engine with default AuthEx key/certificate: </p><div class="fragment"><div class="line">TLS tls;</div>
<div class="line">tls.setKeyCert(<span class="stringliteral">&quot;vault:&quot;</span>,<span class="stringliteral">&quot;vault:&quot;</span>);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Engine prefix <code>vault</code> will prefer local keyservice engine (<code>engine_keyservice.so</code> or <code>libengine_keyservice.so</code>), if it was installed and loaded. If not, library <code>libvfiipctls</code> might fallback to remote keyservice engine (<code>engine_keyservice_sdi.so</code> or <code>libengine_keyservice_sdi.so</code>). </dd>
<dd>
On Fusion (V/OS) and Engage (V/OS 2) the local keyservice engine comes along with the operating system, therefore, ADKIPC library <code>engine_keyservice.so</code> is not installed on these platforms.</dd></dl>
<h3><a class="anchor" id="sec_ipc_remote_keyservice"></a>
Remote keyservice engine</h3>
<p>Primary, the remote keyservice engine was introduced for Android devices (e.g. T650c, CM5, M440 or M424) running the payment application on Android, which is not allowed to access the security module of the terminal directly. In addition, new V/OS 3 terminals have the same security concept, which allows SDI (Secure Data Interface) component only to access the security processor. SDI is a separate component coming along with SDI installation. The remote keyservice engine connects to the SDI remote keyservice, which is fully decoupled from normal SDI interface. It is available for applications running on the same device as the SDI component. The service provides a command interface, which is implemented by the remote keyservice engine <code>engine_keyservice_sdi.so</code> (and <code>libengine_keyservice_sdi.so</code> for Android) to read certificates or to operate with a private RSA key. When the remote keyservice engine has been installed, it can be selected by using the engine name "sdi", which is passed as prefix in parameters for the key and/or the certificate on to <a class="el" href="classvfiipc_1_1_t_l_s.html#ae964fcae76a97db22c3e2a6128c4aaad">TLS::setKeyCert</a>.<br  />
Example to select remote keyservice engine with default AuthEx key/certificate: </p><div class="fragment"><div class="line">TLS tls;</div>
<div class="line">tls.setKeyCert(<span class="stringliteral">&quot;sdi:&quot;</span>,<span class="stringliteral">&quot;sdi:&quot;</span>);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Engine prefix <code>sdi</code> will prefer remote keyservice engine (<code>engine_keyservice_sdi.so</code> or <code>libengine_keyservice_sdi.so</code>), if it was installed and loaded. If not, library <code>libvfiipctls</code> might fallback to local keyservice engine (<code>engine_keyservice.so</code> or <code>libengine_keyservice.so</code>). </dd>
<dd>
The remote keyservice engine <code>libengine_keyservice_sdi.so</code> for Android comes along with IPC development distribution package. There are no installation packages, therefore, users must integrate the library to application package for installation.</dd></dl>
<h1><a class="anchor" id="sec_ipc_notification_service"></a>
Notification Service</h1>
<p>Notification service is used for sending asynchronous notifications for interprocess communication within a terminal. The service comes along with <code>libvfiipc</code> that implements both the server and client part of the notification service. The server part is considered to run by exactly one process. The client part implements a C++ interface for use by clients. It communicates with the server using unix domain sockets or named pipes depending on the platform it is run on.</p>
<h2><a class="anchor" id="subsec_ipc_notify"></a>
Notifications</h2>
<p>Notifications that are handled by notification service consist of:</p>
<ul>
<li>notification ID</li>
<li>source address</li>
<li>destination address</li>
<li>hierarchical JSON encoded data</li>
<li>optional flags</li>
</ul>
<p>Addressing is based on the application ID of the applications. For this each application registers with notification service to specify its own application ID (see <a class="el" href="namespacevfiipc.html#a88455cb389891217791604f188ac0fa5">vfiipc::ipcSetAppID</a>). The same way it registers for the notifications it is interested in (see <a class="el" href="namespacevfiipc.html#a625ae82cd0bc99851ccb8a8ffdcaea1e">vfiipc::ipcRegisterNotificationCB</a>).</p>
<p>For specifying the destination address two additional addresses are supported:</p><ul>
<li>1 - send the notification to a single application</li>
<li>* - send the notification to all applications (broadcast)</li>
</ul>
<p>Notifications are identified by a notification ID. <a class="el" href="namespacevfiipc.html#a3ad101cda0c973d26791bd8f194d4b80">vfiipc::ipcNotify</a> is used to send notifications. Data is provided as JSON object.</p>
<p>If the broadcast address is used as destination the notification is sent to all applications that have been registered for this specific notification ID.</p>
<p>If <em>1</em> has been used as address the server creates a list of all applications that have registered for a notification ID and continues with this list. If a specific application ID has been used this address is used as destination address. In case the destination list contains more than one entry, the notification is delivered to the application with the highest priority. If several applications share the highest priority it is unspecified which one of them will receive the notification.</p>
<p>Notifications are delivered by invoking the registered callback function (see <a class="el" href="namespacevfiipc.html#ab377f9e2a200c707731b1984626d70c9">vfiipc::NotifyCallback</a>). The source address of the sending application is delivered to the callback function. This address can be used in case a result notification is to be sent when processing has been completed. Also the destination address as used when sending is passed on to the callback. By this a callback can find out whether it was invoked during a broadcast or whether it has been addressed individually. Parameters are provided as <a class="el" href="classvfiipc_1_1_j_s_object.html">vfiipc::JSObject</a> which implements an interface for encoding and decoding JSON data.</p>
<p>Receiving notifications works transparently for the application: Notification service uses separate threads for receiving and for invoking callbacks. Callbacks may be invoked concurrently, so locking may be required if the callbacks access common data.</p>
<dl class="section note"><dt>Note</dt><dd>Notifications are global, every process is allowed to send and receive any notification. This allows for maximum flexibility but has some implications on security: Notifications must not be used to send sensitive data in plain text.</dd></dl>
<p>Example application, that receives "echo" notifications and sends them back to sender as "echo-reply" notification: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="notify_8h.html">ipc/notify.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacevfiipc.html">vfiipc</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> echo_cb(<span class="keywordtype">void</span> *data,</div>
<div class="line">              <span class="keyword">const</span> std::string &amp;from,</div>
<div class="line">              <span class="keyword">const</span> std::string &amp;to,</div>
<div class="line">              <span class="keyword">const</span> std::string &amp;notification,</div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classvfiipc_1_1_j_s_object.html">vfiipc::JSObject</a> &amp;param,</div>
<div class="line">              <span class="keywordtype">unsigned</span> flags)</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// print received information to console</span></div>
<div class="line">   printf(<span class="stringliteral">&quot;callback\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;   from:         %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;   to:           %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;   notification: %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;   param:        %s\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;   flags:        %x\n\n&quot;</span>,from.c_str(),to.c_str(),notification.c_str(),param.<a class="code" href="classvfiipc_1_1_j_s_object.html#a535976112a5480b2957b0030cff36b68">dump</a>().c_str(),flags);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// just send back received information to sender as &quot;echo-reply&quot; notification</span></div>
<div class="line">   <a class="code" href="namespacevfiipc.html#a3ad101cda0c973d26791bd8f194d4b80">ipcNotify</a>(from,<span class="stringliteral">&quot;echo-reply&quot;</span>,param);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// set application ID</span></div>
<div class="line">   <a class="code" href="namespacevfiipc.html#a88455cb389891217791604f188ac0fa5">ipcSetAppID</a>(<span class="stringliteral">&quot;echo-server&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// register for receiving &quot;echo&quot; notification</span></div>
<div class="line">   <span class="keywordflow">if</span>(<a class="code" href="namespacevfiipc.html#a625ae82cd0bc99851ccb8a8ffdcaea1e">ipcRegisterNotificationCB</a>(<span class="stringliteral">&quot;echo&quot;</span>,echo_cb,0,0)) {</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;Failed to register callbacks\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span>(1);</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">while</span>(1) sleep(1000); <span class="comment">// processing happens in callback</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="subsec_ipc_setup_server"></a>
Setup Notification Service</h2>
<p>Before a notification callback can be configured by any client with <a class="el" href="namespacevfiipc.html#a625ae82cd0bc99851ccb8a8ffdcaea1e">vfiipc::ipcRegisterNotificationCB</a>, exactly one process must setup the Notification Service as a server, which is started with one of the following functions: </p><div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="namespacevfiipc.html#a7eda24f6e23d0f36491cc949c16ac4c3">NotifyResult</a> <a class="code" href="namespacevfiipc.html#a1862bc6c0fe6d07d60c677292cbc9619">ipcNotificationServer</a>();</div>
<div class="line"><span class="keyword">enum</span> <a class="code" href="namespacevfiipc.html#a7eda24f6e23d0f36491cc949c16ac4c3">NotifyResult</a> <a class="code" href="namespacevfiipc.html#a1862bc6c0fe6d07d60c677292cbc9619">ipcNotificationServer</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *config_file);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If a client invokes <a class="el" href="namespacevfiipc.html#a625ae82cd0bc99851ccb8a8ffdcaea1e">vfiipc::ipcRegisterNotificationCB</a>, before the server was started, the function will fail with error code <a class="el" href="namespacevfiipc.html#a7eda24f6e23d0f36491cc949c16ac4c3a3332b9f23fcc102341e551348f714940">vfiipc::NOTIFY_ERR_SERVER</a>.</dd></dl>
<p>Since ADK IPC 1.4.5 an additional component <code>notifysvc</code> was added, which can be installed as notification server running as separate process. Download packages are available for several terminal platforms and come along with ADK IPC distribution packages. Since ADK IPC 1.5.0 the <code>notifysvc</code> was moved from user sys13 to sys12, which allows to use notification service while sysmode is active.</p>
<h2><a class="anchor" id="subsec_ipc_observer"></a>
Observer</h2>
<p>In addition to registering for notifications an application may register as observer (see <a class="el" href="namespacevfiipc.html#a5cb6705e4d5e2d94225eac66c760e872">vfiipc::ipcRegisterObserver</a>). As observer it will be informed about all delivered notifications. This could be used for example to control visibility of applications or it could be used by power management to detect idle situations.</p>
<p>The observer callback (see <a class="el" href="namespacevfiipc.html#a74917bd8d91bec1ff98234834e531071">vfiipc::NotifyObserver</a>) is provided with the source and resolved destination address, notification ID and flags parameter. The notification data is not passed on to the observer callback.</p>
<h2><a class="anchor" id="subsec_ipc_remote"></a>
Remote access</h2>
<p>By default the notification server has disabled remote access. On Fusion (V/OS), Engage (V/OS 2) and V/OS 3 devices remote access may optionally enabled by providing a configuration file that contains a white list of notifications that are accepted from remote hosts and that are allowed to be sent to remote hosts. The configuration file is passed on as parameter when starting the notification server using <code><a class="el" href="namespacevfiipc.html#a1862bc6c0fe6d07d60c677292cbc9619">ipcNotificationServer()</a></code>.</p>
<p>Component <code>notfiysvc</code> takes the configuration file as parameter as follows: </p><pre class="fragment">./notifysvc my_notify.cfg
</pre><p> In addition, notifysvc itself looks up the configuration depending on used platform and ADKIPC version from these locations:<br  />
<b>V/OS and V/OS 2 (since ADKIPC 1.5.0)</b> </p><pre class="fragment">/home/sys12/notify.cfg
</pre><p> <b>V/OS 3 (since ADKIPC 1.28.0)</b> </p><pre class="fragment">/home/sys_ipc/notify.cfg
</pre><p> Please note that these locations are ignored, if configuration file is passed as program parameter. If no configuration exists, <code>notifysvc</code> comes up without permission for remote access.</p>
<h3><a class="anchor" id="subsubsec_ipc_notify_config"></a>
Configuration file format</h3>
<p>Each line in the configuration file defines a whitelist rule and has the following format: </p><pre class="fragment">[in|out] &lt;from&gt; &lt;to&gt; &lt;notification ID&gt;
</pre><p><em>in</em> refers to inbound notifications received from remote hosts, <em>out</em> refers to outbound notifications to be sent to remote hosts. <code>&lt;to&gt;</code> and <code>&lt;notification ID&gt;</code> refer to the corresponding parameters as provided to <code><a class="el" href="namespacevfiipc.html#a3ad101cda0c973d26791bd8f194d4b80">ipcNotify()</a></code>, <code>&lt;from&gt;</code> refers to the <em>from</em> parameter provided to <code><a class="el" href="namespacevfiipc.html#a3ad101cda0c973d26791bd8f194d4b80">ipcNotify()</a></code> or to the default value set by <code><a class="el" href="namespacevfiipc.html#a88455cb389891217791604f188ac0fa5">ipcSetAppID()</a></code> whichever is appropriate. <code>&lt;from&gt;</code>, <code>&lt;to&gt;</code> and <code>&lt;notification ID&gt;</code> all take patterns that may use '<code>*</code>' to match any sequence of characters. '<code>\</code>' acts as escape character to force matching the next character literally. For example '<code>\*</code>' would match the '<code>*</code>' character. Pattern matching is case sensitive.</p>
<p>Empty lines and lines starting with '<code>#</code>' are treated as comment and are ignored.</p>
<p>Example configuration file: </p><pre class="fragment"># Optional configuration file for notifysvc
# Format:
# [in|out] &lt;from&gt; &lt;to&gt; &lt;notification-id&gt;

in * * foo
out * * foo

in * 1 test
out * * test_reply

# allow all notifications starting with ext_
in * * ext_*
out * * ext_*
</pre><dl class="section note"><dt>Note</dt><dd>To prevent remote devices to exhaust terminal resources by registering for many notifications, a limit of 256 registrations for all remote devices exists. If this limit is reached new registrations are silently discarded. </dd></dl>
<dl class="section user"><dt></dt><dd></dd></dl>
<dl class="section note"><dt>Note</dt><dd>Remote devices cannot register as an observer for security reasons.</dd></dl>
<h3><a class="anchor" id="subsubsec_ipc_restrict_remote_access"></a>
Restrict remote access</h3>
<p>Basically, notification server uses port <code>5899</code> to listen for incomming connections. Without a configuration file notification server binds the port to local loopback device, which restricts access for local processes only. The existance of a configuration file with a valid white list (see previous chapter) binds the port to any interface. Thus, external clients are able to connect over all available network interfaces, which is the default. Due to security reasons and to restrict access to specific network interfaces only, since ADKIPC 1.28.0 the configuration file was enhanced with new parameter line <code>&lt;interface&gt;</code>. </p><pre class="fragment">interface &lt;interface name&gt;
</pre><p>If specified in the configuration file, notification server creates a separate server instance, which binds port <code>5899</code> to network interface with name or IP address <code>&lt;interface name&gt;</code>. Multiple parameter lines <em>interface</em> will result multiple server instances, each of them responds to the associated network interface for remote access. White list rules <code>[in|out]</code> are applied cross over all these instances. Finally, one additional server instance is created for the local loopback device so that local processes are able to communicate with the outer world.</p>
<p>Example for CM5/M440/M424: </p><pre class="fragment"># allow access for Android over USB network device
interface vfi-terminal

# allow all notifications starting with ext_
in * * EXT_SYS_*
out * * EXT_SYS_*
...
</pre><p> Interface <code>vfi-terminal</code> binds the port <code>5899</code> to interface <code>192.168.2.6</code> (entry in <code>/etc/hosts</code>). This restricts remote access to Android over internal USB network only, thus, connections over other remote network devices are not possible. In addition, the port is bound to local loopback device to allow communication with local Engage processes.</p>
<h3><a class="anchor" id="subsubsec_ipc_remote"></a>
Remote protocol</h3>
<p>When remote access has been enabled, the notification server listens on port 5899 for incoming connections. It sends and receives messages of the following format: </p><pre class="fragment">00 4E 46 59        # Header
&lt;4 bytes size&gt;     # Number of the bytes that follow in this message, ordering is big endian
&lt;message ID&gt;       # Message ID in big endian, currently unused. Ignore when receiving,
                   # set to 00 00 00 00 when sending
&lt;user data&gt;        # JSON encoded user data
</pre><p>Example message: </p><pre class="fragment">00000000  00 4e 46 59 00 00 00 45  00 00 00 00              .NFY...E ....
0000000C  7b 22 6e 6f 74 69 66 69  63 61 74 69 6f 6e 22 3a  {"notifi cation":
0000001C  22 74 65 73 74 22 2c 22  70 72 69 6f 72 69 74 79  "test"," priority
0000002C  22 3a 31 2c 22 74 6f 22  3a 22 78 79 7a 22 2c 22  ":1,"to" :"xyz","
0000003C  74 79 70 65 22 3a 22 72  65 67 69 73 74 65 72 22  type":"r egister"
0000004C  7d                                                }
</pre><p>The JSON data may contain different types of messages. The message type is determined by the "type" member. The following types may be sent to the notification server from a remote client:</p><ul>
<li><b><code> register </code></b> - register for receiving notifications of a specific ID</li>
<li><b><code> unregister </code></b> - remove the registration</li>
<li><b><code> notify </code></b> - send a notification The following types are sent by notification server to remote clients:</li>
<li><b><code> notify </code></b> - notification</li>
<li><b><code> unicast_error </code></b> - error message in case a notification cannot be delivered</li>
</ul>
<p>Unknown message types should be ignored by the remote client to allow for extensions of the protocol.</p>
<p>The different messages contain the following additional data:<br  />
<br  />
<b><code>register:</code></b> </p><table class="doxtable">
<tr>
<th>JSON member</th><th>Description </th></tr>
<tr>
<td><code>to</code> </td><td>receiver ID of the registration </td></tr>
<tr>
<td><code>notification</code> </td><td>notification ID </td></tr>
<tr>
<td><code>priority</code> </td><td>priority </td></tr>
</table>
<p><b><code> unregister:</code></b> </p><table class="doxtable">
<tr>
<th>JSON member</th><th>Description </th></tr>
<tr>
<td><code>to</code> </td><td>receiver ID of the registration </td></tr>
<tr>
<td><code>notification</code> </td><td>notification ID </td></tr>
</table>
<p><b><code> notify:</code></b> </p><table class="doxtable">
<tr>
<th>JSON member</th><th>Description </th></tr>
<tr>
<td><code>from</code> </td><td>sender ID </td></tr>
<tr>
<td><code>to</code> </td><td>receiver ID </td></tr>
<tr>
<td><code>notification</code> </td><td>notification ID </td></tr>
<tr>
<td><code>flags</code> </td><td>flags </td></tr>
<tr>
<td><code>reference</code> </td><td>reference for internal use, ignore </td></tr>
<tr>
<td><code>parameter</code> </td><td>JSON user data (<code>param</code> of ipcNotify) </td></tr>
</table>
<p><b><code> unicast_error:</code></b> </p><table class="doxtable">
<tr>
<th>JSON member</th><th>Description </th></tr>
<tr>
<td><code>from</code> </td><td>sender ID </td></tr>
<tr>
<td><code>to</code> </td><td>receiver ID </td></tr>
<tr>
<td><code>notification</code> </td><td>notification ID </td></tr>
<tr>
<td><code>flags</code> </td><td>flags </td></tr>
<tr>
<td><code>reference</code> </td><td>reference for internal use, ignore </td></tr>
<tr>
<td><code>parameter</code> </td><td>JSON user data (<code>param</code> of ipcNotify) </td></tr>
</table>
<p>If a remote client sends an unregister message, it may still receive this type of notifications due to race conditions, e.g. if the notification was already queued up in the TCP receive buffer. In this case the remote client must send back the message as is to the notification server so that it may send it to another client or generate a <code>unicast_error</code> message. Failing to do so, notifications may be lost.</p>
<p>When the TCP link is closed, there is a minimal risk of a notification being lost. To reduce this risk, remote clients should keep the link up once established during the whole runtime. If links are to be closed the risk may be reduced by unregistering all notifications and then waiting for about 1s if some notifications are received, and sending them back to the server before closing the connection.</p>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_Compiling_and_Linking"></a>
Compiling and Linking</h1>
<h2><a class="anchor" id="subsec_Compiling_and_Linking"></a>
Compiling and Linking</h2>
<p>When using ADK IPC libraries, the developer has to consider the following settings for compiling and linking:</p>
<ul>
<li>
<b>GCC specific settings for applications:</b> <ol>
<li>
Mandatory flags for GCC compiler and linker (ld):<br  />
 Linking an application with IPC libraries <code>libvfiipc.a</code> or <code>libvfiipc.so</code> requires adding the following flags to the linker command: <div class="fragment"><div class="line">-pthread -lrt</div>
</div><!-- fragment --> This is mandatory, since IPC libraries use POSIX threads and realtime functions. POSIX threads and realtime libraries come along with sysroot of the compiler (SDK). It is recommended to add option <code>-pthread</code> to GCC compiler flags for application, too.  </li>
</ol>
</li>
<li>
<b>Settings for using shared IPC libraries:</b> <ol>
<li>
Mandatory linker settings:<br  />
 For linking the shared library the following linker settings must be added to command line for GCC: <div class="fragment"><div class="line">-L&lt;library path&gt; -lvfiipc</div>
</div><!-- fragment --> For using IPC TLS functions, additionally add the following to linker command line of GCC: <div class="fragment"><div class="line">-L&lt;library path&gt; -lvfiipctls</div>
</div><!-- fragment --> <code>&lt;library</code> <code>path&gt;</code> means the path, where shared library <code>libvfiipc.so</code> and/or <code>libvfiipctls.so</code> are located.  </li>
<li>
Terminal download packages for Fusion (V/OS) and Engage (V/OS 2): <ul>
<li>
<code>dl.libvfiipc-X.X.X-X.tar</code>: IPC library </li>
<li>
<code>dl.libvfiipc-remove-X.X.X-X.tar</code>: Removal package for IPC library </li>
<li>
<code>dl.libvfiipctls-X.X.X-X.tar</code>: IPC TLS library (depending on OpenSSL 1.0.2 used with old OS versions in ADK &lt; 4.10) </li>
<li>
<code>dl.libvfiipctls-ossl3-X.X.X-X.tar</code>: IPC TLS library (depending on OpenSSL 3 used newer newer OS versions in ADK &gt;= 4.10) </li>
<li>
<code>dl.libvfiipctls-remove-X.X.X-X.tar</code>: Removal package for both IPC TLS libraries above </li>
<li>
<code>dl.notifysvc-X.X.X-X.tar</code>: Notification service </li>
<li>
<code>dl.notifysvc-remove-X.X.X-X.tar</code>: Removal package for notification service </li>
</ul>
</li>
<li>
Terminal download packages for (V/OS 3): <ul>
<li>
<code>dl.libvfiipc-X.X.X-X.tgz</code>: IPC library </li>
<li>
<code>dl.libvfiipc-remove-X.X.X-X.tgz</code>: Removal package for IPC library </li>
<li>
<code>dl.libvfiipctls-X.X.X-X.tgz</code>: IPC TLS library (depending on OpenSSL 3, usable with all OS versions) </li>
<li>
<code>dl.libvfiipctls-remove-X.X.X-X.tgz</code>: Removal package for IPC TLS library </li>
<li>
<code>dl.notifysvc-X.X.X-X.tgz</code>: Notification service </li>
<li>
<code>dl.notifysvc-removal-X.X.X-X.tgz</code>: Removal package for notification service </li>
<li>
<code>dl.engine_keyservice-X.X.X-X.tgz</code>: Local keyservice engine library (depending on OpenSSL 3, usable with all OS versions) </li>
<li>
<code>dl.engine_keyservice-remove-X.X.X-X.tgz</code>: Removal package for local keyservice engine library </li>
<li>
<code>dl.engine_keyservice_sdi-X.X.X-X.tgz</code>: Remote keyservice engine library (depending on OpenSSL 3, usable with all OS versions) </li>
<li>
<code>dl.engine_keyservice_sdi-remove-X.X.X-X.tgz</code>: Removal package for remote keyservice engine library </li>
</ul>
</li>
</ol>
</li>
</ul>
<p><em><b>Linking strategy for ADKIPC with other ADK libraries</b></em></p>
<p>Applications should apply one of the following linking strategies:</p><ul>
<li>Dynamic linking with <code>libvfiipc.so</code> and/or <code>libvfiipctls.so</code> (preferred method):<br  />
 It is recommended to link all ADK libraries dymanically using shared objects. In multi-application environments the use of shared objects reduces code size of binaries. In addition, the code section for a shared library is loaded during runtime at once. This will avoid the waste of system memory.</li>
<li>Static linking with <code>libvfiipc.a</code>:<br  />
 For single application environments (e.g. an application without other ADK services) it might be pracitable, if application links all libraries statically. Thus, an application can avoid runtime dependencies and need not to install various download packages the dynamic libraries. In addition, the linker is able to remove unused code parts from static libraries, which might reduce the binary size for this single application. For TLS support, applications additionally must link <code>libvfiipctls</code>. <br  />
<br  />
</li>
</ul>
<h1><a class="anchor" id="sec_ipc_Troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="ipc_logging"></a>
Logging</h2>
<p>Since version 1.9.3 the ADK IPC has added logging support for diagnostics and problem analyses. On all platforms logging messages can be enabled by setting environment variable <code>IPC_LOGMASK</code> and/or <code>NFY_LOGMASK</code>. Variable <code>IPC_LOGMASK</code> enables logging messages for IPC layer, whereas variable <code>NFY_LOGMASK</code> will output logging messages generated by notification clients and the server. Both variables are defined as a bitmask consisting of following decimal values: </p><pre class="fragment">1   = LOG_EMERG:   log messages for conditions, if system is unusable
2   = LOG_ALERT:   log messages, which action must be taken immediately
4   = LOG_CRIT:    log messages for critical conditions
8   = LOG_ERR:     log messages for error conditions
16  = LOG_WARNING: log messages for warning conditions
32  = LOG_NOTICE:  log messages for normal but significant conditions
64  = LOG_INFO:    log messages with informational contents
128 = LOG_DEBUG:   log debug-level messages
</pre><p><code>LOG_EMERG</code> represents the lowest logging level, which only generates messages, if the IPC or notification component cannot be started or is not working at all. The highest level <code>LOG_DEBUG</code> will produce many messages of low-level I/O routines and should only be enabled for debugging purposes. For first analyses it is recommended to set <code>LOG_ERR</code>, which will provide information about error conditions, e.g. communication problems.</p>
<p>The environment variables <code>IPC_LOGMASK</code> and <code>NFY_LOGMASK</code> are applied for the following IPC components:</p><ul>
<li>libvfiipc.so (IPC shared library)</li>
<li>libvfiipc.a (IPC static library)</li>
<li>notifysvc (IPC notification service)</li>
</ul>
<p>Since version 1.27.0 the environment variable <code>IPCTLS_LOGMASK</code> was introduced and is applied for the following IPC components:</p><ul>
<li>libvfiipctls.so (IPC TLS shared library)</li>
<li>libvfiipctls.a (IPC TLS static library)</li>
</ul>
<p>Previous ADKIPC versions used <code>IPC_LOGMASK</code> to enable logging for TLS libraries.</p>
<p>For each platform, IPC components use different defaults for environment varialbes <code>*_LOGMASK</code> and also the output channels depend on the used operating system:</p>
<ul>
<li>Fusion (V/OS), Engage (V/OS 2) and V/OS 3<br  />
 On Fusion (V/OS), Engage (V/OS 2) and V/OS 3 the default value for environment varialbes <code>*_LOGMASK</code> is <code>0</code>, which means that no logging outputs are activated by default. Logging messages are directly redirected to stderr of the applications console. Depending on device the system console outputs are activated differently (e.g. on MX9 press key combination 3-5-7 at terminal startup). Since there is no possibility to set environment variables for applications with sysmode, variables <code>*_LOGMASK</code> can be either set for IPC libraries with <code>setenv()</code> from inside application at startup or they can be added to start file of V/OS installation package as follows:<br  />
<pre class="fragment">IPC_LOGMASK=64 ipc_app </pre> (V/OS startup file example)<br  />
<br  />
</li>
<li>Android<br  />
 On Android the default value for environment variables <code>*_LOGMASK</code> is <code>255</code> and by default all logging messages are forwarded to Android Logging API. Once <code>libvfilog</code> is installed and found on the system, environment variables <code>*_LOGMASK</code> are set to <code>0</code>, which disables Android Logging API. From that point ADKLOG (see Support for ADKLOG below) is used as primary logging channel. If an application now sets one of environment variables <code>*_LOGMASK</code> with <code>setenv()</code> at startup both, Android Logging API and ADKLOG are disabled and logging messages are forwarded to stderr as on other platforms. Finally, filtering for the logging messages is applied according logging masks provided by values of these variables.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If all environment variables <code>IPC_LOGMASK</code>, <code>NFY_LOGMASK</code> and <code>IPCTLS_LOGMASK</code> are unset, IPC components will use ADKLOG library, if it is installed on the system. For more details, please refer to chapter below.</dd></dl>
<p>A logging message consists of several fields and the content is similar on the several platforms:</p>
<p><b>Fusion (V/OS), Engage (V/OS 2) and V/OS 3</b>:</p>
<p>A console logging message on these platforms consist of the following fields:</p>
<div class="image">
<img src="ipc_logging_vos.png" alt=""/>
</div>
 <p>1) <em>timestamp:</em> <br  />
The timestamp format is <code>&lt;seconds&gt;</code>.<code>&lt;milliseconds&gt;</code>. The value represents the time since beginning of capture (startup or first usage of IPC component).</p>
<p>2) <em>log</em> <em>prefix</em>, <em>log</em> <em>channel:</em> <br  />
The field <code>log</code> <code>prefix</code> is used to identify ADKIPC as logging source. For identification of the subcomponent the field <code>log</code> <code>channel</code> was introduced to identify logging outputs for the following IPC components:</p>
<ul>
<li><b>IPC:</b> IPC layer</li>
<li><b>NFY:</b> Notification server</li>
<li><b>NFYCL:</b> Notification client</li>
<li><b>IPCTLS:</b> IPCTLS layer</li>
</ul>
<p><br  />
 <b>Android</b>:</p>
<p>A logging message on Android captured with <code>logcat</code> tool coming along with ADB:</p>
<div class="image">
<img src="ipc_logging_android.png" alt=""/>
</div>
 <p>1) <em>time:</em> <br  />
The time format is <code>&lt;hour&gt;:&lt;minute&gt;:&lt;seconds&gt;.&lt;milliseconds&gt;</code></p>
<p>2) <em>log</em> <em>level</em> IPC logging levels are mapped to Android logging levels as follows: </p><table class="doxtable">
<tr>
<th>IPC logging level</th><th>Android logging level</th><th>Description </th></tr>
<tr>
<td><code>LOG_EMERG</code></td><td><code>A</code></td><td>Assert </td></tr>
<tr>
<td><code>LOG_ALERT</code></td><td><code>A</code></td><td>Assert </td></tr>
<tr>
<td><code>LOG_CRIT</code></td><td><code>E</code></td><td>Error </td></tr>
<tr>
<td><code>LOG_ERR</code></td><td><code>E</code></td><td>Error </td></tr>
<tr>
<td><code>LOG_WARNING</code></td><td><code>W</code></td><td>Warning </td></tr>
<tr>
<td><code>LOG_NOTICE</code></td><td><code>I</code></td><td>Info </td></tr>
<tr>
<td><code>LOG_INFO</code></td><td><code>I</code></td><td>Info </td></tr>
<tr>
<td><code>LOG_DEBUG</code></td><td><code>V</code></td><td>Verbose </td></tr>
</table>
<p>3) <em>log</em> <em>channel:</em> <br  />
Same logging channels as used for Fusion (V/OS), Engage (V/OS 2) and V/OS 3</p>
<p><br  />
<br  />
 <b>Support for ADKLOG: Logging with liblog library</b></p>
<p>Since version 1.9.3 the ADK IPC has added support for ADKLOG component. With ADKLOG a new ADK logging concept was implemented, which provides the Logging Control Panel (LCP) used as central instance to configure and enable logging for the several ADK components. For this, LCP uses configuration files (for IPC and notification layer), which are read by <code>liblog</code> library. If installed on the system and environment variables <code>IPC_LOGMASK</code>, <code>NFY_LOGMASK</code> and <code>IPCTLS_LOGMASK</code> are not set, ADKLOG library <code>liblog</code> will be used by ADKIPC libraries to output logging messages. In this case, the logging messages are passed to ADKLOG library instead of using IPC logging methods as described above.</p>
<dl class="section note"><dt>Note</dt><dd>On Android ADKLOG library is provided with <code>libvfilog</code>.</dd></dl>
<p>In order to lookup the corresponding configuration files, ADKLOG uses component identifiers, which are reserved for each ADK component. ADKIPC uses the following:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component ID </th><th class="markdownTableHeadNone">Configuration file </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>IPC</code>  </td><td class="markdownTableBodyNone"><code>IPC_log.conf</code>  </td><td class="markdownTableBodyNone">IPC layer related log settings  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>NFY</code>  </td><td class="markdownTableBodyNone"><code>NFY_log.conf</code>  </td><td class="markdownTableBodyNone">Notification server related log settings  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>NFYCL</code>  </td><td class="markdownTableBodyNone"><code>NFYCL_log.conf</code>  </td><td class="markdownTableBodyNone">Notification client related log settings  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>IPCTLS</code>  </td><td class="markdownTableBodyNone"><code>IPCTLS_log.conf</code>  </td><td class="markdownTableBodyNone">IPCTLS layer related log settings  </td></tr>
</table>
<p>The configuration files contain several settings for logging like output channels, verbosity and a logging mask, which is similar to environment variables <code>*_LOGMASK</code>. For more details about configuration settings or logging message formats, please refer to documentation of ADKLOG project.</p>
<dl class="section note"><dt>Note</dt><dd>If only one of the environment variables <code>*_LOGMASK</code> is set, IPC logging method is preferred and ADKLOG with <code>liblog</code> is disabled. Only if both environment variables are unset, ADKIPC will lookup <code>liblog</code> library from the system to enable logging via ADKLOG.</dd></dl>
<p><br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_ADK_IPC_Demo_Applications"></a>
IPC Demo Applications</h1>
<p>This section contains the distribution package of ADK IPC with a server and client sample application.</p>
<p>The sample application demonstrates the usage of ADK IPC interface and is provided for the two communication variants: Pipe and TCP/IP. Use the instructions for building and downloading a demo application in the enclosed file.</p>
<h2><a class="anchor" id="subsec_ipc_Server_Demo"></a>
Server Demo</h2>
<p>Server demo source: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> response(IPC *r, <span class="keywordtype">int</span> timeout_msec)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if USE_IPC_MESSAGES==1 // use read_msg() and write_msg()</span></div>
<div class="line">   vector&lt;char&gt; buf;</div>
<div class="line">   <span class="keywordtype">int</span> id;</div>
<div class="line">   <span class="keywordtype">bool</span> res;</div>
<div class="line">   res=r-&gt;read_msg(PREFIX,<span class="keywordtype">id</span>,buf,SIZELIMIT,timeout_msec);</div>
<div class="line">   <span class="keywordflow">if</span>(!res) {</div>
<div class="line">      <span class="keywordflow">if</span>(r-&gt;error() || r-&gt;eof()) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read_msg():error=%d,eof=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error(),r-&gt;eof());</div>
<div class="line">         <span class="keywordflow">return</span> -1;</div>
<div class="line">      }</div>
<div class="line">      printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!!read_msg():TIMEOUT !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">   }</div>
<div class="line">   buf.push_back(0);</div>
<div class="line">   printf(<span class="stringliteral">&quot;read_msg() OK: %s\n&quot;</span>,&amp;buf[0]);</div>
<div class="line">   <span class="keywordflow">if</span>(!r-&gt;write_msg(PREFIX,<span class="keywordtype">id</span>,buf)) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! write_msg():error=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error());</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">   }</div>
<div class="line">   printf(<span class="stringliteral">&quot;write done\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else // use low level read()/write()  -&gt; this runs with test/client.sh</span></div>
<div class="line">   <span class="keywordtype">char</span> buf[256];</div>
<div class="line">   <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>=r-&gt;read(buf,<span class="keyword">sizeof</span>(buf)-1,timeout_msec,0);</div>
<div class="line">   <span class="keywordflow">if</span>(<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&lt;=0) {</div>
<div class="line">       <span class="keywordflow">if</span>(r-&gt;error() || r-&gt;eof()) {</div>
<div class="line">          printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read():error=%d,eof=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error(),r-&gt;eof());</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">       }</div>
<div class="line">       printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!!read():TIMEOUT !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">       <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    buf[<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>]=0;</div>
<div class="line">    printf(<span class="stringliteral">&quot;read() OK: %s\n&quot;</span>,buf);</div>
<div class="line">    <span class="keywordflow">if</span>(!r-&gt;write(buf,<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>)) {</div>
<div class="line">       printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! write():error=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error());</div>
<div class="line">       <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if USE_CALLBACK_SERVER==1</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ipc_callback(<span class="keywordtype">void</span> *data, IPC *ipc)</div>
<div class="line">{</div>
<div class="line">  printf(<span class="stringliteral">&quot;ipc_callback() invoked: data available on IPC object %p\n&quot;</span>,ipc);</div>
<div class="line">  <span class="keywordtype">int</span> *callback_done=(<span class="keywordtype">int</span> *)data;</div>
<div class="line">  <span class="keywordtype">int</span> ret=response(ipc,0); <span class="comment">// use a timeout of 0, since available data is notified by this callback</span></div>
<div class="line">  <span class="keywordflow">if</span>(ret&lt;0) *callback_done=1; <span class="comment">// leave loop on error</span></div>
<div class="line">  <span class="keywordflow">if</span>(SINGLE_SHOT_SERVER) *callback_done=1;</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *server(<span class="keywordtype">void</span> *p)</div>
<div class="line">{</div>
<div class="line">   IPC *r=(IPC *)p;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if USE_CALLBACK_SERVER==1</span></div>
<div class="line">   <span class="keywordtype">int</span> callback_done=0;</div>
<div class="line">   <span class="keywordflow">if</span>(!r-&gt;set_callback(ipc_callback,(<span class="keywordtype">void</span> *)&amp;callback_done)) callback_done=1; <span class="comment">// error</span></div>
<div class="line">   <span class="keywordflow">while</span>(!callback_done) sleep(1);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">   <span class="keywordflow">do</span></div>
<div class="line">   {</div>
<div class="line">     <span class="keywordtype">int</span> ret=response(r,2000);</div>
<div class="line">     <span class="keywordflow">if</span>(ret&lt;0) <span class="keywordflow">break</span>; <span class="comment">// leave loop on error</span></div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">while</span>(!SINGLE_SHOT_SERVER);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">   <span class="keyword">delete</span> r; <span class="comment">// closes the session and does not require an explicit call of r-&gt;close()</span></div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">   {</div>
<div class="line">      WSADATA d;</div>
<div class="line">      WSAStartup(MAKEWORD(2,2),&amp;d);</div>
<div class="line">   }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">   printf(<span class="stringliteral">&quot;******************* Demo-Server started *********************\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#if defined USE_TCP</span></div>
<div class="line">   TCP s;</div>
<div class="line">   <span class="keywordflow">if</span>(!s.listen(TCP_PORT,argc&gt;=2 ? argv[1] : 0)) {</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;Failed to listen on %s:%d\n&quot;</span>,argc&gt;=2?argv[1]:<span class="stringliteral">&quot;&quot;</span>,TCP_PORT);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">else</span> fprintf(stderr,<span class="stringliteral">&quot;Listening on %s\n&quot;</span>,s.local_addr());</div>
<div class="line"><span class="preprocessor">#elif defined USE_TLS</span></div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *cafile=0;</div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *cafile2=0;</div>
<div class="line">   <span class="keywordtype">int</span> i;</div>
<div class="line">   <span class="keywordflow">for</span>(i=1;i+1&lt;argc &amp;&amp; argv[i][0]==<span class="charliteral">&#39;-&#39;</span>;i++) {</div>
<div class="line">      <span class="keywordflow">if</span>(!strcmp(argv[i],<span class="stringliteral">&quot;--client-auth&quot;</span>)) cafile=argv[++i];</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i],<span class="stringliteral">&quot;--ca&quot;</span>)) cafile2=argv[++i];</div>
<div class="line">      <span class="keywordflow">else</span> i=argc;</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">if</span>(i&gt;=argc) {</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;Usage: %s [--client-auth &lt;ca-file/ca-dir&gt;] [--ca &lt;ca-file/ca-dir&gt;] &lt;Key-file&gt; [&lt;local-ip&gt;]\n&quot;</span>,argv[0]);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">   }</div>
<div class="line">   TLS s;</div>
<div class="line">   s.setKeyCert(argv[i],argv[i]);</div>
<div class="line">   <span class="keywordflow">if</span>(cafile) {</div>
<div class="line">      <span class="keyword">struct </span>stat sca;</div>
<div class="line">      <span class="keywordflow">if</span>(stat(cafile, &amp;sca)==0 &amp;&amp; S_ISDIR(sca.st_mode)) {</div>
<div class="line">         s.addCA(0,cafile);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">         s.addCA(cafile,0);</div>
<div class="line">      }</div>
<div class="line">      s.setClientAuth(<span class="keyword">true</span>);</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">if</span>(cafile2) {</div>
<div class="line">      <span class="keyword">struct </span>stat sca;</div>
<div class="line">      <span class="keywordflow">if</span>(stat(cafile2, &amp;sca)==0 &amp;&amp; S_ISDIR(sca.st_mode)) {</div>
<div class="line">         s.addCA(0,cafile2);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">         s.addCA(cafile2,0);</div>
<div class="line">      }</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">if</span>(!s.listen(TCP_PORT,i+1&lt;argc ? argv[i+1] : 0)) {</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;Failed to listen on %s:%d\n&quot;</span>,i+1&lt;argc ? argv[i+1]:<span class="stringliteral">&quot;&quot;</span>,TCP_PORT);</div>
<div class="line">      <span class="keywordtype">string</span> es;</div>
<div class="line">      TLS::Error e=s.TLSError(&amp;es);</div>
<div class="line">      fprintf(stderr,<span class="stringliteral">&quot;Error %d: &#39;%s&#39;\n&quot;</span>,e,es.c_str());</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">else</span> fprintf(stderr,<span class="stringliteral">&quot;Listening on %s\n&quot;</span>,s.local_addr());</div>
<div class="line"><span class="preprocessor">#elif !defined _WIN32 // pipe test</span></div>
<div class="line">   Pipe s;</div>
<div class="line">   s.listen(PIPE_NAME);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#error &quot;Pipe not supported on WIN32&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">   <span class="keywordflow">while</span>(1)</div>
<div class="line">   {</div>
<div class="line">      IPC *r=s.accept();</div>
<div class="line">      <span class="keywordflow">if</span>(!r) {</div>
<div class="line"><span class="preprocessor">#ifdef USE_TLS</span></div>
<div class="line">         <span class="keywordtype">string</span> es;</div>
<div class="line">         TLS::Error e=s.TLSError(&amp;es);</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;Error %d: &#39;%s&#39;\n&quot;</span>,e,es.c_str());</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">         <span class="keywordflow">continue</span>;</div>
<div class="line">      }</div>
<div class="line">      printf(<span class="stringliteral">&quot;local: %s\n&quot;</span>,r-&gt;local_addr());</div>
<div class="line">      printf(<span class="stringliteral">&quot;remote: %s\n&quot;</span>,r-&gt;remote_addr());</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span>(SINGLE_THEADED_SERVER) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;Single-threaded server\n&quot;</span>);</div>
<div class="line">         server(r);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">         printf(<span class="stringliteral">&quot;Multi-threaded server\n&quot;</span>);</div>
<div class="line">         pthread_t server_thread;</div>
<div class="line">         pthread_attr_t attr;</div>
<div class="line">         pthread_attr_init(&amp;attr);</div>
<div class="line">         pthread_attr_setdetachstate(&amp;attr,PTHREAD_CREATE_DETACHED);</div>
<div class="line">         pthread_attr_setstacksize(&amp;attr,32*1024); <span class="comment">// use 32 KB as default stack size for session threads</span></div>
<div class="line">         <span class="keywordflow">if</span>(!pthread_create(&amp;server_thread,&amp;attr,server,(<span class="keywordtype">void</span> *)r)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;New session thread with ipc=%lx successfully started\n&quot;</span>,(<span class="keywordtype">long</span>)r);</div>
<div class="line">         } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;!!!!!! Could NOT start session thread with ipc=%lx !!!!!!\n&quot;</span>,(<span class="keywordtype">long</span>)r);</div>
<div class="line">         }</div>
<div class="line">         pthread_attr_destroy(&amp;attr);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// printf(&quot;main() server T%d: heap_current=%d,heap_max=%d,stack_max=%d\n&quot;,pthread_self(),_heap_current(),_heap_max(),_stack_max());</span></div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="subsec_ipc_Client_Demo"></a>
Client Demo</h2>
<p>Client demo source: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> receive(IPC *r, <span class="keywordtype">int</span> timeout_msec)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if USE_IPC_MESSAGES==1 // use read_msg() and write_msg()</span></div>
<div class="line">   vector&lt;char&gt; buf;</div>
<div class="line">   <span class="keywordtype">int</span> id;</div>
<div class="line">   <span class="keywordtype">bool</span> res;</div>
<div class="line">   res=r-&gt;read_msg(PREFIX,<span class="keywordtype">id</span>,buf,SIZELIMIT,timeout_msec);</div>
<div class="line">   <span class="keywordflow">if</span>(!res) {</div>
<div class="line">      <span class="keywordflow">if</span>(r-&gt;error() || r-&gt;eof()) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read_msg():error=%d,eof=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error(),r-&gt;eof());</div>
<div class="line">         <span class="keywordflow">return</span> -1;</div>
<div class="line">      }</div>
<div class="line">      printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read_msg():TIMEOUT !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">   }</div>
<div class="line">   buf.push_back(0);</div>
<div class="line">   printf(<span class="stringliteral">&quot;read_msg() OK: %s\n&quot;</span>,&amp;buf[0]);</div>
<div class="line"><span class="preprocessor">#else // use low level read()/write()</span></div>
<div class="line">   <span class="keywordtype">char</span> peekbuf[256];</div>
<div class="line">   <span class="keywordtype">int</span> peekn=r-&gt;peek(peekbuf,<span class="keyword">sizeof</span>(peekbuf)-1,timeout_msec);</div>
<div class="line">   <span class="keywordtype">char</span> buf[256];</div>
<div class="line">   <span class="keywordtype">int</span> <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>=r-&gt;read(buf,<span class="keyword">sizeof</span>(buf)-1,timeout_msec,0);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span>((peekn&gt;0 &amp;&amp; <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&lt;0) || (peekn&gt;0 &amp;&amp; <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&gt;0 &amp;&amp; memcmp(peekbuf,buf,<a class="code" href="http__get__curl_8c.html#a8195a86b6d75b9a3939505e8bb50021e">std::min</a>(peekn,<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>)))) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! peek() mismatch !!!!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">   } <span class="keywordflow">else</span> {</div>
<div class="line">      printf(<span class="stringliteral">&quot;peek match %d bytes\n&quot;</span>,<a class="code" href="http__get__curl_8c.html#a8195a86b6d75b9a3939505e8bb50021e">std::min</a>(peekn,<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>));</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">if</span>(<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>&lt;=0) {</div>
<div class="line">      <span class="keywordflow">if</span>(r-&gt;error() || r-&gt;eof()) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read():error=%d,eof=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error(),r-&gt;eof());</div>
<div class="line">         <span class="keywordflow">return</span> -1;</div>
<div class="line">      }</div>
<div class="line">      printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! read():TIMEOUT !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">   }</div>
<div class="line">   buf[<a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a>]=0;</div>
<div class="line">   printf(<span class="stringliteral">&quot;read() OK: %s\n&quot;</span>,buf);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">   <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if USE_CALLBACK_CLIENT==1</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ipc_callback(<span class="keywordtype">void</span> *data, IPC *ipc)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> *callback_invoked=(<span class="keywordtype">int</span> *)data;</div>
<div class="line">  printf(<span class="stringliteral">&quot;ipc_callback() invoked: data available on IPC object %p with data=%p\n&quot;</span>,ipc,data);</div>
<div class="line">  *callback_invoked=1;</div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> *client(<span class="keywordtype">void</span> *p)</div>
<div class="line">{</div>
<div class="line">   IPC *r=(IPC *)p;</div>
<div class="line"><span class="preprocessor">#if USE_CALLBACK_CLIENT==1</span></div>
<div class="line">   <span class="keywordtype">int</span> callback_invoked=0;</div>
<div class="line">   <span class="keywordflow">if</span>(!r-&gt;set_callback(ipc_callback,(<span class="keywordtype">void</span> *)&amp;callback_invoked)) {</div>
<div class="line">     printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! set_callback() error !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">     <span class="keywordflow">return</span> 0;</div>
<div class="line">   }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">do</span> {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span> hello[]=<span class="stringliteral">&quot;Hello world!&quot;</span>;</div>
<div class="line"><span class="preprocessor">#if USE_IPC_MESSAGES==1 // use read_msg() and write_msg()</span></div>
<div class="line">      <span class="keywordflow">if</span>(!r-&gt;write_msg(PREFIX,0,hello,strlen(hello))) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! write_msg():error=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error());</div>
<div class="line">         <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keywordflow">if</span>(!r-&gt;write(hello,strlen(hello))) {</div>
<div class="line">         printf(<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! write():error=%d !!!!!!!!!!!!!!!!\n&quot;</span>,r-&gt;error());</div>
<div class="line">         <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">     <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="preprocessor">#if USE_CALLBACK_CLIENT==1</span></div>
<div class="line">     <span class="keywordflow">while</span>(!callback_invoked) {</div>
<div class="line">       printf(<span class="stringliteral">&quot;waiting for callback %p...\n&quot;</span>,ipc_callback);</div>
<div class="line">       usleep(50000); <span class="comment">// 50ms</span></div>
<div class="line">     }</div>
<div class="line">     ret=receive(r,0); <span class="comment">// use a timeout of 0, since available data is notified by this callback</span></div>
<div class="line">     r-&gt;set_callback(0); <span class="comment">// protect callback_invoked from subsequent callbacks</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">     ret=receive(r,2000);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">     <span class="keywordflow">if</span>(ret&lt;=0) <span class="keywordflow">break</span>; <span class="comment">// leave loop on error</span></div>
<div class="line">   } <span class="keywordflow">while</span>(!SINGLE_SHOT_CLIENT);</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">   {</div>
<div class="line">      WSADATA d;</div>
<div class="line">      WSAStartup(MAKEWORD(2,2),&amp;d);</div>
<div class="line">   }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">   printf(<span class="stringliteral">&quot;******************* Demo-Client started *********************\n&quot;</span>);</div>
<div class="line">   <span class="keywordflow">do</span> {</div>
<div class="line"><span class="preprocessor">#if defined USE_TCP</span></div>
<div class="line">      <span class="keywordflow">if</span>(argc&gt;3) {</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;Usage: %s [&lt;ip_addr&gt;] [&lt;port&gt;]\n&quot;</span>,argv[0]);</div>
<div class="line">         <span class="keywordflow">return</span> 1;</div>
<div class="line">      }</div>
<div class="line">      TCP s;</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_addr=<span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(argc&gt;=2) ip_addr=argv[1]; <span class="comment">// allow to set IP address via argument list</span></div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port=TCP_PORT;</div>
<div class="line">      <span class="keywordflow">if</span>(argc==3) {</div>
<div class="line">         port=atoi(argv[2]);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">while</span>(!s.connect(ip_addr,port)) {</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! Connect failed !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">         sleep(1);</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#elif defined USE_TLS</span></div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span> *keyfile=0;</div>
<div class="line">      <span class="keywordtype">int</span> i;</div>
<div class="line">      <span class="keywordflow">for</span>(i=1;i+1&lt;argc &amp;&amp; argv[i][0]==<span class="charliteral">&#39;-&#39;</span>;i++) {</div>
<div class="line">         <span class="keywordflow">if</span>(!strcmp(argv[i],<span class="stringliteral">&quot;--key&quot;</span>)) keyfile=argv[++i];</div>
<div class="line">         <span class="keywordflow">else</span> i=argc;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span>(i&gt;=argc) {</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;Usage: %s [--key &lt;Key-file&gt;] &lt;CA-file/CA-dir&gt; [&lt;ip_addr&gt;] [&lt;port&gt;]\n&quot;</span>,argv[0]);</div>
<div class="line">         <span class="keywordflow">return</span> 1;</div>
<div class="line">      }</div>
<div class="line">      TLS s;</div>
<div class="line">      <span class="keywordflow">if</span>(keyfile) s.setKeyCert(keyfile,keyfile);</div>
<div class="line">      <span class="keyword">struct </span>stat sca;</div>
<div class="line">      <span class="keywordflow">if</span>(stat(argv[i], &amp;sca)==0 &amp;&amp; S_ISDIR(sca.st_mode)) {</div>
<div class="line">         s.setCA(0,argv[i]);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">         s.setCA(argv[i],0);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      s.setCheckConfig(TLS::IGNORE_HOSTNAME);</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">char</span> *ip_addr=<span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(i+1&lt;argc) ip_addr=argv[i+1]; <span class="comment">// allow to set IP address via argument list</span></div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port=TCP_PORT;</div>
<div class="line">      <span class="keywordflow">if</span>(i+2&lt;argc) {</div>
<div class="line">         port=atoi(argv[i+2]);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">while</span>(!s.connect(ip_addr,port)) {</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! Connect failed !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">         <span class="keywordtype">string</span> es;</div>
<div class="line">         TLS::Error e=s.TLSError(&amp;es);</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;Error %d: &#39;%s&#39;\n&quot;</span>,e,es.c_str());</div>
<div class="line">         sleep(1);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#elif !defined _WIN32 // pipe test</span></div>
<div class="line">      Pipe s;</div>
<div class="line">      <span class="keywordflow">while</span>(!s.connect(PIPE_NAME)) {</div>
<div class="line">         fprintf(stderr,<span class="stringliteral">&quot;!!!!!!!!!!!!!!!! Connect failed !!!!!!!!!!!!!!!!\n&quot;</span>);</div>
<div class="line">         sleep(1);</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#error &quot;Pipe not supported on WIN32&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      printf(<span class="stringliteral">&quot;local: %s\n&quot;</span>,s.local_addr());</div>
<div class="line">      printf(<span class="stringliteral">&quot;remote: %s\n&quot;</span>,s.remote_addr());</div>
<div class="line">      client(&amp;s); <span class="comment">// fire</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// printf(&quot;main() client T%d: heap_current=%d,heap_max=%d,stack_max=%d\n&quot;,pthread_self(),_heap_current(),_heap_max(),_stack_max());</span></div>
<div class="line">   } <span class="keywordflow">while</span>(!SINGLE_CONNECT_CLIENT);</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> <br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_JSON_Demo_Application"></a>
JSON Demo Application</h1>
<p>The distribution package of ADK IPC contains a JSON sample application. The sample application demonstrates the usage of class JSObject provided by header file <code>jsobject.h</code>. Use the instructions for building and downloading a demo application in the enclosed file.</p>
<p>JSON demo source: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacevfiipc.html">vfiipc</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> filter(<span class="keyword">const</span> std::string &amp;key)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> key==<span class="stringliteral">&quot;Password&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="namespacevfihtml.html#aae7be032793c509f7d46a8e251b0f0e5">JSObject</a> obj;                                <span class="comment">// JavaScript equivalent:</span></div>
<div class="line">   obj(<span class="stringliteral">&quot;float&quot;</span>)=42.5;                          <span class="comment">// obj.number=42</span></div>
<div class="line">   obj(<span class="stringliteral">&quot;intnum&quot;</span>)=42;</div>
<div class="line">   obj(<span class="stringliteral">&quot;string&quot;</span>)=<span class="stringliteral">&quot;Hello world!&quot;</span>;                <span class="comment">// obj.string=&quot;Hello world!&quot;</span></div>
<div class="line">   obj(<span class="stringliteral">&quot;object&quot;</span>)(<span class="stringliteral">&quot;bool&quot;</span>)=<span class="keyword">true</span>;                  <span class="comment">// obj.object.bool=true</span></div>
<div class="line">   obj(<span class="stringliteral">&quot;int64&quot;</span>)=1234567890123456789LL;</div>
<div class="line">   obj(<span class="stringliteral">&quot;array&quot;</span>)[3](<span class="stringliteral">&quot;test&quot;</span>)=3;                   <span class="comment">// obj.array[3].test=3</span></div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;%d\n&quot;</span>,(<span class="keywordtype">int</span>)obj(<span class="stringliteral">&quot;float&quot;</span>));</div>
<div class="line">   printf(<span class="stringliteral">&quot;%.16g\n&quot;</span>,(<span class="keywordtype">float</span>)obj(<span class="stringliteral">&quot;float&quot;</span>));</div>
<div class="line">   printf(<span class="stringliteral">&quot;%d\n&quot;</span>,(<span class="keywordtype">int</span>)obj(<span class="stringliteral">&quot;intnum&quot;</span>));</div>
<div class="line">   printf(<span class="stringliteral">&quot;%.16g\n&quot;</span>,(<span class="keywordtype">float</span>)obj(<span class="stringliteral">&quot;intnum&quot;</span>));</div>
<div class="line">   printf(<span class="stringliteral">&quot;%lld\n&quot;</span>,obj(<span class="stringliteral">&quot;int64&quot;</span>).getInt64());</div>
<div class="line">   printf(<span class="stringliteral">&quot;%d\n&quot;</span>,(<span class="keywordtype">int</span>)obj(<span class="stringliteral">&quot;array&quot;</span>)[3](<span class="stringliteral">&quot;test&quot;</span>));</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">string</span> s2=obj(<span class="stringliteral">&quot;string&quot;</span>);</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,s2.c_str());</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">string</span> s=obj.dump();</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,s.c_str());</div>
<div class="line">   printf(<span class="stringliteral">&quot;%d\n&quot;</span>,(<span class="keywordtype">int</span>)obj.load(s));</div>
<div class="line"> </div>
<div class="line">   s=obj.dump();</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,s.c_str());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">string</span> a=<span class="stringliteral">&quot;1\n2&quot;</span>;</div>
<div class="line">   printf(<span class="stringliteral">&quot;\n%s\n&quot;</span>,a.c_str());</div>
<div class="line">   obj(<span class="stringliteral">&quot;twoline&quot;</span>)=a;</div>
<div class="line">   s=obj.dump();</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,s.c_str());</div>
<div class="line">   obj.load(s);</div>
<div class="line">   a=(string)obj(<span class="stringliteral">&quot;twoline&quot;</span>);</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,a.c_str());</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="namespacevfihtml.html#aae7be032793c509f7d46a8e251b0f0e5">JSObject</a> x;</div>
<div class="line">   <span class="keywordtype">string</span> z=<span class="stringliteral">&quot;abc\n\r\t\&quot;\\hallo&quot;</span>;</div>
<div class="line">   z+=<span class="charliteral">&#39;\000&#39;</span>;</div>
<div class="line">   x(<span class="stringliteral">&quot;foo&quot;</span>)=z;</div>
<div class="line">   <span class="keywordtype">string</span> t=x.dump();</div>
<div class="line">   printf(<span class="stringliteral">&quot;%s\n&quot;</span>,x.dump().c_str());</div>
<div class="line">   assert(t==<span class="stringliteral">&quot;{\&quot;foo\&quot;:\&quot;abc\\n\\r\\t\\\&quot;\\\\hallo\\u0000\&quot;}&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="namespacevfihtml.html#aae7be032793c509f7d46a8e251b0f0e5">JSObject</a> zz;</div>
<div class="line">   zz.<a class="code" href="classvfiipc_1_1_j_s_object.html#a5dc8013bd6fdf9ccb6104890a00094ab">load</a>(<span class="stringliteral">&quot;{\&quot;User\&quot;:\&quot;Testuser\&quot;,\&quot;Password\&quot;:\&quot;Test1234\&quot;}&quot;</span>);</div>
<div class="line">   printf(<span class="stringliteral">&quot;Normal dump: %s\n&quot;</span>,zz.dump().c_str());</div>
<div class="line">   printf(<span class="stringliteral">&quot;Filtered dump: %s\n&quot;</span>,zz.logdump(filter).c_str());</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
</div><!-- fragment --><p> <br  />
<br  />
</p>
<h1><a class="anchor" id="sec_ipc_APPENDIX_A_Glossary"></a>
Appendix A: Glossary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Term </th><th class="markdownTableHeadNone">Definitions  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ADK </td><td class="markdownTableBodyNone">Application Development Kit  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">API </td><td class="markdownTableBodyNone">Application Programming Interface  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DNS </td><td class="markdownTableBodyNone">Domain Name System  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">EOF </td><td class="markdownTableBodyNone">End of File  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GCC </td><td class="markdownTableBodyNone">GNU Compiler Collection  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">I/O </td><td class="markdownTableBodyNone">Input or Output  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IP </td><td class="markdownTableBodyNone">Internet Protocol  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IPC </td><td class="markdownTableBodyNone">Inter Process Communication  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">JSON </td><td class="markdownTableBodyNone">JavaScript Object Notation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OS </td><td class="markdownTableBodyNone">Operating System  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">POSIX </td><td class="markdownTableBodyNone">Portable Operating System Interface based on UNIX  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SDK </td><td class="markdownTableBodyNone">Software Development Kit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STL </td><td class="markdownTableBodyNone">Standard Template Library  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TCP/IP </td><td class="markdownTableBodyNone">Transmission Control Protocol/Internet Protocol  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">V/OS </td><td class="markdownTableBodyNone">Verifone Operating System  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VPN </td><td class="markdownTableBodyNone">Verifone Part Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">XML </td><td class="markdownTableBodyNone">Extensible Markup Language  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ADB </td><td class="markdownTableBodyNone">Android Debug Bridge  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TLS </td><td class="markdownTableBodyNone">Transport Layer Security  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassvfiipc_1_1_j_s_object_html_a5dc8013bd6fdf9ccb6104890a00094ab"><div class="ttname"><a href="classvfiipc_1_1_j_s_object.html#a5dc8013bd6fdf9ccb6104890a00094ab">vfiipc::JSObject::load</a></div><div class="ttdeci">bool load(const std::string &amp;s)</div><div class="ttdef"><b>Definition:</b> jsobject.h:280</div></div>
<div class="ttc" id="anamespacevfiipc_html_a3ad101cda0c973d26791bd8f194d4b80"><div class="ttname"><a href="namespacevfiipc.html#a3ad101cda0c973d26791bd8f194d4b80">vfiipc::ipcNotify</a></div><div class="ttdeci">DllSpec enum NotifyResult ipcNotify(const std::string &amp;to, const std::string &amp;notification_id, const vfiipc::JSObject &amp;param, unsigned flags=0, const std::string &amp;from=&quot;&quot;)</div></div>
<div class="ttc" id="anotify_8h_html"><div class="ttname"><a href="notify_8h.html">notify.h</a></div></div>
<div class="ttc" id="ahttp__get__curl_8c_html_a8195a86b6d75b9a3939505e8bb50021e"><div class="ttname"><a href="http__get__curl_8c.html#a8195a86b6d75b9a3939505e8bb50021e">min</a></div><div class="ttdeci">#define min(X, Y)</div><div class="ttdef"><b>Definition:</b> http_get_curl.c:49</div></div>
<div class="ttc" id="anamespacevfiipc_html"><div class="ttname"><a href="namespacevfiipc.html">vfiipc</a></div><div class="ttdef"><b>Definition:</b> ipc.h:27</div></div>
<div class="ttc" id="anamespacevfiipc_html_a7eda24f6e23d0f36491cc949c16ac4c3"><div class="ttname"><a href="namespacevfiipc.html#a7eda24f6e23d0f36491cc949c16ac4c3">vfiipc::NotifyResult</a></div><div class="ttdeci">NotifyResult</div><div class="ttdef"><b>Definition:</b> notify.h:35</div></div>
<div class="ttc" id="anamespacevfiipc_html_a88455cb389891217791604f188ac0fa5"><div class="ttname"><a href="namespacevfiipc.html#a88455cb389891217791604f188ac0fa5">vfiipc::ipcSetAppID</a></div><div class="ttdeci">DllSpec void ipcSetAppID(const std::string &amp;app_id)</div></div>
<div class="ttc" id="anamespacevfiipc_html_a1862bc6c0fe6d07d60c677292cbc9619"><div class="ttname"><a href="namespacevfiipc.html#a1862bc6c0fe6d07d60c677292cbc9619">vfiipc::ipcNotificationServer</a></div><div class="ttdeci">DllSpec enum NotifyResult ipcNotificationServer()</div></div>
<div class="ttc" id="aclassvfiipc_1_1_j_s_object_html_a535976112a5480b2957b0030cff36b68"><div class="ttname"><a href="classvfiipc_1_1_j_s_object.html#a535976112a5480b2957b0030cff36b68">vfiipc::JSObject::dump</a></div><div class="ttdeci">void dump(std::string &amp;s, bool(*filter_cb)(const std::string &amp;key)) const</div></div>
<div class="ttc" id="aipc_8h_html"><div class="ttname"><a href="ipc_8h.html">ipc.h</a></div></div>
<div class="ttc" id="anamespacevfiipc_html_a625ae82cd0bc99851ccb8a8ffdcaea1e"><div class="ttname"><a href="namespacevfiipc.html#a625ae82cd0bc99851ccb8a8ffdcaea1e">vfiipc::ipcRegisterNotificationCB</a></div><div class="ttdeci">DllSpec enum NotifyResult ipcRegisterNotificationCB(const std::string &amp;notification_id, NotifyCallback cb, void *data, int priority=0, const std::string &amp;to=&quot;&quot;)</div></div>
<div class="ttc" id="anamespacevficom_1_1cmdparam_1_1in_1_1ussd__write_html_a024d40cda59916fb9470299c7338d3e3"><div class="ttname"><a href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">vficom::cmdparam::in::ussd_write::n</a></div><div class="ttdeci">const COM3_DllSpec char n[]</div><div class="ttdoc">integer</div></div>
<div class="ttc" id="anamespacevfihtml_html_aae7be032793c509f7d46a8e251b0f0e5"><div class="ttname"><a href="namespacevfihtml.html#aae7be032793c509f7d46a8e251b0f0e5">vfihtml::JSObject</a></div><div class="ttdeci">vfiipc::JSObject JSObject</div><div class="ttdef"><b>Definition:</b> jsobject.h:12</div></div>
<div class="ttc" id="aclassvfiipc_1_1_j_s_object_html"><div class="ttname"><a href="classvfiipc_1_1_j_s_object.html">vfiipc::JSObject</a></div><div class="ttdef"><b>Definition:</b> jsobject.h:28</div></div>
<div class="ttc" id="anamespacevfiipc_html_ad81e4165dd387a02aacdb8a57c4fdd4f"><div class="ttname"><a href="namespacevfiipc.html#ad81e4165dd387a02aacdb8a57c4fdd4f">vfiipc::ipcCallback</a></div><div class="ttdeci">void(* ipcCallback)(void *data, IPC *ipc)</div><div class="ttdef"><b>Definition:</b> ipc.h:36</div></div>
<div class="ttc" id="anamespacevficom_1_1cmdparam_1_1in_1_1ping_html_ae0d180616fe53dddd61f70c62526b0db"><div class="ttname"><a href="namespacevficom_1_1cmdparam_1_1in_1_1ping.html#ae0d180616fe53dddd61f70c62526b0db">vficom::cmdparam::in::ping::size</a></div><div class="ttdeci">const COM3_DllSpec char size[]</div><div class="ttdoc">integer - [optional] use &quot;size&quot; as number of data bytes to be sent, default 56</div></div>
<div class="ttc" id="amain_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> main.cpp:1237</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li><li class="navelem"><a class="el" href="pg_all_components.html">ADK Components</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:01 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
