<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: VOS3 Architecture Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_vos3_architecture.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">VOS3 Architecture Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_vos3_introduction"></a>
Introduction</h1>
<p>Verifone Operating System 3 (VOS3) is next generation operating system for Verifone Inc Point-of-sales terminal products.</p>
<p>Like VOS2 on Engage product range, the Operating System is based on Embedded Linux and provides support for Verifone Application Development Kit (ADK). To a large extend the provided APIs are compatibility with earlier Engage product range to enable migration and execution of existing applications on the new VOS3 based platforms.</p>
<h1><a class="anchor" id="sec_vos3_hw_and_supported_devices"></a>
Hardware and Supported Devices</h1>
<p>VOS3 is the operating system for the application processor in the system. The application processor drives the display and touch, speaker and communication interfaces such as Wifi, Bluetooth, Cellular modem as well as cabled connections via Ethernet, USB and Serial.</p>
<p>A secure processor is connected with an internal interconnect and handles the touch and physical keypad for secured inputs as well as the card readers for magnetic, contact chip, contactless chip cards and secure access modules (SAM).</p>
<div class="image">
<img src="vos3_hw_conceptual_view.png" alt=""/>
</div>
<p>VOS3 support is currently provided for following Verifone products:</p><ul>
<li>P630 pinpad</li>
<li>M425/M450 multi-lane pinpads</li>
<li>Ux700AIO and Ux700-ML unattended all-in-one and multi-lane products</li>
</ul>
<p>VOS3 support for additional upcoming products is planned.</p>
<h1><a class="anchor" id="sec_vos3_sw_stack_overview"></a>
SW Stack Overview</h1>
<p>The following chart provides an overview on SW components running secure and application processor of the system.</p>
<div class="image">
<img src="vos3_sw_stack.png" alt=""/>
</div>
<h1><a class="anchor" id="vos3_secure_processor"></a>
Secure Processor</h1>
<h2><a class="anchor" id="vos3_secure_processor_boot_loader"></a>
Secure Processor Boot Loader</h2>
<p>The Secure Processor boot loader support loading and authentication of secure processor firmware.</p>
<h2><a class="anchor" id="vos3_secure_processor_firmware"></a>
Secure Processor Firmware</h2>
<p>The secure processor firmware implements secure functions of the system including:</p>
<ul>
<li>system tamper detection and tamper response</li>
<li>key management supporting secure Verifone VRK key loading</li>
<li>extended key management functions for master / session key handling</li>
<li>encryption functions including symmetric 3DES, AES and asymmetric RSA, ECC algorithms</li>
<li>PIN entry and Sensitive data entry on physical keypad and touch-only devices</li>
<li>ISO PIN block generation and encryption</li>
<li>Magstripe Card reading</li>
<li>ICC Contact Chip Card and Secure Access Module (SAM) reading and L1 processing</li>
<li>RFID Contactless Chip Card reading and L1 processing</li>
<li>Secure PIN Transfer from connected companion Verifone Pinpad devices</li>
</ul>
<p>Some additional functions are provided by the Secure processor, such as:</p>
<ul>
<li>non-PIN prompt physical keypad support</li>
<li>Build-in printer support</li>
</ul>
<h1><a class="anchor" id="vos3_application_processor"></a>
Application Processor</h1>
<h2><a class="anchor" id="vos3_application_boot_loader"></a>
Application Boot Loader</h2>
<p>The secure boot mechanism in the application processor runs at system startup and ensures the authenticity and integrity of all firmware and applications. The secure boot in the application processor does not depend on the secure processor. Depending on the underlying HW platform different boot loader concepts are in use.</p>
<h2><a class="anchor" id="vos3_linux_kernel"></a>
Linux Kernel</h2>
<p>The Linux Kernel provides the basic runtime platform for all system services and applications. Applications can use the provided system APIs for typical operations like file input/output, memory management, multi-threading, etc. Although different revisions of the Linux kernel might used on different VOS3 products, the provided Linux APIs are considered stable and typically compatible between different revisions.</p>
<p>Beside this the Linux Operating system provides basic security mechanisms that help to segregate and protect different application resources including files and run process memory. Also some lower-level devices are restricted in access for applications so that applications can use them through provided system services to resource arbitration and integrity when operating with multiple applications on the system.</p>
<h2><a class="anchor" id="vos3_radio_firmware"></a>
Radio Firmware</h2>
<p>Separate firmware is required for Wifi, Bluetooth and cellular networks chips that might be part of the product.</p>
<h2><a class="anchor" id="vos3_system_services"></a>
System Services</h2>
<p>Verifone provides additional system services on top of the Linux Operating System. Typically these services are running in the background and provide services through API libraries to user applications. System Services include:</p>
<ul>
<li><b>Secure Installation Service (INS)</b>: verification, authentication and installation of system and application download package.</li>
<li><b>Compromise Detection Daemon (CDD)</b>: checks system integrity, logs the tamper condition and controls the 24-hour automatic reboot process</li>
<li><b>Communication Daemon (COM)</b>: communication network setup and control for Cellular, Wifi, Ethernet, Bluetooth, USB and Serial based communication channels</li>
<li><b>Secure Data Interface Service (SDI)</b>: access to the secure processor functions including card reading and EMVCo card processing, PIN entry, encryption functions, encryption of card holder data</li>
<li><b>System Property Service (SYSPROP)</b>: global system properties</li>
<li><b>User Interface Services (UI)</b>: HTML based UI rendering, video playback, printer receipt handling, audio support</li>
<li><b>System Downloader (DL)</b>: local system downloader</li>
<li><b>Remote Maintenance Agent (VHQ)</b>: remote system downloader connecting to Verifone VHQ terminal management system</li>
<li><b>Secure Processor Connector</b>: connection to the secure processor</li>
<li><b>CP Proxy</b>: Connection proxy for Verifone CP platform applications</li>
</ul>
<h2><a class="anchor" id="vos3_system_applications_and_control_panels"></a>
System Applications and Control Panels</h2>
<p>Verifone Platform provides several system applications and control Panels:</p>
<ul>
<li><b><a class="el" href="pg_mac_users_guide.html#sec_mac_desktop">Multi-Application Desktop (MAC)</a></b>: application launcher and desktop/switcher, UI resource handler, system status bar and access to control panels</li>
<li><b><a class="el" href="pg_mac_users_guide.html#sec_mac_mcp">MAC Control Panel</a></b>: the application that provides a set of control panels for device administration, configuration, diagnostics:<ul>
<li><b>Communication Control Panel (CCP)</b>: communication network configuration and setup</li>
<li><b>SW Control Panel (SWCP)</b>: local download and installation of SW packages from USB driver or connected host PC</li>
<li><b>Security Control Panel (SCP)</b>: initial key loading, local customer key loading, security status and version display</li>
<li><b>Logging Control Panel (LCP)</b>: system log-level and output configuration</li>
<li><b>Power Control Panel</b>: putting device to sleep, reboot or turn off</li>
<li><b>Diagnostics Control Panel</b>: contains system diagnostics tools such as Card read diagnostics, Display diagnostics</li>
<li><b>System Settings and Date/Time settings panels</b>: to set display, audio, date, time, timezone etc.</li>
</ul>
</li>
<li><b>CP Downloader</b>: local download application for Verifone CP platform applications, e.g. alternate payment methods (APM)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>the full list of MAC Control Panels is described in the <a class="el" href="pg_mac_users_guide.html#sec_mac_mcp">MAC Control Panel</a> chapter.</dd></dl>
<h2><a class="anchor" id="vos3_verifone_adk_programming_apis"></a>
Verifone ADK Programming APIs</h2>
<p>The Verifone Application Development Kit (ADK) programming APIs is a set of libraries and header files that extend the basic Linux operating system APIs with specific functions implemented in the secure processor firmware or the system services explained above. The APIs are provided to application programmers as part of the system development kit together with development tools.</p>
<p>Refer to the <a class="el" href="pg_all_components.html">ADK Components</a> for detailed description of ADK.</p>
<h2><a class="anchor" id="vos3_user_applications"></a>
User Applications</h2>
<p>User applications implement customer front-end and payment schemes on the POS terminal. They make use of the provided platform services and APIs through the Linux APIs or the Verifone ADK programming interfaces. Typically applications are sand-boxed with separate users and home directories to allow for multiple application installation and concurrent execution.</p>
<h1><a class="anchor" id="vos3_system_protection"></a>
System Protection</h1>
<h2><a class="anchor" id="vos3_domain_separation"></a>
Domain Separation</h2>
<p>The dual-processor system architecture enforces the physical and logical separation of secure processor functions and assets (PIN, plaintext keys) that require the highest level of protection. In addition, the operating system running on the application processor is configured to implement privilege separation, so that the security impact of the entire application processor system is minimized if any single component is compromised.</p>
<h2><a class="anchor" id="vos3_secure_boot_and_system_verification"></a>
Secure Boot and System Verification</h2>
<p>All images up to and including the application boot loader image are verified as part of secure boot using cryptographic authentication. The Linux kernel image and initramfs are verified as part of secure boot. User space software, including applications, is verified by the Verifier module using cryptographic authentication. The Compromise Detection Daemon verifies that the device is not tampered and triggers a 24-hour reset at an user programmable time. Reset is also triggered when a tamper is detected when the device is operation. Files and other resources are protected for application separation using a system based on Linux discretionary-access-control (DAC) and capabilities.</p>
<h2><a class="anchor" id="vos3_tamper_state"></a>
Tamper State</h2>
<p>When a physical tamper is detected or a logical security alert is found, the device gets into a tamper state.</p>
<p>In tamper state the device will boot into the "Tamper state" indicate banner, and then provides access to the MAC desktop where the user can access the Security Panel and tamper log that provides details on the specific tamper condition. Upon tamper the internal system key gets deleted and all installed warrantied and customer keys are getting invalidated. Also some security functions will be blocked from further usage.</p>
<p>The tamper condition can only be erased by connecting the device to a trusted Key loading device and reloading the warrantied keys to the system.</p>
<h1><a class="anchor" id="vos3_system_lifecycle_modes_device_states"></a>
System Lifecycle, Modes and Device States</h1>
<p>Verifone provides system users with following device modes:</p>
<ul>
<li>PRODUCTION mode</li>
<li>APPLICATION DEVELOPMENT mode</li>
</ul>
<p>Production mode is meant for operational usage of the device. In this mode all security provisions are fully enabled.</p>
<p>Refer to the <a class="el" href="pg_system_lifecycle.html">System Lifecycle</a> for more details.</p>
<h1><a class="anchor" id="vos3_system_startup_process"></a>
System Startup Process</h1>
<p>System startup goes through multiple layers including boot loader, system verification before the system launcher starts up the system services and the multi-application controller (MAC).</p>
<p>User applications get started by the system launcher checking authenticity and permissions on behalf of the MAC manifest and the provided application manifest.</p>
<p>If no signing sponsor is found, the system will automatically enable the system downloader.</p>
<p>Once started the MAC desktop can be used for getting access to system control panels.</p>
<h1><a class="anchor" id="vos3_file_system_partitions"></a>
File System Partitions</h1>
<h2><a class="anchor" id="vos3_ab_update_concept"></a>
A/B Update Concept</h2>
<p>The "A/B update" enables seamless updates and relies on having two images during update:</p>
<ul>
<li>image A: Active image</li>
<li>image B: Installation image</li>
</ul>
<p>Note that images may share a single file system partition for efficiency reasons.</p>
<p>The installation procedure comprises following steps:</p>
<ul>
<li>The active image (partition A) is running and installation is done by modifying the Installation image (partition B).</li>
<li>When the installation is finished, the boot loader is told to switch the boot partition from A to B thus the "Installation image" to become the "Active image".</li>
<li>On next reboot, active image is on partition B.</li>
<li>On next installation, partition A is used for installation of new image.</li>
</ul>
<h2><a class="anchor" id="vos3_system_partitions_and_file_system_layout"></a>
System Partitions and File System Layout</h2>
<p>The system flash memory is partitioned into according to the following table:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Partitions </th><th class="markdownTableHeadNone">Contents </th><th class="markdownTableHeadNone">Access </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">aboot, abootbak </td><td class="markdownTableBodyNone">- Boot Loader </td><td class="markdownTableBodyNone">Read-only </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">kernelfs_a, kernelfs_b </td><td class="markdownTableBodyNone">- Linux Kernel and Startup System </td><td class="markdownTableBodyNone">Read-only </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rootfs </td><td class="markdownTableBodyNone">- System Libraries and System Applications /n - System resources: fonts, images (Not executable) /n - User Application binaries /n - User Application resources: fonts, images (non-executable) </td><td class="markdownTableBodyNone">Read-only </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">sysdata </td><td class="markdownTableBodyNone">- System configuration A/B /n - System Runtime Data /n - System Logs </td><td class="markdownTableBodyNone">Read/Write </td><td class="markdownTableBodyNone">- managed by system  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">appdata </td><td class="markdownTableBodyNone">- Application configuration A/B /n - Application Logs /n - Application runtime data /n - Download Area </td><td class="markdownTableBodyNone">Read/Write </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">persist </td><td class="markdownTableBodyNone">- Warrantied Keys /n - Keystore /n - Certstore </td><td class="markdownTableBodyNone">Read/Write </td><td class="markdownTableBodyNone">- managed by system /n - not deleted during updates  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">devinfo </td><td class="markdownTableBodyNone">- Device info /n - Device mode token </td><td class="markdownTableBodyNone">Read-only </td><td class="markdownTableBodyNone">- manged by system  </td></tr>
</table>
<h1><a class="anchor" id="vos3_app_users_and_home_directories"></a>
Application Users and Home Directories</h1>
<h2><a class="anchor" id="vos3_app_and_sys_users"></a>
Application and System Users</h2>
<p>Similar to VOS1/VOS2, application are running under predefined users named usr&lt;X&gt; where &lt;X&gt; is 1 to 16 typically. Applications will be executed under these user privileges and use home directories assigned to these users. Application Users will be automatically created upon installation of user signed packages. Besides this the system has pre-defined users for system and root.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">User </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">usr&lt;X&gt; (1-16) </td><td class="markdownTableBodyNone">MAC user applications / libraries and RO resources  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">sys_&lt;&gt; </td><td class="markdownTableBodyNone">System daemons, libraries and applications  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">root </td><td class="markdownTableBodyNone">root user for system  </td></tr>
</table>
<h2><a class="anchor" id="vos3_user_home_directories"></a>
User Home Directories</h2>
<p>Each user gets assigned a home directory with the following structure:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a class="el" href="class_directory.html">Directory</a> </th><th class="markdownTableHeadNone">Type </th><th class="markdownTableHeadNone">Partition </th><th class="markdownTableHeadNone">Location </th><th class="markdownTableHeadNone">Notes </th><th class="markdownTableHeadNone">A/B support  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">~/(home) </td><td class="markdownTableBodyNone">dir </td><td class="markdownTableBodyNone">rootfs </td><td class="markdownTableBodyNone">/home/usr&lt;X&gt; </td><td class="markdownTableBodyNone">user home folder </td><td class="markdownTableBodyNone">Y  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">~/versioned_data </td><td class="markdownTableBodyNone">symlink </td><td class="markdownTableBodyNone">appdata </td><td class="markdownTableBodyNone">/mnt/appdata/versioned/usr&lt;X&gt; </td><td class="markdownTableBodyNone">storage for versioned application data </td><td class="markdownTableBodyNone">Y  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">~/flash </td><td class="markdownTableBodyNone">symlink </td><td class="markdownTableBodyNone">appdata </td><td class="markdownTableBodyNone">/mnt/appdata/data/usr&lt;X&gt; </td><td class="markdownTableBodyNone">storage for application persistent data </td><td class="markdownTableBodyNone">N  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">~/logs </td><td class="markdownTableBodyNone">symlink </td><td class="markdownTableBodyNone">appdata </td><td class="markdownTableBodyNone">/mnt/appdata/logs/usr&lt;X&gt; </td><td class="markdownTableBodyNone">application logs </td><td class="markdownTableBodyNone">N  </td></tr>
</table>
<h2><a class="anchor" id="vos3_app_permissions_and_capabilities"></a>
Application Permissions and Capabilities</h2>
<p>By default applications have limited set of permissions for accessing certain system resources.</p>
<p>A predefined set of Linux capabilities is assigned to application users covering the typical use cases for applications.</p>
<p>Other system resources can be accessed through provided system services.</p>
<h1><a class="anchor" id="vos3_packages_and_installation"></a>
Packages and Installation</h1>
<p>VOS3 supports authenticated firmware and application updates. Update artifacts are special package files named DLfiles (tar archives), which contain compressed bundles along with the necessary options and meta-information to perform the installation on the system and digital signatures for authentication. The update mechanism is highly flexible and operates at file level, allowing the efficient distribution of patches or partial system updates.</p>
<p>VOS3 introduces a new package format. Packages are getting signed using the <a class="el" href="pg_package_signing.html#subsec_package_signing_fsp">Verifone File Signing Portal</a>.</p>
<h2><a class="anchor" id="vos3_download_files"></a>
Download Files</h2>
<p>Update artifacts (DL-Files) are special package files packaged as tar archives, which contain compressed bundles along necessary options and meta-information to perform the installation on to the system. Bundles contain a digital signature included as a detached CMS file that is used to verify their authenticity. Download files are the container for any VOS3 software update.</p>
<p>These files are actually being downloaded and processed by the system installer.</p>
<p>A download file (DL-File) may contain:</p>
<ul>
<li>System software binaries, configuration, resource and data files</li>
<li>Application software binaries, configuration, resource and data files</li>
<li>Secure Processor Firmware</li>
<li>Radio Module Firmware</li>
<li>VRK Key Loading Packages</li>
<li>etc.</li>
</ul>
<p>The DL-File is structured internally as per the following chart:</p>
<p>A secure processor is connected with an internal interconnect and handles the touch and physical keypad for secured inputs as well as the card readers for magnetic, contact chip, contactless chip cards and secure access modules (SAM).</p>
<div class="image">
<img src="vos3_dl_file_structure.png" alt=""/>
</div>
<p>The outer <b>DL-File</b> is a TAR archive (not compressed) in order to access its content randomly in-place. As a result, to keep minimal size, all internal files are compressed (except signatures). The order of archives (changeset data and bundle info) within a dlfile is not relevant to the installation. However for ease of manipulation / display, it is recommended to use alphabetic ordering sequence within the dlfile archive.</p>
<p>Multiple <b>bundles</b> can be packaged within a DL-File. Each bundle withing the DL-File will consist of:</p>
<ul>
<li>ChangeSet Data - compressed TGZ archive</li>
<li>Bundle Information - compressed TGZ archive</li>
</ul>
<p>The <b>ChangeSet Data</b> archive is sub-structured by packages as grouping mechanism and contains:</p>
<ul>
<li>the actual folders and files to be installed</li>
</ul>
<p>The <b>Bundle Information</b> archive contains:</p>
<ul>
<li>Changeset JSON file</li>
<li>Manifest JSON file</li>
<li>Manifest Signatures in CMS format</li>
</ul>
<p><b>Changeset JSON Files</b> contains changeset instructions for using the changeset data archive content against the <b>source</b> content existing on the device to change it to the <b>destination</b> contents. This file is not signed.</p>
<p><b>Manifest JSON Files</b> describe the bundle changeset data and contains digests / hashes for authentication of each and every file in the change set. Two signatures are applied to authenticate the content of the manifest file.</p>
<dl class="section note"><dt>Note</dt><dd>The <b><a class="el" href="packman_users_guide.html">packman</a></b> tool is provided to largely simplify and automate creation of VOS3 DL files, manifests and contained contents.</dd></dl>
<h2><a class="anchor" id="vos3_differential_download_files"></a>
Differential Download Files</h2>
<p>Differential download files can be built <b>without resigning</b> from two release versions performing a diff between the two.</p>
<p>The DL-File will only contain the differentials and the target manifest and its signatures.</p>
<p>Once downloaded to the system, the system will apply the patches and authenticate and check the resulting binaries based on the provided target manifest and its signatures.</p>
<h2><a class="anchor" id="vos3_user_package_types"></a>
User Package Types</h2>
<p>Users need to package the applications according to VOS3 installation rules and choose a proper VOS3 package type, one of:</p>
<ul>
<li><b>user_ro</b>: read-only application executable, libraries and data</li>
<li><b>font_ro</b>: read-only user fonts (in addition to system provided fonts)</li>
<li><b>versioned_data</b>: private application configuration and assets</li>
<li><b>share_users_versioned_data</b>: shared data between usr&lt;X&gt;</li>
<li><b>data</b>: application runtime data</li>
<li><b>unsigned_data</b>: unsigned application runtime data</li>
<li><b>user_hook</b>: user application plugin to modify RW user data or versioned data</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Additional VOS3 system package types are provided for system usage only.</dd></dl>
<h2><a class="anchor" id="vos3_downloads"></a>
Downloads</h2>
<p>Updates can be installed manually through USB/SD or netloader tool from a connected host PC, or distributed remotely using the terminal management system (e.g., Verifone VHQ) using TLS as security protocol.</p>
<h2><a class="anchor" id="vos3_secure_installer"></a>
Secure Installer</h2>
<p>VOS3 supports authenticated firmware and application updates. Update artifacts are special package files named DLfiles (tar archives), which contain compressed bundles along with the necessary options and meta-information to perform the installation on the system and digital signatures for authentication. The update mechanism is highly flexible and operates at file level, allowing the efficient distribution of patches or partial system updates.</p>
<p>The update mechanism is handled by the privileged <b>Installer</b> component, which is responsible for the following:</p>
<ul>
<li>Installing system updates and application software and other files in the read-only file-system (RootFS)</li>
<li>Installing updates of low-level FW (boot.img including Linux kernel, DTB, and initramfs), application boot loader, radio FW, secure processor updates, etc</li>
<li>Installation APIs for applications.</li>
</ul>
<p>The installation mechanism implemented in the current firmware version is non-A/B, which means that there is a single active image that it is overwritten during the installation process. This mechanism will evolve in the future to a fully A/B redundant system, where updates will be performed on the inactive image and the active image will only be changed until the successful booting of the updated image.</p>
<h2><a class="anchor" id="vos3_authentication"></a>
Authentication</h2>
<p>Authenticity checks are performed at the bundle level. The digital signature is applied to the "manifest.json" file, which is verified by the Installer so that installation will be performed only if the verification is successful. The manifest file contains the hashes of all items within the bundle, so the verification process includes the check of all these hashes as well, and the installation will fail if any of these checks is not successful. This process is the same one as that carried out by the Verifier on every boot.</p>
<p>The signature is provided in a detached CMS file. Actually, the signing system creates two signatures: manifest.json.1.cms and manifest.json.2.cms. The first is an ECDSA signature (ECDSA P-521) and the second one is a PKCS #1 v1.5 RSA signature. The Installer and Verifier only verify the first one (ECDSA) on the current firmware release.</p>
<h2><a class="anchor" id="vos3_anti_rollback_protection"></a>
Anti-rollback Protection</h2>
<p>The installer includes a rollback protection mechanism that works at the bundle level , for system bundles only, that can be used to prevent downgrades when vulnerability patches have been applied. The anti-rollback protection is based on the use of security counters for the system bundles that require the rollback protection.</p>
<h2><a class="anchor" id="vos3_signing"></a>
Signing</h2>
<p>All executable files must be signed through the Verifone Signing Portal. The signing portals provide user management, auditability, and dual control for sensitive functions including user management and approver tasks for signing files. Customers shall follow and enrollment process to get the access to the signing portal. Every customer has assigned an unique identifier, the sponsor identifier, and one or a set of signing products that optionally allow separation between their applications.</p>
<h2><a class="anchor" id="vos3_signing_sponsor"></a>
Signing Sponsor</h2>
<p>It is important to note that the devices are locked to a specific sponsor on the first software update operation using their sponsor-specific signed code. Therefore, the device will not accept software updates from software signed using different sponsors.</p>
<p>VOS3 supports the same same owner/sponsor concept as on earlier systems. A VOS3 device is owned by a single application sponsor used for signing.</p>
<p>The sponsor signing certificate gets loaded onto a fresh device and locks the device to the given sponsor designated by the certificate. The 8-digit sponsor ID is taken from the serial number of the loaded sponsor signing certificate and stored in the system. Any further installation will check if the signing certificate in the signed application package matches the installed sponsor ID in the device.</p>
<p>Resetting he sponsor ID is only possible with a special sponsor removal package signed with the currently installed sponsor certificate.</p>
<dl class="section note"><dt>Note</dt><dd>The more detailed information about the VOS3 packaging and signing is described in the chapter pg_vos3_packaging_and_signing "VOS3 Packaging and Signing".</dd></dl>
<h1><a class="anchor" id="vos3_security_functions"></a>
Security Functions</h1>
<p>The following table summarizes the PCI-POI relevant security functions:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Security Function </th><th class="markdownTableHeadNone">Support  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PIN Support </td><td class="markdownTableBodyNone">- Online PIN blocks: /n - ISO 9564 Format 0. /n - ISO 9564 Format 1. /n - ISO 9564 Format 3. /n - ISO 9564 Format 4 (AES only). /n - AS 2805 6.2 (based on ISO Format 1, but with a second encryption using a value derived from card data) /n - Offline PIN blocks: /n - ISO 9564 Format 2. /n - The Entered PIN length must be between (and including) 4 to 12 digits.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Key Management - Online PIN Encryption </td><td class="markdownTableBodyNone">- TDEA - DUKPT /n - TDEA - MK/SK /n - AES - DUKPT /n - AES - MK/SK /n - Other acquirer-specific schemes via Verifone Customizable Cryptographic Interface (VCCI) scripting  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Offline PIN </td><td class="markdownTableBodyNone">- Plaintext offline Pin for EMV Contact /n - Enciphered offline Pin for EMV CT and CTLS  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Key Management - Account Data Encryption </td><td class="markdownTableBodyNone">- TDEA - DUKPT /n - TDEA - MK/SK (3TDEA only) /n - AES - DUKPT /n - AES - MK/SK /n - Format-Preserving Encryption FF2.1  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Key Loading </td><td class="markdownTableBodyNone">- Remote loading of keys using Verishield Remote Key Loading protocol (VRK)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Key Types </td><td class="markdownTableBodyNone">- TDEA: 112, 168 /n - AES: 128, 192, 256 /n - RSA-2048  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PIN Entry Technology </td><td class="markdownTableBodyNone">- Physical (Hard) Keys: P630 /n - Touch: UX700, V640m, V660p  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Prompt Control </td><td class="markdownTableBodyNone">- Acquirer-controlled  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SRED </td><td class="markdownTableBodyNone">- ADE /n - VSP/VCL  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Other Functions Provided </td><td class="markdownTableBodyNone">- OP (application processor side) /n - Secure Pairing for PIN transfer  </td></tr>
</table>
<h2><a class="anchor" id="vos3_key_storage"></a>
Key Storage</h2>
<p>In general VOS3 is not limited on number of supported keys. Keys are stored in a database and are encrypted with the internal key of the secure processor.</p>
<p>Keys are identified by a unique name across all loaded keys including pre-loaded warrantied keys. The key name is provided as an attribute in the VRK key payload.</p>
<p>The key database gets invalidated upon tamper.</p>
<h2><a class="anchor" id="vos3_key_loading"></a>
Key Loading</h2>
<p>VOS3 supports (remote) key loading using Verifone Remote Key (VRK) Loading method.</p>
<h2><a class="anchor" id="vos3_customizations"></a>
Customizations</h2>
<p>The VOS3 system allows for extensions through system provided plug-ins for custom key derivation.</p>
<p>Verifone supports this development together with application writers.</p>
<h1><a class="anchor" id="vos3_connectivity_functions"></a>
Connectivity Functions</h1>
<table class="doxtable">
<tr>
<th>Connectivity Function</th><th>Support </th></tr>
<tr>
<td>Serial / RS232 </td><td><ul>
<li>
Raw serial </li>
<li>
PPP support </li>
</ul>
</td></tr>
<tr>
<td>USB </td><td><ul>
<li>
USB Host - Classes <ul>
<li>
Mass storage (MSC) - e.g. USB stick </li>
<li>
Human Interface Device (HID) - e.g. Barcode scanner, Keyboard </li>
<li>
Custom Device - e.g. Ethernet or Serial Dongle with driver support </li>
</ul>
</li>
</ul>
<ul>
<li>
USB Device - Classes <ul>
<li>
Communications Device (CDC) <ul>
<li>
ACM - Serial emulation on USB, optional PPP </li>
<li>
RNDIS - Windows Ethernet Gadget </li>
<li>
ECM - Linux Ethernet Gadget </li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>Ethernet </td><td><ul>
<li>
802.1x authentication for wired networks <ul>
<li>
various EAP modes </li>
<li>
pre-loaded AuthN warrantied key </li>
<li>
customer loaded keys &amp; certificates (VRKv2) </li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>Wifi </td><td><ul>
<li>
Authentication: <ul>
<li>
WPA - PSK </li>
<li>
WPA - EAP </li>
<li>
WPA2 - PSK </li>
<li>
WPA2 - EAP </li>
</ul>
</li>
<li>
Pairwise / group cipher: <ul>
<li>
CCMP (AES) </li>
<li>
TKIP </li>
</ul>
</li>
<li>
EAP Keys and Certs: <ul>
<li>
pre-loaded AuthN warrantied key </li>
<li>
customer loaded keys &amp; certificates (VRKv2) </li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>Bluetooth </td><td><ul>
<li>
BT Classic (BR/EDR): <ul>
<li>
Profiles: <ul>
<li>
Serial Port Profile (SPP) </li>
<li>
Personal Area Network (PAN) </li>
</ul>
</li>
<li>
Security: no support for Just Works and Legacy Pairing </li>
</ul>
</li>
<li>
BT Low-Energy (BLE): <ul>
<li>
Profiles: <ul>
<li>
GATT </li>
</ul>
</li>
<li>
Security: no support for Just Works Pairing </li>
</ul>
</li>
<li>
Beacons: <ul>
<li>
iBeacon, Eddystone </li>
<li>
Transmit-only; non connectable </li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>MDB </td><td><ul>
<li>
multi-drop bus support on UX700 </li>
</ul>
</td></tr>
<tr>
<td>Cellular </td><td><ul>
<li>
tbd </li>
</ul>
</td></tr>
<tr>
<td>IP netowrk support </td><td><ul>
<li>
DHCP </li>
<li>
Static IP </li>
<li>
IPv4 </li>
<li>
IPv6 </li>
</ul>
</td></tr>
</table>
<h1><a class="anchor" id="vos3_card_reading_functions"></a>
Card Reading Functions</h1>
<table class="doxtable">
<tr>
<th>Security Function</th><th>Support </th></tr>
<tr>
<td>MSR </td><td><ul>
<li>
3-track magstripe card reader <ul>
<li>
ISO 7811 </li>
<li>
JIS1, JIS2 </li>
<li>
Samsung Pay </li>
<li>
reading of US driving license cards (AAMVA, CADL-ID) </li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>ICC Chip Card </td><td><ul>
<li>
Yes </li>
</ul>
</td></tr>
<tr>
<td>RFID Contactless Cards </td><td><ul>
<li>
ISO cards </li>
<li>
MiFare </li>
</ul>
</td></tr>
<tr>
<td>Synchronous Cards </td><td><ul>
<li>
No support </li>
</ul>
</td></tr>
<tr>
<td>EMV Processing </td><td><ul>
<li>
CT </li>
<li>
CTLS </li>
</ul>
</td></tr>
</table>
<h2><a class="anchor" id="vos3_support_of_p2pe"></a>
Support for P2PE</h2>
<p>Unlike VOS1/VOS2, SDI server is no longer an optional component on VOS3, but will always run and manage the interface to the secure processor of the system.</p>
<p>SDI component on VOS3 supports protection of card holder data and is enabled by default. This brings along support for P2PE card holder protection.</p>
<p>Applications need to be aware that <b>Payment/sensitive data is not provided in clear per default</b>.</p>
<p>Users can <b>leverage SDI P2PE certification</b> if you don't use any VOS2 compatibility mode (e.g. libsdiclient with loaded vos3-cards plugin). As soon as you bypass SDI, i.e. loading the vos3-cards plugin or configure general white listing, you can not make use of the SDI P2PE certification.</p>
<p>To support this, the existing ADK client APIs libraries that expose functionality provided by SDI server will now connect to SDI but provide the same level of API known to ADK users on VOS1 and VOS2 as much as possible.</p>
<p>The SDI server will be running as system level process similar to Android deployments and act as gateway to the secure processor functions. SDI will continue to encapsulate card holder data by default.</p>
<h2><a class="anchor" id="vos3_customization"></a>
Customization</h2>
<p>The VOS3 system allows for extensions through system provided plug-ins for custom card schemes that need processing inside SDI component with access to clear-text card data.</p>
<p>Verifone supports this development together with application writers.</p>
<h1><a class="anchor" id="vos3_user_interface_functions"></a>
User Interface Functions</h1>
<table class="doxtable">
<tr>
<th>UI Function</th><th>Support </th></tr>
<tr>
<td>HTML </td><td><ul>
<li>
HTML for display and printer receipt rendering </li>
<li>
subset of HTML with specific extensions, see the <a class="el" href="pg_gui_users_guide.html">ADK GUIPRT users guide</a> for supported HTML/CSS tags </li>
</ul>
</td></tr>
<tr>
<td>ECMA6 (Javascript) </td><td><ul>
<li>
ECMA6 support as pre-processing scripting for HTML pages </li>
</ul>
</td></tr>
<tr>
<td>Images </td><td><ul>
<li>
JPEG, PNG, BMP, PAM, GIF </li>
</ul>
</td></tr>
<tr>
<td>Animated Images </td><td><ul>
<li>
animated GIF </li>
</ul>
</td></tr>
<tr>
<td>Video Playback <br  />
 </td><td><ul>
<li>
Format #1 <ul>
<li>
Video Encoding: H.264 (MPEG-4 Part 10, AVC) </li>
<li>
Video Encoding Profile: Baseline </li>
<li>
Audio Encoding: AAC, MP3 </li>
<li>
Video Container: AVI </li>
</ul>
</li>
<li>
Format #2 <ul>
<li>
Video Encoding: H.262 (MPEG-2) </li>
<li>
Video Encoding Profile: Simple </li>
<li>
Audio Encoding: AAC, MP3 </li>
<li>
Video Container: AVI, MP4, MOV, M4V </li>
</ul>
</li>
</ul>
</td></tr>
<tr>
<td>Audio Playback </td><td><ul>
<li>
MP3, WAV </li>
</ul>
</td></tr>
<tr>
<td>Barcode reading </td><td><ul>
<li>
TBD </li>
</ul>
</td></tr>
<tr>
<td>Framebuffer </td><td><ul>
<li>
no direct framebuffer access for applications </li>
</ul>
</td></tr>
</table>
<h1><a class="anchor" id="vos3_mac_functions"></a>
Multi-Application Control (MAC) Functions</h1>
<table class="doxtable">
<tr>
<th>MAC Function</th><th>Support </th></tr>
<tr>
<td>System Status Bar </td><td><ul>
<li>
system wide status bar with time, connectivity and battery status icons </li>
<li>
can be hidden via API or </li>
<li>
access to MAC desktop on touch-only device </li>
</ul>
</td></tr>
<tr>
<td>System Settings Panel </td><td><ul>
<li>
various control panels accessible through MAC (refer to <a class="el" href="pg_vos3_architecture.html#vos3_system_applications_and_control_panels">System Applications and Control Panels</a>) </li>
</ul>
</td></tr>
<tr>
<td>Application Launch <br  />
 </td><td><ul>
<li>
automated launch on system startup </li>
<li>
manual launch from MAC desktop </li>
<li>
launch dependencies </li>
</ul>
</td></tr>
<tr>
<td>Application Switching </td><td><ul>
<li>
manually through MAC Desktop </li>
<li>
via MAC API library </li>
</ul>
</td></tr>
<tr>
<td>CP application embedding </td><td><ul>
<li>
launch / hide of CP applications </li>
<li>
embedding via commerce API library </li>
</ul>
</td></tr>
</table>
<p>Refer to the <a class="el" href="pg_mac_users_guide.html">ADK-MAC Programmers Guide</a> for the detailed MAC description. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:00 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
