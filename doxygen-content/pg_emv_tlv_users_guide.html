<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: ADK-EMV TLV Utility Programmers Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_emv_tlv_users_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADK-EMV TLV Utility Programmers Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_emv_tlv_util_Preface"></a>
Preface</h1>
<p>The TLV/util library delivered with the EMV-ADK is an optional component that offers BER-TLV (basic encoding rules) and hexadecimal string conversion function. These can be very helpful if an application lacks this functionality.</p>
<h2><a class="anchor" id="subsec_emv_ct_Organization"></a>
Organization</h2>
<p>This guide is organized as follows:</p>
<p><a class="el" href="pg_emv_tlv_users_guide.html#sec_emv_tlv_util_Overview">Overview</a>. <br  />
 Provides an overview of the TLV/util library.</p>
<p><a class="el" href="pg_emv_tlv_users_guide.html#sec_emv_tlv_util_Programming">Programming</a>. <br  />
 Gives the programming toolset for the library.</p>
<p><a class="el" href="pg_emv_tlv_users_guide.html#sec_emv_tlv_util_Samples">Samples</a> <br  />
 Supplies samples and use cases for further development.</p>
<h1><a class="anchor" id="sec_emv_tlv_util_Overview"></a>
Overview</h1>
<h1><a class="anchor" id="sec_emv_tlv_util_Programming"></a>
Programming</h1>
<h2><a class="anchor" id="subsec_pathname"></a>
TLV Path names</h2>
<p>Path names are used to access nodes within the tree. The path consists of the ASCII representation of the TLV tags separated by '/'. Nodes before the last '/' must be constructed nodes. The path is given as C string, i.e. it is terminated by a 0-byte. Note that only the following characters are allowed in the path:</p>
<p>"0123456789ABCDEF"</p>
<p>The lowercase characters "abcdef" are not supported and may result in errors.</p>
<p>Example path: "20/21/DF03"</p>
<h2><a class="anchor" id="importfilter"></a>
Import filter callback</h2>
<p>The import filter callback allows to remove unwanted data during import to the TLV tree. This allows to import parts of large files that would not fit into memory in whole.</p>
<p>The import filter callback is called just before a node is to be imported, i.e. the node has been created but no content imported yet, and when a node has been completely imported. The filter can then decide whether to keep this node or remove it and whether to stop importing at this point.</p>
<p>The third parameter specifies whether the filter has been called before importing the content of the node (BTLV_IMPORT_START) or whether the node is complete (BTLV_IMPORT_DONE).</p>
<p>The order the filter callback is called depends on the context. For BTLV_IMPORT_START the filter is called for parents first and then for child nodes and for BTLV_IMPORT_DONE the import filter is called when the import has been completed for a node, i.e. it is called first for the children and then for the parent.</p>
<p>Note that the filter will not be called for a node with BTLV_IMPORT_DONE when the filter already decided to remove the node when called with BTLV_IMPORT_START.</p>
<p>Within the import filter the function <a class="el" href="btlv_8h.html#acf449e96c5391ef94ada65ae1a246909">xBTLVMatchPath()</a> is used to check the position of the current node relative to a given path. The following possibilities exist:</p><ul>
<li><b>BTLV_MATCH</b> the path of the node is equal to the given path</li>
<li><b>BTLV_CHILDMATCH</b> the node is a child of the selected path, e.g. the node has the path "20/20/DF01" and the selected path was "20/20"</li>
<li><b>BTLV_PARENTMATCH</b> the node may be a parent of the selected path, e.g. the node has the path "20" and the selected path was "20/20"</li>
<li><b>BTLV_MISMATCH</b> the path of the node does not match the selected path.</li>
</ul>
<p>The filter must return one of the following codes:</p><ul>
<li><b>BTLV_FLTR_KEEP</b> keep the current node and continue importing data</li>
<li><b>BTLV_FLTR_REMOVE</b> remove the current node but continue importing data.</li>
<li><b>BTLV_FLTR_DONE</b> keep the current node and stop importing further nodes. When scanning files for information this can be used to stop reading the file when the desired information has been found.</li>
<li><b>BTLV_FLTR_ABORT</b> remove current node and stop importing further nodes.</li>
</ul>
<p>Care has to be taken to not inadvertently remove nodes. For example it is not sufficient to keep a node by itself but it is also required to keep the parent nodes, or the node would be deleted when the filter is called for the parent.</p>
<p>Therefore, a typical filter that should keep one node with its children would look like: </p><div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029">BTLVFilter</a> testfilter(<span class="keywordtype">void</span> *pvData, <span class="keyword">struct</span> <a class="code" href="struct_b_t_l_v_node.html">BTLVNode</a> *pxRoot, <span class="keyword">enum</span> <a class="code" href="btlv_8h.html#a03946fb744cc22a5454713443cbfd3ac">BTLVContext</a> context)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">if</span>(context==<a class="code" href="btlv_8h.html#a03946fb744cc22a5454713443cbfd3aca8fab1c50c71f0f46dfdaf6ce4d4677bd">BTLV_IMPORT_START</a>) <span class="keywordflow">return</span> <a class="code" href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029a9250de9dbb34e118938b8e0d5e664f9c">BTLV_FLTR_KEEP</a>;</div>
<div class="line">   <span class="keywordflow">if</span>(<a class="code" href="btlv_8h.html#acf449e96c5391ef94ada65ae1a246909">xBTLVMatchPath</a>(pxRoot,<span class="stringliteral">&quot;20/20/20&quot;</span>)==<a class="code" href="btlv_8h.html#afebb9e8dd2052cbbb5f4287ade3ed4a1a3aaffa1128ac43539538bb379aacedf4">BTLV_MISMATCH</a>) <span class="keywordflow">return</span> <a class="code" href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029ac9c5cd9b5f377cb0fd163e48efb26db8">BTLV_FLTR_REMOVE</a>;</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029a9250de9dbb34e118938b8e0d5e664f9c">BTLV_FLTR_KEEP</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> It would be an error to return BTLV_FLTR_REMOVE if the result of the match was BTLV_PARENTMATCH, since then the desired node would be removed along with its parent when the filter was later called for the parent node.</p>
<p>The filter function itself may only modify the structure of those parts of the tree for which the importing has been completed or it will corrupt the structure of the tree which may result in a crash. That is the filter may only modify (e.g. delete nodes) the subtree of the current node.</p>
<h1><a class="anchor" id="sec_emv_tlv_util_Samples"></a>
Samples</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="abtlv_8h_html_aa47b9ee960be926bcd97dddca1c30029ac9c5cd9b5f377cb0fd163e48efb26db8"><div class="ttname"><a href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029ac9c5cd9b5f377cb0fd163e48efb26db8">BTLV_FLTR_REMOVE</a></div><div class="ttdeci">@ BTLV_FLTR_REMOVE</div><div class="ttdef"><b>Definition:</b> btlv.h:49</div></div>
<div class="ttc" id="abtlv_8h_html_aa47b9ee960be926bcd97dddca1c30029a9250de9dbb34e118938b8e0d5e664f9c"><div class="ttname"><a href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029a9250de9dbb34e118938b8e0d5e664f9c">BTLV_FLTR_KEEP</a></div><div class="ttdeci">@ BTLV_FLTR_KEEP</div><div class="ttdef"><b>Definition:</b> btlv.h:45</div></div>
<div class="ttc" id="abtlv_8h_html_acf449e96c5391ef94ada65ae1a246909"><div class="ttname"><a href="btlv_8h.html#acf449e96c5391ef94ada65ae1a246909">xBTLVMatchPath</a></div><div class="ttdeci">TLV_UTIL_INTERFACE enum BTLVMatch xBTLVMatchPath(struct BTLVNode *pxRoot, const char *pcPath)</div></div>
<div class="ttc" id="astruct_b_t_l_v_node_html"><div class="ttname"><a href="struct_b_t_l_v_node.html">BTLVNode</a></div><div class="ttdef"><b>Definition:</b> btlv.h:72</div></div>
<div class="ttc" id="abtlv_8h_html_afebb9e8dd2052cbbb5f4287ade3ed4a1a3aaffa1128ac43539538bb379aacedf4"><div class="ttname"><a href="btlv_8h.html#afebb9e8dd2052cbbb5f4287ade3ed4a1a3aaffa1128ac43539538bb379aacedf4">BTLV_MISMATCH</a></div><div class="ttdeci">@ BTLV_MISMATCH</div><div class="ttdef"><b>Definition:</b> btlv.h:62</div></div>
<div class="ttc" id="abtlv_8h_html_a03946fb744cc22a5454713443cbfd3aca8fab1c50c71f0f46dfdaf6ce4d4677bd"><div class="ttname"><a href="btlv_8h.html#a03946fb744cc22a5454713443cbfd3aca8fab1c50c71f0f46dfdaf6ce4d4677bd">BTLV_IMPORT_START</a></div><div class="ttdeci">@ BTLV_IMPORT_START</div><div class="ttdef"><b>Definition:</b> btlv.h:56</div></div>
<div class="ttc" id="abtlv_8h_html_aa47b9ee960be926bcd97dddca1c30029"><div class="ttname"><a href="btlv_8h.html#aa47b9ee960be926bcd97dddca1c30029">BTLVFilter</a></div><div class="ttdeci">BTLVFilter</div><div class="ttdef"><b>Definition:</b> btlv.h:44</div></div>
<div class="ttc" id="abtlv_8h_html_a03946fb744cc22a5454713443cbfd3ac"><div class="ttname"><a href="btlv_8h.html#a03946fb744cc22a5454713443cbfd3ac">BTLVContext</a></div><div class="ttdeci">BTLVContext</div><div class="ttdef"><b>Definition:</b> btlv.h:55</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li><li class="navelem"><a class="el" href="pg_all_components.html">ADK Components</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:01 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
