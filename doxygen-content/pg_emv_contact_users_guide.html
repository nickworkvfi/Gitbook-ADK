<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADK-Programmers-Guides: ADK-EMV Contact Programmers Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="verifone.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="verifonelogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADK-Programmers-Guides
   &#160;<span id="projectnumber">5.0.3-CD1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pg_emv_contact_users_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADK-EMV Contact Programmers Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_emv_ct_Preface"></a>
Preface</h1>
<p>ADK EMV Contact Programmer's Guide. This guide provides detailed descriptions of the ADK EMV Contact framework features, with comprehensive information on configuring and programming with the ADK EMV Contact framework, plus plenty of use cases for additional support.</p>
<h2><a class="anchor" id="subsec_emv_ct_Audience"></a>
Audience</h2>
<p>This document is for programmers and developers who want to understand and use the ADK EMV Contact framework in their custom payment applications.</p>
<h2><a class="anchor" id="subsec_emv_ct_Organization"></a>
Organization</h2>
<p>This guide is organized as follows:</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_Introduction">Introduction</a>. Provides an overview of the ADK EMV Contact framework.</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_Getting_Started">Getting Started</a>. Shows sample applications for the ADK EMV Contact framework.</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_Programming">Programming</a>. Outlines the different APIs for the ADK EMV Contact framework. Provides descriptions for various features like PIN Entry support or Virtual terminal mapping table support.</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_System_Setup_and_Requirements">System Setup and Requirements</a>. Provides information about hardware supported as well as about software requirements.</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_Troubleshooting">Troubleshooting</a>. Provides tips on problem solving approaches in form of FAQ. Additional advices are given about possible ways of debugging and tracing.</p>
<p><a class="el" href="pg_emv_contact_users_guide.html#sec_emv_ct_Appendix">Appendix</a>. Contains some useful links to related documents and a <b> quick reference to the interface functions:</b> <a class="el" href="pg_emv_contact_users_guide.html#section_emv_ct_EMV_ADK_API_Table">Table of API functions</a></p>
<h1><a class="anchor" id="sec_emv_ct_Introduction"></a>
Introduction</h1>
<p>The Verifone ADK EMV Contact framework supports payment applications following the EMVCo specifications (see <a href="http://www.emvco.com/" title="EMVCo Homepage">EMVCo Homepage</a>).</p>
<p>Please refer to the <a href="./pg_emv_contactless_users_guide.html" title="ADK-EMV Contactless Programmers Guide">ADK-EMV Contactless Programmers Guide</a> for information on the CTLS framework.</p>
<p>It's recommended to analyse sources of "ADK-EMV Demo Application" to get a better understanding how to control the interfaces ("doc/vdedemo/EmvTestApp" in ADK bundle).</p>
<h2><a class="anchor" id="subsec_emv_ct_Intro_ConfigFlow"></a>
Configuration Flow</h2>
<div class="image">
<img src="09_emv_ct_Configuration_Flow.png" alt=""/>
<div class="caption">
Figure: Configuration Flow</div></div>
   <p><b>Description:</b> </p><ul>
<li>Typically the calling application gets the desired configuration dynamically at run-time (from host, TMS, or acquirer). </li>
<li>Initialization is needed prior to calling config commands: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> </li>
<li>Terminal data setting: <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a> </li>
<li>For each supported payment application (AID) one call to <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a> is required. </li>
<li>For each CAP key one call to <a class="el" href="group___f_u_n_c___c_o_n_f.html#gade5b2bbc6ab46c4b7d9efa991b696ad2" title="Stores the specified CAP key.">EMV_CT_StoreCAPKey()</a> is needed. </li>
<li>To free resources it's possible to optionally call <a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a>. </li>
<li><b> Alternative: </b> Directly write the <a class="el" href="pg_emv_contact_users_guide.html#subsubsec_emv_ct_XML_Files">XML Configuration Files</a>. <br  />
 Only recommended for experienced users. <br  />
 Application shall make sure that no EMV transaction is active and either <a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a> has been called if applicable or at least <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gab256e2810f51ed6cc87ea9d5536b7e1e">EMV_CT_INIT_OPT_CONFIG_MODE</a> has not been used. <br  />
 Application writes XML configuration files. <br  />
 EMV ADK reads new configuration data when <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> is called.</li>
</ul>
<p>For more details see <a class="el" href="pg_emv_contact_users_guide.html#subsubsec_emv_ct_Configuration_Commands">Configuration Commands</a></p>
<h2><a class="anchor" id="subsec_emv_ct_Intro_TransactionFlow"></a>
Transaction Flow</h2>
<div class="image">
<img src="10_emv_ct_Transaction_Flow.png" alt=""/>
<div class="caption">
Figure: Transaction Flow</div></div>
   <p><br  />
 <b>Description:</b></p><ul>
<li>EMV ADK framework needs to be initialized before transaction start: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a></li>
<li>Calling application has to detect card insertion. It may use <a class="el" href="group___f_u_n_c___i_c_c.html#ga62577d8d938685a65dd2b326cb03522d" title="Detect if chip card is inserted in card reader (in readable position)">EMV_CT_SmartDetect()</a> for that.</li>
<li>Calling application has to activate the chip card. It's recommended to use <a class="el" href="group___f_u_n_c___i_c_c.html#gaa63515431ea6f33b113fa7af5562db11" title="Detect if chip card is inserted in card reader (read ATR)">EMV_CT_SmartReset()</a> for that.</li>
<li>Transaction is started by <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>.</li>
<li>Return data of this function gives information which payment application is used for the transaction. Depending on this the calling application may need to temporary modify the configuration by means of <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a> with <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga9014b9bb4c7b8ebf61ee98a26a7666ce">EMV_ADK_TEMP_UPDATE</a>.</li>
<li>Offline part of the transaction is performed inside <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a>.</li>
<li>The outcome determines if transaction is declined, offline approved, or has to be sent to host for the decision.</li>
<li>If host connection is needed the host response has to be put in <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a>.</li>
<li>At this point only two outcomes are possible: declined or approved.</li>
<li>It's recommended to call <a class="el" href="group___f_u_n_c___f_l_o_w.html#gaec319989542c7681715566de387d7f69" title="End transaction.">EMV_CT_EndTransaction()</a> after each transaction. This function wipes sensitive data from memory.</li>
<li>Calling <a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a> after each transaction would decrease performance. It's not needed at this point, but in principle it's possible.</li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_Intro_android"></a>
Android</h2>
<p>In Android the ADK-EMV is hidden inside SDI. So application has to use the "Card Detection (23-01)", "EMV System Interface", respectively "EMV Transaction Interface" from <a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a>.</p>
<h2><a class="anchor" id="subsec_emv_ct_Intro_vos3"></a>
VOS3</h2>
<p>In VOS3 ADK-EMV is accessible through SDI. The ADK-EMV-interface is rebuild in <a href="./pg_sdiclient_users_guide.html" title="ADK-SDI-Client Programmers Guide">ADK-SDI-Client Programmers Guide</a>.</p>
<h2><a class="anchor" id="subsec_emv_ct_Intro_2piece"></a>
Two-Piece Solution</h2>
<p>Former Two-Piece Solution with Client/Server architecture for EMV, MSR, TEC, ... is not supported anymore. <br  />
 SDI EPP has to be used instead (see <a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a>).</p>
<h2><a class="anchor" id="subsec_emv_ct_Intro_Usecases"></a>
Use cases</h2>
<p><a class="anchor" id="anchor_emv_ct_Use_Case_Samples_1to4"></a><b>Usecase 1-4</b></p>
<div class="image">
<img src="04_emv_ct_Usecase_Samples_1_to_4.png" alt=""/>
<div class="caption">
Figure: Usecase 1-4</div></div>
   <p><b>Description:</b></p><ul>
<li><b> Usecase 1</b> <br  />
 Used on systems without SDI server. Only possible on VOS and VOS2. <br  />
 Calling application links the static library <code>libEMV_CT_Client.a</code>. <br  />
 So it uses the functional interface with all data in C structs. <br  />
 Dynamic library <code>libEMV_CT_Link.so</code> manages the communication to EMV ADK (<code>libEMV_CT_Framework.so</code>).</li>
<li><b> Usecase 2</b> <br  />
 Used on systems with SDI server respectively SDI service. <br  />
 <code>libsdiclient.a</code> internally configures <a class="el" href="_e_m_v___common___interface_8h.html#aa5ecae39726aadf1805b96849d3d28f5aaf0ee82626c70656d071e14fcdfa3758">EMV_CLIENT_MODE_SDI</a>. <br  />
 So <code>libEMV_CT_Link.so</code> uses <code>libsdiprotocol.so</code> to manage the connection to SDI server/service.<ul>
<li>VOS3 <br  />
 <code>libsdiclient.a</code> provides the same API as ADK-EMV in Usecase 1. <br  />
 That way application does not need source code change when migrating from VOS/VOS2 to VOS3.</li>
<li>Usage without <code>libsdiclient.a</code> <br  />
 Alternatively application may use <code>libEMV_CTLS_Client.a</code> directly. <br  />
 In that case it must set <a class="el" href="_e_m_v___common___interface_8h.html#aa5ecae39726aadf1805b96849d3d28f5aaf0ee82626c70656d071e14fcdfa3758">EMV_CLIENT_MODE_SDI</a>.</li>
</ul>
</li>
<li><b> Usecase 3 </b> <br  />
 Similar to Usecase 2, but calling application implements it's own module to de-/serialize the data and do the communication with the SDI server/service.</li>
<li><b> Usecase 4 </b> <br  />
 Similar to Usecase 1, but calling application implements it's own module to de-/serialize the data and do the EMV ADK connection (calling <a class="el" href="_e_m_v___c_t___ser_interface_8h.html#aa97edfd89af13c80259d4dbd3907f9e4" title="Serial interface to EMV functions.">EMV_CT_SerInterface()</a>).</li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_Concepts"></a>
Concepts</h2>
<h3><a class="anchor" id="subsubsec_emv_ct_concept_gui"></a>
GUI</h3>
<p>UI handling is country-, regional- and domestic-specific. This is why ADK separates business logic from GUI interface. <br  />
 EMV ADK does itself not directly control the GUI. It just gives advice, in case display or cardholder interaction is required. <br  />
 Examples: <br  />
 <a class="el" href="group___c_a_r_d_h_o_l_d_e_r___i_n_f_o.html#ga0d0b71673b210ace78250dc578163862" title="Customer info: last PIN try.">eEMVCrdLastTryPIN</a> is given when cardholder display is needed (callback <a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#ga03bf78609c19ba9c07772fcd74d8c1f1" title="A text information has to be displayed to the cardholder.">TAG_BF09_CBK_CARDHOLDERINFO</a>). <br  />
 <a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gadc9d6fed84456455586fb621722ae922" title="PIN Input request.">TAG_BF08_CBK_PIN</a> callback is invoked when PIN entry is required.</p>
<p>It is recommended to use GUI ADK.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Concept_struct_vs_serialized"></a>
Interface type: Structure-based vs. serialized</h3>
<p>The Verifone EMV services are designed as a serialized interface. On this interface (CLA/INS) all parameters are tag based and where the parameters are named in the EMVCo specification we follow the tags and format of EMVCo. The parameters on this interface will vary depending on EMVCo, Scheme and Feature updates. Whenever an old parameter is obsolete it will removed from the serialized interface and whenever a new parameter is necessary it'll be added. Additionally we provide for better readability an interface, which is structure based and allows to set parameters without setting up a TLV based binary stream. Both approaches are supported with the client on top of the EMV framework. There is no force to use this client, you can at any time directly use the framework API with CLA/INS directly. However because of easier code maintenance it may be beneficial to use the client API, either struct or TLV based. <br  />
Each struct parameter is 1:1 converted to a serialized tag without the need to know the tag and format inside the serialized stream. Whenever you fill a parameter inside the struct you simply need to raise the config flag for this struct parameter and it'll be added to the serialized stream automatically. <br  />
<br  />
 Example: </p><pre class="fragment">TXN_Data.Force_Online = FALSE; // no force Online
Info_Included_Data[1] |=  INPUT_SEL_FORCE_ONLINE; //raise the flag
</pre><h3><a class="anchor" id="subsubsec_emv_ct_up_and_downward_compat"></a>
Updating to a new EMV ADK version</h3>
<p>Please have in mind that adding new features and specification changes requires that transaction and configuration structs are modified regularly. If you want to update to a newer release of the EMV-ADK without taking benefits of new features, spec updates or certifications this can be done anytime by downloading the new framework and kernels and keeping the original client. This allows you to reuse the old application even without recompiling it, even we recommend to update your application to the latest to be up to date with latest EMV testcases, spec changes and feature sets. <br  />
If you decide to update the client to use the new features have in mind that you fill the new parameters accordingly. If you use the TLV stream add the new tags and remove obsolete tags. If you use the struct API have in mind that old parameters disappear and new tags are added. <br  />
The new client is compatible to an old framework (the old framework will not see unknown new tags in the serialized stream) and an old client is compatible to a new framework (obsolete tags are not parsed any more by the new framework, missing tags will be set with compliant defaults). This allows to have the API up to date to the fast changing specifications, enables introducing new parameters and removing obsolete parameters, so that legacy stuff is always kept away from new users and new parameters can be introduced without implications. <br  />
<br  />
Additional considerations:</p><ul>
<li>Do not update kernels if you do not update to the latest feature and specification set because new kernels may require up to date configuration.</li>
<li>There are most probably multiple kernels for Contact and Contactless in an EMV-ADK delivery. Do stock picking of the kernels and load only those to the system that fit to your terminal and your application ICS needs.</li>
<li>If you use the serialized interface properly it is no problem to pick a new client without updating to new features and certifications. However we do not recommend to do so but adapt to the latest spec updates or (if already certified for example) keep the client and kernels you implemented against.</li>
<li>The EMV-ADK updates are independent of the release planning of the ADK integration packages. As soon as new L2 certifications are available and as soon as new E2E tests are integrated we provide a release if possible.</li>
<li>This requires to cross check for the latest regularly to pass the latest E2E tests with your application.</li>
<li>Vice versa you need to take care that you do not automatically update to a newer EMV-ADK version once you have certified your app, you may want to lock it not to endanger your certification.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_Callback_and_Reentrance_Mode"></a>
Callback and Reentrance Mode</h3>
<p>For the transaction sequence, there are two general modes possible:</p><ul>
<li><b>Callback Mode.</b> <br  />
 This is the "standard mode". It is most robust and easy-to-use. <br  />
 Calling application can activate several callbacks. These are invoked during transaction processing. <br  />
 Callback activation is done in <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ac9ddf19e79cf70f6331fdb822fdf1d4f">EMV_CT_SELECT_STRUCT::TxnOptions</a>, <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ac9ddf19e79cf70f6331fdb822fdf1d4f" title="options, allowed values see Options for transaction processing   TLV tag TAG_DF36_TRX_OPTIONS,...">EMV_CT_TRANSAC_STRUCT::TxnOptions</a>, e.g. <a class="el" href="group___t_x_n___o_p_t_i_o_n_s.html#gab687ffddde3bcdd5b299b6ffd5411338" title="B3b1: The callback for the intermediate merchant information will be generated (EMV_CT_CALLBACK_FnT T...">EMV_CT_TRXOP_MERCHINFO_CALLBACK</a>. <br  />
 For an overview about all callback functions see <a class="el" href="pg_emv_contact_users_guide.html#subsubsec_emv_ct_Transaction_Callback_Command">Transaction Callback Command</a>.</li>
<li><b>Reentrance Mode.</b> <br  />
 This mode is only recommended for experienced users. <br  />
 Transaction is interrupted at certain points. At these points the application can perform certain processes: change parameters, handle GUI, etc. The application has full control over all parameters and the complete configuration interface. <br  />
 Transaction is continued by re-calling the same EMV ADK function. <br  />
 Configuration options can be found here: <a class="el" href="group___t_x_n___s_t_e_p_s.html">Re-entrance options</a></li>
</ul>
<div class="image">
<img src="29_emv_ct_Reentrance_Mode.png" alt=""/>
<div class="caption">
Figure: Reentrance vs. Callback Mode</div></div>
   <h3><a class="anchor" id="subsubsec_emv_ct_XML_Files"></a>
XML Configuration Files</h3>
<p>The configuration of the framework is stored in XML files. These are created dynamically using the configuration functions. Missing parameters will be automatically filled with a default.</p>
<p>In V/OS and VOS2 you can find the XML files in the sub folder "flash" of the corresponding user. In Verix they are placed in "I:/1/".</p>
<p>Mapping from XML tags to struct parameters (and TLV tags) can be found in <a class="el" href="_e_m_v___c_t___x_m_l_8h.html">EMV_CT_XML.h</a>.</p>
<p><a class="anchor" id="anchor_emv_ct_XML_Files_Terminal"></a><b>Terminal data</b> (file name: <code>EMV_Terminal.xml</code>) </p><div class="fragment"><div class="line">&lt;TerminalData&gt;</div>
<div class="line">&lt;TermTyp&gt;22&lt;/TermTyp&gt;</div>
<div class="line">&lt;CurrencyTrans&gt;0978&lt;/CurrencyTrans&gt;</div>
<div class="line">&lt;ExpTrans&gt;02&lt;/ExpTrans&gt;</div>
<div class="line">&lt;CountryCodeTerm&gt;0250&lt;/CountryCodeTerm&gt;</div>
<div class="line">&lt;TermCap&gt;E0F8C8&lt;/TermCap&gt;</div>
<div class="line">&lt;TermAddCap&gt;F000B0A001&lt;/TermAddCap&gt;</div>
<div class="line">&lt;SuppLang&gt;0102000000000000&lt;/SuppLang&gt;</div>
<div class="line">&lt;IFD_SerialNumber&gt;12345678&lt;/IFD_SerialNumber&gt;</div>
<div class="line">&lt;KernelVersion&gt;L26.16l&lt;/KernelVersion&gt;</div>
<div class="line">&lt;FrameworkVersion&gt;01.00.00-rc1&lt;/FrameworkVersion&gt;</div>
<div class="line">&lt;/TerminalData&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_XML_Files_Applications"></a><b>Applications</b> (file name: <code>EMV_Applications.xml</code>) </p><div class="fragment"><div class="line">&lt;Application AID=<span class="stringliteral">&quot;A0000000041010&quot;</span>&gt;</div>
<div class="line">&lt;VerNum&gt;0002&lt;/VerNum&gt;</div>
<div class="line">&lt;AppName&gt;Mastercard&lt;/AppName&gt;</div>
<div class="line">&lt;ASI&gt;01&lt;/ASI&gt;</div>
<div class="line">&lt;BrKey&gt;5999&lt;/BrKey&gt;</div>
<div class="line">&lt;TermIdent&gt;3132333435363738&lt;/TermIdent&gt;</div>
<div class="line">&lt;FloorLimit&gt;00001388&lt;/FloorLimit&gt;</div>
<div class="line">&lt;Threshold&gt;000001F4&lt;/Threshold&gt;</div>
<div class="line">&lt;TargetPercentage&gt;00&lt;/TargetPercentage&gt;</div>
<div class="line">&lt;MaxTargetPercentage&gt;00&lt;/MaxTargetPercentage&gt;</div>
<div class="line">&lt;TAC_Denial&gt;0400000000&lt;/TAC_Denial&gt;</div>
<div class="line">&lt;TAC_Online&gt;F850ACF800&lt;/TAC_Online&gt;</div>
<div class="line">&lt;TAC_Default&gt;FC50ACA000&lt;/TAC_Default&gt;</div>
<div class="line">&lt;EMV_Application&gt;01&lt;/EMV_Application&gt;</div>
<div class="line">&lt;DefaultTDOL&gt;9F02065F2A029A039C0195059F3704&lt;/DefaultTDOL&gt;</div>
<div class="line">&lt;DefaultDDOL&gt;9F3704&lt;/DefaultDDOL&gt;</div>
<div class="line">&lt;MerchIdent&gt;202020202020202020202020202020&lt;/MerchIdent&gt;</div>
<div class="line">&lt;CDA_Processing&gt;02&lt;/CDA_Processing&gt;</div>
<div class="line">&lt;AC_BeforeAfter&gt;00&lt;/AC_BeforeAfter&gt;</div>
<div class="line">&lt;POS_EntryMode&gt;05&lt;/POS_EntryMode&gt;</div>
<div class="line">&lt;AdditionalTags&gt;9F530152&lt;/AdditionalTags&gt;</div>
<div class="line">&lt;Taglist&gt;008E&lt;/Taglist&gt;</div>
<div class="line">&lt;AppTermCap&gt;E0F8C8&lt;/AppTermCap&gt;</div>
<div class="line">&lt;AppFlowCap&gt;3F1F170000&lt;/AppFlowCap&gt;</div>
<div class="line">&lt;AIP_CVM_NotSupported&gt;00&lt;/AIP_CVM_NotSupported&gt;</div>
<div class="line">&lt;CountryCodeTerm&gt;0250&lt;/CountryCodeTerm&gt;</div>
<div class="line">&lt;AppTermAddCap&gt;F000B0A001&lt;/AppTermAddCap&gt;</div>
<div class="line">&lt;AppTerminalType&gt;22&lt;/AppTerminalType&gt;</div>
<div class="line">&lt;AID_Prio /&gt;</div>
<div class="line">&lt;AID_Prio /&gt;</div>
<div class="line">&lt;AID_Prio /&gt;</div>
<div class="line">&lt;AID_Prio /&gt;</div>
<div class="line">&lt;AID_Prio /&gt;</div>
<div class="line">&lt;FallbackMIDs&gt;000000&lt;/FallbackMIDs&gt;</div>
<div class="line">&lt;SpecialTRX&gt;2120110000000000&lt;/SpecialTRX&gt;</div>
<div class="line">&lt;FallbackHandling&gt;00&lt;/FallbackHandling&gt;</div>
<div class="line">&lt;ChksumParams&gt;0100000000&lt;/ChksumParams&gt;</div>
<div class="line">&lt;ChksumASCII_EMVCO&gt;BE3FB52A&lt;/ChksumASCII_EMVCO&gt;</div>
<div class="line">&lt;MasterAID /&gt;</div>
<div class="line">&lt;/Application&gt;</div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_XML_Files_Keys"></a><b>Keys</b> (file name: <code>EMV_Keys.xml</code>) </p><div class="fragment"><div class="line">&lt;CapKey Index=<span class="stringliteral">&quot;F8&quot;</span> RID=<span class="stringliteral">&quot;A000000004&quot;</span>&gt;</div>
<div class="line">   &lt;Exponent&gt;03&lt;/Exponent&gt;</div>
<div class="line">   &lt;KeyLen&gt;80&lt;/KeyLen&gt;</div>
<div class="line">   &lt;Key&gt;A1F5E1C9BD8650BD43AB6EE56B891EF7459C0A24FA84F9127D1A6C79D4930F6DB185 2E2510F18B61CD354DB83A356BD190B88AB8DF04284D02A4204A7B6CB7C5551977A9B36379CA3DE1A08E69F301C95CC1C20506959275F41723DD5D2925290579E5A95B0DF6323FC8E9273D6F849198C4996209166D9BFC973C361CC826E1&lt;/Key&gt;</div>
<div class="line">   &lt;Hash&gt;F06ECC6D2AAEBF259B7E755A38D9A9B24E2FF3DD&lt;/Hash&gt;</div>
<div class="line">   &lt;RevocationList&gt;010203&lt;/ RevocationList &gt;</div>
<div class="line">&lt;/CapKey&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_emv_ct_Getting_Started"></a>
Getting Started</h1>
<p>In this chapter you will find execution flow diagrams as well as real code examples describing steps which are required in order to successfully configure application and make a payment transaction.</p>
<h2><a class="anchor" id="sec_emv_ct_Sample_Application"></a>
Sample Application</h2>
<p>For a payment application example, please refer to EMV testapp.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Examples_of_Serialized_Flow"></a>
Examples of Serialized Flow</h3>
<p><b>Configuration</b></p>
<div class="fragment"><div class="line">Init:</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    39 00 [0]</div>
<div class="line"> </div>
<div class="line">MSG RESP:   90 00 [0]</div>
<div class="line"> </div>
<div class="line">CFG Terminal Data:</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    39 01 [68] F0429F3501225F2A0209785F3601029F1A0202509F3303E0F8C89F4005F000B0A001 …</div>
<div class="line">CLIENT MSG RESP:    90 00 [0]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">CFG Application Data (Delete All): MSG  CMD:    39 02 [6] F004DF660120</div>
<div class="line">CLIENT MSG RESP:    90 00 [0]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">CFG Application Data (Set AID, MC) MSG  CMD:    39 02 [381]</div>
<div class="line">F0820179DF6601014F07A00000000410109F09020002500A4D617374657263617264 … CLIENT MSG RESP: 90 00 [ 0]</div>
<div class="line"> </div>
<div class="line">CFG Application Data (Set AID, VISA) CMD:   39 02 [362]</div>
<div class="line">F0820166DF6601014F07A00000000310109F0902008C500456697361DF2001019F15 … CLIENT MSG RESP: 90 00 [ 0]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">… repeat per AID</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">CFG CAP Keys (Delete All)</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    39 03 [6] F004DF660120</div>
<div class="line"> </div>
<div class="line">CLIENT MSG RESP:    90 00 [0]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">CFG CAP Keys (Set CAP Keys, repeat <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">n</a> times) CLIENT MSG  CMD:    39 03 [178]</div>
<div class="line">F081AFDF660101DF0901F8DF0A05A000000004DF0B8180A1F5E1C9BD8650BD43AB6E … MSG RESP:    90 00 [0]</div>
<div class="line">CLIENT MSG  CMD:    39 03 [194] F081BFDF660101DF0901F3DF0A05A000000004DF0B819098F0C770F23864C2E766DF …</div>
<div class="line">MSG RESP:   90 00 [0]</div>
</div><!-- fragment --><p><b>Transaction</b> </p><div class="fragment"><div class="line">Init:</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    39 00 [0]</div>
<div class="line"> </div>
<div class="line">MSG RESP:   90 00 [0]</div>
<div class="line"> </div>
<div class="line">Activate ICC (Applications technology selection process) CLIENT MSG CMD:    41 02 [6] F004DF060100</div>
<div class="line">CLIENT MSG RESP:    90 00 [19] F011DF680E3B6A00FF4A434F50333156323332</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Start Transaction</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    39 10 [57] F0379C01009F02060000000156999A031211019F2103120000DF400100DF430100DF …</div>
<div class="line">CLIENT MSG RESP:    90 00 [112] F06E8408A000000003101002500F4352454449544F2044452056495341DF330B5649 …</div>
<div class="line"> </div>
<div class="line">Continue Transaction Offline CLIENT MSG CMD:    39 11 [ 30]</div>
<div class="line">F01C9F410400000000DF5806000000000000DF4E0100DF470100DF340100</div>
<div class="line"> </div>
<div class="line">(Callback example, here: BF08 == PIN Input, Online PIN) CLIENT MSG  CBK:    91 01 [13] F00BBF0808DF790100DF410101</div>
<div class="line">CLIENT MSG CBKR:    92 00 [6] F004DF790100</div>
<div class="line"> </div>
<div class="line">CLIENT MSG RESP:    90 E2 [405] F0820193DF4204000000019F2701809F3602005E9F260845CFA9C81F28B5BD5A0A476173</div>
<div class="line">…</div>
<div class="line"> </div>
<div class="line">Continue Transaction Online CLIENT MSG  CMD:    39 12 [28]</div>
<div class="line">F01ADF5001018A0230308906000000000000DF55023031DF56023535</div>
<div class="line"> </div>
<div class="line">CLIENT MSG RESP:    90 E3 [401] F082018FDF4204000000019F2701409F3602005E9F2608A2471F498B8BD5695A0A476173</div>
<div class="line">…</div>
<div class="line"> </div>
<div class="line">Deactivate ICC (optional, it is deactivated by the framework <span class="keywordflow">if</span> the transaction is completed, not in any terminate or fallback <span class="keywordflow">case</span> because the subsequent processing is not known to the framework).</div>
<div class="line"> </div>
<div class="line">CLIENT MSG  CMD:    41 04 [6] F004DF060100</div>
<div class="line"> </div>
<div class="line">CLIENT MSG RESP:    90 03 [0]</div>
</div><!-- fragment --><h2><a class="anchor" id="subsec_emv_ct_Code_Snippets"></a>
Code Snippets</h2>
<p>Use the following sample code snippets for basic implementation.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Code_Snippets_Initialization"></a>
Initialization</h3>
<div class="fragment"><div class="line">erg = <a class="code" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592">EMV_CT_Init_Framework</a>(64, (<a class="code" href="group___t_l_v___c_a_l_l_b_c_k.html#ga3ff52ae040bd291d348e505e057f02ef">EMV_CT_CALLBACK_FnT</a>)FrameworkEMVCallbackFunction, (<span class="keywordtype">void</span>*)NULL, <a class="code" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga2e45cc21dd0264a8d3a8c90c733d4f8c">EMV_CT_INIT_OPT_TRACE</a>|<a class="code" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga9b2576e36b0771a53249ff7b448197fd">EMV_CT_INIT_OPT_TRACE_CLT</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span>(erg != <a class="code" href="group___a_d_k___r_e_t___c_o_d_e.html#ga1456bb13b42906927f8a8942169b62e7">EMV_ADK_OK</a>)</div>
<div class="line">  {</div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;Init EMV framework returned %d&quot;</span>, erg);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>(EMV_INIT_ERR_INIT_KERNEL);</div>
<div class="line">  }</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_Code_Snippets_Application_Selection"></a>
Application Selection</h3>
<div class="fragment"><div class="line"><span class="comment">/* Step 1: Application Selection */</span></div>
<div class="line"><span class="keywordflow">do</span></div>
<div class="line">{</div>
<div class="line"> <span class="comment">// call kernel: select application from terminal- and card-/list</span></div>
<div class="line"> eEMVInfo = <a class="code" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb">EMV_CT_StartTransaction</a>(&amp;xterminaldata,  <span class="comment">// IN:  terminaldata</span></div>
<div class="line">                                    &amp;xSelectRes);    <span class="comment">// OUT: select info</span></div>
<div class="line"> </div>
<div class="line"> xterminaldata.Buildlist = FALSE;</div>
<div class="line">} <span class="keywordflow">while</span>(eEMVInfo == _EMV_BADAPP);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span>(eEMVInfo)</div>
<div class="line">{</div>
<div class="line"> <span class="keywordflow">case</span> _EMV_OK: <span class="comment">// application selected, everything OK</span></div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  ……</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_Code_Snippets_Offline_Part_of_the_Transaction"></a>
Offline Part of the Transaction</h3>
<div class="fragment"><div class="line"><span class="comment">/* Step 2: Performing EMV transaction */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// start EMV-payment</span></div>
<div class="line">eEMVInfo = <a class="code" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006">EMV_CT_ContinueOffline</a>(&amp;xEMVTransType, &amp;xEMVTransRes);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// at this point, it is possible to select a new application</span></div>
<div class="line"><span class="keywordflow">while</span>(eEMVInfo == _EMV_BADAPP)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// select new application</span></div>
<div class="line"> xterminaldata.Buildlist = FALSE;</div>
<div class="line"> </div>
<div class="line"> eEMVInfo = <a class="code" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb">EMV_CT_StartTransaction</a>( &amp;xterminaldata,  <span class="comment">// IN:  dummy</span></div>
<div class="line">                                     &amp;xSelectRes);    <span class="comment">// OUT: select info</span></div>
<div class="line"> <span class="keywordflow">if</span>(eEMVInfo == _EMV_OK)</div>
<div class="line"> {</div>
<div class="line">   memset((<span class="keywordtype">void</span>*) &amp;xEMVTransRes,  0, <span class="keyword">sizeof</span>(EMV_TRANSRES_TYPE));</div>
<div class="line"> </div>
<div class="line">   eEMVInfo = <a class="code" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006">EMV_CT_ContinueOffline</a>(&amp;xEMVTransType, &amp;xEMVTransRes);</div>
<div class="line"> }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span>(eEMVInfo)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">case</span> _EMV_ARQC:                <span class="comment">// go online</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* transaction requires communication to the host */</span></div>
<div class="line">    <span class="comment">/* TRX not finished yet --&gt; contact your host */</span></div>
<div class="line">    <span class="comment">/* no text to display */</span></div>
<div class="line">    <span class="comment">/* continue, see below */</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">case</span> _EMV_TC:                  <span class="comment">// write offline-file</span></div>
<div class="line">    <span class="comment">/* transaction successfully finished */</span></div>
<div class="line">…</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_Online_Response_from_Host"></a>
Online Response from Host</h3>
<p>Authorization Response Code, Issuer Authentication Data, possible Scripts (critical + uncritical), following EMVCo formats:</p>
<div class="fragment"><div class="line"><span class="comment">/* Step 3: Completing a transaction Online */</span></div>
<div class="line"> </div>
<div class="line">memcpy(pxTxnRec-&gt;xHostRespRec.AuthResp, <span class="stringliteral">&quot;\x30\x30&quot;</span>, 2);</div>
<div class="line"> </div>
<div class="line">pxTxnRec-&gt;xHostRespRec.LenAuth = 0x0A;</div>
<div class="line">memcpy(ucAuth_Data, <span class="stringliteral">&quot;\x91\x08\x11\x22\x33\x44\x55\x66\x77\x88&quot;</span>, pxTxnRec-&gt;xHostRespRec.LenAuth);</div>
<div class="line"> </div>
<div class="line">pxTxnRec-&gt;xHostRespRec.LenScriptCrit = 26;</div>
<div class="line">memcpy(ucCritScript_Data, <span class="stringliteral">&quot;\x71\x18\x9F\x18\x04\x00\x00\x00\x01\x86\x0F\x84\x1E\x00\x00\x0A\x8E\x08\x11\x22\x33\x44\x55\x66\x77\x88&quot;</span>, pxTxnRec-&gt;xHostRespRec.LenScriptCrit);</div>
<div class="line"> </div>
<div class="line">pxTxnRec-&gt;xHostRespRec.LenScriptUnCrit = 26;</div>
<div class="line">memcpy(ucUnCritScript_Data, <span class="stringliteral">&quot;\x72\x18\x9F\x18\x04\x00\x00\x00\x01\x86\x0F\x84\x1E\x00\x00\x0A\x8E\x08\x11\x22\x33\x44\x55\x66\x77\x88&quot;</span>, pxTxnRec-&gt;xHostRespRec.LenScriptUnCrit);</div>
<div class="line"> </div>
<div class="line">…</div>
<div class="line"> </div>
<div class="line">eEMVInfo = <a class="code" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4">EMV_CT_ContinueOnline</a>(pxTxnRec, &amp;xEMVOnlineRes);</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_PIN_Entry"></a>
PIN Entry</h3>
<p>A code example for managing PIN entry. PIN entry is done using GUI-ADK (<a href="./pg_gui_users_guide.html" title="ADK-GUI Programmers Guide">ADK-GUI Programmers Guide</a>). <br  />
 In case of offline PIN the EMV-ADK transmits the PIN from vault to card (for verification). </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> UIEnterPin(GuiPinParam *pinParam)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> r = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> disp = getCardHolderDisplay();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// if card holder display is separate, show cashier message</span></div>
<div class="line">    <span class="keywordflow">if</span> (disp)</div>
<div class="line">        UI_ShowMessage(UI_STR_CARDHOLDER_INPUT, <span class="stringliteral">&quot;card holder prompted for PIN input&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(disp != UI_DISP_DEFAULT)</div>
<div class="line">            disp = UI_DISP_DEFAULT;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> digits;</div>
<div class="line">        UIParams values;</div>
<div class="line">        map&lt;string,string&gt;::iterator i;</div>
<div class="line">        guiCb = pinParam-&gt;callback;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdab97b324cf4cec94f5e8ed7a3f9a307e8">UI_PROP_PIN_ALGORITHM</a>, (<span class="keywordtype">int</span>) pinParam-&gt;ucPinAlgo);</div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdab3831f55519a8d598508668fa914dae1">UI_PROP_PASSWORD_CHAR</a>, (<span class="keywordtype">int</span>) pinParam-&gt;ulEchoChar);</div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdad99992968807353cde482f423dca5f2c">UI_PROP_PIN_AUTO_ENTER</a>, (<span class="keywordtype">int</span>) pinParam-&gt;ucAutoEnter);</div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bda4f3d2b9a8136f3a8606e9ba8e66371d4">UI_PROP_PIN_BYPASS_KEY</a>, (<span class="keywordtype">int</span>) pinParam-&gt;ulBypassKey);</div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bda03bb51eea83f5cb9f2f47f9a6fc6add5">UI_PROP_PIN_CLEAR_ALL</a>, (<span class="keywordtype">int</span>) pinParam-&gt;ucClearAll);</div>
<div class="line">        <a class="code" href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">uiSetPropertyInt</a>(disp, <a class="code" href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdacd0735c01cf5c93d28977026ba79a648">UI_PROP_TIMEOUT</a>, (<span class="keywordtype">int</span>) pinParam-&gt;lTimeoutMs);</div>
<div class="line"> </div>
<div class="line">        std::string <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">str</a> = pinParam-&gt;currency;</div>
<div class="line">        <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">str</a> += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">        <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">str</a> += pinParam-&gt;amount;</div>
<div class="line">        <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">str</a> += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"> </div>
<div class="line">        values.clear();</div>
<div class="line">        values[<span class="stringliteral">&quot;msgPIN&quot;</span>] = UI_STR_ENTER_PIN;</div>
<div class="line">        values[<span class="stringliteral">&quot;amount&quot;</span>] = <a class="code" href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">str</a>;</div>
<div class="line">        values[<span class="stringliteral">&quot;caution_icon&quot;</span>] = <span class="stringliteral">&quot;1&quot;</span>;</div>
<div class="line">        values[<span class="stringliteral">&quot;title&quot;</span>] = pinParam-&gt;appLabel;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(isKeypadExist())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">while</span> ((r = <a class="code" href="namespacevfigui.html#af5812cac4b8cd48873fcac4608f3082d">uiInvokeURL</a>(disp, UI_REGION_ID_MAIN, values, <span class="stringliteral">&quot;helper_pin.html&quot;</span>, &amp;guiCallback, NULL)) == <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4feab947423fdbe03bf4ee7d4132a7470271">UI_ERR_PERMISSION</a>)</div>
<div class="line">                usleep(1000);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="comment">// X10, Carbon, Swordfish, e280</span></div>
<div class="line">        {</div>
<div class="line">            initializeUiRegions(UI_REGION_ID_MAIN|UI_REGION_ID_SOFTWARE_LEDS);</div>
<div class="line">            <span class="keywordflow">while</span> ((r = <a class="code" href="namespacevfigui.html#af5812cac4b8cd48873fcac4608f3082d">uiInvokeURL</a>(disp, UI_REGION_ID_MAIN, values, <span class="stringliteral">&quot;kbd_pin.html&quot;</span>, &amp;guiCallback, NULL)) == <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4feab947423fdbe03bf4ee7d4132a7470271">UI_ERR_PERMISSION</a>)</div>
<div class="line">                usleep(1000);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(r == <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea0e9295b37bfaa07f3b8e2b2f666bcb08">UI_ERR_OK</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (i = values.begin(); i != values.end(); ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (!strcmp(i-&gt;first.c_str(), <span class="stringliteral">&quot;pin&quot;</span>)) {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (i == values.end()) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (sscanf(i-&gt;second.c_str(), <span class="stringliteral">&quot;%d&quot;</span>, &amp;digits) == 1) {</div>
<div class="line">                Demo_SplashPleaseWait();</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (!strcmp(i-&gt;second.c_str(), <span class="stringliteral">&quot;bypass&quot;</span>)) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga5364807f6ce1265fa8f8e0228db9717c">EMV_CT_PIN_INPUT_BYPASS</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (!strcmp(i-&gt;second.c_str(), <span class="stringliteral">&quot;cancel&quot;</span>)) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#gaed61dc1a7482b607ebad612b3f2d7508">EMV_CT_PIN_INPUT_ABORT</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (r) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea25c0f4789a50189db529c844fbc5395b">UI_ERR_TIMEOUT</a>:</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga71e47e61824568f46a9c9ed547ef206b">EMV_CT_PIN_INPUT_TIMEOUT</a>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea6dc64819a8719e862f267b4c31adaa2b">UI_ERR_ABORT</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4feae72b16ac91ed2f069ed4e315c0a66879">UI_ERR_CANCELLED</a>:</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#gaed61dc1a7482b607ebad612b3f2d7508">EMV_CT_PIN_INPUT_ABORT</a>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> _EMVADK_cbk_duringPINinput(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="group___f_u_n_c___i_c_c.html#ga62577d8d938685a65dd2b326cb03522d">EMV_CT_SmartDetect</a>(0) != <a class="code" href="group___s_m_a_r_t___s_t_a_t_u_s.html#ga7096828cd20d1b879bf0c781ba8405be">EMV_ADK_SMART_STATUS_OK</a>)</div>
<div class="line">  {</div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;--&gt; WHERE IS THE CARD ???????&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ucInputPIN( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pintype,</div>
<div class="line">                          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> bypass,</div>
<div class="line">                          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* pucPINResultData)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rsp;</div>
<div class="line">  <span class="keywordtype">int</span> r = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> BypassKey = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tucAmount[6] = {0};</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tucAmountAscii[13] = {0};</div>
<div class="line">  <span class="keywordtype">char</span> finalAmount[13] = {0};</div>
<div class="line">  guiPinParam pinParam;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> TAGR;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Buffer[32];</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> TAGL = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (bypass)</div>
<div class="line">  {</div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;start PIN entry: Bypass active: YES&quot;</span>);</div>
<div class="line">    BypassKey = 13; <span class="comment">// Bypass activated with Enter Key 0 digits</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;start PIN entry: Bypass active: NO&quot;</span>);</div>
<div class="line">    BypassKey = 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  pinParam.ucPinAlgo = EMV_PIN;</div>
<div class="line">  pinParam.ucAutoEnter = 0;</div>
<div class="line">  pinParam.ucClearAll = 0;</div>
<div class="line">  pinParam.ulEchoChar = <span class="charliteral">&#39;*&#39;</span>;</div>
<div class="line">  pinParam.ulBypassKey = BypassKey;</div>
<div class="line">  pinParam.lTimeoutMs = 30000;</div>
<div class="line">  pinParam.callback = _EMVADK_cbk_duringPINinput;</div>
<div class="line">  pinParam.currency = UI_STR_CURRENCY;</div>
<div class="line"> </div>
<div class="line">  TAGR = 0x9F02;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (pintype == EMV_CTLS_PIN_INPUT_ONLINE)</div>
<div class="line">  {</div>
<div class="line">    TAGL = 0;</div>
<div class="line">    <a class="code" href="group___f_u_n_c___f_l_o_w.html#ga8c9f0640ed818c3dc19da528f5f0b406">EMV_CTLS_fetchTxnTags</a>(0, &amp;TAGR, 1, Buffer, 32, &amp;TAGL);</div>
<div class="line">    <span class="keywordflow">if</span> (TAGL &gt; 0)</div>
<div class="line">      memcpy(tucAmount, &amp;Buffer[3], 6);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5">EMV_CT_fetchTxnTags</a>(<a class="code" href="group___f_e_t_c_h___t_a_g_s___o_p_t_i_o_n_s.html#ga21aa8da8d69f7acd9d8e13b9543df5c0">EMV_ADK_FETCHTAGS_NO_EMPTY</a>, &amp;TAGR, 1, Buffer, 32, &amp;TAGL);</div>
<div class="line">    <span class="keywordflow">if</span> (TAGL &gt; 0)</div>
<div class="line">      memcpy(tucAmount, &amp;Buffer[3], 6);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  APP_TRACE(<span class="stringliteral">&quot;Amount extracted: %02X%02X%02X%02X%02X%02X&quot;</span>,</div>
<div class="line">                     Buffer[3], Buffer[4],</div>
<div class="line">                     Buffer[5], Buffer[6],</div>
<div class="line">                     Buffer[7], Buffer[8]);</div>
<div class="line"> </div>
<div class="line">  vAmountBCD2ASCII(tucAmount, tucAmountAscii, 6);</div>
<div class="line">  vAmountForDisplay(finalAmount, <span class="keyword">sizeof</span>(finalAmount), (<span class="keywordtype">char</span>*)tucAmountAscii, 2);</div>
<div class="line">  pinParam.amount = finalAmount;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> ((pintype == <a class="code" href="group___a_d_k___p_i_n___i_n_p_u_t.html#gaf2bc706ea385477040fc5fa2a0b272c2">EMV_CT_PIN_INPUT_ENCIPHERED</a>) || (pintype == <a class="code" href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga5e82e9ba31d25d95371f61030d0132b2">EMV_CT_PIN_INPUT_PLAIN</a>))</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// PIN Entry using GUI-ADK</span></div>
<div class="line">    rsp = UIEnterPin(&amp;pinParam);</div>
<div class="line"> </div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;=== result of PIN entry: %d ===&quot;</span>, rsp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rsp == <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga5364807f6ce1265fa8f8e0228db9717c">EMV_CT_PIN_INPUT_BYPASS</a>)</div>
<div class="line">      APP_TRACE(<span class="stringliteral">&quot;PIN Bypass from customer&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rsp != <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span>(rsp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    rsp = <a class="code" href="group___f_u_n_c___f_l_o_w.html#ga895cb054c344d011e9e3c6acc4aadafe">EMV_CT_Send_PIN_Offline</a>(pucPINResultData);</div>
<div class="line"> </div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;=== result of PIN offline: %d ===&quot;</span>, rsp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (rsp)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="group___s_m_a_r_t___s_t_a_t_u_s.html#ga7096828cd20d1b879bf0c781ba8405be">EMV_ADK_SMART_STATUS_OK</a>:</div>
<div class="line">        <span class="keywordflow">if</span> (pucPINResultData[0] == 0x63)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (pucPINResultData[1] == 0xC1)</div>
<div class="line">             r = UI_ShowOkCancelMessageExt(getCardHolderDisplay(), 100000, UI_STR_PIN, UI_STR_WRONG_PIN_TRY_LAST, NULL);</div>
<div class="line">          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pucPINResultData[1] == 0xC0)</div>
<div class="line">             r = UI_ShowOkCancelMessageExt(getCardHolderDisplay(), 100000, UI_STR_PIN, UI_STR_WRONG_PIN_GAME_OVER, NULL);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            r = UI_ShowOkCancelMessageExt(getCardHolderDisplay(), 100000, UI_STR_PIN, UI_STR_WRONG_PIN_TRY_AGAIN, NULL);</div>
<div class="line">          <span class="keywordflow">if</span> (r == -1)</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#gaed61dc1a7482b607ebad612b3f2d7508">EMV_CT_PIN_INPUT_ABORT</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>; <span class="comment">// need to check SW1 SW2</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6e1606e2c165d4f4af132d23f6585e37">EMV_CT_PIN_INPUT_COMM_ERR</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pintype == <a class="code" href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga6e50037ec9acfb5dc5af7e8738ce3f12">EMV_CT_PIN_INPUT_ONLINE</a>) || (pintype == EMV_CTLS_PIN_INPUT_ONLINE))</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// with Online PIN of CTLS there is no need to check card insertion</span></div>
<div class="line">    <span class="keywordflow">if</span> (pintype == EMV_CTLS_PIN_INPUT_ONLINE)</div>
<div class="line">      pinParam.callback = NULL;</div>
<div class="line"> </div>
<div class="line">    rsp = UIEnterPin(&amp;pinParam);</div>
<div class="line"> </div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;=== result of PIN entry: %d ===&quot;</span>, rsp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rsp != <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> rsp;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Online PIN needs to be fetched by the local/domestic VSS script handling the online PIN block</span></div>
<div class="line">    <span class="comment">// transmission towards the acquirer/network provider</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pintype == <a class="code" href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga370e1133a282c765ec9f12605b172e3a">EMV_CT_CVM_CUSTOM</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// custom CVM method</span></div>
<div class="line">    APP_TRACE(<span class="stringliteral">&quot;=== result of custom CVM method: OK&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_emv_ct_Programming"></a>
Programming</h1>
<p>Here you can find flow-specific use cases and general guidance of scenarios that you may need for implementation.</p>
<h2><a class="anchor" id="sec_emv_ct_Programming_APIs"></a>
Programming and API Principles</h2>
<p>This section provides programming function reference for the ADK EMV Contact framework.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Configuration_Commands"></a>
Configuration Commands</h3>
<p>For schematic figure see <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Intro_ConfigFlow">Configuration Flow</a></p>
<p>The EMV Configuration comprises the following steps:</p><ul>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Initialize_EMV_Framework">Initialize EMV Framework</a>: Turns on EMV Framework</li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Configure_Terminal_Data">Configure Terminal Data</a>: Configures terminal data.</li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Configure_Application_Data">Configure Application Data</a>: Configures AID data.</li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Configure_CAP_Keys">Configure CAP Keys</a>: Configures CAP Keys</li>
<li><b>Exit</b> <b>Framework:</b> Turns off the EMV Framework (<code><a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a></code>)</li>
</ul>
<p>The following sequence shows an EMV Configuration example for 2 AIDs and 3 CAP Keys:</p>
<div class="image">
<img src="28_emv_ct_EMV_Config_Flow_Example.png" alt=""/>
<div class="caption">
Figure: EMV Config Flow Example</div></div>
   <p><br  />
</p>
<p>The EMV configuration is stored permanently in flash files.</p>
<p><a class="anchor" id="anchor_emv_ct_Initialize_EMV_Framework"></a><b><u>Initialize EMV Framework</u></b></p>
<p>You should initialize the ADK EMV Contact framework before usage, preferably during terminal startup. In case of memory shortage, the application can separate initialization into two steps:</p><ul>
<li><b>Base</b> <b>initialization</b> <br  />
Call with <code>EMV_CT_INIT_OPT_BASE_INIT</code> set in options <br  />
To be done at terminal startup, no memory allocation.</li>
<li><b>Transaction</b> <b>initialization</b> <br  />
To be done for every transaction. Must provide memory allocation. <br  />
After end of transaction, application calls <code><a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a></code>.</li>
</ul>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00/x01 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>P2 = 0: Init Framework</b></p>
<p><b>P2 = 1: Exit Framework</b></p>
<p><br  />
<b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=0)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=1)  </td></tr>
</table>
<div class="image">
<img src="14_emv_ct_Init_Framework.png" alt=""/>
<div class="caption">
Figure: Init Framework</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p>The function interface includes four parameters:</p><ul>
<li>The number of AIDs to support</li>
<li>The function pointer for the callback</li>
<li>An arbitrary pointer, which will be relayed unchanged to callback function call (useful for object-oriented applications)</li>
<li>Initialization options.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>On the serial interface the callbacks are realized by intermediate messages. Those are received by the EMV-client (use case 1 and 2 in <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">anchor_emv_ct_Use_Case_Samples_1to4</a>). If EMV-client is not used the application has to handle this data (use case 3 and 4). In any case it's mandatory to call the Init and Exit functions.</dd></dl>
<p><br  />
</p>
<p><a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework</a>, <a class="el" href="_e_m_v___c_t___interface_8h.html#aa32731a2b868db59639385b8853170e4" title="Internal function for initialization   Don&#39;t call direct!   Instead use EMV_CT_Init_Framework.">EMV_CT_Init_Framework_Client()</a></p>
<p><a class="anchor" id="anchor_emv_ct_Configure_Terminal_Data"></a><b><u>Configure Terminal Data</u></b></p>
<p>This section presents an overview of the typical tags for terminal configuration.</p>
<p>This function provides the ADK EMV Contact framework and subsequent kernel with the terminal data it needs. The framework checks and saves the provided data in an XML file. You can configure the XML file directly (file configuration), instead of using this function (dynamic configuration).</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x01 </td><td class="markdownTableBodyNone">don’t care </td><td class="markdownTableBodyNone">x00/x01 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>P2 = 0: Set Data</b></p>
<p><b>P2 = 1: Get Data</b></p>
<p><b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=0)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Terminal data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=1)  </td></tr>
</table>
<p>The following illustration shows the Set/Get Terminal Data function.</p>
<div class="image">
<img src="11_emv_ct_Set_Get_Terminal_Data.png" alt=""/>
<div class="caption">
Figure: Set/Get Terminal Data</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga954c82bc82203115b10fcab356df0079" title="Get configured terminal data.">EMV_CT_GetTermData()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><b>Defaults and Guides</b></p>
<p>The default terminal data is an attended combined offline/online terminal, supporting all variants of CVM and card authentication:</p><ul>
<li>Currency: EUR</li>
<li>Supported languages: English</li>
<li>Country Code: France.</li>
</ul>
<p>It is recommended to configure all terminal-wide parameters from the application. If any of the parameters are missing, the default will be used. The configuration will not fail because of a missing parameter.</p>
<p>The following table show samples of configuration values.</p>
<p><b>Table: Configuration Values</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tags </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Default Value </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F35 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x22 </td><td class="markdownTableBodyNone">Terminal type  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F1A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">0x02, 0x50 (France) </td><td class="markdownTableBodyNone">Terminal country code according ISO 3166  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F33 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">0xE0, 0xF8, 0xC8 </td><td class="markdownTableBodyNone">Terminal capabilities  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F40 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0xF0, 0x00, 0xB0, 0xA0, 0x01 </td><td class="markdownTableBodyNone">Additional Terminal capabilities  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F1C </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">"00000001" </td><td class="markdownTableBodyNone">Terminal Identification  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F2A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">0x09, 0x78 (EUR) </td><td class="markdownTableBodyNone">Transaction currency code according ISO 4217. For a single transaction this value may be overwritten.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F36 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x02 </td><td class="markdownTableBodyNone">Transaction currency Exponent  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF67 </td><td class="markdownTableBodyNone">20 </td><td class="markdownTableBodyNone">0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 <br  />
 (Only 1 supported: English) </td><td class="markdownTableBodyNone">Supported languages by host (up to 20)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F1E </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">&lt; S/N (last 8 digits) &gt; </td><td class="markdownTableBodyNone">IFD Serial Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF65 </td><td class="markdownTableBodyNone">128 </td><td class="markdownTableBodyNone">(response only) </td><td class="markdownTableBodyNone">Version of EMV kernel  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF11 </td><td class="markdownTableBodyNone">128 </td><td class="markdownTableBodyNone">(response only) </td><td class="markdownTableBodyNone">Version of EMV framework  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF6B </td><td class="markdownTableBodyNone">128 </td><td class="markdownTableBodyNone">(response only) </td><td class="markdownTableBodyNone">version of L1 Driver  </td></tr>
</table>
<p><a class="anchor" id="anchor_emv_ct_EMV_Application__Terminal__Configuration_Examples"></a><b>EMV Application Terminal Configuration Examples</b></p>
<p><em>Terminal Configuration Example – Set all but IFD serial number</em> </p><div class="fragment"><div class="line">Command</div>
<div class="line">39  01  00  00  F0  42  9F  35  01  22  5F  2A  02  08  40  5F    9....B.5.&quot;_*..@_</div>
<div class="line">36  01  02  9F  1A  02  08  40  9F  33  03  E0  F8  C8  9F  40    6......@.3.....@</div>
<div class="line">05  F0  00  B0  A0  01  9F  1C  08  32  32  32  32  32  32  32    .........2222222</div>
<div class="line">32  DF  67  14  01  02  00  00  00  00  00  00  00  00  00  00    2.g.............</div>
<div class="line">00  00  00  00  00  00  00  00                                    ........</div>
<div class="line">Response                        </div>
<div class="line">90  00                      </div>
</div><!-- fragment --><p><em>Terminal Configuration Example – Set Country</em> </p><div class="fragment"><div class="line">Command</div>
<div class="line">39 01   00  00  F0  05  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1A  02  02  80                  </div>
<div class="line"> </div>
<div class="line">Response                        </div>
<div class="line">90  00                      </div>
</div><!-- fragment --><p><em>Terminal Configuration Example – Get Current</em></p>
<div class="fragment"><div class="line">Command</div>
<div class="line">39  01  00  01</div>
<div class="line"> </div>
<div class="line">Response</div>
<div class="line">90  00  F0  81  B2  9F  35  01  22  5F  2A  02  08  40  5F  36    ......5.&quot;_*..@_6</div>
<div class="line">01  02  9F  1A  02  08  40  9F  33  03  E0  F8  C8  9F  40  05    ......@.3.....@.</div>
<div class="line">F0  00  B0  A0  01  9F  1C  08  30  30  30  30  30  30  30  31    ........00000001</div>
<div class="line">DF  67  14  01  02  00  00  00  00  00  00  00  00  00  00  00    .g..............</div>
<div class="line">00  00  00  00  00  00  00  9F  1E  08  30  31  31  30  30  32    ..........011002</div>
<div class="line">30  39  DF  65  08  4C  32  37  2E  30  2E  33  72  DF  11  07    09.e.L27.0.3r...</div>
<div class="line">34  2E  31  30  2E  32  39  DF  6B  3A  49  46  4D  31  38  63    4.10.29.k:IFM18c</div>
<div class="line">2D  45  4D  56  34  2E  33  5F  41  30  30  2C  20  53  57  5F    -EMV4.3_A00, SW_</div>
<div class="line">41  30  30  2C  20  48  57  5F  41  30  30  3B  30  31  2E  33    A00, HW_A00;01.3</div>
<div class="line">37  20  30  34  2F  32  30  32  32  3B  56  32  30  30  63  20    7 04/2022;V200c </div>
<div class="line">43  54  4C  53  DF  6C  10  30  31  31  30  30  32  30  39  30    CTLS.l.011002090</div>
<div class="line">30  30  30  30  30  32  62                                        000002b</div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_Configure_Application_Data"></a><b><u>Configure Application Data</u></b></p>
<p>This function provides the ADK EMV Contact framework and subsequent kernel with the application data it needs. The framework checks and saves the provided data in an XML file. You should configure one set of parameters per application (AID). You can configure the XML file directly (file configuration), instead of using this function (dynamic configuration).</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x02 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00/x01 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>P2 = 0: Set Data</b></p>
<p><b>P2 = 1: Get Data</b></p>
<p><br  />
<b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=0)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Application data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=1)  </td></tr>
</table>
<div class="image">
<img src="12_emv_ct_Set_Get_Application_Data.png" alt=""/>
<div class="caption">
Figure: Set/Get Application Data</div></div>
   <p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga363163e375895b7d3ad03ace5df5d0d3" title="Get configured application data   Has to be called once per application (Visa, MasterCard,...">EMV_CT_GetAppliData()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><br  />
<b>Defaults and Guides</b></p>
<p>The default application is named “Default App” and includes typical EMV parameters for TACs, CDA mode 3, floorlimit 0, partial selection supported, default DOLs == 9F37, no additional or mandatory tags and terminal-wide parameters as configured per terminal and not limited. You should configure almost all AID parameters from the application because they might be changed if applicable. If any of the parameters are missing, the default will be used. The configuration will not fail because of a missing parameter once a correct AID is available.</p>
<p>The following table show samples of configuration values.</p>
<p><b>Table: AID Configuration Control</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tags </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF66 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">AID Set Requests: <br  />
 0x01 &gt; Write one AID config 0x10 &gt; Write/Clear AID config <br  />
 0x20 &gt; Write/Clear all AID configs  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF66 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">AID Get Data Request: <br  />
 0x00 &gt; Read one AID config <br  />
 0x01 &gt; Read first AID config 0x02 &gt; Read next AID config  </td></tr>
</table>
<p><b>Table: AID Configuration Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tags </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Default Value </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4F </td><td class="markdownTableBodyNone">5..16 </td><td class="markdownTableBodyNone"><b>Mandatory</b> (<b>No</b> <b>Default</b>) </td><td class="markdownTableBodyNone">Application ID  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F09 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">&lt; none &gt; <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_1">1)</a> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Terminal application version number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">50 </td><td class="markdownTableBodyNone">..16 </td><td class="markdownTableBodyNone">"Default App" <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Default application name to be used in case application label (tag 50) and application preferred name (tag 9F12) are not read from chip  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF20 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x01 </td><td class="markdownTableBodyNone">Application selection indicator (ASI)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F15 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">0x59, 0x99 </td><td class="markdownTableBodyNone">Merchant category code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F1C </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x31 </td><td class="markdownTableBodyNone">Terminal Identification  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F1B </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">0x00, 0x00, 0x00, 0x00 </td><td class="markdownTableBodyNone">Terminal floor limit (binary coded)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF24 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">0x00, 0x00, 0x00, 0x00 </td><td class="markdownTableBodyNone">Threshold Value for Biased Random Online Selection during risk management (binary coded)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF26 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">Target percentage (BCD coded) for random online selection during risk management  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF25 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">Maximum target percentage (BCD coded) for random online selection during risk management  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF21 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0x04, 0x00, 0x00, 0x00, 0x00 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Terminal Action Code - Denial  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF22 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0xF8, 0x50, 0xAC, 0xF8, 0x00 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Terminal Action Code - Online  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF23 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0xFC, 0x50, 0xAC, 0xA0, 0x00 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Terminal Action Code - Default  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF2D </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x01 </td><td class="markdownTableBodyNone">0xNN = EMV-Application (or similar) <br  />
 0xFF = non-EMV-Application  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF27 </td><td class="markdownTableBodyNone">..80 </td><td class="markdownTableBodyNone">0x9F, 0x37, 0x04 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Default TDOL  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF28 </td><td class="markdownTableBodyNone">..80 </td><td class="markdownTableBodyNone">0x9F, 0x37, 0x04 </td><td class="markdownTableBodyNone">Default DDOL  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F16 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20 </td><td class="markdownTableBodyNone">Merchant Identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF3E </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x02 </td><td class="markdownTableBodyNone">CDA processing, maximum security or maximum speed: <br  />
 0x00 - CDA for ARQC: yes, for TC after successful online communication: yes <br  />
 0x01 - CDA for ARQC: yes, for TC after successful online communication: no <br  />
 0x02 - CDA for ARQC: no, for TC after successful online communication: no <br  />
 0x03 - CDA for ARQC: no, for TC after successful online communication: yes  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF15 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">TACIAC Default handling: <br  />
 0x00 - process default action codes prior to 1st GENERATE AC <br  />
 0x01 - process default action codes after 1st GENERATE AC  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF2E </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">Behavior for AIP 'CVM not supported': <br  />
 0x00 - continue transaction 0x01 - execute CVM signature <br  />
 0x02 - execute CVM online PIN 0x03 - abort transaction  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F39 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x05 </td><td class="markdownTableBodyNone">POS entry mode according ISO 8583:1987  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF5F </td><td class="markdownTableBodyNone">..20 </td><td class="markdownTableBodyNone">&lt; none &gt; </td><td class="markdownTableBodyNone">Up to 10 additional terminal application version numbers (each two byte, network byte order)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF2B </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0x01, 0x1A, 0x00, 0x00, 0x00 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">See AID Application Flow Capabilities (see <a class="el" href="group___a_p_p___f_l_o_w___c_a_p_s.html">Defines for Application flow capabilities</a>)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF29 </td><td class="markdownTableBodyNone">..255 </td><td class="markdownTableBodyNone">&lt; none &gt; </td><td class="markdownTableBodyNone">Additional Tags, TLV encoded  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF2A </td><td class="markdownTableBodyNone">..40 </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">Up to 20 mandatory tags (each two bytes, network byte order)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F33 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">0xE0, 0xF8, 0xC8 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Application Specific Terminal capabilities  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F28 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">0x02, 0x50 </td><td class="markdownTableBodyNone">Application Specific Terminal country code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F40 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0xF0, 0x00, 0xB0, 0xA0, 0x01 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_2">2)</a> </sup> </td><td class="markdownTableBodyNone">Application Specific Additional terminal capabilities  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F35 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x22 </td><td class="markdownTableBodyNone">Application Specific Terminal Type  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF1D </td><td class="markdownTableBodyNone">5..16 </td><td class="markdownTableBodyNone">&lt; none &gt; </td><td class="markdownTableBodyNone">priority applications (tag might occur up to 5 times) <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_3">3)</a> </sup>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF17 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0, 0, 0 </td><td class="markdownTableBodyNone">3 associated mag. stripe IDs, only non-Null values are relevant <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_3">3)</a> </sup>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF1C </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">0x21, 0x20, 0x11, 0x02, 0x00, 0x00, 0x00, 0x00 </td><td class="markdownTableBodyNone">16 half bytes transaction use case filter <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_3">3)</a> </sup>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF18 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">settings for fallback from chip to mag. stripe in conjunction with DF17 <sup> <a class="el" href="pg_emv_contact_users_guide.html#fnEmvctTab10_3">3)</a> </sup>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF2F </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone">code for custom (non-EMVCo defined) CVM method supported by this application  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF13 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">0x21, 0x05, 0x00, 0x00, 0x00 </td><td class="markdownTableBodyNone">flags for supplementary terminal capabilities affecting EMVCo configuration checksum  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF12 </td><td class="markdownTableBodyNone">32 </td><td class="markdownTableBodyNone">(response only) </td><td class="markdownTableBodyNone">EMVCo checksum  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DFD004 </td><td class="markdownTableBodyNone">..3 </td><td class="markdownTableBodyNone">0x00, 0x00, 0x00 </td><td class="markdownTableBodyNone">Transaction types for sale (omitted in response if at default)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DFD005 </td><td class="markdownTableBodyNone">..3 </td><td class="markdownTableBodyNone">0x01, 0x01, 0x01 </td><td class="markdownTableBodyNone">Transaction types for cash-out (omitted in response if at default)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DFD006 </td><td class="markdownTableBodyNone">..3 </td><td class="markdownTableBodyNone">0x09, 0x09, 0x09 </td><td class="markdownTableBodyNone">Transaction types for cash back (omitted in response if at default)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DFD007 </td><td class="markdownTableBodyNone">..3 </td><td class="markdownTableBodyNone">0x20, 0x20, 0x20 </td><td class="markdownTableBodyNone">Transaction types for refund (omitted in response if at default)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DFAB58 </td><td class="markdownTableBodyNone">..88 </td><td class="markdownTableBodyNone">&lt; none &gt; </td><td class="markdownTableBodyNone">Data Container Read IDs for D-PAS data exchange  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DFAB59 </td><td class="markdownTableBodyNone">..88 </td><td class="markdownTableBodyNone">&lt; none &gt; </td><td class="markdownTableBodyNone">Data Container Read ranges for D-PAS data exchange  </td></tr>
</table>
<p><a class="anchor" id="fnEmvctTab10_1"></a><sup> 1) </sup> If none is configured card's application version is used during transaction</p>
<p><a class="anchor" id="fnEmvctTab10_2"></a><sup> 2) </sup> Depending on AID and Terminal Type some default application data settings get adapted values, e.g. a MasterCard application gets "Mastercard" as default application label. Note that these default settings might change any time as ADK EMV evolves. Also note that especially Terminal Capabilities and Additional Terminal Capabilities are not inherited from the terminal settings. Therefore do not rely on and configure all fields as recommended above.</p>
<p><a class="anchor" id="fnEmvctTab10_3"></a><sup> 3) </sup> Settings for special operation. Do not configure unless required.</p>
<p><a class="anchor" id="anchor_emv_ct_EMV_Application__AID__Configuration_Examples_II_"></a><b>EMV Application (AID) Configuration Examples</b></p>
<p><em>AID Configuration Example – Set MC Data</em> </p><div class="fragment"><div class="line">Command – Configure Multiple Parameters</div>
<div class="line">39  02  00  00  F0  81  A2  DF  66  01  01  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  07  A0  00  00</div>
<div class="line">00  04  10  10  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  09  02  00  02  50  0B  4D  61  73  74  65</div>
<div class="line">72  63  61  72  64  00  DF  20  01  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  15  02  59  99  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">1C  08  31  32  33  34  35  36  37  38  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1B  04  00  00  13</div>
<div class="line">88  DF  24  04  00  00  01  F4  DF  26  01  00  DF  25  01  00</div>
<div class="line">DF  21  05  04  00  00  00  00  DF  22  05  F8  50  AC  F8  00</div>
<div class="line">DF  23  05  FC  50  AC  A0  00  DF  2D  01  01  DF  27  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">02  06  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2A  02  9A  03  9C  01  95  05  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  37  04  DF  28</div>
<div class="line">03  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  37  04  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  16  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  20  20  20  20  20  20  20  20</div>
<div class="line">20  20  20  20  20  20  DF  29  04  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  53  01  52  DF  2A  01</div>
<div class="line">8E  DF  2B  05  0E  00  22  00  00      </div>
<div class="line">                    </div>
<div class="line">Response </div>
<div class="line">90 00</div>
</div><!-- fragment --><p><em>AID Configuration Example – Set Visa Data</em> </p><div class="fragment"><div class="line">Command – Configure Label Only  </div>
<div class="line">39  02  00  00  F0  1B  DF  66  01  01  4F  07  A0  00  00  00   9......f..O.....</div>
<div class="line">03  10  10  50  0C  56  69  73  61  20  64  65  66  61  75  6C   ...P.Visa defaul</div>
<div class="line">74                                                               t</div>
<div class="line">Response </div>
<div class="line">90 00</div>
</div><!-- fragment --><p><em>AID Configuration Example – Get Visa Data</em> </p><div class="fragment"><div class="line">Command</div>
<div class="line">39  02  00  01  F0  0D  DF  66  01  00  4F  07  A0  00  00  00</div>
<div class="line">03  10  10</div>
<div class="line"> </div>
<div class="line">Response</div>
<div class="line">90  00  F0  82  01  28  4F  07  A0  00  00  00  03  10  10  9F    .....(O.........</div>
<div class="line">09  02  00  8C  DF  5F  14  FF  FF  FF  FF  FF  FF  FF  FF  FF    ....._..........</div>
<div class="line">FF  FF  FF  FF  FF  FF  FF  FF  FF  FF  FF  50  0C  56  69  73    ...........P.Vis</div>
<div class="line">61  20  64  65  66  61  75  6C  74  DF  20  01  01  9F  15  02    a default. .....</div>
<div class="line">59  99  9F  1C  08  30  30  30  30  30  30  30  31  9F  1B  04    Y....00000001...</div>
<div class="line">00  00  00  00  DF  49  04  00  00  00  00  DF  4A  03  E0  F8    .....I......J...</div>
<div class="line">C8  DF  24  04  00  00  00  00  DF  26  01  00  DF  25  01  00    ..$......&amp;...%..</div>
<div class="line">DF  21  05  00  10  00  00  00  DF  22  05  DC  40  04  F8  00    .!.......&quot;..@...</div>
<div class="line">DF  23  05  DC  40  00  80  00  DF  2D  01  01  DF  27  03  9F    .#..@....-...&#39;..</div>
<div class="line">37  04  DF  28  03  9F  37  04  9F  16  0F  20  20  20  20  20    7..(..7....     </div>
<div class="line">20  20  20  20  20  20  20  20  20  20  DF  15  01  00  9F  39              .....9</div>
<div class="line">01  05  DF  3E  01  02  DF  29  00  DF  2C  00  DF  2A  00  9F    ...&gt;...)..,..*..</div>
<div class="line">33  03  E0  F8  C8  DF  2B  05  01  03  00  00  00  DF  2E  01    3.....+.........</div>
<div class="line">00  9F  1A  02  02  50  5F  28  02  02  50  9F  40  05  F0  00    .....P_(..P.@...</div>
<div class="line">B0  A0  01  9F  35  01  22  DF  17  03  00  00  00  DF  1C  08    ....5.&quot;.........</div>
<div class="line">21  20  11  02  00  00  00  00  DF  18  01  00  DF  2F  01  00    ! .........../..</div>
<div class="line">DF  13  05  21  05  00  00  00  DF  12  20  36  33  30  34  31    ...!...... 63041</div>
<div class="line">38  41  45  37  30  38  42  38  38  45  38  35  36  45  34  37    8AE708B88E856E47</div>
<div class="line">36  39  45  36  32  39  41  43  33  37  43  DF  04  00            69E629AC37C...</div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_Configure_CAP_Keys"></a><b><u>Configure CAP Keys</u></b></p>
<p>This function provides the ADK EMV Contact framework and subsequent kernel with the CAP keys it needs. The framework checks and saves the provided data in an XML file. You can configure the XML file directly (file configuration), instead of using this function (dynamic configuration). Additionally, you can add revoked certificates for each of the keys here, if the application supports the request. Currently, maximum number of CAP keys to be stored is 100 (for both: file and dynamic configuration).</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x03 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00/x01 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>P2 = 0: Set Data</b></p>
<p><b>P2 = 1: Get Data</b></p>
<p><br  />
<b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=0)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Key data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Function executed, xx = response code (P2=1)  </td></tr>
</table>
<div class="image">
<img src="13_emv_ct_Set_Get_CAP_Keys.png" alt=""/>
<div class="caption">
Figure: Set/Get CAP Keys</div></div>
   <p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___c_o_n_f.html#gade5b2bbc6ab46c4b7d9efa991b696ad2" title="Stores the specified CAP key.">EMV_CT_StoreCAPKey()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga429a19bcd6b86ff1f165ff681ae6c79a" title="Reads CAP keys.">EMV_CT_ReadCAPKeys()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga597af0018e1df21cfbd7e52fd4756c9a" title="Reads CAP key information.">EMV_CT_GetCAPKeyInfo()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><b>Table: CA Key Configuration Control</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tags </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF66 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">CA Key Set Request: <br  />
 0x01 &gt; Write one CA Key <br  />
 0x10 &gt; Clear one CA Key <br  />
 0x20 &gt; Clear all CA Keys  </td></tr>
</table>
<p><b>Table: CA Key Configuration Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tags </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF09 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">Key Index  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF0B </td><td class="markdownTableBodyNone">248 Max </td><td class="markdownTableBodyNone">Key Data (modulus)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF0A </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">Associated RID  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF0D </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">3 (0x03) or 65535 (0x01)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF0C </td><td class="markdownTableBodyNone">20 </td><td class="markdownTableBodyNone">SHA-1 of RID, Index, Key, Exp  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF0E </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">Revocation Serial Numbers (3 bytes each)  </td></tr>
</table>
<p><br  />
<em>Defaults and Example</em></p>
<p>The default is an empty CAP Key list. Not configuring keys will result in card authentication failure and the corresponding TVR bits will be raised by the kernel. Once a hash is included to the CAP key injection, this will be cross checked. If not Ok, the injection will be rejected.</p>
<p><b>EMV CA Key Configuration Example</b></p>
<p><em>CA Key Configuration Example – Set Visa Key 99</em> </p><div class="fragment"><div class="line">Command</div>
<div class="line">39  03  44  00  F0  81  AF  DF  66  01  01  DF  09  01  99  DF</div>
<div class="line">0A  05  A0  00  00  00  03  DF  0B  81  80  AB  79  FC  C9  52</div>
<div class="line">08  96  96  7E  77  6E  64  44  4E  5D  CD  D6  E1  36  11  87</div>
<div class="line">4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  39  85  72  25  20  42  52  95  EE  A4  BD  0C  27  81  DE</div>
<div class="line">7<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  31  CD  3D  04  1<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  56  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  74  73  06  EE  D6  29  54  B1</div>
<div class="line">7E  DA  BA  3A  6C  5B  85  A1  DE  1B  EB  9A  34  14  1A  F3</div>
<div class="line">8<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  CF  82  79  C9  DE  A0  D5  A6  71  0D  08  DB  41  24  F0</div>
<div class="line">41  94  55  87  E2  03  59  BA  B4  7B  75  75  AD  94  26  2D</div>
<div class="line">4B  25  F2  64  AF  33  DE  DC  F2  8E  09  61  5E  93  7D  E3</div>
<div class="line">2E  DC  03  C5  44  45  FE  7E  38  27  77  DF  0C  14  4A  BF</div>
<div class="line">FD  6B  1C  51  21  2D  05  55  2E  43  1C  5B  17  00  7D  2<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">5E  6D  DF  0D  01  03                                      </div>
<div class="line"> </div>
<div class="line">Response</div>
<div class="line">90 00</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_Transaction_Commands"></a>
Transaction Commands</h3>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p>Use the following to implement Transaction Commands:</p><ul>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Starting_a_Transaction">Starting a Transaction</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Continue_a_Transaction__Offline_Part">Continue a Transaction Offline Part</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Continue_a_Transaction__Online_Part">Continue a Transaction Online Part</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Fetching_Additional_Tags">Fetching Additional Tags</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Send_EMV_PIN_to_Smart_Card">Send EMV PIN to Smart Card</a></li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_Transaction_Sequence"></a>
Transaction Sequence</h3>
<p>The following illustration shows the transaction sequence flow.</p>
<div class="image">
<img src="30_emv_ct_Transaction_Sequence.png" alt=""/>
<div class="caption">
Figure: Transaction Sequence</div></div>
   <p><a class="anchor" id="anchor_emv_ct_Starting_a_Transaction"></a><b>Starting a Transaction</b></p>
<p>You can use this function to start a transaction, which runs application selection. Terminals are usually configured with several applications, but on the ICC, the configuration may include one or several applications.</p>
<p>You should determine which application to use for payment transactions.</p>
<p>Use the following ways to find out how the ICC and the terminal (000candidate list) support AIDs:</p><ul>
<li><b>PSE</b> <br  />
Only possible with the support of terminal and ICC.<br  />
ICC contains a directory including all supported applications. Find intersection with the terminal‘s supported AIDs.<br  />
</li>
<li><b>Explicit</b> <b>Select</b> for all terminal-known applications.<br  />
If there are several candidates, a callback prompts the cardholder to choose the application.<br  />
The Final SELECT is done for the chosen application. The ICC works on the AID’s data.<br  />
 <em>Serial Interface</em></li>
</ul>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x10 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Txn Data  </td></tr>
</table>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">txn data (application selection) </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="15_emv_ct_Start_Transaction.png" alt=""/>
<div class="caption">
Figure: Start Transaction</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><em>Defaults and Example</em></p>
<p>Use this function to initialize a transaction. You can set the known amount, transaction type, currency, date, time and a number of transaction options. You should supply these essential transaction parameters at this point, although you can change parameters further during transaction processing. In contact mode this step performs application selection including the final select. Subsequently the application may proceed with its own apps kernel or use <code>Continue_Offline</code> to use the EMV kernel to process an EMV transaction.</p>
<p><em>Typical tags</em></p>
<p>This section presents an overview of typical tags for the Start transaction.</p>
<p><b>Table: Start Transaction Command Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9C </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Transaction type, according to ISO 8583 - Annex A: <br  />
 Processing Code, Position 1 + 2  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F02 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Transaction amount auth  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F2A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Currency code to be used for transaction. <br  />
 Only needed in case of DCC  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F36 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Currency exponent to be used for transaction. Only needed in case of DCC  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9A </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Transaction date (YYMMDD). <br  />
 E105 RTC does not supply transaction date.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F21 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Transaction time (HHMMSS). <br  />
 E105 RTC does not supply transaction time.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F41 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">Y </td><td class="markdownTableBodyNone">Transaction Sequence Counter <br  />
 Must be supplied. E105 does not keep sequence counter.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F03 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount Other (CashBack)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF40 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Force Online (if supported by AID config) 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF43 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Force Accept (if supported by AID config) 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF48 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">”Request ARQC from card, but don’t set “suspicious bit” <br  />
 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF57 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Account Type: <br  />
 &gt; 0x00 Default <br  />
 &gt; 0x10 Savings <br  />
 &gt; 0x20 Cheque Debit <br  />
 &gt; 0x30 Credit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF47 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Preselected customer language. <br  />
 See <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Different_Languages">Different Languages</a> .  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF34 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount confirmation (if not PIN + Amount Confirm) not configured): <br  />
 &gt; 0x00 Confirm Amount immediately after language selection before CVM <br  />
 &gt; 0x01 Confirm Amount after cardholder verification  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF05 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Build App List: <br  />
 &gt; 0x00 Reuse the existing list and remove the currently activated AID, e.g. 6985 at GPO <br  />
 &gt; 0x01 Build a new candidate list (needs to be set on start of transaction) <br  />
 &gt; 0xFn Reuse the existing list do not remove anything and select candidate n of the candidate list  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF45 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Do not process PSE (E105 default is False): 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF4D </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Cardholder confirmation: 0x00 = Yes, 0x01 = No  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF36 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">See <a class="el" href="group___t_x_n___o_p_t_i_o_n_s.html">Options for transaction processing</a> .  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF37 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">See <a class="el" href="group___t_x_n___s_t_e_p_s.html">Re-entrance options</a> .  </td></tr>
</table>
<p><b>Table: Start Transaction Response Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">84 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">DF Name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">50 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">App Label (not App Label according to EMVCo)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF33 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">App Name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F11 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer code table  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F12 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">App preferred name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F2D </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Preferred language  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF62 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">EMV Framework Error data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF63 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Display Text Index  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF4E </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">0x80 = final amount (9F02/81) is required for application initialization (GPO)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FF03 </td><td class="markdownTableBodyNone">var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Candidate list containing: <br  />
 DF04 - AID <br  />
 50 - App Label (not App Label according to EMVCo)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF04 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Selected AID Name  </td></tr>
</table>
<p><a class="anchor" id="anchor_emv_ct_EMV_Start_Transaction_Examples"></a><b>EMV Start Transaction Examples</b></p>
<p><em>Start Transaction Command for EUR 1.00 on Multi App Card</em> </p><div class="fragment"><div class="line">Start Command &gt;&gt;</div>
<div class="line">39  10  00  00  F0  2C  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  02  06  00  00  00  00  01  00  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">2A  02  09  78  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  01  02  9A  03  13  02  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  21  03</div>
<div class="line">12  00  00  9C  01  00  DF  05  01  01  DF  36  05  01  00  00</div>
<div class="line">00  00                                                      </div>
<div class="line"> </div>
<div class="line">AppSel Callback Command &lt;&lt;</div>
<div class="line">91  01  F0  34  BF  04  31  DF  74  01  01  50  0B  56  69  73</div>
<div class="line">61  20  43  72  65  64  69  74  50  0A  4D  61  73  74  65  72</div>
<div class="line">63  61  72  64  DF  04  07  A0  00  00  00  03  10  10  DF  04</div>
<div class="line">07  A0  00  00  00  04  10  10                              </div>
<div class="line"> </div>
<div class="line">AppSel Callback Response &gt;&gt; </div>
<div class="line">92  01  F0  04  DF  75  01  01</div>
<div class="line"> </div>
<div class="line">Start Response &lt;&lt;</div>
<div class="line">90  00  F0  66  84  07  A0  00  00  00  03  10  10  50  0B  56</div>
<div class="line">69  73  61  20  43  72  65  64  69  74  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  11  01  01  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2D</div>
<div class="line">08  65  6E  65  73  64  65  66  72  DF  4E  01  00  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  03  17</div>
<div class="line">DF  04  07  A0  00  00  00  03  10  10  50  0B  56  69  73  61</div>
<div class="line">20  43  72  65  64  69  74  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  03  16  DF  04  07  A0  00  00</div>
<div class="line">00  04  10  10  50  0A  4D  61  73  74  65  72  63  61  72  64</div>
<div class="line">DF  04  07  A0  00  00  00  03  10  10                      </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Start Transaction Command <span class="keywordflow">for</span> EUR 1.00 on single app card </div>
<div class="line">Start Command &gt;&gt;</div>
<div class="line">39  10  00  00  F0  24  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  02  06  00  00  00  00  01  00  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">2A  02  09  78  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  01  02  9A  03  13  02  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  21  03</div>
<div class="line">12  00  00  9C  01  00  DF  05  01  01                      </div>
<div class="line"> </div>
<div class="line">Start Response &lt;&lt;</div>
<div class="line">90  00  F0  48  84  07  A0  00  00  00  03  10  10  50  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  43</div>
<div class="line">52  45  44  49  54  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  44  45  20  56  49  53  41  DF  33</div>
<div class="line">0B  56  49  53  41  20  43  52  45  44  49  54  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  11  01  01</div>
<div class="line">9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  12  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  43  52  45  44  49  54  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  44  45  20  56  49</div>
<div class="line">53  41  DF  04  07  A0  00  00  00  03  10  10              </div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_Continue_a_Transaction__Offline_Part"></a><b>Continue a Transaction (Offline Part)</b></p>
<p>This section presents an overview on typical tags for continuing the transaction after the final selection by using the EMVCo CT kernel.</p>
<p>If the “EMV Start Transaction” phase results in an EMV application being found on the card, then a transaction shall be performed. The EMV Offline Transaction performs the offline part of an EMV transaction.</p>
<p>During the EMV Offline Transaction various Callback shall be used. Some of the Callback require UI processing and checking by the host device. The potential callbacks are:</p><ul>
<li><b>Amount</b> <b>Conf:</b> For Amount Confirmation</li>
<li><b>Hotlist/Log</b>: For Transaction Log and Hotlist</li>
<li><b>Domestic/Local</b> Checks: For local PAN checks</li>
<li><b>DCC:</b> For DCC processing.</li>
</ul>
<p>You can use this function to perform offline EMV transactions. Possible results for Offline Transactions:</p><ul>
<li>Decline</li>
<li>Accept offline</li>
<li>Go online</li>
<li>Terminate</li>
<li>Fallback.</li>
</ul>
<p>The following diagram shows the flow for offline transactions.</p>
<div class="image">
<img src="16_emv_ct_Offline_Transaction.png" alt=""/>
<div class="caption">
Figure: Offline Transaction</div></div>
   <p><br  />
</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x11 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Txn Data  </td></tr>
</table>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">txn data (txn result offline) </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="17_emv_ct_Continue_Transaction_Offline.png" alt=""/>
<div class="caption">
Figure: Continue Transaction Offline</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><em>Defaults and Example</em></p>
<p>Use this section to determine how to continue an offline EMV transaction. You can change the amount, add a cashback amount, add the transaction counter for this AID and configure a few more transaction parameters (e.g., callbacks supported). In contact mode, this step performs the offline part of the transaction, ending with the 1st GAC. The payment is completed after this step.</p>
<p><b>Table: EMV Transaction Offline Command Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F02 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction amount auth  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F2A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Currency code to be used for transaction. <br  />
 Only needed in case of DCC  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F36 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Currency exponent to be used for transaction. Only needed in case of DCC  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9A </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction date (YYMMDD).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F21 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction time (HHMMSS).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F03 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount Other (CashBack)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF40 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Force Online (if supported by AID config) <br  />
 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF43 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Force Accept (if supported by AID config) <br  />
 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF48 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Request ARQC from card, but don't set “suspicious bit” <br  />
 0x01 = True, 0x00 = False  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF57 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Account Type: <br  />
 &gt; 0x00 Default <br  />
 &gt; 0x10 Savings <br  />
 &gt; 0x20 Cheque Debit <br  />
 &gt; 0x30 Credit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF47 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Preselected customer language. <br  />
 See <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Different_Languages">Different Languages</a> .  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF34 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount confirmation (if not PIN + Amount Confirm) not configured): <br  />
 &gt; 0x00 Confirm Amount immediately after language selection before CVM <br  />
 &gt; 0x01 Confirm Amount after cardholder verification  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF14 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional Tags  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF36 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">See EMV Transaction Options (Tag DF36)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF37 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">See EMV Transaction Steps (Tag DF37)  </td></tr>
</table>
<p><b>Table: EMV Transaction (offline and online) Response Data</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">For Card Data See: <br  />
 &gt; Offline Transaction Card Data <br  />
 &gt; Online Transaction Card Data <br  />
 &gt; Online Transaction with Online PIN Card Data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF42 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Status Info  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F27 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Cryptogram information data (CID)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F36 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application transaction counter (ATC)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F26 </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application cryptogram  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F39 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">POS entry mode  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F41 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Sequence Counter  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F34 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PAN sequence number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F10 </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Application Data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F37 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Unpredictable Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">95 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Verification Results  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9A </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Date  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F21 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Time  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9C </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Type  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F2A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Currency Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">82 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Interchange Profile  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F1A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Country Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F34 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">CVM Results  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F33 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Capabilities  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F35 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Type  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F1E </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Interface Device (IFD) serial number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">84 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. Dedicated File (DF) Name  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F09 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">vApplication Version Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF08 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Script Result Critical  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF07 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Script Result Uncritical  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9B </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Status Information  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F06 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Identifier (AID)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF29 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional Tags  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F53 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Category Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F02 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount <a class="el" href="class_auth.html">Auth</a> Numeric  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F03 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount <a class="el" href="class_auth.html">Auth</a> Other  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F12 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application name, zero terminated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F25 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Effective Date  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F28 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Country Code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F45 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Data Authentication Code, present if SDA card  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F4C </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. optional: present if DDA/CDA card  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF21 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Denial  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF22 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Online  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF23 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Default  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F0E </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Denial  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F0F </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Online  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F0D </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Default  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F40 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional Terminal Capabilities  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5A </td><td class="markdownTableBodyNone">10 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PAN  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">57 </td><td class="markdownTableBodyNone">19 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Track 2 equivalent data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF62 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional error data, filled if transaction is not successful  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF64 </td><td class="markdownTableBodyNone">32 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Kernel Debug  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F16 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Merchant Identifier  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF63 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Filled with index of display text id if anything should be displayed  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F20 </td><td class="markdownTableBodyNone">27 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. Cardholder Name  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F2D </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Language Preference (zero terminated)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F08 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">ICC Application Version Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F36 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Currency Exponent  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF59 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Number of wrong PIN entries (only in case of offline PIN)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F30 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Service code as defined in ISO/IEC 7813 for track 1 and track 2 format  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF17 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Fallback MID to be used.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8E </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">CVM list retrieved from ICC  </td></tr>
</table>
<p><a class="anchor" id="anchor_emv_ct_EMV_Offline_Transaction_Example"></a>EMV Offline <b>Transaction Example</b></p>
<p><em>Offline Transaction Command</em> </p><div class="fragment"><div class="line">Offline Command &gt;&gt;</div>
<div class="line">39  11  00  00  F0  2D  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  41  04  00  00  00  01  DF  46  06</div>
<div class="line">00  00  00  00  00  00  DF  58  06  00  00  00  00  00  00  DF</div>
<div class="line">4E  01  00  DF  47  01  00  DF  34  01  00  DF  36  05  01  2C</div>
<div class="line">0C  00  00                                                  </div>
<div class="line"> </div>
<div class="line">Amount Conf Callback Command &lt;&lt;</div>
<div class="line">91  01  F0  20  BF  02  1D  DF  30  01  01  DF  31  01  02  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">02  06  00  00  00  00  01  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  03  06  00  00  00  00  00</div>
<div class="line">00  9C  01  00                              </div>
<div class="line"> </div>
<div class="line">Amount Conf Callback Response &gt;&gt; </div>
<div class="line">92  01  F0  04  DF  71  01  01</div>
<div class="line"> </div>
<div class="line">Hotlist/Log Callback Command &lt;&lt;</div>
<div class="line">91  01  F0  3D  BF  03  3A  DF  1A  08  47  61  73  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a></div>
<div class="line"><a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  DF  3D  10  2B  D9  50  22  25  9D  58  31  6C  34  C2</div>
<div class="line">2D  75  45  A3  10  DF  16  08  A3  EC  41  60  43  21  C9  8E</div>
<div class="line">DF  3<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0A  DD  DD  98  76  54  22  22  E0  00  0E  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  34  01</div>
<div class="line">01                                                          </div>
<div class="line"> </div>
<div class="line">Hotlist/Log Callback Response &gt;&gt; </div>
<div class="line">92  01  F0  00</div>
<div class="line"> </div>
<div class="line">Offline Response &lt;&lt;</div>
<div class="line">90  E3  F0  82  01  A0  DF  3D  10  2B  D9  50  22  25  9D  58</div>
<div class="line">31  6C  34  C2  2D  75  45  A3  10  DF  16  08  A3  EC  41  60</div>
<div class="line">43  21  C9  8E  DF  3<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0A  DD  DD  98  76  54  22  22  E0  00</div>
<div class="line">0E  DF  1A  0A  47  61  73  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  DF  42</div>
<div class="line">02  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  27  01  40  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  02  00  02  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  26  08  CE</div>
<div class="line">D8  D6  C7  04  15  81  69  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  39  01  05  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  41  04  00  00</div>
<div class="line">00  01  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  34  01  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  10  07  06  01  0A  03  60  00  00</div>
<div class="line">9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  37  04  B9  C2  98  98  95  05  00  00  00  00  00  9A  03</div>
<div class="line">13  02  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  21  03  12  00  00  9C  01  00  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2A  02  09</div>
<div class="line">78  82  02  5C  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1A  02  02  80  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  34  03  41  03  02</div>
<div class="line">9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  33  03  E0  F8  C8  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  35  01  22  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1E  08  31  32  33</div>
<div class="line">34  35  36  37  38  84  07  A0  00  00  00  03  10  10  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  09</div>
<div class="line">02  00  8C  9B  02  E8  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  06  07  A0  00  00  00  03  10</div>
<div class="line">10  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  12  0B  56  69  73  61  20  43  72  65  64  69  74  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">25  03  10  01  01  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  28  02  08  40  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  45  02  DA  C0  DF</div>
<div class="line">21  05  00  10  00  00  00  DF  22  05  D8  40  04  F8  00  DF</div>
<div class="line">23  05  D8  40  00  A8  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0E  05  00  50  88  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  05  F0  20  04  98  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0D  05  F0  20  04  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">40  05  F0  00  B0  A0  01  DF  64  20  90  00  00  00  BA  C1</div>
<div class="line">08  00  40  40  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  00  21  90  90  01  00  00  00  D1  85</div>
<div class="line">6<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  00  00  00  00  00  00  00  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  16  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  20  20</div>
<div class="line">20  20  20  20  20  20  20  20  20  20  20  20  DF  63  01  03</div>
<div class="line">5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  08  53  44  41  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  4E  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  52  4D  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2D  08  65  6E</div>
<div class="line">65  73  64  65  66  72  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  08  02  00  8C  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  01  02  DF</div>
<div class="line">59  01  00  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  30  02  02  01  8E  1C  00  00  00  00  00  00</div>
<div class="line">00  00  41  03  42  03  5E  03  43  03  1<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  00  00  00  00  00</div>
<div class="line">00 00   00  00  00  00</div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_Continue_a_Transaction__Online_Part"></a><b>Continue a Transaction (Online Part)</b></p>
<p>This section presents an overview of the typical tags for continuing the transaction after the host call.</p>
<p>If the “EMV Offline Transaction” results in “Go online“ then the host device must contact the Payment Host for a decision about the transaction. The Payment Host can return the following outcomes:</p><ul>
<li>Decline</li>
<li>Approve</li>
<li>Host not reachable</li>
</ul>
<p>The Payment Host may send Authentication data that must be transferred to the ICC. The ICC will check Authentication data to assure authenticity of host response.</p>
<p>The Payment Host may also send issuer scripts, e.g. PIN (un)block, or any other proprietary commands. These must also be relayed to the ICC.</p>
<p>Two categories of issuer scripts:</p><ul>
<li>Critical scripts – to be sent to ICC before GENAC2</li>
<li>Uncritical scripts – to be processed after GENAC2</li>
</ul>
<p>You can use this function to perform online EMV transactions. Possible outcomes for Online Transactions:</p><ul>
<li>Decline</li>
<li>Approve</li>
<li>Host not reachable.</li>
</ul>
<p>The host may send Authentication data to the ICC. The ICC will check the data to for authenticity of the host response.</p>
<p>The host may also send issuer scripts, e.g. PIN (un)block, or any other proprietary commands to the ICC.</p>
<p>Two categories of issuer scripts:</p><ul>
<li>Critical scripts – to be sent to ICC before GENAC2</li>
<li>Uncritical scripts – to be processed after GENAC2.</li>
</ul>
<p>The following diagram shows the flow for online transactions.</p>
<div class="image">
<img src="18_emv_ct_Online_Transaction.png" alt=""/>
<div class="caption">
Figure: Online Transaction</div></div>
   <p><br  />
</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x12 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Host Data  </td></tr>
</table>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">txn data (txn result online) </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="18_emv_ct_Continue_Transaction_Online.png" alt=""/>
<div class="caption">
Figure: Continue Transaction Online</div></div>
   <p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><em>Defaults and Example</em></p>
<p>Use this section to complete a transaction after host communication. The parameters do not have any default values because they are either received by the host or they are not available. This includes the response code from the host, issuer application data, as well as critical and uncritical scripts. In contact mode this step performs issuer authentication, script processing and the 2nd GAC. The transaction is completed with this step.</p>
<p><b>Table: EMV Transaction Online Command Data (<a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___h_o_s_t___s_t_r_u_c_t" title="Data structure for host response data. Input for EMV_CT_ContinueOnline()">EMV_CT_HOST_STRUCT</a>)</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF50 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">OnlineResult  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8A </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">AuthResp  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF52 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">LenAuth, AuthData  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF53 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">LenScriptCrit, ScriptCritData  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF54 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">LenScriptUnCrit, ScriptUnCritData  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">89 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">AuthorizationCode  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF51 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Result_referral  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF55 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">AuthResp_Referral  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF56 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">AuthResp_Wrong_PIN  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF57 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">AuthResp_Positive  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F02 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PreAuth_Amount  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF36 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">TxnOptions  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF37 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">TxnSteps  </td></tr>
</table>
<p><b>Table: EMV Transaction Online Response Data (<a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___t_r_a_n_s_r_e_s___s_t_r_u_c_t" title="Data structure for output data of EMV_CT_ContinueOffline() and EMV_CT_ContinueOnline()">EMV_CT_TRANSRES_STRUCT</a>)</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag </th><th class="markdownTableHeadNone">Size </th><th class="markdownTableHeadNone">Mandatory </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF42 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Status Info  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F27 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Cryptogram information data (CID)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F36 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application transaction counter (ATC)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F26 </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application cryptogram  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F39 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">POS entry mode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F41 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Sequence Counter  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F34 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PAN sequence number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F10 </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Application Data  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F37 </td><td class="markdownTableBodyNone">4 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Unpredictable Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">95 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Verification Results  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9A </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Date  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F21 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Time  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9C </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Type  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F2A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Currency Code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">82 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Interchange Profile  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F1A </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Country Code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F34 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">CVM Results  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F33 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Capabilities  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F35 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Type  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F1E </td><td class="markdownTableBodyNone">8 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Interface Device (IFD) serial number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">84 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. Dedicated File (DF) Name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F09 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Version Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF08 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Script Result Critical  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF07 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Script Result Uncritical  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9B </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Status Information  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F06 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Identifier (AID)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF29 </td><td class="markdownTableBodyNone">Var </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional Tags  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F53 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Category Code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F02 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount <a class="el" href="class_auth.html">Auth</a> Numeric  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F03 </td><td class="markdownTableBodyNone">6 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Amount <a class="el" href="class_auth.html">Auth</a> Other  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F12 </td><td class="markdownTableBodyNone">17 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application name, zero terminated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F25 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Application Effective Date  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F28 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Country Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F45 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Data Authentication Code, present if SDA card  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F4C </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. optional: present if DDA/CDA card  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF21 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Denial  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF22 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Online  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF23 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Terminal Action Code - Default  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F0E </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Denial  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F0F </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Online  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F0D </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Issuer Action Code - Default  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9F40 </td><td class="markdownTableBodyNone">5 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional Terminal Capabilities  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5A </td><td class="markdownTableBodyNone">10 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">PAN  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">57 </td><td class="markdownTableBodyNone">19 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Track 2 equivalent data  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF62 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Additional error data, filled if transaction is not successful  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF64 </td><td class="markdownTableBodyNone">32 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Kernel Debug  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F16 </td><td class="markdownTableBodyNone">15 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Merchant Identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DF63 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Filled with index of display text ID if anything should be displayed  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5F20 </td><td class="markdownTableBodyNone">27 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">1 Byte Length. Cardholder Name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F2D </td><td class="markdownTableBodyNone">9 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Language Preference (zero terminated)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">9F08 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">ICC Application Version Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F36 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Transaction Currency Exponent  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF59 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Number of wrong PIN entries (only in case of offline PIN)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5F30 </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Service code as defined in ISO/IEC 7813 for track 1 and track 2 format  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DF17 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">Fallback MID to be used.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8E </td><td class="markdownTableBodyNone">28 </td><td class="markdownTableBodyNone">- </td><td class="markdownTableBodyNone">CVM list retrieved from ICC  </td></tr>
</table>
<p><a class="anchor" id="anchor_emv_ct_EMV_Online_Transaction_Example"></a><b>EMV Online Transaction Example</b></p>
<p><em>Online Transaction Command</em> </p><div class="fragment"><div class="line">Online Command &gt;&gt;</div>
<div class="line">39  12  00  00  F0  1D  DF  50  01  01  8A  02  30  30  DF  52</div>
<div class="line">0A  91  08  11  22  33  44  55  66  77  88  89  06  00  00  00</div>
<div class="line">00  00  00                                              </div>
<div class="line"> </div>
<div class="line">Online Response &lt;&lt;</div>
<div class="line">90  E3  F0  82  01  9D  DF  42  02  00  01  DF  3D  10  6B  81</div>
<div class="line">68  B8  97  D5  75  C6  80  F1  66  BE  7B  79  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  76  DF  16</div>
<div class="line">08  7C  F3  28  E0  A2  CB  C8  5D  DF  3<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0A  DD  DD  98  76</div>
<div class="line">54  22  22  E0  00  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  DF  1A  0A  47  61  73  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a></div>
<div class="line"><a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  <a class="code" href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a>  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  27  01  40  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  02  00  02  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  26  08  72</div>
<div class="line">40  46  E0  19  6D  06  7B  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  39  01  05  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  41  04  00  00</div>
<div class="line">00  01  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  34  01  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  10  07  06  01  0A  03  60  00  00</div>
<div class="line">9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  37  04  C4  21  8D  F1  95  05  00  00  04  00  40  9A  03</div>
<div class="line">13  02  01  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  21  03  12  00  00  9C  01  00  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2A  02  09</div>
<div class="line">78  82  02  5C  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1A  02  02  80  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  34  03  42  03  00</div>
<div class="line">9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  33  03  E0  F8  C8  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  35  01  22  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  1E  08  31  32  33</div>
<div class="line">34  35  36  37  38  84  07  A0  00  00  00  03  10  10  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  09</div>
<div class="line">02  00  8C  9B  02  F8  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  06  07  A0  00  00  00  03  10</div>
<div class="line">10  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  12  0A  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  4E  4C  49  4E  45  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  50  49  4E  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  25</div>
<div class="line">03  10  01  01  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  28  02  08  40  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  45  02  DA  C0  DF  21</div>
<div class="line">05  00  10  00  00  00  DF  22  05  D8  40  04  F8  00  DF  23</div>
<div class="line">05  D8  40  00  A8  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0E  05  00  50  88  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">05  F0  20  04  98  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  0D  05  F0  20  04  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  40</div>
<div class="line">05  F0  00  B0  A0  01  DF  64  20  90  00  00  00  BB  C1  20</div>
<div class="line">00  80  80  40  40  00  21  90  90  02  00  00  00  D1  85  6<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div>
<div class="line">00  00  00  00  00  00  00  00  00  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  16  0<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  20  20  20</div>
<div class="line">20  20  20  20  20  20  20  20  20  20  20  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  20  0A  4<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  4E</div>
<div class="line">4C  49  4E  45  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  50  49  4E  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  2D  08  65  6E  65  73  64</div>
<div class="line">65  66  72  9<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  08  02  00  8C  5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  36  01  02  DF  59  01  00</div>
<div class="line">5<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  30  02  02  01  8E  1C  00  00  00  00  00  00  00  00  42</div>
<div class="line">03  5E  03  1<a class="code" href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>  00  00  00  00  00  00  00  00  00  00  00  00</div>
<div class="line">00  00  00                                                  </div>
</div><!-- fragment --><p><a class="anchor" id="anchor_emv_ct_Fetching_Additional_Tags"></a><b>Fetching Additional Tags</b></p>
<p>Use this function access all ADK EMV Contact tags used during the transaction. The standard Transaction Flow already presents all needed tags for a standard EMV transaction in a readable way (without the need of tag crawling). This function allows you to read all tags from the various tag stores used. This is useful for application-specific tags, various environments, to complete access to all tags and allow a second possibility for implementation.</p>
<p>The requested tag is read from the kernels tag store. If the tag is not available there, the framework tag store is searched, and if not there, the configuration parameters are searched for the tag.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x39 </td><td class="markdownTableBodyNone">x14 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Tag(s) requested  </td></tr>
</table>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tag data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="19_emv_ct_Fetch_an_EMV_tag.png" alt=""/>
<div class="caption">
Figure: Fetch an EMV tag</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5" title="Fetch one or several tags at the end of the transaction.">EMV_CT_fetchTxnTags()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><em>Defaults and Example</em></p>
<p>Use this section to fetch transaction information once the transaction is complete. There are no defaults, but you can fetch a single tag and use it with several calls for each tag or you can you see it by providing a tag list (DOL) and fetch several tags with one call.</p>
<p>This is an additional function to fetch additional data or already presented data in a different way.</p>
<p><a class="anchor" id="anchor_emv_ct_Send_EMV_PIN_to_Smart_Card"></a><b>Send EMV PIN to Smart Card</b></p>
<p>Use this command to send a PIN (stored in the vault) to the ICC (see also <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_PIN_Handling">PIN Handling</a>). This command supports both plaintext PIN and Enciphered Offline PIN. The functions need to be called after customer PIN entry. The verification result will be forwarded to the application. The encryption, forwarding and results handling are processed internally and can’t be altered.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x41 </td><td class="markdownTableBodyNone">x05 </td><td class="markdownTableBodyNone">00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">&mdash;  </td></tr>
</table>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="20_emv_ct_Send_Offline_PIN_Command.png" alt=""/>
<div class="caption">
Figure: Send Offline PIN Command</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><br  />
<em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#ga895cb054c344d011e9e3c6acc4aadafe" title="Send entered (offline) PIN to chip card for verification.">EMV_CT_Send_PIN_Offline()</a></p>
<p>The parameters are identical to the parameters inside tag F0 in the serial interface.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Evaluating_Contact_Transaction_Results"></a>
Evaluating Contact Transaction Results</h3>
<p>The following status codes are returned by the EMV command interface:</p>
<p><b>Table: EMV Command Interface Status Codes</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value </th><th class="markdownTableHeadNone">Definition </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga1456bb13b42906927f8a8942169b62e7" title="Function successful, no error.">EMV_ADK_OK</a> </td><td class="markdownTableBodyNone">Function successful, no error.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xE0 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga14713da8fe0512c8700f524279d2e573" title="CT: Return code if application not found by EMV_CT_CheckSupportedAID().   CTLS: Empty terminal candid...">EMV_ADK_NOAPP</a> </td><td class="markdownTableBodyNone">No common application card / terminal.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xE2 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga493578e3e0e9112d42d209b783fe1f60" title="CT &amp; CTLS: Transaction must be performed online.">EMV_ADK_ARQC</a> </td><td class="markdownTableBodyNone">Transaction must be performed online.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xE3 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga555e8c267be8402d0b540253a991e1ee" title="CT &amp; CTLS: Transaction performed (offline / online)">EMV_ADK_TC</a> </td><td class="markdownTableBodyNone">Transaction performed (offline / online).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xE4 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga956701431c0cef09072c040d816e5d7b" title="CT &amp; CTLS: Transaction declined.">EMV_ADK_AAC</a> </td><td class="markdownTableBodyNone">Transaction cancellation.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xE5 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga43a6dcc45fcf91c2ef8e73afc38ea121" title="CT: Transaction cancellation (former &quot;card referral&quot;), not used anymore.">EMV_ADK_AAR</a> </td><td class="markdownTableBodyNone">Transaction cancellation (former “card referral”).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xE6 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga89c11346e5e636e7c9d42c6a772674bf" title="CT &amp; CTLS: Parameter error (wrong parameter was passed to the function)">EMV_ADK_PARAM</a> </td><td class="markdownTableBodyNone">Parameter error.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xE7 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga5db7ec54114a9799fb2f75892215ad0a" title="CT &amp; CTLS: Proprietary card error (actually converted to EMV_ADK_FALLBACK)">EMV_ADK_CARDERR</a> </td><td class="markdownTableBodyNone">Proprietary card error.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xE8 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gab2bd25812bbdf301a668a2b1c07f63d9" title="CT: Repeat EMV_Select function call-up because selected application on the proprietary card is errone...">EMV_ADK_BADAPP</a> </td><td class="markdownTableBodyNone">Repeat <code>EMV_Select</code> function call-up because selected application on the proprietary card is erroneous.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xE9 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga23fcc197f78dfa83f4c93f97faaa729e" title="CT: User abort during PIN input (cancel button, timeout, card removed)">EMV_ADK_CVM</a> </td><td class="markdownTableBodyNone">User abort during PIN input (cancel button, timeout, card removed).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xEA </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga7045deba09a19eea4f7df8881a08b807" title="On transaction function it means that current transaction must be aborted.   On configuration functio...">EMV_ADK_ABORT</a> </td><td class="markdownTableBodyNone">Current transaction must be aborted.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xEB </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga1dfbf84d77767d546775d51566cb9b3d" title="CT &amp; CTLS: Blocked card, regional dependent if fallback to magstripe should be done.">EMV_ADK_CARD_BLOCKED</a> </td><td class="markdownTableBodyNone">Blocked card, regional dependent if fallback to magstripe should be done  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xEC </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gacf4f664d525a588d4a4e549002e454cd" title="Card error e.g. erroneous TLV coding, incorrect data -&gt; no transaction cancellation.">EMV_ADK_CARDERR_FORMAT</a> </td><td class="markdownTableBodyNone">Card error e.g. erroneous TLV coding, incorrect data. No transaction cancellation.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xED </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gab0e8158b5e7019f0da44c5cbc37bae3d" title="CT &amp; CTLS: e.g. erroneous communication to PINPad, internal error, not (completely) initialized (func...">EMV_ADK_INTERNAL</a> </td><td class="markdownTableBodyNone">Erroneous communication to PINPad, internal error.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xEE </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga1c45091db79e3fb0564afd1c0fde9820" title="CT: Online PIN reentered (PIN check).   EMV_CT_ContinueOnline()will return this value in the followin...">EMV_ADK_ONLINE_PIN_RETRY</a> </td><td class="markdownTableBodyNone">Online PIN re-entered (PIN check).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xEF </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga19d5dde29e85ada4f706ca65644df705" title="Writing config files failed. ANSI C functions fopen(), fwrite(), or fclose() gave back error....">EMV_ADK_SAVE_ERROR</a> </td><td class="markdownTableBodyNone">Required TLV data object is missing. (has not been entered by the application). Implementation error, no process control information (only used by the config functions).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xF0 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gab48a793910e1f71ce30d16a19f6af3e8" title="Application blocked: AID evaluation at fallback, no global fallback because it is not allowed for thi...">EMV_ADK_APP_BLOCKED</a> </td><td class="markdownTableBodyNone">Application blocked: AID evaluation at fallback, no global fallback because it is not allowed for this special blocked application.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xF1 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gaa385b17c04a9c6bbc0093a7ccfc3b11a" title="Error while reading EMV configuration.">EMV_ADK_READ_ERROR</a> </td><td class="markdownTableBodyNone">Error while reading EMV configuration.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xF2 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga61d626babfbbb727f0e45d7219031947" title="E.g. erroneous communication to PINPad, internal error, not used anymore.">EMV_ADK_ERR_HSM</a> </td><td class="markdownTableBodyNone">Erroneous communication to PINPad, internal error  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xF3 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga4837e54c589150debdef49afb8f9b5db" title="CT &amp; CTLS: Error in TLV data object = internal error.">EMV_ADK_TLV_BUILD_ERR</a> </td><td class="markdownTableBodyNone">Error in TLV data object = internal error.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xF4 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga5f6c47c1042b70f3753191850219e745" title="CT &amp; CTLS: Fallback to chip/msr (for CTLS) respectively magstripe (for CT) must be done.">EMV_ADK_FALLBACK</a> </td><td class="markdownTableBodyNone">Fallback to magstripe must be performed.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xF5 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gae80d82057fc9057a5555c08cbe1a013a" title="CT: wrong Online-PIN, repeat transaction (reduced) beginning with EMV_CT_StartTransaction()">EMV_ADK_ONL_PIN_REPEAT</a> </td><td class="markdownTableBodyNone">Wrong Online-PIN, repeat transaction (reduced) beginning with <code><a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a></code>.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xF6 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga25a3deb540cc7a021b162caf736cedd6" title="CT: mandatory (TLV) element missing (EMV-configuration), not used anymore.">EMV_ADK_MAND_ELEM_MISSING</a> </td><td class="markdownTableBodyNone">Mandatory (TLV) element missing (EMV- configuration).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xF7 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga63b90cf63f7b9e1b55766589576e434e" title="CT &amp; CTLS: invalid terminal capabilities (EMV-configuration), not used anymore.">EMV_ADK_INVALID_TERM_CAP</a> </td><td class="markdownTableBodyNone">Invalid terminal capabilities (EMV- configuration).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xF8 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga448fd17086a0da2e18f340086983c120" title="CT: a referral of the application decides if the TRX is approved or not.">EMV_ADK_REFERRAL</a> </td><td class="markdownTableBodyNone">A referral of the application decides if the TRX is approved or not.  </td></tr>
</table>
<p>The following status codes are returned by the EMV command interface for the Re-entry feature:</p>
<p><b>Table: Re-entry Status Codes</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value </th><th class="markdownTableHeadNone">Definition </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA0 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gaae0cf180db0eb31571483f68f247b395" title="CT Reentrance mode: Application requested return start reserved codes.">EMV_ADK_APP_REQ_START</a> </td><td class="markdownTableBodyNone">Application requested return start reserved codes.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xA1 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gaed9d54e360dbfb4a72c615596c8a87fc" title="CT Reentrance mode: Application requested return application selection.">EMV_ADK_APP_REQ_CANDIDATE</a> </td><td class="markdownTableBodyNone">Application requested return application selection.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA2 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga7e8709216fe47553fc0c129f71846579" title="CT Reentrance mode: Application requested return read records.">EMV_ADK_APP_REQ_READREC</a> </td><td class="markdownTableBodyNone">Application requested return read records.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xA3 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga3ebf5cde005e4770514ac5b6c4a93cf0" title="CT Reentrance mode: Application requested return data authentication.">EMV_ADK_APP_REQ_DATAAUTH</a> </td><td class="markdownTableBodyNone">Application requested return data authentication.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA4 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga50c0c0b8fa6d7b1356c1604ad4f04e2e" title="CT Reentrance mode: Application requested return for online PIN entry.">EMV_ADK_APP_REQ_ONL_PIN</a> </td><td class="markdownTableBodyNone">Application requested return for online PIN entry.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xA5 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga9f24ffaff279cf995620ec108e5f43ae" title="CT Reentrance mode: Application requested return for offline PIN entry.">EMV_ADK_APP_REQ_OFL_PIN</a> </td><td class="markdownTableBodyNone">Application requested return for offline PIN entry.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA6 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gae60344ca125866bbf74c921df04c6a15" title="CT Reentrance mode: Application requested return for plaintext PIN entry.">EMV_ADK_APP_REQ_PLAIN_PIN</a> </td><td class="markdownTableBodyNone">Application requested return for plaintext PIN entry.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xA7 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gabdfc095e6577d12f82285f938328b678" title="CT Reentrance mode: Application requested return cardholder verification.">EMV_ADK_APP_REQ_CVM_END</a> </td><td class="markdownTableBodyNone">Application requested return cardholder verification.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA8 </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#gaeec298e8f5ee75843d4b029f06334038" title="CT Reentrance mode: Application requested return riskmanagement.">EMV_ADK_APP_REQ_RISK_MAN</a> </td><td class="markdownTableBodyNone">Application requested return risk management.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xAF </td><td class="markdownTableBodyNone"><a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga41a87a27c017cfc748b95d4406eecfd3" title="CT Reentrance mode: Application requested return end of reserved codes.">EMV_ADK_APP_REQ_END</a> </td><td class="markdownTableBodyNone">Application requested return end of reserved codes.  </td></tr>
</table>
<h3><a class="anchor" id="subsubsec_emv_ct_Transaction_Callback_Command"></a>
Transaction Callback Command</h3>
<p>To learn about the different operation modes callback/reentrance see <a class="el" href="pg_emv_contact_users_guide.html#subsubsec_emv_ct_Callback_and_Reentrance_Mode">Callback and Reentrance Mode</a>.</p>
<p>Transaction callbacks can be activated to provide intermediate transaction results and update transaction parameters. <br  />
 All callbacks are handled in ONE function. <br  />
 It is called with TLV data enclosed in a constructed tag which identifies the callback type.</p>
<p><em>Serial Interface</em></p>
<ul>
<li>The command uses the following format:</li>
</ul>
<p><b>Table: Request</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Callback data </td><td class="markdownTableBodyNone">x91 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Callback Request, data includes info about the callback  </td></tr>
</table>
<ul>
<li><b>SW2 = 0x01</b>: EMV Transaction Request</li>
<li><b>SW2 = 0x02</b>: External card reader request (future use)</li>
<li><b>SW2 = 0xFF</b>: Trace Data follows (see <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Logging">Traces</a>)</li>
</ul>
<p><b>Table: Response</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x92 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">not applicable </td><td class="markdownTableBodyNone">not applicable </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<ul>
<li><b>INS = SW2</b>: From the request to indicate the response belongs to the request</li>
</ul>
<div class="image">
<img src="23_emv_ct_Callback_Flow.png" alt=""/>
<div class="caption">
Figure: Callback Flow</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the function interface (see below).</p>
<p><em>Function Interface</em></p>
<p>Application's callback is handed over as a function pointer to <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a>. <br  />
 It is called with a TLV stream as input. <br  />
 This is enclosed in a constructed tag identifying the type of callback.</p>
<p><em>Callback Types</em></p>
<p>The callback types can be activated separately. <br  />
 The contructed tags used as identifiers can be seen in following table:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Constructed tag </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gaf8eeceb6363ca4e9b124d67334c09f57" title="Transaction progress information for the merchant.">TAG_BF01_CBK_MERCHINFO</a> </td><td class="markdownTableBodyNone">Progress information for the merchant  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#ga626da7fbed5c5a9a5563cf0b9d45a4a4" title="The cardholder has to confirm the amount.">TAG_BF02_CBK_AMOUNTCONF</a> </td><td class="markdownTableBodyNone">Request to let the cardholder confirm the amount  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#ga7db951ffee1aa377131cd752468145a4" title="EMVCo features &quot;transaction log&quot; and &quot;hotlist&quot;.">TAG_BF03_CBK_LOG_HOTLIST</a> </td><td class="markdownTableBodyNone">EMVCo features "transaction log" and "hotlist" (blacklist, exception list)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gababcd780ecf1c9d400ecfde024d910fe" title="Application Candidate List Reduction/Modification.">TAG_BF04_CBK_REDUCE_CAND</a> </td><td class="markdownTableBodyNone">Application candidate list created, calling application can modify it  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#afd0adcc12331559863dd65d8f7558645" title="not valid">TAG_BF05_CBK_DOM_APPS</a> </td><td class="markdownTableBodyNone">Domestic app detected during application selection  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#ac82fa7e4064512e71e63fd647b817d97" title="not valid">TAG_BF06_CBK_LOCAL_CHECKS</a> </td><td class="markdownTableBodyNone">Local checks after reading the PAN (and other card dat)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a> </td><td class="markdownTableBodyNone">DCC (Dynamic Currency Conversion, see <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Dynamic_Currency_Change">Dynamic Currency Change</a>)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gadc9d6fed84456455586fb621722ae922" title="PIN Input request.">TAG_BF08_CBK_PIN</a> </td><td class="markdownTableBodyNone">Request to let the cardholder input the PIN  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#ga03bf78609c19ba9c07772fcd74d8c1f1" title="A text information has to be displayed to the cardholder.">TAG_BF09_CBK_CARDHOLDERINFO</a> </td><td class="markdownTableBodyNone">Information to be shown to the cardholder  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#ga2bdf296e1436b64373715038c87263b2" title="Callback for Traces.">TAG_BF7F_CBK_TRACE</a> </td><td class="markdownTableBodyNone">Traces (see <a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_Logging">Traces</a>)  </td></tr>
</table>
<p>For a detailed description refer to <a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html">Constructed tags for callback functions</a>.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Transparent_ICC_Commands"></a>
Transparent ICC Commands</h3>
<p>Use the following to implement Transparent ICC Commands:</p><ul>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Detecting_a_Smart_Card">Detecting a Smart Card</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Activating_a_Smart_Card">Activating a Smart Card</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Send_an_ISO_Command_to_a_Smart_Card">ISO Command to a Smart Card</a></li>
<li><a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Deactivate_a_Smart_Card">Deactivate a Smart Card</a></li>
</ul>
<p><a class="anchor" id="anchor_emv_ct_Detecting_a_Smart_Card"></a><b>Detecting a Smart Card</b></p>
<p>Use the following information to implement the smart card detection function.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x41 </td><td class="markdownTableBodyNone">x01 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">None </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="24_emv_ct_Detect_Smart_Card.png" alt=""/>
<div class="caption">
Figure: Detect Smart Card</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___i_c_c.html#ga62577d8d938685a65dd2b326cb03522d" title="Detect if chip card is inserted in card reader (in readable position)">EMV_CT_SmartDetect()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><a class="anchor" id="anchor_emv_ct_Activating_a_Smart_Card"></a><b>Activating a Smart Card</b></p>
<p>Use the following information to implement the smart card activation function.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x41 </td><td class="markdownTableBodyNone">x02 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<p>The following illustration shows the data flow for the function.</p>
<div class="image">
<img src="25_emv_ct_Activate_Smart_Card.png" alt=""/>
<div class="caption">
Figure: Activate Smart Card</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___i_c_c.html#gaa63515431ea6f33b113fa7af5562db11" title="Detect if chip card is inserted in card reader (read ATR)">EMV_CT_SmartReset()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><a class="anchor" id="anchor_emv_ct_Send_an_ISO_Command_to_a_Smart_Card"></a><b>Send an ISO Command to a Smart Card</b></p>
<p>Use the following information to implement the function.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x41 </td><td class="markdownTableBodyNone">x03 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<div class="image">
<img src="26_emv_ct_ISO_Smart_Card_Command.png" alt=""/>
<div class="caption">
Figure: ISO Smart Card Command</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___i_c_c.html#ga728923e6e6be8867cf954b7c8d4414d5" title="send chip card command and receive response">EMV_CT_SmartISO()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<p><a class="anchor" id="anchor_emv_ct_Deactivate_a_Smart_Card"></a><b>Deactivate a Smart Card</b></p>
<p>Use the following information to implement the smart card deactivation function.</p>
<p><em>Serial Interface</em></p>
<p>The command uses the following format:</p>
<p><b>Table: Command</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CLA </th><th class="markdownTableHeadNone">INS </th><th class="markdownTableHeadNone">P1 </th><th class="markdownTableHeadNone">P2 </th><th class="markdownTableHeadNone">Data  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x41 </td><td class="markdownTableBodyNone">x01 </td><td class="markdownTableBodyNone">x04 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">Data  </td></tr>
</table>
<p><b>Table: Response</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data </th><th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">none </td><td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed, xx = response code  </td></tr>
</table>
<p>The following illustration shows the Deactivate Smart Card function.</p>
<div class="image">
<img src="27_emv_ct_Deactivate_Smart_Card.png" alt=""/>
<div class="caption">
Figure: Deactivate Smart Card</div></div>
   <p><br  />
</p>
<p>The parameters inside the tag F0 are identical to the structure in the functional interface.</p>
<p><em>Function Interface</em></p>
<p><a class="el" href="group___f_u_n_c___i_c_c.html#gab99f6946bd7815a64a54be66652c2840" title="Deactivate chip card.">EMV_CT_SmartPowerOff()</a></p>
<p>The members of the structures are identical to the parameters inside tag F0 in the serial interface.</p>
<h2><a class="anchor" id="subsec_emv_ct_Dynamic_Currency_Change"></a>
Dynamic Currency Change</h2>
<p>Depending on card parameters (e.g. PAN, customer selection ,...) the calling application needs to execute the running transaction in a currency different to the one configured in <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a> respectively <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>.</p>
<p>To enable DCC feature <a class="el" href="group___a_p_p___f_l_o_w___c_a_p_s.html#gab46cea653620bce1d34685cb1ab851d9" title="B3b2: Enable DCC (Dynamic currency conversion).   Invocation depends on MS_RETURN_CALLBACKS,...">DCC_CHECK</a> must be activated in <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#a760a1211f0f7f2df285879a21e2fa9d8" title="Configure special application characteristics, see Defines for Application flow capabilities,...">EMV_CT_APPLIDATA_STRUCT::App_FlowCap</a>.</p>
<p>The following variants are supported:</p>
<h3><a class="anchor" id="subsubsec_emv_ct_dcc_decloc"></a>
Decision at callback for local checks after READ RECORD</h3>
<p>Decision about currency change is taken in callback <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#ac82fa7e4064512e71e63fd647b817d97" title="not valid">TAG_BF06_CBK_LOCAL_CHECKS</a>.</p>
<p><b> Schematic flow diagram (with currency change): </b> <br  />
</p><div class="image">
<img src="31_emv_ct_DCC_DecisionAtLocalCheck.png" alt=""/>
</div>
<p><b> Detailed description: </b> <br  />
</p><ul>
<li>Amount confirmation must be done after DCC decision. <br  />
 Configure <a class="el" href="group___a_p_p___f_l_o_w___c_a_p_s.html#ga646066dcb5ff2196f23e81697ece0fa0" title="B2b4: Confirm amount and enter PIN in one display.   Invoking callback for amount confirmation depend...">EMV_CT_CONF_AMOUNT_PIN</a> or <a class="el" href="group___c_o_n_f_i_r_m___a_m_o_u_n_t___w_h_e_n.html#ga3c236b770965440b570922685ba301d8" title="after cardholder verification">CONFIRM_AMOUNT_AFTER_CVM</a>. </li>
<li>Transaction is going the normal way until <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#ac82fa7e4064512e71e63fd647b817d97" title="not valid">TAG_BF06_CBK_LOCAL_CHECKS</a>. </li>
<li>Calling application determines, if DCC has to be done for this transaction. <br  />
 This check is project dependent. <br  />
 For example <a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga4ccedb21a71fcb6ace22bac98ba548a5" title="Application Primary Account Number (5A)   used as T_5A_PAN in EMV_CT_TRANSRES_STRUCT,...">TAG_5A_APP_PAN</a> and/or <a class="el" href="group___e_m_v_c_o___t_a_g_s.html#gac2b5ddfa533fc2ce2612d1f126b2ed5f" title="Application Currency Code (9F42)   used as puc9F42_acc in EMV_CT_CALLBACK_FnT (TAG_BF07_CBK_DCC),...">TAG_9F42_APP_CURRENCY_CODE</a> may be checked. <br  />
 And (if DCC is allowed for the used card) the cardholder is asked for the currency to be used. </li>
<li>In case <b> no DCC </b> has to be done, no special action is needed. <br  />
 Subsequent callback <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a> will be called and has to be answered with <a class="el" href="group___d_c_c___m_o_d_e.html#gab16895363cf9883dd307f4636575467d" title="No DCC: Continue transaction with original amount, floor limit, ...">MODE_DCC_NO_TRX_CONTINUE</a>. <br  />
 Transaction will be completed with configured terminal currency. </li>
<li>In case <b> DCC has to be done </b> calling application has to check input parameter <a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#ga6295466514899cd71991d081038ca021" title="EMV_CT_CALLBACK_FnT (TAG_BF06_CBK_LOCAL_CHECKS)">TAG_DF5B_DCC_PROHIBIT</a>. </li>
<li>In case of <code>FALSE</code> (=0): no special action needed at this step. <br  />
 Subsequent callback <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a> will be invoked. <br  />
 Calling application has to fill in new currency code (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga369ab2cc83e9b220bdfa79753f1f3962" title="Transaction Currency Code (5F2A)   Configured with CurrencyTrans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F2A_TRANS_CURRENCY</a>) and exponent (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga134c61ae2787b93c5def5bbf929f7cb4" title="Transaction Currency Exponent (5F36)   Configured with Exp_Trans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F36_TRANS_CURRENCY_EXP</a>). <br  />
 Amount (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga6952b55733eff49c55768a6f7802f9e4" title="Amount Authorized (Numeric) (9F02)   used as Betrag_num in EMV_CT_SELECT_STRUCT, puc9F02_amount in EM...">TAG_9F02_NUM_AMOUNT_AUTH</a>), floor limit (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#gab275fa140f8e21bda8e1d0bdafe47602" title="Terminal Floor Limit (9F1B)   used as EMV_CT_APPLIDATA_STRUCT::FloorLimit, puc9F1B_fl in EMV_CT_CALLB...">TAG_9F1B_TRM_FLOOR_LIMIT</a>) and threshold value (<a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#gab925ead3cc4b76ac55df0d4238c9f951" title="see EMV_CT_APPLIDATA_STRUCT::Threshhold   also used for callback EMV_CT_CALLBACK_FnT (TAG_BF07_CBK_DC...">TAG_DF24_THRESHHOLD</a>) <br  />
 has to be converted and also given back. <br  />
 Return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#ga3013f7c194336abee82578c1f8472bd8" title="DCC requested: Continue transaction with returned amount, floor limit, ...">MODE_DCC_YES_TRX_CONTINUE</a>. <br  />
 Transaction will be completed in the new currency. </li>
<li>In case of <code>TRUE:</code> Calling application has to set <a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga188ecff68e5b74f42c28d8faa67778d9" title="Return value to EMV ADK in callback EMV_CT_CALLBACK_FnT (TAG_BF06_CBK_LOCAL_CHECKS)   Possible values...">TAG_DF76_CBK_MANIPUL_TRX</a> to <a class="el" href="group___a_d_k___r_e_t___c_o_d_e.html#ga956701431c0cef09072c040d816e5d7b" title="CT &amp; CTLS: Transaction declined.">EMV_ADK_AAC</a>. </li>
<li>Running transaction will be terminated. </li>
<li>Calling application has to start a new transaction with <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>. <br  />
 As <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a30d37bb81b40a6e53cb3081ee862ddef" title="Transaction amount (will also be used for EMVCo tags 81, 9F3A)   mandatory   Can also be changed by E...">EMV_CT_PAYMENT_STRUCT::Amount</a> the converted amount has to be filled in. <br  />
 <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ae1f191741d0c4b9351e7f52d69b20d73" title="Currency code to be used for transaction. Only needed in case of DCC   Can also be changed by EMV_CT_...">EMV_CT_PAYMENT_STRUCT::CurrencyTrans</a> and <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#aaa3e0774e163e148c88b989c3ada3b76" title="Currency exponent to be used for transaction.   Only needed in case of DCC.   Can also be changed by ...">EMV_CT_PAYMENT_STRUCT::ExpTrans</a> must be set according to the new currency to be used. </li>
<li>Local check callback (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#ac82fa7e4064512e71e63fd647b817d97" title="not valid">TAG_BF06_CBK_LOCAL_CHECKS</a>) will be invoked as above. <br  />
 No special action needed for calling application. <br  />
 Just mirror the parameters. </li>
<li>DCC callback (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a>) will be invoked. <br  />
 Calling application has to give back converted values for floor limit (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#gab275fa140f8e21bda8e1d0bdafe47602" title="Terminal Floor Limit (9F1B)   used as EMV_CT_APPLIDATA_STRUCT::FloorLimit, puc9F1B_fl in EMV_CT_CALLB...">TAG_9F1B_TRM_FLOOR_LIMIT</a>) and threshold (<a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#gab925ead3cc4b76ac55df0d4238c9f951" title="see EMV_CT_APPLIDATA_STRUCT::Threshhold   also used for callback EMV_CT_CALLBACK_FnT (TAG_BF07_CBK_DC...">TAG_DF24_THRESHHOLD</a>). <br  />
 Return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#ga3013f7c194336abee82578c1f8472bd8" title="DCC requested: Continue transaction with returned amount, floor limit, ...">MODE_DCC_YES_TRX_CONTINUE</a>. <br  />
 Amount (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga6952b55733eff49c55768a6f7802f9e4" title="Amount Authorized (Numeric) (9F02)   used as Betrag_num in EMV_CT_SELECT_STRUCT, puc9F02_amount in EM...">TAG_9F02_NUM_AMOUNT_AUTH</a>) and currency (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga369ab2cc83e9b220bdfa79753f1f3962" title="Transaction Currency Code (5F2A)   Configured with CurrencyTrans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F2A_TRANS_CURRENCY</a>, <a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga134c61ae2787b93c5def5bbf929f7cb4" title="Transaction Currency Exponent (5F36)   Configured with Exp_Trans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F36_TRANS_CURRENCY_EXP</a>) must not be mirrored unchanged at this step! <br  />
 Otherwise transaction will abort. <br  />
 Transaction will be completed in the new currency.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_dcc_deconline"></a>
Decision at online connection</h3>
<p>Transaction is handled online. Host decides if dynamic currency change is allowed. If yes: Transaction is terminated. The cardholder is asked to select his favourite currency. Transaction is restarted with this currency.</p>
<p><b> Schematic flow diagram (with currency change): </b> <br  />
</p><div class="image">
<img src="32_emv_ct_DCC_DecisionAtOnlineConnection.png" alt=""/>
</div>
<p><b> Detailed description: </b> <br  />
</p><ul>
<li>Including the first cryptogram the transaction is going like usual. </li>
<li>In case of going online the host decides if DCC is allowed. </li>
<li>If no: The transaction continues as usually. </li>
<li>If yes: Host answers with protocol specific DCC information. </li>
<li>Calling application has to call <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a> with any <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a50f253cd97f2612f2d5abe02959e130f" title="Authorisation Response Code. The response code from the host. Note: The format must be converted from...">EMV_CT_HOST_STRUCT::AuthResp</a> indicating "decline" <br  />
 (e.g. "88" for ZKA Germany). </li>
<li>Running transaction will be terminated. </li>
<li>If project requires: Cardholder is asked for the currency to be used. </li>
<li>Calling application has to start a new transaction with <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>. <br  />
 <em> In case of currency change: </em> As <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a30d37bb81b40a6e53cb3081ee862ddef" title="Transaction amount (will also be used for EMVCo tags 81, 9F3A)   mandatory   Can also be changed by E...">EMV_CT_PAYMENT_STRUCT::Amount</a> the converted amount has to be filled in. <br  />
 <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ae1f191741d0c4b9351e7f52d69b20d73" title="Currency code to be used for transaction. Only needed in case of DCC   Can also be changed by EMV_CT_...">EMV_CT_PAYMENT_STRUCT::CurrencyTrans</a> and <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#aaa3e0774e163e148c88b989c3ada3b76" title="Currency exponent to be used for transaction.   Only needed in case of DCC.   Can also be changed by ...">EMV_CT_PAYMENT_STRUCT::ExpTrans</a> must be set according to the new currency to be used. <br  />
 <em> In case of NO currency change: </em> Fill <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a30d37bb81b40a6e53cb3081ee862ddef" title="Transaction amount (will also be used for EMVCo tags 81, 9F3A)   mandatory   Can also be changed by E...">EMV_CT_PAYMENT_STRUCT::Amount</a> with the original value. </li>
<li>DCC callback (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a>): <br  />
 <em> In case of changed currency: </em> This function will be called unconditionally. <br  />
 Calling application has to give back converted values for floor limit (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#gab275fa140f8e21bda8e1d0bdafe47602" title="Terminal Floor Limit (9F1B)   used as EMV_CT_APPLIDATA_STRUCT::FloorLimit, puc9F1B_fl in EMV_CT_CALLB...">TAG_9F1B_TRM_FLOOR_LIMIT</a>) and threshold (<a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#gab925ead3cc4b76ac55df0d4238c9f951" title="see EMV_CT_APPLIDATA_STRUCT::Threshhold   also used for callback EMV_CT_CALLBACK_FnT (TAG_BF07_CBK_DC...">TAG_DF24_THRESHHOLD</a>). <br  />
 Return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#ga3013f7c194336abee82578c1f8472bd8" title="DCC requested: Continue transaction with returned amount, floor limit, ...">MODE_DCC_YES_TRX_CONTINUE</a>. <br  />
 Amount (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga6952b55733eff49c55768a6f7802f9e4" title="Amount Authorized (Numeric) (9F02)   used as Betrag_num in EMV_CT_SELECT_STRUCT, puc9F02_amount in EM...">TAG_9F02_NUM_AMOUNT_AUTH</a>) and currency (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga369ab2cc83e9b220bdfa79753f1f3962" title="Transaction Currency Code (5F2A)   Configured with CurrencyTrans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F2A_TRANS_CURRENCY</a>, <a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga134c61ae2787b93c5def5bbf929f7cb4" title="Transaction Currency Exponent (5F36)   Configured with Exp_Trans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F36_TRANS_CURRENCY_EXP</a>) must not be changed at this step! <br  />
 Otherwise transaction will abort. <br  />
 <em> In case of unchanged currency: </em> This function may be called, depending on other transaction conditions. <br  />
 All values shall be mirrored unchanged and return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#gab16895363cf9883dd307f4636575467d" title="No DCC: Continue transaction with original amount, floor limit, ...">MODE_DCC_NO_TRX_CONTINUE</a>. </li>
<li>Transaction will be completed in the chosen currency.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_dcc_decbreak"></a>
Decision after break at DCC callback</h3>
<p>Transaction is aborted in case DCC is allowed. Host contact and cardholder interaction can be done outside of any callbacks. Transaction is restarted with new currency.</p>
<p><b> Schematic flow diagram (with currency change): </b> <br  />
</p><div class="image">
<img src="33_emv_ct_DCC_DecisionAfterBreakDCCCallback.png" alt=""/>
</div>
<ul>
<li>Transaction is going the normal way until DCC callback (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a>). </li>
<li>Calling application determines, if DCC is possible for this transaction (e.g. check PAN). </li>
<li><em> In case NO: </em> return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#gab16895363cf9883dd307f4636575467d" title="No DCC: Continue transaction with original amount, floor limit, ...">MODE_DCC_NO_TRX_CONTINUE</a>. <br  />
 Transaction will be completed without change of the currency. </li>
<li><em> In case YES: </em> return <a class="el" href="group___d_c_c___m_o_d_e.html#ga39f2bb07ab592bed46fc75aeb756da19" title="DCC requested, but transaction must be restarted: Transaction abort, no text display.">MODE_DCC_YES_TRX_ABORT</a>. <br  />
 TransactionFlow will abort the transaction (no display to cardholder or cashier). <br  />
 Calling application has the possibility to contact host for DCC decision. <br  />
 And (if host allows DCC) ask the cardholder for the currency to be used. </li>
<li>Calling application has to start a new transaction with <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>. <br  />
 As <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ae9357fb5fbb42943ac347ea3b2cd4d6a" title="Transaction type, according to ISO 8583 - Annex A: Processing Code, Position 1 + 2   see Transaction ...">EMV_CT_SELECT_STRUCT::TransType</a> value <a class="el" href="group___t_r_a_n_s___t_y_p_e_s.html#gac505daa3b605ab4a797b9b84296fb1a4" title="Contact only: Transaction repetition after amount change (requirement detected in TAG_BF06_CBK_LOCAL_...">EMV_ADK_TRAN_TYPE_REPEAT_AMOUNT_CHANGE</a> has to be used. <br  />
 <em> In case of currency change: </em> As <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a30d37bb81b40a6e53cb3081ee862ddef" title="Transaction amount (will also be used for EMVCo tags 81, 9F3A)   mandatory   Can also be changed by E...">EMV_CT_PAYMENT_STRUCT::Amount</a> the converted amount has to be filled in. <br  />
 <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#ae1f191741d0c4b9351e7f52d69b20d73" title="Currency code to be used for transaction. Only needed in case of DCC   Can also be changed by EMV_CT_...">EMV_CT_PAYMENT_STRUCT::CurrencyTrans</a> and <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#aaa3e0774e163e148c88b989c3ada3b76" title="Currency exponent to be used for transaction.   Only needed in case of DCC.   Can also be changed by ...">EMV_CT_PAYMENT_STRUCT::ExpTrans</a> must be set according to the new currency to be used. <br  />
 <em> In case of NO currency change: </em> Fill <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a30d37bb81b40a6e53cb3081ee862ddef" title="Transaction amount (will also be used for EMVCo tags 81, 9F3A)   mandatory   Can also be changed by E...">EMV_CT_PAYMENT_STRUCT::Amount</a> with the original value. </li>
<li>DCC callback (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#af335a870e9d2f299c848f76b843907f7" title="not valid">TAG_BF07_CBK_DCC</a>) <br  />
 <em> In case of changed currency: </em> This function will be called unconditionally. <br  />
 Calling application has to give back converted values for floor limit (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#gab275fa140f8e21bda8e1d0bdafe47602" title="Terminal Floor Limit (9F1B)   used as EMV_CT_APPLIDATA_STRUCT::FloorLimit, puc9F1B_fl in EMV_CT_CALLB...">TAG_9F1B_TRM_FLOOR_LIMIT</a>) and threshold (<a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#gab925ead3cc4b76ac55df0d4238c9f951" title="see EMV_CT_APPLIDATA_STRUCT::Threshhold   also used for callback EMV_CT_CALLBACK_FnT (TAG_BF07_CBK_DC...">TAG_DF24_THRESHHOLD</a>). <br  />
 Return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#ga3013f7c194336abee82578c1f8472bd8" title="DCC requested: Continue transaction with returned amount, floor limit, ...">MODE_DCC_YES_TRX_CONTINUE</a>. <br  />
 Amount (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga6952b55733eff49c55768a6f7802f9e4" title="Amount Authorized (Numeric) (9F02)   used as Betrag_num in EMV_CT_SELECT_STRUCT, puc9F02_amount in EM...">TAG_9F02_NUM_AMOUNT_AUTH</a>) and currency (<a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga369ab2cc83e9b220bdfa79753f1f3962" title="Transaction Currency Code (5F2A)   Configured with CurrencyTrans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F2A_TRANS_CURRENCY</a>, <a class="el" href="group___e_m_v_c_o___t_a_g_s.html#ga134c61ae2787b93c5def5bbf929f7cb4" title="Transaction Currency Exponent (5F36)   Configured with Exp_Trans in EMV_CT_TERMDATA_STRUCT (for DCC p...">TAG_5F36_TRANS_CURRENCY_EXP</a>) must not be changed at this step! <br  />
 Otherwise transaction will abort. <br  />
 <em> In case of unchanged currency: </em> This function may be called, depending on other transaction conditions. <br  />
 All values shall be mirrored unchanged and return value (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#ga866150b1aa87d89f0783c4dd4eeb3d59" title="DCC mode, see DCC mode.">TAG_DF7D_CBK_DCC_CHECK</a>) must be <a class="el" href="group___d_c_c___m_o_d_e.html#gab16895363cf9883dd307f4636575467d" title="No DCC: Continue transaction with original amount, floor limit, ...">MODE_DCC_NO_TRX_CONTINUE</a>. </li>
<li>Transaction will be completed in the chosen currency.</li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_PIN_Handling"></a>
PIN Handling</h2>
<p>A transaction may require cardholder PIN entry. In this case EMV ADK will call the appropiate <b> callback function </b> (<a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gadc9d6fed84456455586fb621722ae922" title="PIN Input request.">TAG_BF08_CBK_PIN</a>).</p>
<p>Input from EMV ADK (encapsulated in <code>TAG_BF08_CBK_PIN</code>):</p><ul>
<li>PIN Type (DF79)</li>
<li>Bypass Info (DF41)</li>
<li>Random number (9F37)</li>
<li>Public Key Modulus (DF7A)</li>
<li>Public key Exponent (DF7B)</li>
<li>Amount (9F02) – only if the amount confirmation is processed together with PIN entry</li>
<li>Cashback Amount (9F03) – only if the amount confirmation is processed together with PIN entry</li>
</ul>
<p>Output to EMV ADK:</p><ul>
<li>PIN Outcome (DF79)</li>
<li>Verify Result SW12 (DF6F)</li>
</ul>
<p>The application must implement this callback function. Three PIN methods are defined by EMV: offline plaintext, offline enciphered and online enciphered PIN. The application has to use the <b> Vault </b> to realize PIN input.</p>
<p>How application shall implement the callback function <a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a> with <a class="el" href="group___c_b_c_k___f_c_t___t_a_g_s.html#gadc9d6fed84456455586fb621722ae922" title="PIN Input request.">TAG_BF08_CBK_PIN</a>: </p><ul>
<li>Check which <em> method of PIN </em> is required: <a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#gae1140e3c457d68c0dd795ffad8c84b29" title="EMV ADK to application: PIN type requested (Input params for PIN entry)   Application to EMV ADK: PIN...">TAG_DF79_CBK_PIN_INFO</a> <br  />
 The value is one of <a class="el" href="group___a_d_k___p_i_n___i_n_p_u_t.html">Input params for PIN entry</a></li>
</ul>
<ul>
<li>Check if PIN bypass shall be allowed: <a class="el" href="group___v_e_r_i___p_r_i_m___t_a_g_s.html#gade39b36895af55804c1fd7793695292a" title="If PIN_BYPASS was configured in EMV_CT_APPLIDATA_STRUCT::App_FlowCap: This tag is given by EMV ADK in...">TAG_DF41_PIN_BYPASS</a></li>
</ul>
<ul>
<li><em> Version 1: Usage of GUI ADK </em> <br  />
 Realize PIN input into vault with the appropriate GUI ADK functions. <br  />
 <em> Version 2: without GUI ADK </em> <br  />
 Realize PIN input into vault with the appropriate OS functions.</li>
</ul>
<ul>
<li>Evaluate the PIN entry result (PIN outcome can be success, timeout, bypass, cancel)</li>
</ul>
<ul>
<li>If success and it is <code>EMV_PIN:</code> <br  />
 Call <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga895cb054c344d011e9e3c6acc4aadafe">EMV_CT_Send_PIN_Offline</a> to forward the entered offline PIN to the ICC for verification.</li>
</ul>
<ul>
<li>If success and it is <code>POST_PROC_PIN:</code> <br  />
 Use your local host encryption routines and scripts to handle the PIN and forward it once you receive an ARQC at the end of the transaction.</li>
</ul>
<ul>
<li>If no success, inform the EMV ADK about the outcome (<a class="el" href="group___t_l_v___c_b_c_k___t_l_v.html#gae1140e3c457d68c0dd795ffad8c84b29" title="EMV ADK to application: PIN type requested (Input params for PIN entry)   Application to EMV ADK: PIN...">TAG_DF79_CBK_PIN_INFO</a>): <br  />
 <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a>, <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6e1606e2c165d4f4af132d23f6585e37">EMV_CT_PIN_INPUT_COMM_ERR</a>, <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#gaed61dc1a7482b607ebad612b3f2d7508">EMV_CT_PIN_INPUT_ABORT</a>, <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga5364807f6ce1265fa8f8e0228db9717c">EMV_CT_PIN_INPUT_BYPASS</a>, <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga71e47e61824568f46a9c9ed547ef206b">EMV_CT_PIN_INPUT_TIMEOUT</a>, <a class="el" href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a></li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_pin_flow"></a>
Schematic flow diagram</h3>
<div class="image">
<img src="34_emv_ct_TLV_CallbackPin.png" alt=""/>
<div class="caption">
callback flow</div></div>
<h2><a class="anchor" id="subsec_emv_ct_Transaction_Status_Information"></a>
Transaction Status Information</h2>
<p>At the end of the transaction, the status information provides the results, including Online PIN entry. </p><div class="fragment"><div class="line"><span class="preprocessor">#define     EMV_ADK_SI_ONLINE_PIN_REQUIRED   0x0001u</span></div>
<div class="line">    Online PIN processing to be done. </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_SIGNATURE_REQUIRED   0x0002u</span></div>
<div class="line">    Signature verification required. </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_FORCED_ACCEPTANCE   0x0004u</span></div>
<div class="line">    Forced acceptance. </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_USER_DEFINED_CVM   0x0008u</span></div>
<div class="line">    user defined CVM </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_CUSTOMER_CARDWITHDRAWL   0x0080u</span></div>
<div class="line">    <a class="code" href="namespacevfisdi.html#a28287671eaf7406afd604bd055ba4066">Result</a> is <a class="code" href="group___a_d_k___r_e_t___c_o_d_e.html#ga7045deba09a19eea4f7df8881a08b807">EMV_ADK_ABORT</a> because customer has pulled out the card. </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_GICC_TIPPABLE   0x0100u</span></div>
<div class="line">    A tip transaction may follow <span class="keyword">this</span> payment. </div>
<div class="line"><span class="preprocessor">#define     EMV_ADK_SI_PIN_FAILURE   0x0400u</span></div>
<div class="line"><span class="preprocessor">    Last entered offline PIN was wrong. </span></div>
</div><!-- fragment --><h2><a class="anchor" id="subsec_emv_ct_Different_Languages"></a>
Different Languages</h2>
<p>Language selection is usually up the application, however, if not selected by the application, the EMV-ADK will run the selection during processing.</p>
<p>Explanation:</p>
<p>You can configure up to 20 languages in terminal configuration using the definitions in the header file:</p>
<pre class="fragment">/// @defgroup TF_LANGUAGES Known languages
/// @ingroup DEF_CONF_TEXT
/// @brief see ::EMV_ADK_TXT_TYPE
/// @}
#define EMV_ADK_LANG_NO_LANG            0x00 ///&lt; internal use only
#define EMV_ADK_LANG_ENGLISH            0x01 ///&lt; English
#define EMV_ADK_LANG_GERMAN             0x02 ///&lt; German
#define EMV_ADK_LANG_FRENCH             0x03 ///&lt; French
#define EMV_ADK_LANG_SPANISH            0x04 ///&lt; Spanish
….
</pre><p>However, this is to fulfill the EMVCo specs. In most cases it is expected that the application will use the config option to pre-select a language at the beginning of a transaction. This can be configured in the transaction data if the application needs to support more than one language.</p>
<p>There are two common ways to select the language:</p><ul>
<li><a class="anchor" id="a"></a>a For unattended terminals, it is usually the customer who selects the language first, before starting a transaction. Once this selection is complete, the EMVCo language selection does not take place any more (pre-selected terminal language from customer).</li>
<li>b For attended machines, the customer usually selects the language after the AID is known. Therefore the results of the <code>StartTransaction</code> includes the tag 5F2D and the application can handle this on its own (GUI is part of the application not of the EMV framework) and forward the preselected language at the beginning of <code>ContinueOffline</code> function, using the same parameter as in Step <a class="el" href="pg_emv_contact_users_guide.html#a">a</a>.</li>
</ul>
<p>If either step is not performed, the framework will use the provided language list (as mentioned above) and compare it to the tag 5F2D internally to “fix” the language according to EMVCo needs.</p>
<p>However, there will be never a display from the framework, so it is just used for the subsequent callbacks (amount confirmation, PIN entry) to tell the application the currently selected language, which may be used by the application in customer displays.</p>
<h2><a class="anchor" id="subsec_emv_ct_Display_Messages"></a>
Display Messages</h2>
<p>The following codes present additional information about display messages. This is optional and the application may display messages based on this information but may use return codes and debug data as well for the command.</p>
<p><b>Table: Display Messages</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value </th><th class="markdownTableHeadNone">Definition </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00 </td><td class="markdownTableBodyNone"><code>EMV_TXT_NO_TXT</code>  </td><td class="markdownTableBodyNone">No text (internal use)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x01 </td><td class="markdownTableBodyNone"><code>EMV_TXT_REFUND_CONF_AMOUNT</code>  </td><td class="markdownTableBodyNone">Refund EUR XXXXXX, XX PLEASE CONFIRM.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x02 </td><td class="markdownTableBodyNone"><code>EMV_TXT_AMOUNT</code>  </td><td class="markdownTableBodyNone">AMOUNT EUR XXXXXX, XX PLEASE CONFIRM  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x03 </td><td class="markdownTableBodyNone"><code>EMV_TXT_APPROVED</code>  </td><td class="markdownTableBodyNone">APPROVED  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA3 </td><td class="markdownTableBodyNone"><code>EMV_TXT_AUTH_APPROVED</code>  </td><td class="markdownTableBodyNone">Like #EMV_TXT_APPROVED, but for reservation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x04 </td><td class="markdownTableBodyNone"><code>EMV_TXT_DECLINED</code>  </td><td class="markdownTableBodyNone">DECLINED  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xA4 </td><td class="markdownTableBodyNone"><code>EMV_TXT_AUTH_DECLINED</code>  </td><td class="markdownTableBodyNone">Like #EMV_TXT_DECLINED, but for reservation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x05 </td><td class="markdownTableBodyNone"><code>EMV_TXT_NOT_ACCEPTED</code>  </td><td class="markdownTableBodyNone">NOT ACCEPTED  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x06 </td><td class="markdownTableBodyNone"><code>EMV_TXT_CARD_ERROR</code>  </td><td class="markdownTableBodyNone">CARD ERROR  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x07 </td><td class="markdownTableBodyNone"><code>EMV_TXT_PROCESSING_ERROR</code>  </td><td class="markdownTableBodyNone">PROCESSING ERROR  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x08 </td><td class="markdownTableBodyNone"><code>EMV_TXT_CARD_READ_OK</code>  </td><td class="markdownTableBodyNone">Card read ok  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x09 </td><td class="markdownTableBodyNone"><code>EMV_TXT_AUTHORIZING</code>  </td><td class="markdownTableBodyNone">Authorizing, online txn CTLS  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x10 </td><td class="markdownTableBodyNone"><code>EMV_TXT_REMOVE_CARD</code>  </td><td class="markdownTableBodyNone">REMOVE CARD  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x11 </td><td class="markdownTableBodyNone"><code>EMV_TXT_USE_CHIP_READER</code>  </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x12 </td><td class="markdownTableBodyNone"><code>EMV_TXT_USE_MAG_STRIPE</code>  </td><td class="markdownTableBodyNone">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x13 </td><td class="markdownTableBodyNone"><code>EMV_TXT_VOICEAUT</code>  </td><td class="markdownTableBodyNone">Voice authorization in case of communication problem  </td></tr>
</table>
<h2><a class="anchor" id="subsec_emv_ct_Card_Deactivation"></a>
Card Deactivation</h2>
<p>The card is deactivated inside the ADK if:</p><ul>
<li>User aborts during Application Selection</li>
<li>On internal errors</li>
<li>If an AAC was requested explicitly</li>
<li>If an AAC was delivered by card</li>
<li>If a TC was the outcome of a transaction</li>
<li>On any fallback decision or termination after GPO</li>
<li>Any card read transaction after application selection process</li>
<li>Always after Online processing</li>
<li>On critical errors during apps selection process.</li>
<li>See also chapter <a class="el" href="pg_emv_contact_users_guide.html#subsec_ct_processtermination">Process Termination</a></li>
</ul>
<p>The card is NOT deactivated when no common apps in the candidate list allow further processing in the application without resetting the card.</p>
<h2><a class="anchor" id="subsec_emv_ct_Additional_Tags"></a>
Additional Tags</h2>
<p>This chapter provides information how additional tags are handled using the EMV kernels and the ADK.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Additional_Tags_Term"></a>
Additional tags provided by the terminal</h3>
<p>The EMV kernel allows to define an additional tag store for each AID. This concept also reflects in the ADK interface. For additional tags there is a special configuration field in the AID configuration interface, resulting in a separate XML tag for each AID in the XML configuration file. You can configure AIDs using the EMV_CT_SetAppliData function (for details refer to the ADK documentation). The parameter for additional terminal tags is: <br  />
 unsigned char Additional_Tags_TRM [EMV_ADK_ADD_TAG_SIZE] <br  />
 Tag + Length + Value: Additional terminal data for special applications <br  />
 Example: MasterCard 9F53, validity bit EMV_CT_INPUT_APL_ADD_TAGS <br  />
 Tag, Struct, XML Reference: <br  />
 TLV tag TAG_DF29_ADD_TAGS, <br  />
 Additional_Tags_TRM in <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#ad7a6039ab1aa91113c012eab4293d664" title="Tag + Length + Value: Additional terminal data for special applications   Example: MasterCard 9F53,...">EMV_CT_APPLIDATA_STRUCT::Additional_Tags_TRM</a>, <br  />
 XML Tag: XML_TAG_APPLIDATA_ADDITIONAL_TAGS_TRM.</p>
<p>You need to provide probable additional terminal tags for each AID when you configure the system. If you know the value already at that time (e.g. it will not change per transaction) you can provide the final value for this tag already. Otherwise simply configure a valuable default here and update the value at the time of transaction.</p>
<p>For updating tags during a transaction you simply start the transaction as usual. Once the application is selected (final select performed) you can update the tags for the selected AID as needed. Once <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a> is completed you can use <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a> with option <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga9014b9bb4c7b8ebf61ee98a26a7666ce">EMV_ADK_TEMP_UPDATE</a> or <a class="el" href="group___f_u_n_c___f_l_o_w.html#gad3dd36d27d5fa94d3f302dc4a4546b70" title="Update one or several kernel tags during transaction.">EMV_CT_updateTxnTags()</a> to update the tags according to your needs dynamically. In this way you can guarantee that in any DOL (PDOL, DDOL, CDOL, …) the correct values are provided to the ICC.</p>
<p>Example: <code> {unsigned char additionalTagsTerminal[] = {0x9F,0x53,0x01,0x52}; </code></p>
<h3><a class="anchor" id="subsubsec_emv_ct_Additional_Tags_ICC"></a>
Additional tags provided by the ICC</h3>
<p>Data sent by the card during SELECT, READ RECORDS and GENERATE AC operations is either stored by the L2 kernel or automatically stored by the EMV ADK automatic tag store. In both cases <a class="el" href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5" title="Fetch one or several tags at the end of the transaction.">EMV_CT_fetchTxnTags()</a> with option <a class="el" href="group___f_e_t_c_h___t_a_g_s___o_p_t_i_o_n_s.html#gaf2ba6457aff8e9f5bc3acc1b84715061" title="Search tags only in kernel database, excluding kernel private tags (&quot;readHypTag&quot;).">EMV_ADK_FETCHTAGS_KERNEL</a> offers access to these tags, no matter which part stored the data.</p>
<dl class="section note"><dt>Note</dt><dd>Previous approaches to use <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#acd89bdbc00f19a23befec2eed0ff7b00">EMV_CT_APPLIDATA_STRUCT::Additional_Tags_CRD</a> or <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga8cb0828f8f3a9d40dd0ec4695c992123">EMV_CT_INIT_OPT_L1_DUMP</a> are deprecated or no more supported.</dd></dl>
<h3><a class="anchor" id="subsubsec_emv_ct_Additional_Tags_GetData"></a>
Additional tags read with GET DATA</h3>
<p><a class="el" href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5" title="Fetch one or several tags at the end of the transaction.">EMV_CT_fetchTxnTags()</a> with option <a class="el" href="group___f_e_t_c_h___t_a_g_s___o_p_t_i_o_n_s.html#ga4aaa4083df605146b8ca652c6ceee553" title="Issue Get Data command &#39;80 CA&#39; to directly read the information from the chip card.">EMV_ADK_FETCHTAGS_GET_DATA</a> will cause a GET DATA command sent to ICC.</p>
<h2><a class="anchor" id="subsec_emv_ct_special_tags"></a>
Handling of special tags</h2>
<h3><a class="anchor" id="subsubsec_emv_ct_mand_ICC_tags"></a>
Mandatory ICC tags</h3>
<p>There are domestic specifications defining mandatory ICC tags. <br  />
 In case the ICC does not provide them the transaction must be declined. <br  />
 To realize this requirement one has to set these tags in <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#a15601aa3b54c9da3032a3ed1d43b0b6b" title="Tags only: These tags must be provided by the card, otherwise the transaction is terminated....">EMV_CT_APPLIDATA_STRUCT::Mandatory_Tags_CRD</a>. <br  />
 EMV ADK will decline the transaction if any of these tags is not provided by the ICC.</p>
<h2><a class="anchor" id="subsec_emv_ct_prio_apps"></a>
Priority applications</h2>
<p>An EMV chipcard may include <em> several applications (AIDs) </em>. <br  />
 In case the terminal supports more than one of them, the <em> cardholder has to select </em> one for the transaction. <br  />
 In many countries the cards are equipped with one (or more) national application(s) and one (or more) international. <br  />
 Example for Germany: national = girocard, international = maestro <br  />
<br  />
 In these countries it's usual to have <b> rules </b> in place like this: <br  />
 <code> if card_supports_national_issuer then use_national_issuer <br  />
 else use_international_issuer </code></p>
<p>To realize this requirement the EMV Framework supports so called "priority applications". <br  />
<br  />
 <b> Example for configuration: </b> <br  />
 <em> Requirement: </em> girocard (AID A0 00 00 00 03 59 10 10 02 80 01) shall take priority over maestro (AID A0 00 00 00 04 30 60). <br  />
 <em> Configuration: </em> </p><ul>
<li>Configure girocard as usual (with <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>). </li>
<li>Configure maestro with desired parameters. As usually use <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>. <br  />
 In <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#aafdd60748ec764b0398657d3a87e0d19" title="Priority applications for this application (EMV_CT_APPLI_STRUCT)   max. number see EMV_ADK_MAX_PRIO_A...">EMV_CT_APPLIDATA_STRUCT::xAIDPrio</a> fill in girocard AID (A0 00 00 00 03 59 10 10 02 80 01).</li>
</ul>
<p><em> Transaction behavior: </em> <br  />
 In case a card is inserted, which supports both girocard and maestro, the transaction is (automatically) done with girocard (<em>without cardholder selection</em>).</p>
<h2><a class="anchor" id="subsec_emv_ct_virt_term_map"></a>
Virtual terminal mapping table</h2>
<p>There may be the need to use different parameter sets per transaction type or currency. Typical use case is setting the floor limit to zero for refund. And of course you have to set different floor limit for different currency. This requirement can be realized by the "Virtual terminal mapping table". Approach lets you to have several parameter sets for the same application.</p>
<p>It goes this way:</p><ol type="1">
<li><b> Create a mapping table </b> <br  />
 for linkage between<ol type="a">
<li>virtual terminal ID <br  />
 and</li>
<li>transaction type respectively currency</li>
</ol>
For each desired map entry call <a class="el" href="group___f_u_n_c___c_o_n_f.html#gab5d29810043af901c08736d4e9337353" title="Changes the Virtual Terminal Map.">EMV_CT_MapVirtualTerminal()</a>. Pre-condition: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> for any Virtual Terminal has been called before. <br  />
 Don't use Virtual Terminal value zero as this is used as "default": It's used in case the current transaction does not match any table entry.</li>
<li><b> Set parameters for the virtual terminals </b> <br  />
 For virtual terminal 0 and every entry in above created table you have to<ol type="a">
<li>Set to virtual terminal: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a>, <br  />
 set <code>options</code> accordingly (e.g. <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gaf4074eda84324e107cb5ad73458868c8" title="virtual terminal 1: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_1</a>, <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga3fe310b168e70a4bf7e383bdd7d78494" title="virtual terminal 2: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_2</a>, or ...) <br  />
 For virtual terminal 0: set most significant byte to zero.</li>
<li>Set terminal data: <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a></li>
<li>Set application data: <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>, <br  />
 if needed clear history with <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga7bc8a670f539230cb315ba2cb7442ea8" title="Clear all data.">EMV_ADK_CLEAR_ALL_RECORDS</a></li>
<li>Set keys: <a class="el" href="group___f_u_n_c___c_o_n_f.html#gade5b2bbc6ab46c4b7d9efa991b696ad2" title="Stores the specified CAP key.">EMV_CT_StoreCAPKey()</a>, <br  />
 if needed clear history with <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga7bc8a670f539230cb315ba2cb7442ea8" title="Clear all data.">EMV_ADK_CLEAR_ALL_RECORDS</a></li>
</ol>
</li>
<li><b> Reset virtual terminal to zero </b> <br  />
 To have a defined state: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> with most significant byte set to zero</li>
<li><b> Apply the configuration </b> <br  />
 if <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gab256e2810f51ed6cc87ea9d5536b7e1e">EMV_CT_INIT_OPT_CONFIG_MODE</a> is set: use <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga3170974cb7a73a9dec8f881295cc1cac" title="Write configuration to files.">EMV_CT_ApplyConfiguration()</a> to write the configuration to disk</li>
<li><b> Execute transactions </b> <br  />
 Use transaction commands as usual: <br  />
 <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a> <br  />
 EMV ADK will take care that parameter set matching current transaction's currency/transaction type is used.</li>
</ol>
<p>Remark: The order of 1. and 2. can be changed.</p>
<h2><a class="anchor" id="subsec_emv_ct_virt_term_approach"></a>
"Original" Virtual Terminal Approach</h2>
<p><a class="el" href="pg_emv_contact_users_guide.html#subsec_emv_ct_virt_term_map">Virtual terminal mapping table</a> provides useful feature allowing application to map different input data (like currency or transaction type) with preconfigured parameters set. However, sometimes it is useful to have different parameter sets without mapping them to transaction data fields. In case we just want to have different parameter sets and switch between them on demand, we still can use the same approach, but this time without calling method <a class="el" href="group___f_u_n_c___c_o_n_f.html#gab5d29810043af901c08736d4e9337353" title="Changes the Virtual Terminal Map.">EMV_CT_MapVirtualTerminal()</a>, since there is no mapping anymore.</p>
<dl class="section note"><dt>Note</dt><dd>This functionality is supported by Vertex framework only.</dd></dl>
<p>So, in order to work with different parameter sets, first, we need to prepare them and save them in the terminal's flash memory. All parameters will be automatically saved with ids added to their parameter file names: EMV_CT_Applications.xml for virtual terminal 0, EMV_CT_Applications_01.xml - for virtual terminal with id == 1, etc.</p>
<p>Workflow should follow the algorithm described below:</p>
<ol type="1">
<li><b> First, set parameters for your virtual terminals </b> <br  />
 For each virtual terminal you have to<ol type="a">
<li>Set Vertex framework into configuration mode first by calling <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> with option <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gab256e2810f51ed6cc87ea9d5536b7e1e">EMV_CT_INIT_OPT_CONFIG_MODE</a> enabled, <br  />
 set other <code>options</code> accordingly (e.g. <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gaf4074eda84324e107cb5ad73458868c8" title="virtual terminal 1: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_1</a> for your first Virtual Terminal, <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga3fe310b168e70a4bf7e383bdd7d78494" title="virtual terminal 2: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_2</a> - for second and so on)</li>
<li>Set terminal data: <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a></li>
<li>Set application data: <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>, <br  />
 if needed clear history with <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga7bc8a670f539230cb315ba2cb7442ea8" title="Clear all data.">EMV_ADK_CLEAR_ALL_RECORDS</a></li>
<li>Set keys: <a class="el" href="group___f_u_n_c___c_o_n_f.html#gade5b2bbc6ab46c4b7d9efa991b696ad2" title="Stores the specified CAP key.">EMV_CT_StoreCAPKey()</a>, <br  />
 if needed clear history with <a class="el" href="group___a_p_p_l_i___c_o_n_f___m_o_d_e.html#ga7bc8a670f539230cb315ba2cb7442ea8" title="Clear all data.">EMV_ADK_CLEAR_ALL_RECORDS</a></li>
<li>Switch configuration mode off by calling method <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> again, but this time without option <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gab256e2810f51ed6cc87ea9d5536b7e1e">EMV_CT_INIT_OPT_CONFIG_MODE</a> enabled.</li>
<li>call <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga3170974cb7a73a9dec8f881295cc1cac" title="Write configuration to files.">EMV_CT_ApplyConfiguration()</a> to write configuration to disk.</li>
</ol>
</li>
<li><b> Execute transactions </b> <br  />
 Use transaction commands as usual: <br  />
 <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a> <br  />
 EMV ADK will take care that parameter set matching current Virtual Terminal will be used.</li>
<li><b> Switch Virtual Terminal </b> <br  />
 In order to switch to another set of parameters (to another Virtual Terminal), you need to call <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a> with appropriate Virtual Terminal ID (<a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gaf4074eda84324e107cb5ad73458868c8" title="virtual terminal 1: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_1</a> for ID 1, <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga3fe310b168e70a4bf7e383bdd7d78494" title="virtual terminal 2: configuration and transaction not done with the standard terminal but virtual ter...">EMV_CT_INIT_VIRT_2</a> for ID 2 etc.). Once done, transactions are performed using usual methods without any additional modifications (<a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a>, <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a>). <dl class="section note"><dt>Note</dt><dd>There is no EMV_CT_INIT_VIRT_0 defined, since 0 is reserved for your default (real) terminal. In order to return back to your default terminal set most significant option byte to zero.</dd></dl>
</li>
</ol>
<h2><a class="anchor" id="subsec_ct_processtermination"></a>
Process Termination</h2>
<p>On process exit the EMV-CT-Framework switches off customer contact card as well as SAM cards slots 1-3. This is done by an exit function which is registered with Linux API function <code>atexit</code>. In order to make this function be invoked the processes main function has to return or <code>exit</code> has to be called. For handling such events like switching to sysmode it recommended to create an exit handler that calls <code>exit</code> and which is registered with <code>signal(SIGTERM,my_exit_handler)</code>.</p>
<h1><a class="anchor" id="sec_emv_ct_System_Setup_and_Requirements"></a>
System Setup and Requirements</h1>
<h2><a class="anchor" id="subsec_emv_ct_Compiler_and_Linker_Settings"></a>
Compiler and Linker Settings</h2>
<p>Chapter is empty.</p>
<h2><a class="anchor" id="subsec_emv_ct_Hardware"></a>
Hardware</h2>
<p>The ADK EMV Contact framework is hardware platform agnostic and supports installation on V/OS, VOS2, Android, and VOS3 terminals. <br  />
For currently supported platforms see release notes (emv-release-notes-x.x.x-xxx.pdf).</p>
<h2><a class="anchor" id="subsec_emv_ct_Software"></a>
Software</h2>
<p>The EMV framework requires installation of corresponding platform packages. <br  />
For details please refer to the release notes (emv-release-notes-x.x.x-xxx.pdf).</p>
<h2><a class="anchor" id="subsec_emv_ct_Deliverables_and_Deployment"></a>
Deliverables and Deployment</h2>
<h3><a class="anchor" id="subsubsec_emv_ct_Deliver_Deploy_solutions_vos"></a>
VOS/VOS2: ADK integration solution packages</h3>
<p>Recommended way is to use ADK integration solution packages. <br  />
 Those packages guarantee that all needed SW components are available and compatible. <br  />
 They are named like <code>adk-full-ext-x.x.x-xxxx.zip</code> </p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package name </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="2"><b>vos/</b>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>include/</code> , <code>lib/</code>  </td><td class="markdownTableBodyNone">development packages (header + libs)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="2"><b>vos/load/solutions/</b>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos-ux-prod.tgz</code>  </td><td class="markdownTableBodyNone">Usage without SDI  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos-sdi-prod.tgz</code>  </td><td class="markdownTableBodyNone">SDI in standard mode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos-ux_sdi_hdl_solution-prod.tgz</code>  </td><td class="markdownTableBodyNone">SDI in headless mode  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="2"><b>vos2/</b>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>include/</code> , <code>lib/</code>  </td><td class="markdownTableBodyNone">development packages (header + libs)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="2"><b>vos2/load/solutions/</b>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos2-engage-prod.tgz</code>  </td><td class="markdownTableBodyNone">Usage without SDI  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos2-sdi_solution-prod.tgz</code>  </td><td class="markdownTableBodyNone">SDI in standard mode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos2-sdi_hdl_solution-prod.tgz</code>  </td><td class="markdownTableBodyNone">SDI in headless mode  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dl.adk-x.x.x-xxxx-vos2-sdi_epm_solution-prod.tgz</code>  </td><td class="markdownTableBodyNone">Download package for external PINPad (EPP)  </td></tr>
</table>
<h3><a class="anchor" id="subsubsec_emv_ct_Deliver_Deploy_solutions_emv_desired"></a>
emv-desired.xml</h3>
<p>This file contains device specific lists of L2 kernels &ndash; contact and contactless &ndash; that a main application needs to select. In contrast to contactless for the contact L2 kernel there is a default (L27.0.3 at time of writing). Projects that require to keep the contact L1 driver at state of L3 certification can additionally set an IFM version in an &lt;L1&gt; node. A main application has to provide its own emv-desired.xml and install it either as a user config package at /etc/config/emv-desired.xml (VOS, VOS2) or together with the user-signed main application at $HOME/emv-desired.xml (VOS, VOS2) and /u00/buildagent-home/sdi/emv/emv-desired.xml (VOS3). For Android see <a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a>. The EMV-ADK documentation archive (emv-doc-x.x.x-xxx.zip) contains a sample file and a corresponding XSD file (emv-desired.xsd) that can be used to validate the formal correctness of the project specific emv-desired.xml.<br  />
 Available certifications decide which kernel version is allowed to use on which terminal (see <a href="http://www.emvco.com/" title="EMVCo Homepage">EMVCo Homepage</a>).</p>
<p>Example </p><div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;ISO-8859-1&quot;</span>?&gt;</div>
<div class="line"><span class="comment">&lt;!-- The value of attribute emv-desired is arbitrary text and is intended to identify the emv-desired.xml file. It will be printed to trace and warning messages if applicable. --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">emv</span> <span class="keyword">emv-desired</span> = <span class="stringliteral">&quot;my project and version&quot;</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">ct</span>&gt; <span class="comment">&lt;!-- no device specification for other, unlisted devices --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">L2</span>&gt;<span class="keyword">L27.0.3</span>&lt;/<span class="keywordtype">L2</span>&gt; <span class="comment">&lt;!-- without trailing platform letter --&gt;</span></div>
<div class="line">&lt;/<span class="keywordtype">ct</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">ct</span>&gt; <span class="comment">&lt;!-- As L2 certifications are not device specific it is possible to give an entire platform, see emv-desired.xsd for possible values --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">platform</span>&gt;<span class="keyword">VOS</span>&lt;/<span class="keywordtype">platform</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">L2</span>&gt;<span class="keyword">L27.0.2</span>&lt;/<span class="keywordtype">L2</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">ct</span>&gt;</div>
<div class="line">&lt;<span class="keywordtype">ct</span>&gt; <span class="comment">&lt;!-- device specific entry, especially required for freezing IFM version --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">device</span>&gt;<span class="keyword">V200c</span>&lt;/<span class="keywordtype">device</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">device</span>&gt;<span class="keyword">P200</span>&lt;/<span class="keywordtype">device</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">device</span>&gt;<span class="keyword">P400</span>&lt;/<span class="keywordtype">device</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">device</span>&gt;<span class="keyword">M400</span>&lt;/<span class="keywordtype">device</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">L1</span>&gt;<span class="keyword">IFM18c-EMV4.3_A00</span>&lt;/<span class="keywordtype">L1</span>&gt; <span class="comment">&lt;!-- the beginning of the IFM version is sufficient, optional entry --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">L2</span>&gt;<span class="keyword">L27.0.3</span>&lt;/<span class="keywordtype">L2</span>&gt; <span class="comment">&lt;!-- mandatory entry --&gt;</span></div>
<div class="line">&lt;/<span class="keywordtype">ct</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">emv</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="subsubsec_emv_ct_Deliver_Deploy_solutions_android"></a>
Android</h3>
<p>Android Applications are typically implemented in Java. For those the Verifone PSDK is the recommended interface. <br  />
 This documentation does not deal with PSDK but is written for C/C++ users. Typically applications on vos/vos2 are using C/C++ and need to be migrated to Android.</p>
<p>On Android systems the ADK-EMV is integrated in the SDI service and therefore not directly accessible. <br  />
 See Usecase 2 and 3 in <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>. <br  />
 It's recommended to use <code>libsdiclient</code> (<a href="./pg_sdiclient_users_guide.html" title="ADK-SDI-Client Programmers Guide">ADK-SDI-Client Programmers Guide</a>) for SDI respectively EMV access.</p>
<p>Verifone Android Terminals come with a preloaded SDI service. <br  />
 If needed this can be updated by installation of <code>SDIService-</code>(trinity|neo)-x.x.x-xxx.apk.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Deliver_Deploy_solutions_vos3"></a>
VOS3</h3>
<p>Similar to Android the ADK-EMV is integrated in the SDI service and therefore not directly accessible. <br  />
 See Usecase 2 and 3 in <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>. <br  />
 SW to be loaded on the terminal:</p><ul>
<li><code>dl.adk-VOS3_x.x.x-CD-xxx-vos3-</code>(m450|p630|ux700)-prod.tar <br  />
 or</li>
<li><code>adk-VOS3_x.x.x-CD-xxx-vos3-</code>(m450|p630|ux700)-fastboot-prod.tgz <br  />
 or</li>
<li><code>adk-VOS3_x.x.x-CD-xxx-vos3-</code>(m450|p630|ux700)-flatimage-prod.tgz</li>
</ul>
<p><b>Development headers and libs</b> <br  />
 All EMV headers are included in SDK <code>adk-sdk-vos3-VOS3_x.x.xx-CD-xxx.zip</code>. <br  />
 Also the needed libs, which are:</p><ul>
<li><code>libEMV_CT_Client.a</code> </li>
<li><code>libEMV_CT_Link.so</code>, <code>libEMV_CT_Link.so.x</code> </li>
<li><code>libTLV_Util.so</code>, <code>libTLV_Util.so.x</code> </li>
</ul>
<p><b>VOS2 compatibility mode:</b> <br  />
 <code>libsdiclient</code> (<a href="./pg_sdiclient_users_guide.html" title="ADK-SDI-Client Programmers Guide">ADK-SDI-Client Programmers Guide</a>) offers the interfaces from ADK-EMV, ADK-MSR and ADK-TEC. <br  />
 To make use of this feature it's needed to load the vos3-cards-plugin to the terminal.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Deliver_Deploy_internal_packages"></a>
VOS/VOS2: Internal structure of packages</h3>
<p>ADK-EMV loading packages are also provided separately. <br  />
 When using those the user is responsible for version compatibility to the other used SW components. <br  />
 Packages delivered (x - version number digit):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Package name </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>emv-doc-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">Documentation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>emv-vos-dev-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS development package, to be installed in PC build environment  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>emv-vos-load-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS load package, to be installed on terminal  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>emv-vos2-dev-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS2 development package, to be installed in PC build environment  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>emv-vos2-load-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS2 load package, to be installed on terminal  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>emv-vats-vos-load-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS load package with VATS transaction simulation, to be installed on terminal  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>emv-vats-vos2-load-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">VOS2 load package with VATS transaction simulation, to be installed on terminal  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>emv-full-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">Full package (Documentation, development and load packages for VOS, VOS2, Android, and VOS3)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>emv-vats-full-x.x.x-xxx.zip</code>  </td><td class="markdownTableBodyNone">Full package with VATS transaction simulation (Load packages for VOS, VOS2, Android, and VOS3)  </td></tr>
</table>
<p>In these packages you can find:</p>
<ul>
<li><b>Development</b> <b>packages</b> <ul>
<li>Include headers <br  />
<code>include/emv</code> </li>
<li>Libraries for linking<ul>
<li>Usecase 1 and 2 (see <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>) <br  />
<code>libEMV_CT_Client.a</code>, <code>libEMV_CT_Link.so</code> </li>
<li>Usecase 4 (see <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>) <br  />
<code>libEMV_CT_Framework.so</code> </li>
</ul>
</li>
<li>TLV utility <br  />
 To ease handling of BER TLV streams used on EMV ADK interface a library is provided: <br  />
<code>libTLV_Util.so</code> <br  />
 Please note: This shared library is also used by the EMV-ADK components themselves and therefore has to be deployed to the target device. <br  />
 The predecessor <code>libTLV_Util.a</code> is <b>deprecated</b> and will by discontinued.</li>
<li>Special Use Case <br  />
 This library provides the EMV-ADK functional interface, serialize the commands in the EMV-ADK native way and calls <code>EMV_CT_SerInterface</code>. <br  />
 It is intended for payment applications that are split to multiple processes which do interprocess communication via an application specific protocol. <br  />
<code>libEmvSerialise.a</code> </li>
<li>Internal use only <br  />
 Needed by TEC server: <code>libEmvTecClient.a</code> <br  />
<br  />
</li>
</ul>
</li>
<li><b>Load</b> <b>packages</b> <br  />
<br  />
<ul>
<li>VOS, VOS2<ul>
<li>Components needed for Usecase 1 (see <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>)<ul>
<li>Framework linker <br  />
<code>dl.libEMV_CT_Link.so.x.x.x.tar</code> </li>
<li>Framework <br  />
<code>dl.libEMV_CT_Framework.so.x.x.x+VEL.tar</code> </li>
<li>L2 Kernel <br  />
<code>dl.EMV_CT_VERTEX-x.x.x-nnn.tar</code> (L2 kernel set) <br  />
<code>dl.emv-allowed-x.x.x.tar</code> (list of certified L2 kernels) <br  />
<code>emv-desired.xml</code> list of required L2 kernels) <br  />
<code>If</code> EMV ADK framework init option EMV_CT_INIT_OPT_SHARED_CONFIG/EMV_CTLS_INIT_OPT_SHARED_CONFIG is active the primary location for the emv-desired is <br  />
<code>/etc/config/adkemv/emv-desired</code>.xml (e.g. SDI Server usage) otherwise it is ${HOME}/emv-desired.xml <br  />
<code>In</code> both cases the secondary search location is /etc/config/emv-desired.xml</li>
</ul>
</li>
<li>Components needed for Usecase 2 (see <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>)<ul>
<li>Framework linker <br  />
<code>dl.libEMV_CT_Link.so.x.x.x.tar</code> </li>
</ul>
</li>
<li>Components needed for Usecase 4 (see <a class="el" href="pg_emv_contact_users_guide.html#anchor_emv_ct_Use_Case_Samples_1to4">Usecases 1 to 4</a>)<ul>
<li>Framework <br  />
<code>dl.libEMV_CT_Framework.so.x.x.x+VEL.tar</code> </li>
<li>L2 Kernel <br  />
<code>dl.EMV_CT_VERTEX-x.x.x-nnn.tar</code> (L2 kernel set) <br  />
<code>dl.emv-allowed-x.x.x.tar</code> (list of certified L2 kernels) <br  />
<code>/etc/config/emv-desired</code>.xml or $HOME/emv-desired.xml (list of required L2 kernels)</li>
</ul>
</li>
</ul>
</li>
<li>VATS (Verifone Automatic test system) - internal use <br  />
 A special version of framework shared object is delivered. By means of VATS python test scripts the reponses of EMV ADK transaction functions can be simulated. <br  />
<code>dl.libEMV_CT_Framework.so.x.x.x+VEL_VATS.tar</code> <br  />
<br  />
</li>
<li>Encryption manager: VTP / VSP <br  />
 See also <a href="./pg_emv_encryption_manager_users_guide.html" title="ADK-EMV Encryption Manager Programmers Guide">ADK-EMV Encryption Manager Programmers Guide</a>.<ul>
<li>VOS: VTP <br  />
<code>dl.libEMV_EM.so.x.x.x+VTPx.x.x.tar</code> </li>
<li>Verix: VSP <br  />
<code>dl.libEMV_EM.so.x.x.x+VSPx.x.x.xx.zip</code> </li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="sec_emv_ct_Troubleshooting"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="subsec_emv_ct_TS_1"></a>
How to start analyzing an EMV problem?</h2>
<ul>
<li>Fetch the basic information<ul>
<li>which ADK EMV version is used and which L2 kernel is used</li>
<li>config XML files available</li>
<li>trace of the EMV transaction available</li>
<li>test case or card used</li>
<li>OS, terminal, ADK integration package used</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_TS_2"></a>
Guide for EMV Analysis</h2>
<ol type="1">
<li>Double check the EMV version in the trace If CTLS find out which kernels are loaded and which was used for the transaction <br  />
</li>
<li>Try to understand the transaction<ul>
<li>Transaction Type and Amount</li>
<li>Application selection (if relevant)</li>
<li>CVM performed</li>
<li>SDA or DDA or CDA</li>
<li>Outcome of the transaction <br  />
</li>
</ul>
</li>
<li>Check especially the outcome as in the description there should be something like (expected outcome, real outcome) Use the kernel debug data (This is most important)<ul>
<li>Exit Code</li>
<li>Last SW12</li>
<li>ODA bitmaps <br  />
</li>
</ul>
</li>
<li>Check the TVR, what happened during the transaction<ul>
<li>Check if AAC,TC or ARQC was requested from terminal side and why (TAC/IAC analysis)</li>
<li>Check TSI and what is supported by the card</li>
<li>For CTLS check if there is something scheme specific to consider</li>
<li>Check the “outcome tags” of the transaction if you see something suspicious <br  />
</li>
</ul>
</li>
<li>Now you may be know why the txn outcome differs from the expected. Try to think what you would need to change in this transaction to come to the expected outcome.<ul>
<li>Cross check with test case requirement</li>
<li>Cross check if you have the test card or Collis script available to reproduce the problem <br  />
</li>
</ul>
</li>
<li>Now it might be XML file review time: Check if you can see already something from the transaction parameters or XML config parameters of the AID that may be wrong configured and would lead to a wrong behavior. <br  />
</li>
<li>If everything is seems correct and you don’t detect obvious misconfiguration:<ul>
<li>Try to reproduce the issue with the software stack given in the ticket</li>
<li>Try to reproduce with the latest software stack (newest) and see if still existing <br  />
</li>
</ul>
</li>
<li>If not reproducible: Try to compare with customer environment and blame their application :D If reproducible: Try to fix it with parameter changes or test app adoption <br  />
</li>
<li>If no help: Check if the test case is correctly chosen and if applicable or may be something wrong with test case <br  />
</li>
<li>If no help: Contact ADK guys and discuss</li>
</ol>
<h2><a class="anchor" id="subsec_emv_ct_Frequently_Asked_Questions"></a>
Frequently Asked Questions</h2>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_1"></a>
What is EMV?</h3>
<ul>
<li>The term EMV comes from Europay, MasterCard and Visa. These 3 credit card companies got together in 1994 to start to develop the EMV Specifications to apply chip card technology in payment transactions.</li>
<li>EMVCo was later formed to manage the maintenance of the Specifications and administration of EMV type approval process. EMVCo, LLC, was formed in February 1999.</li>
<li>Europay became part of MasterCard in 2002. The current members of EMVCo are American Express, JCB, Discover, MasterCard, UnionPay and Visa. Each of these organizations owns an equal share of EMVCo and has representatives in the EMVCo organization at the management and working group levels.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_2"></a>
What is an ICC?</h3>
<ul>
<li>In EMV context, smart card, chip card, ICC (integrated circuit card) and EMV card are referred to the same thing.</li>
<li>A chip card used in payment transactions is usually a card with a magstripe at the back (will disappear in future) plus a chip in front which is a self-contained microprocessor.</li>
<li>A chip card can be,<ul>
<li>Contact only</li>
<li>Contactless only</li>
<li>Dual-interface, i.e. contact and contactless</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_3"></a>
Why is EMV called Chip and PIN?</h3>
<p>When EMV was rolled out in UK, it was given a marketing name of “Chip and PIN”. This is because of the chip on the card and that offline PIN verification is usually required during the transaction, even for credit card transactions. However, whether PIN is required for cardholder verification is up to the issuer to decide. In many Asian Pacific countries, EMV cards were issued with signature as the preferred CVM for POS transactions.</p>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_4"></a>
What is an AID?</h3>
<p>AID stands for Application Identifier. Every card application in EMV is identified by an AID. The structure of AID is defined in ISO 7816-4. It consists of 2parts, Rid and PIX. Samples:</p><ul>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x04,0x10,0x10} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x03,0x10,0x10} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x04,0x30,0x60} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x04,0x60,0x00} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x03,0x20,0x10} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x03,0x20,0x20} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x03,0x30,0x10} };</li>
<li>{ 7, {0xA0,0x00,0x00,0x00,0x03,0x80,0x10} };</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_5"></a>
What is a PCD, PICC?</h3>
<ul>
<li>PCD which stands for Promixity Coupling Device is the contactless reader used in contactless payments. It generates RF field through which the contactless card (PICC) gets the power and communicates with the reader.</li>
<li>PICC stands for Proximity ICC which is the contactless card used in contactless payments</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_6"></a>
Can A customer simply plug in a Verifone device and expect chip payment transactions to work immediately?</h3>
<p>No, plug and play is not possible for EMV.</p><ul>
<li>Despite the fact that we have hardware and software ready for customers, customers will need to process the followings, through either a standalone or integrated payment application,</li>
<li>Provide EMV terminal configurations, e.g. AID list supported, CAPKs, floor limit, etc</li>
<li>Process callbacks for process customization</li>
<li>Handle EMV data such as Application Cryptogram in host communication</li>
<li>Process non-EMV requirements which are required for EMV transactions, e.g. reversal if host approval is rejected by the card</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_7"></a>
What kinds of certification are required for implementing contact EMV?</h3>
<ul>
<li>EMVCo defines and maintains EMV specifications. These provide global requirements to ensure interoperability. EMV Level 1 and Level 2 certifications are managed by EMVCo. The objective of these certifications is to prove that the device conforms to the EMV specifications.</li>
<li>EMVCo does not own or operate any card scheme. Each card scheme defines its own implementation details in addition to the EMVCo's global requirements, e.g.</li>
<li>Visa - VIS</li>
<li>MasterCard - M/Chip</li>
<li>Amex - AEIPS, etc Each card scheme manages its own End to End Certification for payment application that supports the card scheme's contact EMV requirements. All of the card schemes require EMV Level 1 and Level 2 certification as a pre-requisite for requesting the End to End Certification. End to End Certification is the responsibility of acquirers.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_8"></a>
What kinds of certification are required for implementing contactless payments?</h3>
<p>Unlike contact EMV requirement which was started off in a cooperation manner from Europay, MasterCard and Visa, contactless payment requirements were started off as competition. As a result, each card scheme defines its own contactless requirements which are totally different from each other. Thus, while there is only one contact EMV kernel in the device, it requires one contactless kernel for each card scheme's contactless specification. The contactless kernel certification is managed by individual card scheme. Certifications are per kernel AND per hardware (not per terminal family).</p>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_9"></a>
What is a certified or approved terminal configuration?</h3>
<ul>
<li>Different EMV terminal configurations used may result in different ways an EMV transaction be processed. For example, an offline only terminal will never request for an online host authorization while an online only terminal will never approve a transaction without online processing. Because this, EMV Level 2 type approval request for an EMV kernel is submitted with an ICS (Implementation Conformance Statement) with a list configurations to be used. The listed configurations are tested during the certification process.</li>
<li>A Letter of Approval will be issued with all the configurations tested after the certification is successful. These configurations are known as certified or approved terminal configurations of the certified EMV kernel. When the EMV kernel is used in a payment system, the terminal configuration used has to be one the certified configurations. Otherwise, it is running in non-compliant mode.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_10"></a>
What is a major or minor EMV terminal configuration item?</h3>
<ul>
<li>EMVCo issued type approval bulletins TA11 and TA31 to classify EMV terminal configuration items into Major, Minor, Hide-able and Variable categories. Major items must be followed exactly as the certified configurations shown on Letter of Approval. Other types of items are allowed to be different.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_11"></a>
What is required in an EMV application?</h3>
<ul>
<li>Bear in mind that all EMV requirements specified in the EMVCo’s Specifications have been implemented in the EMV kernel and the kernel has been certified. The application you’re going to create is to address the followings,</li>
<li>Customize the transaction flow to meet the merchant or acquirer’s requirements, e.g. EMV related display messages, prompts, receipts etc</li>
<li>EMV transaction related process that is not specified in EMV Specifications, e.g. enforcing to use chip technology, fallback to use magstripe in case of chip failure, etc</li>
<li>Communicate with host with EMV specific transaction data</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_12"></a>
What is fallback to MSR?</h3>
<ul>
<li>In EMV using chip card for MSR transactions is only allowed after attempting to process a chip transaction but failed due to chip malfunction or other issues.</li>
<li>If CTLS fails there might be fallback scenarios to other technologies (Chip / msr) depending on the scheme. Also here MSR usage is allowed only if the chip part (CTLS chip or CTLS msr) is not working</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_13"></a>
What Are Card Read Transactions?</h3>
<ul>
<li>A full EMV transaction involves validation processing steps such as data authentication, cardholder verification, terminal risk management etc.</li>
<li>The purpose of non-EMV transaction using EMV functionality is only to read the PAN or track 2 equivalent data from the chip card. This involves only the first few steps such as Application Selection, Initiate Application Selection and then Read Application Data. As soon as the PAN is received from the rest of the EMV transaction steps will be skipped. Usually an AAC is requested.</li>
<li>Also the rest of the transaction will then be processed as if the PAN is read from the magnetic stripe, i.e. non-EMV.</li>
<li>Reversal, Refund, Reservation Confirmation, separate tip, …</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_14"></a>
Under which situation(s), is a host approval required to be reversed?</h3>
<ul>
<li>The chip card is required to stay in the chip reader throughout the whole transaction. The reason is that at the end of the transaction, the card is required to generate an Application Cryptogram (AC). The AC will be stored by payment systems to proof that such transaction was performed with the genuine card’s presence.</li>
<li>After the online processing, if the host approves the transaction, the host decision (in the form of ARPC which is a type of AC) is required to be sent to the card. The card will authenticate the ARPC to make sure that the response is good before accepting the approval.</li>
<li>If either the card rejects the decision or the card has been prematurely removed, a reversal is required to be sent back to the host.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_15"></a>
What are common EMVCo Terms?</h3>
<ul>
<li>AIP is Application Interchange Profile. It specifies the application functions that are supported by the card application.</li>
<li>AFL is Application File Locator. It consists of the list of files and related records for the currently selected application that shall be read by the terminal application for the subsequent transaction processing.</li>
<li>TVR is Terminal Verification Results. It is a 5-byte data element which is used as a bitmap. Each bit records the result of a validation during Data Authentication, Processing Restrictions, Cardholder Verification and Terminal Risk Management.</li>
<li>AC is Application Cryptogram. It is generated by the card using an Issuer specific algorithm and cryptographic keys.</li>
<li>There are 3 types of AC,<ul>
<li>TC, Transaction Certificate, which is generated for an approved transaction</li>
<li>ARQC, Authorization Request Cryptogram, which is generated for host authorization request</li>
<li>AAC, Application Authentication Cryptogram, which is generated for a declined transaction</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_16"></a>
What is TAC IAC processing?</h3>
<ul>
<li>TAC is Terminal Action Code and IAC is Issuer Action Code. Each of them comes in a set of 3, namely,</li>
<li>TAC – Denial, TAC – Online, TAC – Default, and</li>
<li>IAC – Denial, IAC – Online, IAC – Default</li>
<li>Each of these data element has the exactly same structure as TVR. They are used in pairs, e.g. TAC – Denial and IAC – Denial, to compare to the TVR to decide if the specific action shall be taken.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_17"></a>
What is tearing?</h3>
<ul>
<li>During a chip payment transaction, the card has to communicate with the terminal throughout the transaction.</li>
<li>For contact chip card, the card is required to stay in the reader. For contactless chip card, the card is required to stay within the RF field generated by the reader.</li>
<li>Tearing occurs when the card removed such that the communication is no longer possible. Tearing is a lot easier to occur in contactless transactions.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_18"></a>
What is collision?</h3>
<ul>
<li>Collision occurs when more than one contactless chip card is moved within the RF field generated by the contactless reader and the reader is not able to establish a comms channel to any of the CTLS cards. This is not unusual in contactless transactions, e.g. a cardholder puts a Visa and a MasterCard contactless card in a wallet and presents the wallet to the reader during the transaction.</li>
<li>Collision only occurs in contactless transactions. Collision detection can not be guaranteed, especially if the contactless reader is able to communictae stable with one of the cards in the field it will progress with this card even there seems there are 2 cards inside the antenna range.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_19"></a>
What is contactless magstripe and contactless EMV?</h3>
<ul>
<li>Contactless payments were started off as competition. MasterCard and Visa defined separately their own requirements in applying contactless technology in payment.</li>
<li>Early contactless chip specifications were designed for MSR payment network to address counterfeit fraud in MSR cards. A dynamic card verification code that can only be generated by a genuine card is added into the track 1 and track 2 data. The code is generated by the card and formatted by the reader into track data. The process is transparent to the existing terminal application. The dynamic code is verified by the issuer host. This code is known as CVC3 for MasterCard and dCVV for Visa.</li>
<li>Both MasterCard and Visa later defined new requirements for EMV infrastructure. Visa called its requirement payWave qVSDC while MasterCard called it PayPass M/Chip. Their original requirement payWave MSD and PayPass magstripe respectively.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_20"></a>
What are Callbacks?</h3>
<ul>
<li>Callbacks are used to customize EMV applications, e.g. for regional/domestic requirements.</li>
<li>Callbacks are used to provide intermediate transaction results to the terminal application and to fetch updated parameters from the terminal application depending on the transaction progress.</li>
<li>Typical use case are<ul>
<li>Specific processing one the PAN/BIN range is known</li>
<li>Language and application selection requirements</li>
<li>Co branded Cards</li>
<li>additional security checks, e.g. blacklist, online txn, …</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_21"></a>
What are the most important callbacks for Contact EMV?</h3>
<ul>
<li>CVM (PIN Offline, Online, Biometrics)</li>
<li>Application Selection</li>
<li>Blacklist</li>
<li>DCC</li>
<li>Domestic Reconfig Example: Continue Transaction Offline CLIENT MSG CMD: 39 11 [ 30] F01C9F410400000000DF5806000000000000DF4E0100DF470100DF340100 (Callback example, here: BF08 == PIN Input, Online PIN) CLIENT MSG CBK: 91 01 [13] F00BBF0808DF790100DF410101 CLIENT MSG CBKR: 92 00 [6] F004DF790100 CLIENT MSG RESP: 90 E2 [405] F0820193DF4204000000019F2701809F3602005E9F260845CFA9C81F28B5BD5A0A476173</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_22"></a>
What are the most important callbacks for Contactless EMV?</h3>
<ul>
<li>Contactless Callbacks are avoided whenever possible because of the 500msecs txn time requirement</li>
<li>Application Selection (e.g. US Common Debit)<ul>
<li>No customer involvement</li>
</ul>
</li>
<li>Kernel Selection (e.g. French Card Bancaire)<ul>
<li>Same AID can point to different kernels</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_23"></a>
How is the Configuration for EMV Working?</h3>
<p>There are different kind of parameters</p><ul>
<li>Terminal Wide</li>
<li>Application Specific<ul>
<li>The same per scheme in CT</li>
<li>Different per scheme in CTLS</li>
</ul>
</li>
<li>CAP Keys (used to secure the transaction)</li>
<li>You configure all those parameters as they come from your acquirer. Alternatively you can use TMS or a fixed configuration (file download).</li>
<li>Parameters must be updatable in the field.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_24"></a>
Why are there in CTLS so many different configuration Options?</h3>
<ul>
<li>In opposite to CT, there is an own kernel for each CTLS scheme</li>
<li>There are around 15 different kernels as per today, each having their own independent specification</li>
<li>Each kernel brings its own data and configuration</li>
<li>The specs are independent on each other and define their own flow and configuration tags and fields</li>
<li>Each of those must be configured indepedently</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_25"></a>
Where do I find an overview on CTLS Kernel certifications?</h3>
<ul>
<li>Certification in CTLS have to be performed per terminal</li>
<li>different antenna layout per terminal</li>
<li>underlying CTLS L1 Ask your PM or support team for advice here</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_26"></a>
How does the ADK cross check the used kernels (allowed XML)?</h3>
<ul>
<li>New kernels that are not yet certified are just provided after certification</li>
<li>During End of certification and LOA there are usually several weeks until the kernel becomes valid and allowed to be used</li>
<li>It happens that a kernel from one to the other product is unchanged (e.g. one common set of kernels for Engage as far as possible) ? Anyhow I am only allowed to use kernels that have LOA available</li>
<li>As soon as the LOA of a kernel is available the next ADK Cards release will add this kernel to the allowed file and activate this for official usage</li>
<li>Allowed XML file is system signed and part of the ADK release</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_27"></a>
What happens if I use a not certified kernel?</h3>
<ul>
<li>If an uncertified kernel is used, then it will not be in the allowed XML and the ADK will recognize this<ul>
<li>Add remarks/warnings to the trace</li>
<li>Issue a warning beep (Once on first Init Framework after bootup)</li>
<li>Display a Splash Screen with warning that uncertified kernels are loaded.</li>
</ul>
</li>
<li>This will allow development with pre-released kernels but obviously will indicate if a wrong kernel is downloaded in the field (which is a requirement from the EMV team).</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_28"></a>
How can I select the kernel I want to use (desired XML)?</h3>
<ul>
<li>Add your kernels to the desired XML file<ul>
<li>Per terminal</li>
<li>One file for all</li>
<li>Sample/Default delivered with each EMV ADK release: “doc/emv/emv-desired.xml“ (also as load package in latest releases)</li>
</ul>
</li>
<li>Payment applications might want to load only a subset of kernels or require to load fixed specific kernel versions as they were used for their national or bank approval. The payment application must specify this setting in the emv-desired.xml configuration file.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_29"></a>
What has an influence on transaction speed for EMV Contact (Contactless)?</h3>
<p>There are many parameters that influence the speed of an EMV Chip transaction. Since the card processing time in EMV contact transactions is significantly bigger than the terminal processing time, the used card has a major influence on the overall transaction time of an EMV transaction.</p><ul>
<li>transaction processing on terminal apps side<ul>
<li>minimize processor load during transaction (no videos, animated HTMLS, ...)</li>
<li>NO TRACES!!!</li>
<li>cardholder interaction</li>
<li>no delay in between subsequent kernel calls / subsequent ADK calls (move apps processing that is not needed immediately after the end of the transaction)</li>
<li>have all transaction data available on card insertion and do not collect it during the transaction</li>
</ul>
</li>
<li>used card<ul>
<li>card supports SDA/DDA/CDA</li>
<li>PSE support</li>
<li>key length needed for private key operations</li>
<li>cards OS implementation</li>
<li>support of baudrate increase on L1</li>
<li>cards processor / crypto co processor / internal characteristics of the card</li>
</ul>
</li>
<li>Contactless (similar to contact):<ul>
<li>baudrate of comms is higher</li>
<li>time critical: Cryptogram calculation on the ICC</li>
<li>PSE ALWAYS supported</li>
<li>Specs have speed optimized flow (e.g. no offline PIN, data authentication after card removal)</li>
</ul>
</li>
<li>An up to date CT card is as fast as a CTLS card<ul>
<li>4 paramters go into the calculation</li>
<li>Terminal processing time</li>
<li>Card processing time</li>
<li>Terminal transmission time</li>
<li>Card transmission time</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_30"></a>
What options do I have for LED usage, especially on screen LEDs?</h3>
<ul>
<li>The VERTEX kernels and the VFI-Reader have callbacks to indicate LED switches</li>
<li>On terminals with physical LEDs the ADK switches them automatically, fastest way and recommended</li>
<li>On terminals with screen LEDs you can invoke a callback and use ADK GUI to display the LEDs. There is a speed optimized display option implemented that will display the LEDs fast.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_31"></a>
What restrictions do apply with On Screen LEDs?</h3>
<ul>
<li>slower than physical LEDs</li>
<li>Screen refreshes only all xx msecs depending on scree refresh rate</li>
<li>Thus no consecutive switching possible but even if LEDs switche din order, they will be switched on at the same time.</li>
<li>Apps needs to consider LEDs in screen layout</li>
<li>ADK GUI solution reserves the border of the display for the LEDs, remaining screen free visible.</li>
<li>Example in EMV test app (function configureSoftLeds --&gt; uiConfigLEDs)</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_32"></a>
What do I need to consider with the CTLS logo positioning?</h3>
<ul>
<li>Location: CTLS Logo must be centered over the "landing zone" where the signal is strongest.</li>
<li>Size: Contactless Symbol image appears optimally when shown no smaller than 13mm in height and 22mm in width</li>
<li>Clear Space: A minimum clear space of ¼ the height of the Contactless Symbol should be maintained on all four sides of the image</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_33"></a>
How to integrate MSR, CT, CTLS with technology selection?</h3>
<ul>
<li>Standard Use Cases MSR and CT activation and CTLS (Auto) EMV-Transaction MSR and CT activation and CTLS EMV ISO detection</li>
<li>To drive a complete EMV transaction via TECHSEL it is necessary to Setup the EMV transaction in advance SetupCTLSTransaction CallTechnologySelection Polls msr, CT and CTLS (performs complete CTLS txn) Evaluate TECHSEL outcome If(msr) Handle Track Data else if (CT) StartTransactionCT /ContinueOfflineCT (start CT transaction) else if (CTLS) ContinueOfflineCTLS (fetch CTLS data / handle CTLS txn)</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_34"></a>
How does mobile EMV payment (Apple, Android, Samsung) work?</h3>
<p>Tokenization</p><ul>
<li>“virtual card” created on issuer side, which is connected to the originally photographed / entered card data</li>
<li>This is loaded to mobile and just at issuer backend the original card is referenced/mapped to the original card and bank account</li>
<li>Apple / Samsung have security module, card keys can be downloaded to device</li>
<li>Cheaper Android systems do not have this ? HCE (Host Cloud Emulation)</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_FAQ_35"></a>
From where to fetch the last Status Word from chipcard?</h3>
<p>In response data of <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a> the first two bytes of <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#a5d30443bc2f23ca5b8e38843f5c9c9e3" title="Debug Data of the Contact Optimum L2 kernel and if available of the CTLS Optimum kernels   TLV tag TA...">EMV_CT_TRANSRES_TYPE::T_DF64_KernelDebugData</a> give the last status word from ICC.</p>
<h2><a class="anchor" id="subsec_emv_ct_Logging"></a>
Traces</h2>
<p>Traces are essential for all kind of analysis. <br  />
 Please use ADK-LOG (<a href="./pg_logging_users_guide.html" title="ADK-LOG Programmers Guide">ADK-LOG Programmers Guide</a>) to fetch them. <br  />
 Following logging channels contain EMV related data:</p><ul>
<li>EMVCT</li>
<li>EMVCTLS</li>
<li>TEC</li>
<li>when using SDI:<ul>
<li>SDI</li>
<li>SDICLT</li>
<li>SDIPROT</li>
</ul>
</li>
</ul>
<p>To fetch ALL traces use "Log Level = Trace". <br  />
 To have timestamps with milliseconds use "Log format = RFC 5424".</p>
<h3><a class="anchor" id="subsubsec_emv_ct_Logging_callback"></a>
For special needs: Trace callbacks</h3>
<p>For compatibility reasons the trace callback mechanism is still available. <br  />
 Please only use in case ADK-LOG functionality does not cover your needs. <br  />
 Trace callback mechanism can be configured by</p><ul>
<li><a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga2e45cc21dd0264a8d3a8c90c733d4f8c" title="Callback trace (TAG_BF7F_CBK_TRACE), switch on EMV trace. Only effective in case of deactivated EMV_C...">EMV_CT_INIT_OPT_TRACE</a>,</li>
<li><a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga9b2576e36b0771a53249ff7b448197fd" title="Callback trace (TAG_BF7F_CBK_TRACE), switch on client trace. Only effective in case of deactivated EM...">EMV_CT_INIT_OPT_TRACE_CLT</a>,</li>
<li><a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gadb67c45ce3f0e228db2585ecb885b0dd" title="Callback trace (TAG_BF7F_CBK_TRACE), additionally write to syslog. Only effective in case of deactiva...">EMV_CT_INIT_OPT_TRACE_SYSLOG</a>,</li>
<li><a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#gafc7596039c1ae075f46cb4e23fd5a1a1" title="Solely use ADK-LOG for tracing. Deactivates trace callback (TAG_BF7F_CBK_TRACE). De-/Activation of AD...">EMV_CT_INIT_OPT_TRACE_ADK_LOG</a>.</li>
</ul>
<h3><a class="anchor" id="subsubsec_emv_ct_Logging_timings"></a>
Timing Traces</h3>
<p>A trace option for timings is implemented: <a class="el" href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga10ed9429c080a6f23be83f0bb732703e" title="measure card and terminal performance. Note: For this feature other trace output is switched off">EMV_CT_INIT_OPT_TIMINGS</a>.</p>
<p>This will do the following:</p>
<p>Once activated automatically disables the EMV client logs and EMV transaction logs</p>
<p>Fetch time stamps at the begining of each CT and CTLS transaction call, e.g. </p><pre class="fragment">StartTransaction / SetupTransaction
ContinueOffline
ContinueOnline
</pre><p>Fetch time stamps before and after each CT and CTLS L1 command</p>
<p>Fetch a time stamp at the end of the transaction (CT switched off (offline or online)), (CTLS field disabled and LED/Beep thread started)</p>
<p>All these data will be written just to RAM during the transaction. Just at the end when the card is deactivated and transaction completed it will be written to log (either to callback trace or to ADK-LOG as configured by the application). This way it will have alsmost zero influence on the transaction timing.</p>
<p>The above measure points allow to differ clearly in</p><ul>
<li>card calculation time (slow card),</li>
<li>ADK and kernel calculation time (slow ADK or kernel) and</li>
<li>Application calculation time in between the ADK calls (slow application).</li>
</ul>
<p>As long as the same card is used it also excludes the card itself since the card calclulation time can be removed from the process. We don't have any influence on card speed (except PPS procedure, which should be activated by application).</p>
<p>It allows application developers to create tests, where they can measure their application processing time. It also allows applications to find out with this log if they have an exceptional slow card for testing.</p>
<h2><a class="anchor" id="subsec_emv_ct_KernelDebugData"></a>
Kernel Debug Data</h2>
<p>Debug Data is part of the transaction results and can be used for evaluating the status and possible issues within the last transaction. Currently there are 32 bytes reserved for the Debug Data. It is recommended to have the debug data available for support, trace or analysis.</p>
<p>The debug data is composed of 2-byte ADK debug data and kernel debug data.</p>
<p>The 2-byte ADK debug data offers information on the ADK exit point and on the status or sub steps of the transaction. The trailing bytes are the ADK debug data.</p>
<p>The kernel debug data is stored in the leading bytes.</p>
<p>For the Vertex contact kernel there are 24 bytes of transaction information available: </p><div class="fragment"><div class="line">0   <span class="comment">// ICC SW1</span></div>
<div class="line"> </div>
<div class="line">1   <span class="comment">// ICC SW2</span></div>
<div class="line"> </div>
<div class="line">2   <span class="comment">// Level 1 exit status</span></div>
<div class="line"> </div>
<div class="line">3   <span class="comment">// Kernel exit status</span></div>
<div class="line"> </div>
<div class="line">4   <span class="comment">// Bitmap indicating transaction progress</span></div>
<div class="line"> </div>
<div class="line">5   <span class="comment">// Status of certificate recovery</span></div>
<div class="line"> </div>
<div class="line">6   <span class="comment">// Status of CVM process</span></div>
<div class="line"> </div>
<div class="line">7   <span class="comment">// Status of script processing</span></div>
<div class="line"> </div>
<div class="line">8   <span class="comment">// 1st GenerateAC cryptogram type requested.</span></div>
<div class="line"> </div>
<div class="line">9   <span class="comment">// 1st GenerateAC cryptogram type received.</span></div>
<div class="line"> </div>
<div class="line">10  <span class="comment">// 2nd GenerateAC cryptogram type requested.</span></div>
<div class="line"> </div>
<div class="line">11  <span class="comment">// 2nd GenerateAC cryptogram type received.</span></div>
<div class="line"> </div>
<div class="line">12  <span class="comment">// Auxiliary debug data</span></div>
<div class="line"> </div>
<div class="line">13  <span class="comment">// Cryptography operation</span></div>
<div class="line"> </div>
<div class="line">14  <span class="comment">// Cryptography outcome (Data Authentication)</span></div>
<div class="line"> </div>
<div class="line">15  <span class="comment">// ZKA debug &quot;Step&quot; data</span></div>
<div class="line"> </div>
<div class="line">16  <span class="comment">// ZKA debug &quot;Sub-step&quot; data</span></div>
<div class="line"> </div>
<div class="line">17  <span class="comment">// Yet another auxiliary debug data byte</span></div>
<div class="line"> </div>
<div class="line">18  <span class="comment">// Cryptography outcome (Encrypted PIN)</span></div>
<div class="line"> </div>
<div class="line">19  <span class="comment">// &#39;Control&#39; byte of selected application</span></div>
<div class="line"> </div>
<div class="line">20  <span class="comment">// Kernel configuration byte</span></div>
<div class="line"> </div>
<div class="line">21  <span class="comment">// RFU</span></div>
<div class="line"> </div>
<div class="line">22  <span class="comment">// RFU</span></div>
<div class="line"> </div>
<div class="line">23  <span class="comment">// RFU</span></div>
</div><!-- fragment --><pre class="fragment">// Kernel debug data
// Identifiers for each debug byte
EMVL2_STATUS_ICCSW1    0  // ICC SW1
EMVL2_STATUS_ICCSW2    1  // ICC SW2
EMVL2_STATUS_L1EXIT    2  // Level 1 exit status
EMVL2_STATUS_KEXIT     3  // Kernel exit status
EMVL2_STATUS_PROG      4  // Bitmap indicating transaction progress
EMVL2_STATUS_CRYPT     5  // Status of certificate recovery
EMVL2_STATUS_CVM       6  // Status of CVM process
EMVL2_STATUS_SCRIPT    7  // Status of script processing
EMVL2_STATUS_GAC1REQ   8  // 1st GenerateAC cryptogram type requested.
EMVL2_STATUS_GAC1RSP   9  // 1st GenerateAC cryptogram type received.
EMVL2_STATUS_GAC2REQ  10  // 2nd GenerateAC cryptogram type requested.
EMVL2_STATUS_GAC2RSP  11  // 2nd GenerateAC cryptogram type received.
EMVL2_STATUS_AUX1     12  // Auxiliary debug data
EMVL2_STATUS_CSTAGE   13  // Cryptography operation
EMVL2_STATUS_CSTAT1   14  // Cryptography outcome (Data Authentication)
EMVL2_STATUS_ZKASTEP1 15  // ZKA debug "Step" data
EMVL2_STATUS_ZKASTEP2 16  // ZKA debug "Sub-step" data
EMVL2_STATUS_AUX2     17  // Yet another auxiliary debug data byte
EMVL2_STATUS_CSTAT2   18  // Cryptography outcome (Encrypted PIN)
EMVL2_STATUS_ACONTROL 19  // 'Control' byte of selected application
EMVL2_STATUS_KCONFIG  20  // Kernel configuration byte
EMVL2_STATUS_AUX3     21  // RFU
EMVL2_STATUS_AUX4     22  // RFU
EMVL2_STATUS_AUX5     23  // RFU


// Kernel exit status values [byte 3]
L2ES_00  0x00 // Exit status not defined

// Select PSE (01 - 0F)
L2ES_01  0x01 // Select PSE, L1 Error 
L2ES_02  0x02 // Select PSE, Card blocked 
L2ES_03  0x03 // Select PSE, Non EMV card detected
L2ES_04  0x04 // Candidate list full
L2ES_05  0x05 // Candidate list empty 
L2ES_06  0x06 // Auto select only candidate
L2ES_07  0x07 // Auto select first candidate
L2ES_08  0x08 // Manual selection by user required
                      
// Final Select (10 - 1F)
L2ES_10  0x10 // Final select, L1 Error
L2ES_11  0x11 // Final select, application successfully selected
L2ES_12  0x12 // Final select, non EMV Card detected
L2ES_13  0x13 // Final select, card blocked
L2ES_14  0x14 // Final select, mandatory data (tag 84) missing
L2ES_15  0x15 // Final select, card AID differs from that requested
L2ES_16  0x16 // Final select, bad parameter values supplied by user
                      
// Get Processing Options (20 - 2F)
L2ES_20  0x20 // GPO, L1 error
L2ES_21  0x21 // GPO, Bad SW12 response 
L2ES_22  0x22 // GPO, Conditions of use not satisfied (6985)
L2ES_23  0x23 // GPO, parsing error
L2ES_24  0x24 // GPO, mandatory data missing (tag 82 and tag 94)
L2ES_25  0x25 // GPO, bad AFL length
L2ES_26  0x26 // GPO, bad AFL format

// Read Records (30 - 3F)
L2ES_30  0x30 // Read Records, L1 error
L2ES_31  0x31 // Read Records, Bad SW12 response 
L2ES_32  0x32 // Read Records, mandatory data Exp Date || PAN || CDOL1 || CDOL2 missing
L2ES_33  0x33 // Read Records, parsing error 

// Data authentication (40 - 4F)
L2ES_40  0x40 // Internal authenticate, L1 error
L2ES_41  0x41 // Internal authenticate, Bad SW12 response 
L2ES_42  0x42 // Internal authenticate, DDOL syntax error
L2ES_43  0x43 // Internal authenticate, parsing error

// Cardholder Verification (50 - 5F)
L2ES_50  0x50 // CVM, bad parameter supplied
L2ES_51  0x51 // CVM, bad CVM list format
L2ES_52  0x52 // Online PIN, unknown state encountered
L2ES_53  0x53 // User error, offline PIN, functionality no longer supported
L2ES_54  0x54 // External PED reports ICC L1 error
L2ES_55  0x55 // Get PTC, L1 error 
L2ES_56  0x56 // Verify, L1 error
L2ES_57  0x57 // Verify, bad SW12
L2ES_58  0x58 // Verify, SW1 = '63' but bad SW2 value    
L2ES_59  0x59 // Get Challenge, L1 error

// Validate transaction (60 - 6F)
L2ES_60  0x60 // VT, bad parameter supplied
L2ES_61  0x61 // Get Data ATC, L1 error
L2ES_62  0x62 // Get Data LOATC, L1 error

// Action analysis (70 - 8F)
L2ES_70  0x70 // Bad parameter supplied
L2ES_71  0x71 // GenAC1 CDOL1 syntax error
L2ES_72  0x72 // GenAC1 L1 error
L2ES_73  0x73 // GenAC1 Bad SW12
L2ES_74  0x74 // GenAC1 SW12 = 6985
L2ES_75  0x75 // GenAC1 parsing error
L2ES_76  0x76 // GenAC1 logic error
L2ES_77  0x77 // GenAC1 Mandatory data missing (9F26)
L2ES_78  0x78 // GenAC1 Mandatory data missing (9F27, 9F36)
L2ES_79  0x79 // GenAC1 Mandatory data missing (9F4B)
L2ES_7A  0x7A // GenAC1 Accept
L2ES_7B  0x7B // GenAC1 Decline
L2ES_7C  0x7C // GenAC1 Forced Decline
L2ES_7D  0x7D // GenAC1 Unknown card response
L2ES_7E  0x7E // GenAC1 Online

// Complete Online Txn (90 - AF)
L2ES_90  0x90 // Bad parameter supplied
L2ES_91  0x91 // GenAC2 CDOL2 syntax error
L2ES_92  0x92 // GenAC2 L1 error
L2ES_93  0x93 // GenAC2 Bad SW12
L2ES_94  0x94 // GenAC2 SW12 = 6985
L2ES_95  0x95 // GenAC2 parsing error
L2ES_96  0x96 // GenAC2 logic error
L2ES_97  0x97 // GenAC2 Mandatory data missing (9F26)
L2ES_98  0x98 // GenAC2 Mandatory data missing (9F27, 9F36)
L2ES_99  0x99 // GenAC2 Mandatory data missing (9F4B)
L2ES_9A  0x9A // GenAC2 Accept
L2ES_9B  0x9B // GenAC2 Decline
L2ES_9C  0x9C // GenAC2 Forced decline
L2ES_9D  0x9D // GenAC2 Unknown card response
                      
                      
// Bitmap values for transaction progress (PROG) byte [4] 
EMVL2_PROG_OT    0x01  // Complete online transaction has been attempted
EMVL2_PROG_AA    0x02  // Action analysis has been attempted
EMVL2_PROG_VT    0x04  // Validate transaction has been attempted
EMVL2_PROG_CV    0x08  // Cardholder verification has been attempted
EMVL2_PROG_DA    0x10  // Data authentication has been attempted
EMVL2_PROG_SA    0x20  // Final application selection has been attempted
EMVL2_PROG_LOA   0x40  // List of AIDs processing has been attempted
EMVL2_PROG_PSE   0x80  // PSE processing has been attempted 


// Values for cryptography (CRYPT) byte [5]
// Bits 0 and 1 used to store authentication method as follows
EMVL2_CRYPT_NONE         0  // (00)  No method performed
EMVL2_CRYPT_SDA          1  // (01)  SDA attempted
EMVL2_CRYPT_DDA          2  // (10)  DDA attempted
EMVL2_CRYPT_GENAC_DDA    3  // (11)  Combined GenAC/DDA attempted

// Bits 2 - 7 are a bitmap defined as follows
EMVL2_CRYPT_DD2_REC   0x04  // (Cert 05) Signed dynamic data (DDA/GenAC2)
EMVL2_CRYPT_DD1_REC   0x08  // (Cert 05) Signed dynamic data (DDA - DDA/GenAC1)
EMVL2_CRYPT_PIN_REC   0x10  // (Cert 04) PIN encryption public key recovered
EMVL2_CRYPT_ICC_REC   0x20  // (Cert 04) ICC public key recovered
EMVL2_CRYPT_SSD_REC   0x40  // (Cert 03) Signed static data recovered
EMVL2_CRYPT_ISS_REC   0x80  // (Cert 02) Issuer public key recovered

//Values for Cardholder Verification (CVM) byte [6]
EMVL2_CVM_NONE        0x01  // Method "No CVM Required" requested
EMVL2_CVM_FAIL        0x02  // Method "Fail CVM Always" requested
EMVL2_CVM_SIGN        0x04  // Method "Signatrue" requested
EMVL2_CVM_OFPP        0x08  // Method "Offline Plain text PIN" requested
EMVL2_CVM_OFEP        0x10  // Method "Offline encrypted PIN" requested
EMVL2_CVM_ONEP        0x20  // Method "Online encrypted requested"
EMVL2_CVM_SIGRQD      0x40  // Txn should request signature at end of txn                             
EMVL2_CVM_PINKEY      0x80  // PIN encryption key identified and successfully recovered

//Values for Script processing (SCRIPT) byte [7]
EMVL2_SCRIPT_71SREC   0x01  // Type 71 script received
EMVL2_SCRIPT_72SREC   0x02  // Type 72 script received
EMVL2_SCRIPT_71PERR   0x04  // Type 71 script parsing error
EMVL2_SCRIPT_72PERR   0x08  // Type 72 script parsing error
EMVL2_SCRIPT_71SRUN   0x10  // Type 71 script run
EMVL2_SCRIPT_72SRUN   0x20  // Type 72 script run
EMVL2_SCRIPT_71SERR   0x40  // Type 71 script run error
EMVL2_SCRIPT_72SERR   0x80  // Type 72 script run error

// Values for Aux byte 1 [12]
EMVL2_CAPK_MISSING    0x01  // Cert auth public key not found
EMVL2_CAPK_EXPIRED    0x02  // Cert auth PK expired
EMVL2_CAPK_BADHASH    0x04  // Cert auth PK has incorrect hash value
EMVL2_IPKC_REVOKED    0x08  // Issuer public key certificate revoked
EMVL2_AUTH_RECBAD     0x10  // Record nominated for data authentication not present in tag 70 
EMVL2_HASH_OVRFLOW    0x20  // Hash input data memory overflow
EMVL2_TDH_OVRFLOW     0x40  // TDH Hash input buffer overflow 
EMVL2_CERT_MISMATCH   0x80  // CDA encrypted and clear certificate types do not match 


// Values for cryptography operation byte  [13]
EMVL2_CRYPTO_NODATA   0x00 // No cryptography operation requested
EMVL2_CRYPTO_STORE1   0x01 // Store signed card records
EMVL2_CRYPTO_STORE2   0x02 // Store SDA Tag List
EMVL2_CRYPTO_STORE3   0x03 // Store TDOL input data (CDOL1)
EMVL2_CRYPTO_STORE4   0x04 // Store TDOL input data (CDOL2)
EMVL2_CRYPTO_STORE5   0x05 // Store TDH data (PDOL)
EMVL2_CRYPTO_STORE6   0x06 // Store TDH data (CDOL1)
EMVL2_CRYPTO_STORE7   0x07 // Store TDH data (CDOL2)
EMVL2_CRYPTO_STORE8   0x08 // Store TDH data (GenAC response)
EMVL2_CRYPTO_HASH0    0x0A // Hash kernel checksum 
EMVL2_CRYPTO_HASH1    0x0B // Hash public key

EMVL2_CRYPTO_RSA2     0x10 // Recover issuer public key certificate 02
EMVL2_CRYPTO_HASH2    0x11 // Hash issuer public key certificate 02
EMVL2_CRYPTO_RSA3     0x20 // Recover signed static data certificate 03
EMVL2_CRYPTO_HASH3    0x21 // Hash signed static data certificate 03
EMVL2_CRYPTO_RSA4a    0x30 // Recover ICC public key certificate 04
EMVL2_CRYPTO_HASH4a   0x31 // Hash ICC public key certificate 04   
EMVL2_CRYPTO_RSA4b    0x40 // Recover PIN public key certificate 04
EMVL2_CRYPTO_HASH4b   0x41 // Hash PIN public key certificate 04
EMVL2_CRYPTO_RSA5a    0x50 // Recover DDA certificate 05
EMVL2_CRYPTO_HASH5a   0x51 // Hash DDA signed certificate 05
EMVL2_CRYPTO_RSA5b    0x60 // Recover CDA certificate 05 (GenAC1)
EMVL2_CRYPTO_HASH6    0x61 // Hash TDOL in CDOL1         (GenAC1) 
EMVL2_CRYPTO_HASH5c   0x62 // Hash CDA certificate 05    (GenAC1)
EMVL2_CRYPTO_HASH5b   0x63 // Hash CDA transaction data  (GenAC1)
EMVL2_CRYPTO_RSA5c    0x70 // Recover CDA certificate 05 (GenAC2)
EMVL2_CRYPTO_HASH7    0x71 // Hash TDOL in CDOL2         (GenAC1) 
EMVL2_CRYPTO_HASH5e   0x72 // Hash CDA certificate 05    (GenAC2)
EMVL2_CRYPTO_HASH5d   0x73 // Hash CDA transaction data  (GenAC2)
EMVL2_CRYPTO_RSA6     0x80 // Encrypt PIN using ICC public key
EMVL2_CRYPTO_RSA7     0x90 // Encrypt PIN using PIN public key

// Kernel checksum
EMVL2_CHKSUM_PARAM    0xA0 // Bad parameters supplied
EMVL2_CHKSUM_TTYPE    0xA1 // Terminal type (tag 9F35) absent
EMVL2_CHKSUM_TCAP     0xA2 // Terminal Capabilities (tag 9F33) absent
EMVL2_CHKSUM_ATCAP    0xA3 // Additional terminal capabilities absent
EMVL2_CHKSUM_APCAP    0xA4 // Application capabilities absent
EMVL2_CHKSUM_HASH1    0xA5 // Hash checksum op 1
EMVL2_CHKSUM_HASH2    0xA6 // Hash checksum op 2
EMVL2_CHKSUM_HASH3    0xA7 // Hash checksum op 3
EMVL2_CHKSUM_HASH4    0xA8 // Hash checksum op 4
EMVL2_CHKSUM_HASH5    0xA9 // Hash checksum op 5
EMVL2_CHKSUM_HASH6    0xAA // Hash checksum op 6
EMVL2_CHKSUM_RSA1     0xAB // RSA  checksum op 1
EMVL2_CHKSUM_RSA2     0xAC // RSA  checksum op 2



// Values for cryptography result byte [14] 
//      EMVL2_CRYPTO_NODATA   0x00 // No cryptography result available

// Pre RSA Checks
EMVL2_CRYPTO_NOCERT   0x01 // Encrypted certificate missing
EMVL2_CRYPTO_NOINDEX  0x02 // Public key index missing
EMVL2_CRYPTO_PKERR    0x03 // Public key error (See aux byte 1 for error details)
EMVL2_CRYPRO_BADLEN   0x04 // Data and key lengths differ
EMVL2_CRYPTO_NOEXP    0x05 // Public exponent required to validate hash is missing
#define EMVL2_CRYPRO_BADEXP   0x06 // Public exponent value other than 3 or 2^16+1

// RSA or Hash in progress
EMVL2_CRYPTO_WAITING  0x10 // Crypto calculation in progress

// Post RSA Errors
EMVL2_CRYPTO_NOTBC    0x20 // Footer is not 'BC'
EMVL2_CRYPTO_NOT6A    0x21 // Header is not '6A'
EMVL2_CRYPTO_BADCERT  0x22 // Incorrect certificate type '02, 03' etc
EMVL2_CRYPTO_BADPKALG 0x23 // Unknown public key algorithm
EMVL2_CRYPTO_CERTEXPD 0x24 // Certificate has expired
EMVL2_CRYPTO_BADPAN   0x25 // Decrypted and Transaction PANs differ
EMVL2_CRYPTO_BADCID   0x26 // Plain text and encrypted CIDs do not match
EMVL2_CRYPTO_NOREMAIN 0x27 // Required remainder missing
EMVL2_CRYPTO_DDSHORT  0x28 // ICC Dynamic Data too short
EMVL2_CRYPTO_DNSHORT  0x29 // ICC Dynamic Number too short 
EMVL2_CRYPTO_DNLONG   0x2A // ICC Dynamic Number too long 
EMVL2_CRYPTO_BADDATE  0x2B // Incorrect expiry date format
EMVL2_CRYPTO_CERTRVKD 0x2C // Iss PK Cert revoked 
                                   
//----------------------------0x30 // RFU
//----------------------------0x31 // RFU
//----------------------------0x32 // RFU
//----------------------------0x33 // RFU

// SHA Errors
EMVL2_CRYPTO_MEMFULL  0x40 // Memory overflow while storing hash input data
EMVL2_CRYPTO_BADHASH  0x41 // Decrypted and calculated hash values differ

// Final outcomes
EMVL2_CRYPTO_SUCCESS  0x90 // Certificate successfully recovered and validated
EMVL2_CRYPTO_DONE     0x91 // Crypto operation complete
                                   
// Bytes [15] and [16]
// These bytes hold the ZKA Step and Sub-step information which can be used to determine the 
// most recent smart card command transmitted by the kernel.
// Byte [15]    Byte [16]   SmartCard Command
// 20              xx       List of AIDs - Select
// 21              xx       PSE - Select
// 22              xx       PSE - Read Record
// 30              00       Final Select
// 40              00       Get Processing Options
// 50              xx       Read Record
// 60              00       Internal Authenticate
// 70              01       Get Data - PIN Try Counter
// 71              00       Get Challenge
// 72              10       Verify - Encrypted offline PIN
// 72              20       Verify - Plaintext PIN
// 80              01       Get Data - ATC
// 80              02       Get Data - LOATC
// 90              01       GenerateAC1 (Non CDA)
// 90              11       GenerateAC1 (CDA)
// 90              02       GenerateAC2 (Non CDA)
// 90              12       GenerateAC2 (CDA)
// A0              00       External Authenticate
// B1              xx       Type 71 (Critical) Issuer script command
// B2              xx       Type 72 (Non critical) Issuer script command
// Note
// 'xx' indicates a counter value which is incremented each time that the corresponding 
// smart card command is transmitted by the kernel.
 

// Aux 2 Debug byte [17]
EMVL2_ADT_FORMERR     0x01 // Insufficient memory to format additional tag store
EMVL2_ADT_MULTI       0x02 // Multiple tag definition detected
EMVL2_ADT_TAGERR      0x04 // Additional tag definition error
EMVL2_SPR_MEMFULL     0x08 // Script processing results memory full
EMVL2_CVM_MISSING     0x10 // CVM list missing or contains only X and Y values
EMVL2_CVM_FORMAT      0x20 // CVM list contains format error
// -----------------------    0x80 // RFU
// -----------------------    0x80 // RFU
</pre><h1><a class="anchor" id="sec_emv_ct_Appendix"></a>
Appendix</h1>
<h2><a class="anchor" id="subsec_ct_Serialized_Interface_Basics"></a>
Serialized Interface Basics</h2>
<p>This chapter contains programming guidelines for the ADK EMV Contactless framework.</p>
<h3><a class="anchor" id="subsubsec_ct_serif_Basic_Format"></a>
Basic Format</h3>
<p>The EMV Application Layer is based on ISO 7816 or APDU. The command and response pairs have the following formats:</p>
<table class="doxtable">
<tr>
<td>CLA </td><td>INS </td><td>P1 </td><td>P2 </td><td>DATA  </td></tr>
</table>
<p><b>Figure: EMV Application Command</b></p>
<table class="doxtable">
<tr>
<td>DATA </td><td>SW1 </td><td>SW2  </td></tr>
</table>
<p><b>Figure: EMV Application Response</b></p>
<p>The main features are:</p><ul>
<li><b>CLA:</b> Class of command</li>
<li><b>INS:</b> Specific Instruction within a class</li>
<li><b>P1:</b> Parameter 1</li>
<li><b>P2:</b> Parameter 2</li>
<li><b>Data:</b> Command data or Response data</li>
<li><b>SW1:</b> Status word 1</li>
<li><b>SW2:</b> Status word 2.</li>
</ul>
<p>Values for CLA, INS, P1, P2 or defined in <a class="el" href="group___a_d_k___t_r_a_n_s_p_o_r_t___t_a_g_s.html">Tags for transport layer</a></p>
<h3><a class="anchor" id="subsubsec_ct_serif_Basic_Flows"></a>
Basic Flows</h3>
<p>The command and response pair must have a standard flow:</p>
<div class="image">
<img src="06_emv_ct_EMV_Application_Command_and_Response.png" alt=""/>
<div class="caption">
Figure: EMV Application Command and Response</div></div>
   <p>The Application Protocol must also have a callback flow required for EMV:</p>
<div class="image">
<img src="07_emv_ct_EMV_Application_Command_and_Response_with_Callback.png" alt=""/>
<div class="caption">
Figure: EMV Application Command and Response with Callback</div></div>
   <h3><a class="anchor" id="subsubsec_ct_serif_Status_Words"></a>
Status Words</h3>
<p>The following standard status words are used:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">SW1 </th><th class="markdownTableHeadNone">SW2 </th><th class="markdownTableHeadNone">Meaning  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">x00 </td><td class="markdownTableBodyNone">All OK  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">x90 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Function executed xx = response code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x91 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Callback Request  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">x92 </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">Callback Response  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">xXX </td><td class="markdownTableBodyNone">any other use case specific error code  </td></tr>
</table>
<h3><a class="anchor" id="subsubsec_ct_serif_Data_Coding"></a>
Data Coding</h3>
<p>The data stream is BER-TLV (ISO/IEC 8825) encoded. Both Primitive and Constructed TLVs are used. All data are included in the xF0 Constructed Tag.</p>
<h3><a class="anchor" id="subsubsec_ct_serif_P1_P2_Coding"></a>
P1-P2 Coding</h3>
<p>These 2 bytes are coded as:</p>
<div class="image">
<img src="06_emv_ctls_P1_P2_Coding.png" alt=""/>
<div class="caption">
Figure: P1-P2 Coding</div></div>
   <p><br  />
</p>
<h3><a class="anchor" id="subsubsec_ct_serif_Data_conversion"></a>
Conversion Of Data Objects</h3>
<p>All tags defined by EMVCo follow the EMVCo rules. For other tags please follow the length in the function description. The following rules for length apply: byte = 1 byte, short = 2 byte, long = 4 byte. All serial data have in field[0] have the most significant value. Example:, follow the 9F02 for the EMV amount of a transaction, where in amount[5] is the cent value and in amount[0] the highest BCD number</p>
<h2><a class="anchor" id="subsec_emv_ct_Config_AppliData_specialTrx"></a>
Configuration of application data: special transaction</h2>
<p>See <a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#ab10831fed2998962919365d261912869">EMV_CT_APPLIDATA_STRUCT::xuc_Special_TRX</a></p>
<p>Example how to interpret <a class="el" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga6cc01afa0601ada21584df60dd9a5a2a" title="Default setting, for interpretation see Configuration of application data: special transaction .">EMV_ADK_TRX_CONFIG_DEFAULT</a></p>
<ul>
<li>Byte 1: 0x21<ul>
<li>Higher nibble: 2 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7202569b2762f206a2285efa29fb2bc2">EMV_ADK_EMV_ADK_MANUAL_REVERSAL_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gafa96196deed546963b891e4e003c4af9">EMV_ADK_MANUAL_REVERSAL_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga997cfbf7b11c32d41485cefcc76a9dde">EMV_ADK_MANUAL_REVERSAL_B</a> </div>
</div><!-- fragment --></li>
<li>Lower nibble: 1 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaaeca402b298b32204ccd7ead5099711a">EMV_ADK_REFUND_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7039e7109163f62d9e9b1ae75d2c5b9e">EMV_ADK_REFUND_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gab876922d002680ba54292d9a0d59ab58">EMV_ADK_REFUND_YES</a> </div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Byte 2: 0x20<ul>
<li>Higher nibble: 2 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae346012c0d19fa6f7eb45b91931cdd2a">EMV_ADK_EMV_ADK_RESERVATION_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga8883a4abbc4c9a4ff1d0d04d293551fe">EMV_ADK_RESERVATION_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga1293a1632952de877c91dbc35ccf1aa8">EMV_ADK_RESERVATION_A_PLUS</a> </div>
</div><!-- fragment --></li>
<li>Lower nibble: 0 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga94e977d7738de920e0fb4014df66e4fb">EMV_ADK_TIP_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7244e0c110d753f37865fa24333fd2ec">EMV_ADK_TIP_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga89c93daaa639b2689e0e8b09acb9d20a">EMV_ADK_TIP_NO</a> </div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Byte 3: 0x11<ul>
<li>Higher nibble: 1 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaf93007826337d6c58ca7b846b84fa656">EMV_ADK_REFERRAL_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae1efb0a95d1fc749c9cbf26346ca1719">EMV_ADK_REFERRAL_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae9e243d4a817340c4ff493d32af9eeeb">EMV_ADK_REFERRAL_YES</a> </div>
</div><!-- fragment --></li>
<li>Lower nibble: 1 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga38142b9746b0c7f21dbc5fc636384b54">EMV_ADK_VOICEAUT_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaae6e9d4466ac1cd32a3ada32c5bbe102">EMV_ADK_VOICEAUT_NIBBLE</a>) == EMV_ADK_VOICEAUT_YES </div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Byte 4: 0x00<ul>
<li>Higher nibble: 0 <br  />
 not used</li>
<li>Lower nibble: 0 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gabacf717c5dc2ac7384db3e832da09477">EMV_ADK_FALLBACK_AFTER_CVM_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga5f66d7a538a6c040c5a82ca9715938cb">EMV_ADK_FALLBACK_AFTER_CVM_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga9415cd28524e3d7ddf572591090e92a4">EMV_ADK_FALLBACK_AFTER_CVM_NO</a> </div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Byte 5: 0x00<ul>
<li>Higher nibble: 0 <br  />
 <div class="fragment"><div class="line">xuc_Special_TRX[<a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaad39a4d4fb662a2ea5e08f0701b230e0">EMV_ADK_IGNORE_CARD_ERROR_BYTE</a>] <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#gab1f5eb6ff8bb92e90599b438f237e479">EMV_ADK_IGNORE_CARD_ERROR_NIBBLE</a>) == <a class="code" href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga70b113f6808165477ba42a659a8a414c">EMV_ADK_IGNORE_CARD_ERROR_NO</a> </div>
</div><!-- fragment --></li>
<li>Lower nibble: 0 <br  />
 not used</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_Related_Documentation"></a>
Related Documentation</h2>
<p>To learn more about the ADK EMV framework, please refer to the following documents:</p>
<ul>
<li><a href="./pg_emv_contact_users_guide.html" title="ADK-EMV Contact Programmers Guide">ADK-EMV Contact Programmers Guide</a> this document </li>
<li><a href="./pg_emv_contactless_users_guide.html" title="ADK-EMV Contactless Programmers Guide">ADK-EMV Contactless Programmers Guide</a> </li>
<li><a href="./pg_tec_programmers_guide.html" title="ADK-TEC Programmers Guide">ADK-TEC Programmers Guide</a> </li>
<li><a href="./pg_msr_programmers_guide.html" title="ADK-MSR Programmers Guide">ADK-MSR Programmers Guide</a> </li>
<li><a href="./pg_nfc_users_guide.html" title="ADK-NFC Programmers Guide">ADK-NFC Programmers Guide</a> </li>
<li><a href="./pg_sdi_users_guide.html" title="ADK-SDI Programmers Guide">ADK-SDI Programmers Guide</a> </li>
<li><a href="./pg_sdiclient_users_guide.html" title="ADK-SDI-Client Programmers Guide">ADK-SDI-Client Programmers Guide</a></li>
</ul>
<h2><a class="anchor" id="subsec_emv_ct_Acronym_Definitions"></a>
Acronym Definitions</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Acronym </th><th class="markdownTableHeadNone">Definitions  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AAC </td><td class="markdownTableBodyNone">Application Authentication Cryptogram  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AAR </td><td class="markdownTableBodyNone">Application Authorization Referral  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AC </td><td class="markdownTableBodyNone">Application Cryptogram  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ADK </td><td class="markdownTableBodyNone">Application Development Kit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AES </td><td class="markdownTableBodyNone">Advanced Encryption Standard  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AFL </td><td class="markdownTableBodyNone">Algorithm Application File Locator  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AID </td><td class="markdownTableBodyNone">Application Identifier  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AIP </td><td class="markdownTableBodyNone">Application Interchange Profile  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">APDU </td><td class="markdownTableBodyNone">Application Protocol Data Unit  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">API </td><td class="markdownTableBodyNone">Application Protocol Interface  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ARM </td><td class="markdownTableBodyNone">Advanced RISC Machines  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ARQC </td><td class="markdownTableBodyNone">Authorization Request Cryptogram  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ASI </td><td class="markdownTableBodyNone">Application Selection Indicator  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ATR </td><td class="markdownTableBodyNone">Answer To Reset  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BER-TLV </td><td class="markdownTableBodyNone">Basic Encoding Rules - Tag Length Value  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CAPK </td><td class="markdownTableBodyNone">Certification Authority Public Key as in the EMV standard  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CBC </td><td class="markdownTableBodyNone">Cipher Block Chaining mode, as defined in ANSI X3.106  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CDA </td><td class="markdownTableBodyNone">Combined Dynamic Data Authentication  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CID </td><td class="markdownTableBodyNone">Cryptogram Information Data  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CVM </td><td class="markdownTableBodyNone">Cardholder Verification Method  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DA </td><td class="markdownTableBodyNone">Data Authentication  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DDA </td><td class="markdownTableBodyNone">Dynamic Data Authentication  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DEA/DES </td><td class="markdownTableBodyNone">Data Encryption Algorithm/Standard, as defined in ANSI X3.92  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DOL </td><td class="markdownTableBodyNone">Data Object List  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DDOL </td><td class="markdownTableBodyNone">Dynamic Data Authentication Data Object List  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DUKPT </td><td class="markdownTableBodyNone">Derived Unique Key Per Transaction  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">EMV </td><td class="markdownTableBodyNone">Joint Europay, MasterCard and Visa Standard  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FCI </td><td class="markdownTableBodyNone">File Control Information  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IAC </td><td class="markdownTableBodyNone">Issuer Action Code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ICC </td><td class="markdownTableBodyNone">Integrated Circuit Card (Smart Card)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IFD </td><td class="markdownTableBodyNone">Interface Device  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MAC </td><td class="markdownTableBodyNone">Message Authentication Code, as defined in ANSI X9.19  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MMU </td><td class="markdownTableBodyNone">Memory Management Unit  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OS </td><td class="markdownTableBodyNone">Operating System  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PAN </td><td class="markdownTableBodyNone">Primary Account Number  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PED </td><td class="markdownTableBodyNone">PIN Entry Device  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PDOL </td><td class="markdownTableBodyNone">Processing Options Data Object List  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PIN </td><td class="markdownTableBodyNone">Personal Identification Number  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">POS </td><td class="markdownTableBodyNone">Point-of-Sale  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PRD </td><td class="markdownTableBodyNone">Product Requirement Document  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PSE </td><td class="markdownTableBodyNone">Payment System Environment  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">RID </td><td class="markdownTableBodyNone">Registered Application Provider Identifier  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RSA </td><td class="markdownTableBodyNone">Rivest, Shamir and Adelman offline data authentication public key algorithm  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SOC </td><td class="markdownTableBodyNone">System on Chip  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SAM </td><td class="markdownTableBodyNone">Secure Access Module  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SC </td><td class="markdownTableBodyNone">Smart Card (Integrated Chip Card)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SDA </td><td class="markdownTableBodyNone">Static Data Authentication  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SDK </td><td class="markdownTableBodyNone">Software Development Kit  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SW1, SW2 </td><td class="markdownTableBodyNone">Status Bytes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TAC </td><td class="markdownTableBodyNone">Terminal Action Code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TC </td><td class="markdownTableBodyNone">Transaction Certificate  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TDOL </td><td class="markdownTableBodyNone">Transaction Certificate Data Object List  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TLV </td><td class="markdownTableBodyNone">Tag Length Value  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TVR </td><td class="markdownTableBodyNone">Terminal Verification Results  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UI </td><td class="markdownTableBodyNone">User Interface  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USB </td><td class="markdownTableBodyNone">Universal Serial Bus  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">XML </td><td class="markdownTableBodyNone">Extensible Markup Language  </td></tr>
</table>
<h1><a class="anchor" id="section_emv_ct_EMV_ADK_API_Table"></a>
Table of API functions</h1>
<p><b> Interface functions: </b> <br  />
 </p><table border="5" cellspacing="2" cellpadding="2">
<tr>
<th align="left">Topic  </th><th align="left">CLA INS  </th><th colspan="2" align="left">Structures respectively functions   </th></tr>
<tr>
<td colspan="4"></td></tr>
<tr>
<th align="left">INITIALIZE EMV FRAMEWORK </th><th>39 00 </th><td colspan="2"><a class="el" href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592" title="Initialize EMV ADK.">EMV_CT_Init_Framework()</a>, <a class="el" href="group___f_u_n_c___i_n_i_t.html#gaad2d6cdd1249528199d5dc969e48b43c" title="Kernel deactivation.">EMV_CT_Exit_Framework()</a>   </td></tr>
<tr>
<td colspan="4"></td></tr>
<tr>
<th align="left">CONFIGURE TERMINAL DATA </th><th>39 01 </th><td><a class="el" href="group___d_e_f___c_o_n_f___t_e_r_m.html#struct_e_m_v___c_t___t_e_r_m_d_a_t_a___s_t_r_u_c_t" title="struct for interface to EMV_CT_SetTermData() and EMV_CT_GetTermData()">EMV_CT_TERMDATA_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___c_o_n_f.html#ga351c2deba9865081c314d818463f20c9" title="Set terminal specific data and perform verification and saving of data.">EMV_CT_SetTermData()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga954c82bc82203115b10fcab356df0079" title="Get configured terminal data.">EMV_CT_GetTermData()</a>   </td></tr>
<tr>
<th align="left">CONFIGURE APPLICATION DATA </th><th>39 02 </th><td><a class="el" href="group___d_e_f___c_o_n_f___a_p_p_l_i.html#struct_e_m_v___c_t___a_p_p_l_i_d_a_t_a___s_t_r_u_c_t" title="Structure for configuration of one single application   see EMV_CT_SetAppliData()">EMV_CT_APPLIDATA_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___c_o_n_f.html#ga73ca1735defbb65a1aae2ead1de70233" title="Set application specific data and perform verification and saving of data.   Has to be called once pe...">EMV_CT_SetAppliData()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga363163e375895b7d3ad03ace5df5d0d3" title="Get configured application data   Has to be called once per application (Visa, MasterCard,...">EMV_CT_GetAppliData()</a>  </td></tr>
<tr>
<th align="left">CONFIGURE CAP KEYS </th><th>39 03 </th><td><a class="el" href="group___d_e_f___c_a_r_d___c_o_n_f.html#struct_e_m_v___c_t___c_a_p_k_e_y___s_t_r_u_c_t" title="Data structure CAP keys.">EMV_CT_CAPKEY_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___c_o_n_f.html#gade5b2bbc6ab46c4b7d9efa991b696ad2" title="Stores the specified CAP key.">EMV_CT_StoreCAPKey()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga429a19bcd6b86ff1f165ff681ae6c79a" title="Reads CAP keys.">EMV_CT_ReadCAPKeys()</a>, <a class="el" href="group___f_u_n_c___c_o_n_f.html#ga597af0018e1df21cfbd7e52fd4756c9a" title="Reads CAP key information.">EMV_CT_GetCAPKeyInfo()</a>   </td></tr>
<tr>
<th align="left">SAVE ADK CONFIG </th><th>39 04 </th><td></td><td><a class="el" href="group___f_u_n_c___c_o_n_f.html#ga3170974cb7a73a9dec8f881295cc1cac" title="Write configuration to files.">EMV_CT_ApplyConfiguration()</a>   </td></tr>
<tr>
<th align="left">GET ADK VERSION </th><th>39 05 </th><th colspan="2" align="left"><a class="el" href="group___f_u_n_c___i_n_i_t.html#ga36754df7722826d8264b5a00f7455312" title="Get contact framework version.">EMV_CT_FRAMEWORK_GetVersion()</a>, without CLA INS: <a class="el" href="group___f_u_n_c___i_n_i_t.html#ga732afcde31cd447a8221c0d19a1463b3" title="Get contact client version.">EMV_CT_CLIENT_GetVersion()</a>   </th></tr>
<tr>
<th align="left">SET VIRTUAL TERMINAL MAP </th><th>39 06 </th><th colspan="2" align="left"><a class="el" href="group___f_u_n_c___c_o_n_f.html#gab5d29810043af901c08736d4e9337353" title="Changes the Virtual Terminal Map.">EMV_CT_MapVirtualTerminal()</a>   </th></tr>
<tr>
<td colspan="4"></td></tr>
<tr>
<th align="left" rowspan="9">TRANSACTION COMMANDS </th><th>39 10 </th><td><a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___s_e_l_e_c_t___s_t_r_u_c_t" title="struct for interface to EMV_CT_StartTransaction()">EMV_CT_SELECT_STRUCT</a>, <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___s_e_l_e_c_t_r_e_s___s_t_r_u_c_t" title="result data of EMV_CT_StartTransaction()">EMV_CT_SELECTRES_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb" title="EMV Application Selection.">EMV_CT_StartTransaction()</a> </td></tr>
<tr>
<th>39 11 </th><td><a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___t_r_a_n_s_a_c___s_t_r_u_c_t" title="Structure for call of EMV_CT_ContinueOffline()">EMV_CT_TRANSAC_STRUCT</a>, <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___t_r_a_n_s_r_e_s___s_t_r_u_c_t" title="Data structure for output data of EMV_CT_ContinueOffline() and EMV_CT_ContinueOnline()">EMV_CT_TRANSRES_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006" title="EMV transaction (offline part including 1st cryptogram)">EMV_CT_ContinueOffline()</a>   </td></tr>
<tr>
<th>39 12 </th><td><a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___h_o_s_t___s_t_r_u_c_t" title="Data structure for host response data. Input for EMV_CT_ContinueOnline()">EMV_CT_HOST_STRUCT</a>, <a class="el" href="group___a_d_k___t_r_x___e_x_e_c.html#struct_e_m_v___c_t___t_r_a_n_s_r_e_s___s_t_r_u_c_t" title="Data structure for output data of EMV_CT_ContinueOffline() and EMV_CT_ContinueOnline()">EMV_CT_TRANSRES_STRUCT</a> </td><td><a class="el" href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4" title="EMV transaction (handling of host response including 2nd cryptogram)">EMV_CT_ContinueOnline()</a>   </td></tr>
<tr>
<th>39 13 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#gad3dd36d27d5fa94d3f302dc4a4546b70" title="Update one or several kernel tags during transaction.">EMV_CT_updateTxnTags()</a>   </td></tr>
<tr>
<th>39 14 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5" title="Fetch one or several tags at the end of the transaction.">EMV_CT_fetchTxnTags()</a>   </td></tr>
<tr>
<th>39 15 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#gaec319989542c7681715566de387d7f69" title="End transaction.">EMV_CT_EndTransaction()</a>   </td></tr>
<tr>
<th>39 16 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#gac8f6430c652d6dad621ca3c0cf367346" title="Get additional candidate information for reducing, resorting or displaying the mutual candidate list.">EMV_CT_GetCandidateData()</a>   </td></tr>
<tr>
<th>39 17 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#gad55c11dd44dbba66d6fefeb48b01a9e4" title="Do List Of Application processing for a single terminal AID.">EMV_CT_CheckSupportedAID()</a>   </td></tr>
<tr>
<th>39 18 </th><td colspan="2">optional: <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga1af2b496d37337cff4fb8b9407ed933d" title="Retrieve formatted transaction data at the end of the transaction.">EMV_CT_fetchTxnDOL()</a>   </td></tr>
<tr>
<th align="left">TRANSACTION CALLBACKS </th><th></th><td colspan="2"><a class="el" href="adk__emv__contactless__programmers__guide_8dox.html#a591fd0f380cd390007ce78b47be923c4">EMV_CT_CALLBACK_FnT</a>, PIN handling: <a class="el" href="group___f_u_n_c___f_l_o_w.html#ga895cb054c344d011e9e3c6acc4aadafe" title="Send entered (offline) PIN to chip card for verification.">EMV_CT_Send_PIN_Offline()</a>   <br  />
 </td></tr>
<tr>
<td colspan="4"><br  />
 </td></tr>
<tr>
<th align="left">TRANSPARENT ICC COMMANDS </th><th>41 xx</th><td colspan="2"><a class="el" href="group___f_u_n_c___i_c_c.html#ga728923e6e6be8867cf954b7c8d4414d5" title="send chip card command and receive response">EMV_CT_SmartISO()</a> 41 03, <a class="el" href="group___f_u_n_c___i_c_c.html#ga62577d8d938685a65dd2b326cb03522d" title="Detect if chip card is inserted in card reader (in readable position)">EMV_CT_SmartDetect()</a> 41 01, <a class="el" href="group___f_u_n_c___i_c_c.html#gaa63515431ea6f33b113fa7af5562db11" title="Detect if chip card is inserted in card reader (read ATR)">EMV_CT_SmartReset()</a> 41 02, <a class="el" href="group___f_u_n_c___i_c_c.html#gab99f6946bd7815a64a54be66652c2840" title="Deactivate chip card.">EMV_CT_SmartPowerOff()</a> 41 04   </td></tr>
</table>
<p><br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_ga71e47e61824568f46a9c9ed547ef206b"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga71e47e61824568f46a9c9ed547ef206b">EMV_CT_PIN_INPUT_TIMEOUT</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_TIMEOUT</div><div class="ttdoc">Timeout.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:139</div></div>
<div class="ttc" id="agroup__vfigui_html_gga83f7c4e297519549c9a54137e2eab4feae72b16ac91ed2f069ed4e315c0a66879"><div class="ttname"><a href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4feae72b16ac91ed2f069ed4e315c0a66879">UI_ERR_CANCELLED</a></div><div class="ttdeci">@ UI_ERR_CANCELLED</div><div class="ttdef"><b>Definition:</b> gui_error.h:27</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bdab97b324cf4cec94f5e8ed7a3f9a307e8"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdab97b324cf4cec94f5e8ed7a3f9a307e8">vfigui::UI_PROP_PIN_ALGORITHM</a></div><div class="ttdeci">@ UI_PROP_PIN_ALGORITHM</div><div class="ttdef"><b>Definition:</b> gui.h:572</div></div>
<div class="ttc" id="agroup__vfigui_html_gga83f7c4e297519549c9a54137e2eab4fea25c0f4789a50189db529c844fbc5395b"><div class="ttname"><a href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea25c0f4789a50189db529c844fbc5395b">UI_ERR_TIMEOUT</a></div><div class="ttdeci">@ UI_ERR_TIMEOUT</div><div class="ttdef"><b>Definition:</b> gui_error.h:22</div></div>
<div class="ttc" id="agroup___c_t_i_n_i_t___o_p_t_i_o_n_s_html_ga2e45cc21dd0264a8d3a8c90c733d4f8c"><div class="ttname"><a href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga2e45cc21dd0264a8d3a8c90c733d4f8c">EMV_CT_INIT_OPT_TRACE</a></div><div class="ttdeci">#define EMV_CT_INIT_OPT_TRACE</div><div class="ttdoc">Callback trace (TAG_BF7F_CBK_TRACE), switch on EMV trace. Only effective in case of deactivated EMV_C...</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:1642</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gabacf717c5dc2ac7384db3e832da09477"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gabacf717c5dc2ac7384db3e832da09477">EMV_ADK_FALLBACK_AFTER_CVM_BYTE</a></div><div class="ttdeci">#define EMV_ADK_FALLBACK_AFTER_CVM_BYTE</div><div class="ttdoc">byte for configuration of &quot;fallback to magstripe after start of cardholder verification or early PIN ...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:227</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga94e977d7738de920e0fb4014df66e4fb"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga94e977d7738de920e0fb4014df66e4fb">EMV_ADK_TIP_BYTE</a></div><div class="ttdeci">#define EMV_ADK_TIP_BYTE</div><div class="ttdoc">byte for configuration of tip (gratuity)</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:217</div></div>
<div class="ttc" id="amd5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="md5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> md5.cpp:81</div></div>
<div class="ttc" id="agroup___f_u_n_c___i_c_c_html_ga62577d8d938685a65dd2b326cb03522d"><div class="ttname"><a href="group___f_u_n_c___i_c_c.html#ga62577d8d938685a65dd2b326cb03522d">EMV_CT_SmartDetect</a></div><div class="ttdeci">DLL_CTC unsigned char EMV_CT_SmartDetect(unsigned char ucOptions)</div><div class="ttdoc">Detect if chip card is inserted in card reader (in readable position)</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga997cfbf7b11c32d41485cefcc76a9dde"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga997cfbf7b11c32d41485cefcc76a9dde">EMV_ADK_MANUAL_REVERSAL_B</a></div><div class="ttdeci">#define EMV_ADK_MANUAL_REVERSAL_B</div><div class="ttdoc">future use</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:237</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gaaeca402b298b32204ccd7ead5099711a"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaaeca402b298b32204ccd7ead5099711a">EMV_ADK_REFUND_BYTE</a></div><div class="ttdeci">#define EMV_ADK_REFUND_BYTE</div><div class="ttdoc">byte for configuration of refund</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:212</div></div>
<div class="ttc" id="agroup___f_u_n_c___i_n_i_t_html_ga514e39585c5a6b79632ac317593ff592"><div class="ttname"><a href="group___f_u_n_c___i_n_i_t.html#ga514e39585c5a6b79632ac317593ff592">EMV_CT_Init_Framework</a></div><div class="ttdeci">#define EMV_CT_Init_Framework(numberOfAIDs, EMV_Callback, externalData, options)</div><div class="ttdoc">Initialize EMV ADK.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:1678</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gab1f5eb6ff8bb92e90599b438f237e479"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gab1f5eb6ff8bb92e90599b438f237e479">EMV_ADK_IGNORE_CARD_ERROR_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_IGNORE_CARD_ERROR_NIBBLE</div><div class="ttdoc">nibble for configuration of &quot;ignore card error after issuer authorization&quot;</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:231</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gae9e243d4a817340c4ff493d32af9eeeb"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae9e243d4a817340c4ff493d32af9eeeb">EMV_ADK_REFERRAL_YES</a></div><div class="ttdeci">#define EMV_ADK_REFERRAL_YES</div><div class="ttdoc">voice referral allowed   not used for contactless</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:256</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bda4f3d2b9a8136f3a8606e9ba8e66371d4"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bda4f3d2b9a8136f3a8606e9ba8e66371d4">vfigui::UI_PROP_PIN_BYPASS_KEY</a></div><div class="ttdeci">@ UI_PROP_PIN_BYPASS_KEY</div><div class="ttdef"><b>Definition:</b> gui.h:567</div></div>
<div class="ttc" id="agroup___f_e_t_c_h___t_a_g_s___o_p_t_i_o_n_s_html_ga21aa8da8d69f7acd9d8e13b9543df5c0"><div class="ttname"><a href="group___f_e_t_c_h___t_a_g_s___o_p_t_i_o_n_s.html#ga21aa8da8d69f7acd9d8e13b9543df5c0">EMV_ADK_FETCHTAGS_NO_EMPTY</a></div><div class="ttdeci">#define EMV_ADK_FETCHTAGS_NO_EMPTY</div><div class="ttdoc">In case no data is found for a given TLV tag: don't include this tag in the output.</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:491</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga1293a1632952de877c91dbc35ccf1aa8"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga1293a1632952de877c91dbc35ccf1aa8">EMV_ADK_RESERVATION_A_PLUS</a></div><div class="ttdeci">#define EMV_ADK_RESERVATION_A_PLUS</div><div class="ttdoc">reservation variant a (without partial reversal) allowed, amount increment (Reservierung-Erhoehung) a...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:243</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_ga6e1606e2c165d4f4af132d23f6585e37"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6e1606e2c165d4f4af132d23f6585e37">EMV_CT_PIN_INPUT_COMM_ERR</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_COMM_ERR</div><div class="ttdoc">Communication error.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:136</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_ga5364807f6ce1265fa8f8e0228db9717c"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga5364807f6ce1265fa8f8e0228db9717c">EMV_CT_PIN_INPUT_BYPASS</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_BYPASS</div><div class="ttdoc">Customer chose &quot;bypass PIN entry&quot;.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:138</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_gaed61dc1a7482b607ebad612b3f2d7508"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#gaed61dc1a7482b607ebad612b3f2d7508">EMV_CT_PIN_INPUT_ABORT</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_ABORT</div><div class="ttdoc">Customer canceled.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:137</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_ga6d46e6b2aa75de94de0855301068a093"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga6d46e6b2aa75de94de0855301068a093">EMV_CT_PIN_INPUT_OKAY</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_OKAY</div><div class="ttdoc">PIN input was successful.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:135</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bdab3831f55519a8d598508668fa914dae1"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdab3831f55519a8d598508668fa914dae1">vfigui::UI_PROP_PASSWORD_CHAR</a></div><div class="ttdeci">@ UI_PROP_PASSWORD_CHAR</div><div class="ttdef"><b>Definition:</b> gui.h:563</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___i_n_p_u_t_html_ga370e1133a282c765ec9f12605b172e3a"><div class="ttname"><a href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga370e1133a282c765ec9f12605b172e3a">EMV_CT_CVM_CUSTOM</a></div><div class="ttdeci">#define EMV_CT_CVM_CUSTOM</div><div class="ttdoc">Custom CVM, the highest bit indicates the custom CVM, byte 0...3 indicates the custom CVM method.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:127</div></div>
<div class="ttc" id="anamespacevfigui_html_af5812cac4b8cd48873fcac4608f3082d"><div class="ttname"><a href="namespacevfigui.html#af5812cac4b8cd48873fcac4608f3082d">vfigui::uiInvokeURL</a></div><div class="ttdeci">DllSpec int uiInvokeURL(int display, int region_id, stringmap &amp;value, const char *url, uiCallback cb=0, void *cbdata=0)</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gaad39a4d4fb662a2ea5e08f0701b230e0"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaad39a4d4fb662a2ea5e08f0701b230e0">EMV_ADK_IGNORE_CARD_ERROR_BYTE</a></div><div class="ttdeci">#define EMV_ADK_IGNORE_CARD_ERROR_BYTE</div><div class="ttdoc">byte for configuration of &quot;ignore card error after issuer authorization&quot;</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:230</div></div>
<div class="ttc" id="agroup___s_m_a_r_t___s_t_a_t_u_s_html_ga7096828cd20d1b879bf0c781ba8405be"><div class="ttname"><a href="group___s_m_a_r_t___s_t_a_t_u_s.html#ga7096828cd20d1b879bf0c781ba8405be">EMV_ADK_SMART_STATUS_OK</a></div><div class="ttdeci">#define EMV_ADK_SMART_STATUS_OK</div><div class="ttdoc">okay (== comms ok == card in == card activated ... )</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:476</div></div>
<div class="ttc" id="agroup___c_t_i_n_i_t___o_p_t_i_o_n_s_html_ga9b2576e36b0771a53249ff7b448197fd"><div class="ttname"><a href="group___c_t_i_n_i_t___o_p_t_i_o_n_s.html#ga9b2576e36b0771a53249ff7b448197fd">EMV_CT_INIT_OPT_TRACE_CLT</a></div><div class="ttdeci">#define EMV_CT_INIT_OPT_TRACE_CLT</div><div class="ttdoc">Callback trace (TAG_BF7F_CBK_TRACE), switch on client trace. Only effective in case of deactivated EM...</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:1643</div></div>
<div class="ttc" id="agroup__vfigui_html_gga83f7c4e297519549c9a54137e2eab4fea0e9295b37bfaa07f3b8e2b2f666bcb08"><div class="ttname"><a href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea0e9295b37bfaa07f3b8e2b2f666bcb08">UI_ERR_OK</a></div><div class="ttdeci">@ UI_ERR_OK</div><div class="ttdef"><b>Definition:</b> gui_error.h:19</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_gab005fdec183a0c8fef18ae677cce6dc5"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#gab005fdec183a0c8fef18ae677cce6dc5">EMV_CT_fetchTxnTags</a></div><div class="ttdeci">DLL_CTC EMV_ADK_INFO EMV_CT_fetchTxnTags(unsigned long options, unsigned long *requestedTags, unsigned short noOfRequestedTags, unsigned char *tlvBuffer, unsigned short bufferLength, unsigned short *tlvDataLength)</div><div class="ttdoc">Fetch one or several tags at the end of the transaction.</div></div>
<div class="ttc" id="anamespacevficom_1_1cmdparam_1_1in_1_1ussd__write_html_aa2ad567d2728772e7ce46242b9f5e83a"><div class="ttname"><a href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#aa2ad567d2728772e7ce46242b9f5e83a">vficom::cmdparam::in::ussd_write::str</a></div><div class="ttdeci">const COM3_DllSpec char str[]</div><div class="ttdoc">string, optional</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga7244e0c110d753f37865fa24333fd2ec"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7244e0c110d753f37865fa24333fd2ec">EMV_ADK_TIP_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_TIP_NIBBLE</div><div class="ttdoc">nibble for configuration of tip (gratuity)</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:218</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga89c93daaa639b2689e0e8b09acb9d20a"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga89c93daaa639b2689e0e8b09acb9d20a">EMV_ADK_TIP_NO</a></div><div class="ttdeci">#define EMV_ADK_TIP_NO</div><div class="ttdoc">tip (gratuity) forbidden: Transactions with EMV_ADK_TRAN_TYPE_TIP are handled like ordinary EMV_ADK_T...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:248</div></div>
<div class="ttc" id="agroup___a_d_k___r_e_t___c_o_d_e_html_ga1456bb13b42906927f8a8942169b62e7"><div class="ttname"><a href="group___a_d_k___r_e_t___c_o_d_e.html#ga1456bb13b42906927f8a8942169b62e7">EMV_ADK_OK</a></div><div class="ttdeci">#define EMV_ADK_OK</div><div class="ttdoc">Function successful, no error.</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:66</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___i_n_p_u_t_html_gaf2bc706ea385477040fc5fa2a0b272c2"><div class="ttname"><a href="group___a_d_k___p_i_n___i_n_p_u_t.html#gaf2bc706ea385477040fc5fa2a0b272c2">EMV_CT_PIN_INPUT_ENCIPHERED</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_ENCIPHERED</div><div class="ttdoc">Offline enciphered PIN.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:124</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bdacd0735c01cf5c93d28977026ba79a648"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdacd0735c01cf5c93d28977026ba79a648">vfigui::UI_PROP_TIMEOUT</a></div><div class="ttdeci">@ UI_PROP_TIMEOUT</div><div class="ttdef"><b>Definition:</b> gui.h:562</div></div>
<div class="ttc" id="amd5_8cpp_html_a0a143972cb6c4fe16f0ffa8a3d41ebf3"><div class="ttname"><a href="md5_8cpp.html#a0a143972cb6c4fe16f0ffa8a3d41ebf3">FF</a></div><div class="ttdeci">#define FF(a, b, c, d, x, s, ac)</div><div class="ttdef"><b>Definition:</b> md5.cpp:95</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga7202569b2762f206a2285efa29fb2bc2"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7202569b2762f206a2285efa29fb2bc2">EMV_ADK_EMV_ADK_MANUAL_REVERSAL_BYTE</a></div><div class="ttdeci">#define EMV_ADK_EMV_ADK_MANUAL_REVERSAL_BYTE</div><div class="ttdoc">byte for configuration of manual reversal</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:210</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gaf93007826337d6c58ca7b846b84fa656"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaf93007826337d6c58ca7b846b84fa656">EMV_ADK_REFERRAL_BYTE</a></div><div class="ttdeci">#define EMV_ADK_REFERRAL_BYTE</div><div class="ttdoc">byte for configuration of referral   not used for contactless</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:220</div></div>
<div class="ttc" id="anamespacevficom_1_1cmdparam_1_1in_1_1ussd__write_html_a024d40cda59916fb9470299c7338d3e3"><div class="ttname"><a href="namespacevficom_1_1cmdparam_1_1in_1_1ussd__write.html#a024d40cda59916fb9470299c7338d3e3">vficom::cmdparam::in::ussd_write::n</a></div><div class="ttdeci">const COM3_DllSpec char n[]</div><div class="ttdoc">integer</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___i_n_p_u_t_html_ga6e50037ec9acfb5dc5af7e8738ce3f12"><div class="ttname"><a href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga6e50037ec9acfb5dc5af7e8738ce3f12">EMV_CT_PIN_INPUT_ONLINE</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_ONLINE</div><div class="ttdoc">Online enciphered PIN.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:122</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gae1efb0a95d1fc749c9cbf26346ca1719"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae1efb0a95d1fc749c9cbf26346ca1719">EMV_ADK_REFERRAL_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_REFERRAL_NIBBLE</div><div class="ttdoc">nibble for configuration of referral   not used for contactless</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:221</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga9415cd28524e3d7ddf572591090e92a4"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga9415cd28524e3d7ddf572591090e92a4">EMV_ADK_FALLBACK_AFTER_CVM_NO</a></div><div class="ttdeci">#define EMV_ADK_FALLBACK_AFTER_CVM_NO</div><div class="ttdoc">No fallback to magstripe after start cardholder verification or early PIN entry.   Take care: EMV_CT_...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:261</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gaae6e9d4466ac1cd32a3ada32c5bbe102"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gaae6e9d4466ac1cd32a3ada32c5bbe102">EMV_ADK_VOICEAUT_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_VOICEAUT_NIBBLE</div><div class="ttdoc">nibble for configuration of voice authorization   not used for contactless</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:223</div></div>
<div class="ttc" id="agroup___t_l_v___c_a_l_l_b_c_k_html_ga3ff52ae040bd291d348e505e057f02ef"><div class="ttname"><a href="group___t_l_v___c_a_l_l_b_c_k.html#ga3ff52ae040bd291d348e505e057f02ef">EMV_CT_CALLBACK_FnT</a></div><div class="ttdeci">void(* EMV_CT_CALLBACK_FnT)(unsigned char *pucSend, unsigned short sSendSize, unsigned char *pucReceive, unsigned short *psReceiveSize, void *externalData)</div><div class="ttdoc">Common callback function: send/receive TLV stream to/from calling application.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Link.h:45</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bda03bb51eea83f5cb9f2f47f9a6fc6add5"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bda03bb51eea83f5cb9f2f47f9a6fc6add5">vfigui::UI_PROP_PIN_CLEAR_ALL</a></div><div class="ttdeci">@ UI_PROP_PIN_CLEAR_ALL</div><div class="ttdef"><b>Definition:</b> gui.h:566</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___i_n_p_u_t_html_ga5e82e9ba31d25d95371f61030d0132b2"><div class="ttname"><a href="group___a_d_k___p_i_n___i_n_p_u_t.html#ga5e82e9ba31d25d95371f61030d0132b2">EMV_CT_PIN_INPUT_PLAIN</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_PLAIN</div><div class="ttdoc">Offline plaintext PIN.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:123</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_gac13472c2a4aea6475fe7bb52627e97eb"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#gac13472c2a4aea6475fe7bb52627e97eb">EMV_CT_StartTransaction</a></div><div class="ttdeci">DLL_CTC EMV_ADK_INFO EMV_CT_StartTransaction(EMV_CT_SELECT_TYPE *pxSelectInput, EMV_CT_SELECTRES_TYPE *pxSelectRes)</div><div class="ttdoc">EMV Application Selection.</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_ga895cb054c344d011e9e3c6acc4aadafe"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#ga895cb054c344d011e9e3c6acc4aadafe">EMV_CT_Send_PIN_Offline</a></div><div class="ttdeci">DLL_CTC unsigned char EMV_CT_Send_PIN_Offline(unsigned char *pucPINResultData)</div><div class="ttdoc">Send entered (offline) PIN to chip card for verification.</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_ga8c9f0640ed818c3dc19da528f5f0b406"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#ga8c9f0640ed818c3dc19da528f5f0b406">EMV_CTLS_fetchTxnTags</a></div><div class="ttdeci">DLL_CLC EMV_ADK_INFO EMV_CTLS_fetchTxnTags(unsigned long options, unsigned long *requestedTags, unsigned short noOfRequestedTags, unsigned char *tlvBuffer, unsigned short bufferLength, unsigned short *tlvDataLength)</div><div class="ttdoc">Fetch one or several tags at the end of the transaction.</div></div>
<div class="ttc" id="agroup__vfigui_html_gga83f7c4e297519549c9a54137e2eab4fea6dc64819a8719e862f267b4c31adaa2b"><div class="ttname"><a href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4fea6dc64819a8719e862f267b4c31adaa2b">UI_ERR_ABORT</a></div><div class="ttdeci">@ UI_ERR_ABORT</div><div class="ttdef"><b>Definition:</b> gui_error.h:20</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga8883a4abbc4c9a4ff1d0d04d293551fe"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga8883a4abbc4c9a4ff1d0d04d293551fe">EMV_ADK_RESERVATION_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_RESERVATION_NIBBLE</div><div class="ttdoc">nibble for configuration of reservation</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:216</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga38142b9746b0c7f21dbc5fc636384b54"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga38142b9746b0c7f21dbc5fc636384b54">EMV_ADK_VOICEAUT_BYTE</a></div><div class="ttdeci">#define EMV_ADK_VOICEAUT_BYTE</div><div class="ttdoc">byte for configuration of voice authorization   not used for contactless</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:222</div></div>
<div class="ttc" id="agroup___a_d_k___r_e_t___c_o_d_e_html_ga7045deba09a19eea4f7df8881a08b807"><div class="ttname"><a href="group___a_d_k___r_e_t___c_o_d_e.html#ga7045deba09a19eea4f7df8881a08b807">EMV_ADK_ABORT</a></div><div class="ttdeci">#define EMV_ADK_ABORT</div><div class="ttdoc">On transaction function it means that current transaction must be aborted.   On configuration functio...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:125</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gae346012c0d19fa6f7eb45b91931cdd2a"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gae346012c0d19fa6f7eb45b91931cdd2a">EMV_ADK_EMV_ADK_RESERVATION_BYTE</a></div><div class="ttdeci">#define EMV_ADK_EMV_ADK_RESERVATION_BYTE</div><div class="ttdoc">byte for configuration of reservation</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:215</div></div>
<div class="ttc" id="anamespacevfigui_html_ac94648784fbac056c2d259dbfc3e50aa"><div class="ttname"><a href="namespacevfigui.html#ac94648784fbac056c2d259dbfc3e50aa">vfigui::uiSetPropertyInt</a></div><div class="ttdeci">DllSpec int uiSetPropertyInt(int display, enum UIPropertyInt property, int value)</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_ga42f570d2b8e66841ab9e8de7736e92d4"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#ga42f570d2b8e66841ab9e8de7736e92d4">EMV_CT_ContinueOnline</a></div><div class="ttdeci">DLL_CTC EMV_ADK_INFO EMV_CT_ContinueOnline(EMV_CT_HOST_TYPE *pxOnlineInput, EMV_CT_TRANSRES_TYPE *pxTransRes)</div><div class="ttdoc">EMV transaction (handling of host response including 2nd cryptogram)</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga70b113f6808165477ba42a659a8a414c"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga70b113f6808165477ba42a659a8a414c">EMV_ADK_IGNORE_CARD_ERROR_NO</a></div><div class="ttdeci">#define EMV_ADK_IGNORE_CARD_ERROR_NO</div><div class="ttdoc">Transaction decline on card error after issuer authorization.</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:264</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga5f66d7a538a6c040c5a82ca9715938cb"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga5f66d7a538a6c040c5a82ca9715938cb">EMV_ADK_FALLBACK_AFTER_CVM_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_FALLBACK_AFTER_CVM_NIBBLE</div><div class="ttdoc">nibble for configuration of &quot;fallback to magstripe after start of cardholder verification or early PI...</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:228</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_ga7039e7109163f62d9e9b1ae75d2c5b9e"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#ga7039e7109163f62d9e9b1ae75d2c5b9e">EMV_ADK_REFUND_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_REFUND_NIBBLE</div><div class="ttdoc">nibble for configuration of refund</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:213</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gab876922d002680ba54292d9a0d59ab58"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gab876922d002680ba54292d9a0d59ab58">EMV_ADK_REFUND_YES</a></div><div class="ttdeci">#define EMV_ADK_REFUND_YES</div><div class="ttdoc">refund allowed</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:239</div></div>
<div class="ttc" id="agroup___a_d_k___p_i_n___r_e_t_u_r_n_html_ga783dde28172a0a5cbe376bd56ece1a90"><div class="ttname"><a href="group___a_d_k___p_i_n___r_e_t_u_r_n.html#ga783dde28172a0a5cbe376bd56ece1a90">EMV_CT_PIN_INPUT_OTHER_ERR</a></div><div class="ttdeci">#define EMV_CT_PIN_INPUT_OTHER_ERR</div><div class="ttdoc">Other error.</div><div class="ttdef"><b>Definition:</b> EMV_CT_Interface.h:140</div></div>
<div class="ttc" id="anamespacevfisdi_html_a28287671eaf7406afd604bd055ba4066"><div class="ttname"><a href="namespacevfisdi.html#a28287671eaf7406afd604bd055ba4066">vfisdi::Result</a></div><div class="ttdeci">Result</div><div class="ttdef"><b>Definition:</b> sdi_enum.h:10</div></div>
<div class="ttc" id="agroup__vfigui_html_gga83f7c4e297519549c9a54137e2eab4feab947423fdbe03bf4ee7d4132a7470271"><div class="ttname"><a href="group__vfigui.html#gga83f7c4e297519549c9a54137e2eab4feab947423fdbe03bf4ee7d4132a7470271">UI_ERR_PERMISSION</a></div><div class="ttdeci">@ UI_ERR_PERMISSION</div><div class="ttdef"><b>Definition:</b> gui_error.h:26</div></div>
<div class="ttc" id="anamespacevfigui_html_a0c064fcc5409b0845e11925a55f324bdad99992968807353cde482f423dca5f2c"><div class="ttname"><a href="namespacevfigui.html#a0c064fcc5409b0845e11925a55f324bdad99992968807353cde482f423dca5f2c">vfigui::UI_PROP_PIN_AUTO_ENTER</a></div><div class="ttdeci">@ UI_PROP_PIN_AUTO_ENTER</div><div class="ttdef"><b>Definition:</b> gui.h:565</div></div>
<div class="ttc" id="agroup___f_u_n_c___f_l_o_w_html_ga8be6df6babc587a19f63f284b2a6f006"><div class="ttname"><a href="group___f_u_n_c___f_l_o_w.html#ga8be6df6babc587a19f63f284b2a6f006">EMV_CT_ContinueOffline</a></div><div class="ttdeci">DLL_CTC EMV_ADK_INFO EMV_CT_ContinueOffline(EMV_CT_TRANSAC_TYPE *pxTransactionInput, EMV_CT_TRANSRES_TYPE *pxTransRes)</div><div class="ttdoc">EMV transaction (offline part including 1st cryptogram)</div></div>
<div class="ttc" id="agroup___s_p_e_c_i_a_l___t_r_x_s_html_gafa96196deed546963b891e4e003c4af9"><div class="ttname"><a href="group___s_p_e_c_i_a_l___t_r_x_s.html#gafa96196deed546963b891e4e003c4af9">EMV_ADK_MANUAL_REVERSAL_NIBBLE</a></div><div class="ttdeci">#define EMV_ADK_MANUAL_REVERSAL_NIBBLE</div><div class="ttdoc">nibble for configuration of manual reversal</div><div class="ttdef"><b>Definition:</b> EMV_Common_Interface.h:211</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Application Development Kit (ADK)</a></li><li class="navelem"><a class="el" href="system_overview.html">System Overview</a></li><li class="navelem"><a class="el" href="pg_all_components.html">ADK Components</a></li>
    <li class="footer">Generated on Mon Jun 16 2025 16:04:01 for ADK-Programmers-Guides by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
